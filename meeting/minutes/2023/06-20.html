<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>QT4 CG Meeting 039 Minutes 2023-06-20</title>
<meta name="generator" content="Org Mode" />
<link rel="stylesheet" type="text/css" href="/meeting/css/htmlize.css"/>
<link rel="stylesheet" type="text/css" href="../../../css/style.css"/>
<link rel="shortcut icon" href="/img/QT4-64.png" />
<link rel="apple-touch-icon" sizes="64x64" href="/img/QT4-64.png" type="image/png" />
<link rel="apple-touch-icon" sizes="76x76" href="/img/QT4-76.png" type="image/png" />
<link rel="apple-touch-icon" sizes="120x120" href="/img/QT4-120.png" type="image/png" />
<link rel="apple-touch-icon" sizes="152x152" href="/img/QT4-152.png" type="image/png" />
</head>
<body>
<div id="content" class="content">
<h1 class="title">QT4 CG Meeting 039 Minutes 2023-06-20</h1>
<div id="table-of-contents" role="doc-toc">
<h2>Table of Contents</h2>
<div id="text-table-of-contents" role="doc-toc">
<ul>
<li><a href="#minutes">Draft Minutes</a></li>
<li><a href="#new-actions">Summary of new and continuing actions <code>[0/5]</code></a></li>
<li><a href="#administrivia">1. Administrivia</a>
<ul>
<li><a href="#roll-call">1.1. Roll call <code>[10/11]</code></a></li>
<li><a href="#agenda">1.2. Accept the agenda</a>
<ul>
<li><a href="#so-far">1.2.1. Status so far…</a></li>
</ul>
</li>
<li><a href="#approve-minutes">1.3. Approve minutes of the previous meeting</a></li>
<li><a href="#next-meeting">1.4. Next meeting</a></li>
<li><a href="#open-actions">1.5. Review of open action items <code>[3/8]</code></a></li>
<li><a href="#open-pull-requests">1.6. Review of open pull requests and issues</a></li>
</ul>
</li>
<li><a href="#technical-agenda">2. Technical Agenda</a>
<ul>
<li><a href="#parse-csv">2.1. PR #533: 413: Spec for CSV parsing with fn:parse-csv()</a></li>
</ul>
</li>
<li><a href="#any-other-business">3. Any other business?</a></li>
<li><a href="#adjourned">4. Adjourned</a></li>
</ul>
</div>
</div>
<p>
<a href="../">Agenda index</a> / <a href="https://qt4cg.org">QT4CG.org</a> / <a href="https://qt4cg.org/dashboard">Dashboard</a> / <a href="https://github.com/qt4cg/qtspecs/issues">GH Issues</a> / <a href="https://github.com/qt4cg/qtspecs/pulls">GH Pull Requests</a>
</p>

<div id="outline-container-minutes" class="outline-2">
<h2 id="minutes">Draft Minutes</h2>
<div class="outline-text-2" id="text-minutes">
</div>
</div>

<div id="outline-container-new-actions" class="outline-2">
<h2 id="new-actions">Summary of new and continuing actions <code>[0/5]</code></h2>
<div class="outline-text-2" id="text-new-actions">
<ul class="org-ul">
<li class="off"><code>[&#xa0;]</code> QT4CG-002-10: BTW to coordinate some ideas about improving diversity in the group</li>
<li class="off"><code>[&#xa0;]</code> QT4CG-016-08: RD to clarify how namespace comparisons are performed.</li>
<li class="off"><code>[&#xa0;]</code> QT4CG-026-01: MK to write a summary paper that outlines the decisions we need to make on “value sequences”
<ul class="org-ul">
<li>This is related to PR #368: Issue 129 - Context item generalized to context value and
subsequent discussion.</li>
</ul></li>
<li class="off"><code>[&#xa0;]</code> QT4CG-029-01: RD+DN to draft spec prose for the “divide and conquer” approach outlined in issue #399</li>
<li class="off"><code>[&#xa0;]</code> QT4CG-029-07: NW to open the next discussion of #397 with a demo from DN
See PR <a href="https://qt4cg.org/dashboard/#pr-449">#449</a></li>
</ul>
</div>
</div>

<div id="outline-container-administrivia" class="outline-2">
<h2 id="administrivia"><span class="section-number-2">1.</span> Administrivia</h2>
<div class="outline-text-2" id="text-administrivia">
</div>

<div id="outline-container-roll-call" class="outline-3">
<h3 id="roll-call"><span class="section-number-3">1.1.</span> Roll call <code>[10/11]</code></h3>
<div class="outline-text-3" id="text-roll-call">
<p>
Regrets DN.
</p>

<ul class="org-ul">
<li class="on"><code>[X]</code> Reece Dunn (RD)</li>
<li class="on"><code>[X]</code> Sasha Firsov (SF)</li>
<li class="on"><code>[X]</code> Christian Grün (CG)</li>
<li class="on"><code>[X]</code> Joel Kalvesmaki (JK) [0:10-]</li>
<li class="on"><code>[X]</code> Michael Kay (MK)</li>
<li class="on"><code>[X]</code> John Lumley (JL)</li>
<li class="off"><code>[&#xa0;]</code> Dimitre Novatchev (DN)</li>
<li class="on"><code>[X]</code> Matt Patterson (MP)</li>
<li class="on"><code>[X]</code> Ed Porter (EP)</li>
<li class="on"><code>[X]</code> C. M. Sperberg-McQueen (MSM)</li>
<li class="on"><code>[X]</code> Norm Tovey-Walsh (NW). <i>Scribe</i>. <i>Chair</i>.</li>
</ul>
</div>
</div>

<div id="outline-container-agenda" class="outline-3">
<h3 id="agenda"><span class="section-number-3">1.2.</span> Accept the agenda</h3>
<div class="outline-text-3" id="text-agenda">
<p>
Proposal: Accept <a href="../../agenda/2023/06-20.html">the agenda</a>.
</p>

<p>
Accepted.
</p>
</div>

<div id="outline-container-so-far" class="outline-4">
<h4 id="so-far"><span class="section-number-4">1.2.1.</span> Status so far…</h4>
<div class="outline-text-4" id="text-so-far">

<div id="org8b3a769" class="figure">
<p><img src="./issues-open-2023-06-20.png" alt="issues-open-2023-06-20.png" />
</p>
<p><span class="figure-number">Figure 1: </span>“Burn down” chart on open issues</p>
</div>


<div id="orgd87d599" class="figure">
<p><img src="./issues-by-spec-2023-06-20.png" alt="issues-by-spec-2023-06-20.png" />
</p>
<p><span class="figure-number">Figure 2: </span>Open issues by specification</p>
</div>


<div id="org17141c1" class="figure">
<p><img src="./issues-by-type-2023-06-20.png" alt="issues-by-type-2023-06-20.png" />
</p>
<p><span class="figure-number">Figure 3: </span>Open issues by type</p>
</div>
</div>
</div>
</div>

<div id="outline-container-approve-minutes" class="outline-3">
<h3 id="approve-minutes"><span class="section-number-3">1.3.</span> Approve minutes of the previous meeting</h3>
<div class="outline-text-3" id="text-approve-minutes">
<p>
Proposal: Accept <a href="../../minutes/2023/06-13.html">the minutes of the previous meeting</a>.
</p>

<p>
Accepted.
</p>
</div>
</div>

<div id="outline-container-next-meeting" class="outline-3">
<h3 id="next-meeting"><span class="section-number-3">1.4.</span> Next meeting</h3>
<div class="outline-text-3" id="text-next-meeting">
<p>
The next meeting <a href="../../agenda/2023/06-27.html">is scheduled for Tuesday, 27 June 2023</a>.
</p>

<p>
No regrets heard.
</p>

<p>
Accepted.
</p>

<p>
Reminder: the CG will take a vacation for four weeks in August. We
will not meet on 1, 8, 15, or 22 August.
</p>
</div>
</div>

<div id="outline-container-open-actions" class="outline-3">
<h3 id="open-actions"><span class="section-number-3">1.5.</span> Review of open action items <code>[3/8]</code></h3>
<div class="outline-text-3" id="text-open-actions">
<ul class="org-ul">
<li class="off"><code>[&#xa0;]</code> QT4CG-002-10: BTW to coordinate some ideas about improving diversity in the group</li>
<li class="off"><code>[&#xa0;]</code> QT4CG-016-08: RD to clarify how namespace comparisons are performed.</li>
<li class="off"><code>[&#xa0;]</code> QT4CG-026-01: MK to write a summary paper that outlines the decisions we need to make on “value sequences”
<ul class="org-ul">
<li>This is related to PR #368: Issue 129 - Context item generalized to context value and
subsequent discussion.</li>
</ul></li>
<li class="off"><code>[&#xa0;]</code> QT4CG-029-01: RD+DN to draft spec prose for the “divide and conquer” approach outlined in issue #399</li>
<li class="off"><code>[&#xa0;]</code> QT4CG-029-07: NW to open the next discussion of #397 with a demo from DN
See PR <a href="https://qt4cg.org/dashboard/#pr-449">#449</a></li>
<li class="on"><code>[X]</code> QT4CG-035-01: CG to make a few more (slightly more complex) <code>map:keys</code> examples.</li>
<li class="on"><code>[X]</code> QT4CG-035-02: CG to fix the type signature and examples in <code>map:filter</code>.</li>
<li class="on"><code>[X]</code> QT4CG-038-01: NW to attempt to craft some sort of proposal for dealing with stale issues.
<ul class="org-ul">
<li><a href="https://lists.w3.org/Archives/Public/public-xslt-40/2023Jun/0012.html">https://lists.w3.org/Archives/Public/public-xslt-40/2023Jun/0012.html</a></li>
</ul></li>
</ul>
</div>
</div>

<div id="outline-container-open-pull-requests" class="outline-3">
<h3 id="open-pull-requests"><span class="section-number-3">1.6.</span> Review of open pull requests and issues</h3>
<div class="outline-text-3" id="text-open-pull-requests">
<p>
The following editorial or otherwise minor PRs were open when this
agenda was prepared. The chair proposes that these can be merged
without discussion.
</p>

<ul class="org-ul">
<li>PR <a href="https://qt4cg.org/dashboard/#pr-549">#549</a>: 526 load xquery module</li>
<li>PR <a href="https://qt4cg.org/dashboard/#pr-552">#552</a>: Editorial: Updates to back matter and status section of F+O spec</li>
<li>PR <a href="https://qt4cg.org/dashboard/#pr-551">#551</a>: Drop the fn:differences function</li>
<li>PR <a href="https://qt4cg.org/dashboard/#pr-550">#550</a>: 548: require parens around lambda arguments</li>
<li>PR <a href="https://qt4cg.org/dashboard/#pr-558">#558</a> Added fn:items-X cross-references</li>
<li>PR <a href="https://qt4cg.org/dashboard/#pr-559">#559</a> Minor editorial edits</li>
</ul>

<p>
Proposal: Accept these PRs.
</p>

<p>
Accepted.
</p>

<p>
It has been proposed that the following issues be <a href="https://github.com/qt4cg/qtspecs/labels/Propose%20Closing%20with%20No%20Action">closed without action</a>.
</p>

<ul class="org-ul">
<li>Iss <a href="https://github.com/qt4cg/qtspecs/issues/425">#425</a>: Structural proposal (ThinLayer™️) : Add a layer of thin spec between XPath and the XPath Derived Language</li>
<li>Iss <a href="https://github.com/qt4cg/qtspecs/issues/399">#399</a>: fn:deep-equal: Using Multilevel Hierarchy and Abstraction when designing and specifying complex functions</li>
<li>Iss <a href="https://github.com/qt4cg/qtspecs/issues/376">#376</a>: add documentation prefix attribute to xsl:stylesheet</li>
<li>Iss <a href="https://github.com/qt4cg/qtspecs/issues/331">#331</a>: Extend fn:path to support arrays and maps.</li>
<li>Iss <a href="https://github.com/qt4cg/qtspecs/issues/112">#112</a>: Abbreviate map:function($someMap) to $someMap?function()</li>
<li>Iss <a href="https://github.com/qt4cg/qtspecs/issues/82">#82</a>: Should the mode attribute for apply-templates in templates of enclosed modes default to #current?</li>
</ul>

<p>
An issue that is closed can always be reopened if someone, on further
consideration, decides it shouldn’t have been closed.
</p>

<ul class="org-ul">
<li>RD: I’d like to discuss issue 52.</li>
<li>NW: Ok, next week. (Removed from list.)</li>
</ul>

<p>
Proposal: Close these issues.
</p>

<p>
Accepted.
</p>
</div>
</div>
</div>

<div id="outline-container-technical-agenda" class="outline-2">
<h2 id="technical-agenda"><span class="section-number-2">2.</span> Technical Agenda</h2>
<div class="outline-text-2" id="text-technical-agenda">
<p>
This week’s focus is on two large PRs related to CSV and JSON. We
expect Matt Patterson to join us for the CSV discussions.
</p>
</div>

<div id="outline-container-parse-csv" class="outline-3">
<h3 id="parse-csv"><span class="section-number-3">2.1.</span> PR #533: 413: Spec for CSV parsing with fn:parse-csv()</h3>
<div class="outline-text-3" id="text-parse-csv">
<p>
See PR <a href="https://qt4cg.org/dashboard/#pr-533">#533</a>
</p>

<ul class="org-ul">
<li>MP: introduces the topic.
<ul class="org-ul">
<li>The format does not cleanly to our base XDM constructs; it’s weird
and poorly specified.</li>
<li>There’s an RFC which is really about any consistently delimited,
line-oriented text files.
<ul class="org-ul">
<li>The RFC is an attempt to catalog existing practice. It was rather Anglo-centric.</li>
<li>Also it failed to noticed that Microsoft Excel on the Mac doesn’t produce valid CSVs.</li>
<li>It’s been almost 20 years since it was published, work is underway to revise it.</li>
<li>The basic thing is that you need to be fairly liberal in your parsing.</li>
<li>Using the RFC as it exists as a basis for generation makes a lot
more sense than using it for parsing.</li>
</ul></li>
<li>I looked at bunch of parsers/generators in a bunch of languages
<ul class="org-ul">
<li>I’ve spent years working with Ruby’s version</li>
<li>Also looked at several Java parsers and the Python one</li>
<li>The simpler it can be, the better. A lot of time in other
language implementations is taken up with data transformations
and mappings from pure strings into native formats. I think as a
function provided by the language itself, we should stay away from that.</li>
<li>We just provide a collection of strings.</li>
<li>The convention that the first row is a set of column names is
pretty universally supported.</li>
<li>In most language implementations, what gets returned is an
object that behaves a bit like an object and a bit like an
array; which is something we don’t have.</li>
<li>We have to take a slightly more lispy approach and separate them</li>
</ul></li>
<li>I propose a function that takes a string and</li>
<li>Return a record that identifies the parts. If you ask the function
to treat the first row as column headers, you can use those names
to lookup fields.</li>
<li>We can abstract away some of that machinery by returning a
function that takes a name or column number.</li>
<li>There are questions about how to deal with duplicate names.
<ul class="org-ul">
<li>As far as I can see, the consensus in other languages is that
you take the first occurence of the name and discard the rest.</li>
<li>The other thing you need to provide is a complete record of that
first row so that you can construct the whole CSV if you need
to.</li>
</ul></li>
<li>What we have at the moment is an array of sequences that gives you
access to the actual data itself.</li>
</ul></li>
</ul>

<p>
Some discussion of the status of the current draft. Resolved as a
caching issue.
</p>

<ul class="org-ul">
<li>MP continues
<ul class="org-ul">
<li>The number of columns in a row can vary.</li>
<li>If you access a position that doesn’t exist in an array, you get
an error. If you access it in a sequence, you get the empty
sequence. That’s why the proposal is for an array of sequences.</li>
<li>For some implementations, a sequence of arrays might be easier.</li>
<li>But I think arrays of sequences works best at the moment.</li>
</ul></li>
</ul>

<p>
JL clarifies that the return is an array of sequences, one array entry
for each row; a sequence of columns.
</p>

<ul class="org-ul">
<li>MP continues
<ul class="org-ul">
<li>There are defaults for line and column separators.</li>
<li>Some languages make it harder to set the separators, but they
allow you to if you really need to.</li>
<li>Quoting in CSV is weird, it doesn’t use backslash escapes. To
escape the quote character you just double it.</li>
<li>Whitespace is supposed to be preserved by default, but there are
cases where you get a bunch of extra whitespace (padding or whatever).
<ul class="org-ul">
<li>There’s an option to trim leading and trailing spaces (but not
touching embedded whitespace)</li>
</ul></li>
<li>The default for whether or not to treat the first row as a header
should probably be false.</li>
<li>In the data structure that’s returned, there’s a function called
<code>fields</code> that basically wraps up accessing the fields.</li>
<li>Attempted to provide examples, but more are expected.</li>
<li>There are some issues with the names of things; the RFC uses
records and fields. I’ve always thought of them as rows and columns.
So now we have CSV records that are different from our records.</li>
</ul></li>
<li>NW: Don’t do that. Call them rows and columns.</li>
<li>RD: You could also add a couple of notes to make it clear that we
know we’re mapping from the RFC terms.</li>
<li>MP: I don’t have a strong opinion about the names.</li>
<li>MP: The spec is currently incomplete because I’m not sure best how
to document a function returned in a map from a function.</li>
<li>MK: Producing testable examples here is going ot be tricky because
of the problem of function identity.</li>
</ul>

<p>
Some discussion of providing a separate function for generating the
header map and for processing individual lines. You could then build
the same machinery. This might allow you to work around the problem of
different line endings from what, for example, <code>unparsed-text()</code>
produces
</p>

<ul class="org-ul">
<li>MP: Having separate functions would make them easier to document in
some sense. The function that’s returned could be a partial
application of a more general function applied to the header map.</li>

<li>RD: I have two questions:
<ul class="org-ul">
<li>1. What about parsing <a href="https://universaldependencies.org/format.html">CoNLL-U</a> format, a tab separated
format. They have fixed headers that are not provided in the file,
but they’re part of the format.</li>
</ul></li>
<li>MP: When this was original conceived, the field lookup function
wasn’t part of the returned data structure. The suggestion was that
you extract the map to do the lookup. If you’re using a variable to
define the map, you can use that variable. If we’re giving you a
function, we should provide a way for you to pass in your own map.
As soon as you start providing conveniences for field lookup, then
it makes sense to enable someone to pass in a map. That also applies
to generating CSVs.</li>
<li>RD:
<ul class="org-ul">
<li>2. The CoNLL-U format also allows comment lines. Can those be supported?</li>
</ul></li>
<li>MP: That’s mentioned in more recent drafts of the RFC. It should be
possible to include; it complicates things a little bit but it’s
probably common enough.</li>
<li>RD: Comments are single lines, not ends-of-lines etc.</li>
<li>MP: Do you want the comments back?</li>
<li>RD: Yes</li>
<li>MP: That <b>complicates</b> things. This proposal doesn’t require a
fixed number of fields on each row, so it could get weird.
<ul class="org-ul">
<li>It seems like this is something we probably need because they’re
likely to generate errors if we don’t support them.</li>
</ul></li>
<li>MSM: I think I have two questions.
<ul class="org-ul">
<li>1. You’ve been mostly talking about <code>parse-csv</code>, I see there’s also
a <code>csv-to-xml</code> function and I wonder, when I have CSV to parse, I
use the BaseX <code>parse-csv</code> function and that’s always worked for me.
How does <code>csv-to-xml</code> compare to the <code>parse-csv</code> function BaseX?</li>
</ul></li>
<li>MP: It’s terribly named. It doesn’t have a schema for what a CSV
should look like. It’s meant to be there so that if you’re turning a
50 column weird financial CSV int XML, it’s easier to get to the
things you need. It’s an iterator across a data in the parsed CSV
record. it goes through and gives you all the columns, you can say
you only want columns 1, 5, and 7 or only “date” and “description”.
<ul class="org-ul">
<li>It also allows you to hide away the fact that simple iteration
with ?* doesn’t work over sequences.</li>
</ul></li>
<li>MSM: 
<ul class="org-ul">
<li>2. I didn’t understand most of the explanation; I think that
illustrates my primary reaction which is that this seems like an
awful lot of machinery. I’d like simple case to be simpler. In
connection with that, I can relate to some people wanting to get
one kind of thing back and others a different kind of thing. There
are lots of different things that users might want to get
(elements, attribute, maps, arrays, records)
<ul class="org-ul">
<li>Why not return an array of maps or a map of maps or…</li>
<li>If I’ve got headers, what I generally want is an element because
I find XML a useful way to structure information.</li>
</ul></li>
</ul></li>
<li>MP: Maps would be feasible, but there would be a lot of redundancy
there. You’d effectively be repeating the header data for every row.
And the other problem is that a lot CSVs have duplicate headers. Or
columns that don’t have a header.</li>
<li>MSM: In those cases, I expect some munging to occur. A suffix
number, for example: “num” and “num_2”. Or “field_37” if there’s no
header. If you’d like a map, a map with a munged name is likely to
be better.</li>
<li>MP: I think the biggest problem with maps in this case is the lack
of a defined order.</li>
<li>MSM: If I have distinct names and a way to determine which columns
got those names, I can solve that problem.</li>
<li>RD: You could also use sequences indexes.</li>
<li>MP: That all sounds more heavyweight which I’d like to avoid. A
separate issue here is that it would be nice if this actually spat
out actual elements or a more common thing like a map or a sequence.</li>
<li>MK: It would be nice if you could get the natural way you’d express
the same data in XML or JSON very simply.</li>
<li>MP: In JSON?</li>
<li>MK: As an array of maps.</li>
<li>CG: In BaseX, one of the things that’s important is that the formats
can be reversed. We didn’t use maps because we can’t get back the
original order. The main problem with the XML representation was the
memory consumption for millions of records. That’s also why we
didn’t duplicate any data. A minimal representation is a sequence of
arrays. This allows us to recreate the original structure.
<ul class="org-ul">
<li>Do we want a unidirectional conversion, or do you need to be able
to back?</li>
</ul></li>
<li>MP: With the exception of whitespace trimming, there’s nothing in
the return format that would prevent you from constructing a
functionally equivalent CSV.
<ul class="org-ul">
<li>Perhaps the delimiters used shold be part of the returned record.</li>
<li>You don’t know necessarily whether fields were quoted.</li>
<li>To go all the way down to the byte level, you couldn’t use
<code>unparsed-text</code> because we wouldn’t have, for example, the encoding.</li>
</ul></li>
<li>JL: If you provide a CSV string that only contains the header row,
you’ll get back an entry with map that identifies the columns.</li>
<li>MP: And an empty map.</li>
<li>JL: Can I reuse that header with another parse which doesn’t have the header.</li>
<li>MP: That’s not in the draft as it stands. But it seems like something we should add.</li>
<li>SF: We have usability, scalability, and performance problems here.
To be able to work efficiently usually XSLT and XML take the
streaming approach. Process the data while it’s still being
received. If we won’t treate CSV as a data source, then we will have
scalability issue problems. If you have issues with the interface,
that’s a usability problem. Whether you want to expose the data as
arrays or sequences, that’s a an API issue. In Java, you can have an
accessor for basically an Collection from any other collection. If
you don’t do that, then we will face those issues with different
format access, with performance, and treating as a single blob a
stream, it will be processed multiple times as a very chunk of
memory. 
<ul class="org-ul">
<li>We should separate the problem of data source and an interface for any kind of data source.</li>
</ul></li>
<li>MP: I think there are a lot of use cases where you want to parse a
fairly small string. The ins-and-outs of a streaming approach would
need more consideration.</li>
<li>MK: On the input side, one possibility would be to accept a sequence of strings.</li>
<li>MP: I did think about that.</li>
</ul>

<p>
What to do before next week? Please try to engage in email and in issues and comments.
</p>

<p>
Some discussion of how to make the presentation easier. MK proposes displaying the text.
</p>

<ul class="org-ul">
<li>CG: I would be happy if there was more discussion on the pull request.</li>
</ul>
</div>
</div>
</div>

<div id="outline-container-any-other-business" class="outline-2">
<h2 id="any-other-business"><span class="section-number-2">3.</span> Any other business?</h2>
<div class="outline-text-2" id="text-any-other-business">
<p>
None heard.
</p>
</div>
</div>

<div id="outline-container-adjourned" class="outline-2">
<h2 id="adjourned"><span class="section-number-2">4.</span> Adjourned</h2>
<div class="outline-text-2" id="text-adjourned">
</div>
</div>
</div>
</body>
</html>