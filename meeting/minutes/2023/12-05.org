:PROPERTIES:
:ID:       C66E5BBA-2F2C-48F2-AC87-7FBB007F0DFF
:END:
#+title: QT4 CG Meeting 057 Minutes 2023-12-05
#+author: Norm Tovey-Walsh
#+filetags: :qt4cg:
#+options: html-style:nil h:6
#+html_head: <link rel="stylesheet" type="text/css" href="/meeting/css/htmlize.css"/>
#+html_head: <link rel="stylesheet" type="text/css" href="../../../css/style.css"/>
#+html_head: <link rel="shortcut icon" href="/img/QT4-64.png" />
#+html_head: <link rel="apple-touch-icon" sizes="64x64" href="/img/QT4-64.png" type="image/png" />
#+html_head: <link rel="apple-touch-icon" sizes="76x76" href="/img/QT4-76.png" type="image/png" />
#+html_head: <link rel="apple-touch-icon" sizes="120x120" href="/img/QT4-120.png" type="image/png" />
#+html_head: <link rel="apple-touch-icon" sizes="152x152" href="/img/QT4-152.png" type="image/png" />
#+options: author:nil email:nil creator:nil timestamp:nil
#+startup: showall

[[../][Agenda index]] / [[https://qt4cg.org][QT4CG.org]] / [[https://qt4cg.org/dashboard][Dashboard]] / [[https://github.com/qt4cg/qtspecs/issues][GH Issues]] / [[https://github.com/qt4cg/qtspecs/pulls][GH Pull Requests]]

* Minutes
:PROPERTIES:
:unnumbered: t
:CUSTOM_ID: minutes
:END:

Approved [[./12-12.html][at meeting 058]] on 12 December 2023.

* Summary of new and continuing actions [0/8]
:PROPERTIES:
:unnumbered: t
:CUSTOM_ID: new-actions
:END:

+ [ ] QT4CG-052-02: NW to consider how to schedule an “editor’s meeting”
+ [ ] QT4CG-052-05: MK to rename the ~hexBinary-equal~ function to ~binary-equal~?
+ [ ] QT4CG-052-06: MK to consider the editorial question of “promotion” for the symmetric relations.
+ [ ] QT4CG-055-01: MK to clarify that the return type of the deep lookup operator is a flat sequence.
+ [ ] QT4CG-056-04: MK to write a proposal for adding a select attribute to xsl:text
+ [ ] QT4CG-057-01: CG to make a PR for changing items to subsequence in some functions.
+ [ ] QT4CG-057-02: CG to make the list of options in deep-equal alphabetical again
+ [ ] QT4CG-057-03: CG to attempt to clarify that the unordered option in deep-equal only applies to the top-level sequence

* Administrivia
:PROPERTIES:
:CUSTOM_ID: administrivia
:END:

** Roll call [11/11]
:PROPERTIES:
:CUSTOM_ID: roll-call
:END:

+ [X] Reece Dunn (RD)
+ [X] Sasha Firsov (SF)
+ [X] Christian Grün (CG)
+ [X] Joel Kalvesmaki (JK) [:10-]
+ [X] Michael Kay (MK)
+ [X] John Lumley (JL)
+ [X] Dimitre Novatchev (DN)
+ [X] Wendell Piez (WP)
+ [X] Ed Porter (EP)
+ [X] C. M. Sperberg-McQueen (MSM)
+ [X] Norm Tovey-Walsh (NW). /Scribe/. /Chair/.

** Accept the agenda
:PROPERTIES:
:CUSTOM_ID: agenda
:END:

Proposal: Accept [[../../agenda/2023/12-05.html][the agenda]].

Accepted.

*** Status so far…
:PROPERTIES:
:CUSTOM_ID: so-far
:END:

#+CAPTION: “Burn down” chart on open issues
#+NAME:   fig:open-issues
[[./issues-open-2023-12-05.png]]

#+CAPTION: Open issues by specification
#+NAME:   fig:open-issues-by-spec
[[./issues-by-spec-2023-12-05.png]]

#+CAPTION: Open issues by type
#+NAME:   fig:open-issues-by-type
[[./issues-by-type-2023-12-05.png]]

** Approve minutes of the previous meeting
:PROPERTIES:
:CUSTOM_ID: approve-minutes
:END:

Proposal: Accept [[../../minutes/2023/11-28.html][the minutes of the previous meeting]].

Accepted.

** Next meeting
:PROPERTIES:
:CUSTOM_ID: next-meeting
:END:

The next meeting [[../../agenda/2023/12-12.html][is scheduled for Tuesday, 12 December 2023]].

Any regrets for the next meeting?

None heard.

** Review of open action items [4/9]
:PROPERTIES:
:CUSTOM_ID: open-actions
:END:

+ [ ] QT4CG-052-02: NW to consider how to schedule an “editor’s meeting”
+ [ ] QT4CG-052-05: MK to rename the ~hexBinary-equal~ function to ~binary-equal~?
+ [ ] QT4CG-052-06: MK to consider the editorial question of “promotion” for the symmetric relations.
+ [ ] QT4CG-055-01: MK to clarify that the return type of the deep lookup operator is a flat sequence.
+ [X] QT4CG-055-02: DN to open an issue requesting examples of implausible expressions to clarify the spec
+ [X] QT4CG-056-01: MK to update PR #479 so that it merges cleanly.
+ [X] QT4CG-056-02: MK to update PR #412 so that it merges cleanly.
+ [X] QT4CG-056-03: MK to draft a PR to remove the function-namespaces feature.
+ [ ] QT4CG-056-04: MK to write a proposal for adding a select attribute to xsl:text

** Review of open pull requests and issues
:PROPERTIES:
:CUSTOM_ID: open-pull-requests
:END:

*** Merge without discussion
:PROPERTIES:
:CUSTOM_ID: merge-without-discussion
:END:

The following PRs are editorial, small, or otherwise appeared to be
uncontroversial when the agenda was prepared. The chairs propose that
these can be merged without discussion. If you think discussion is
necessary, please say so.

+ PR [[https://qt4cg.org/dashboard/#pr-863][#863]]: 742 Drop xsl:function-library declaration
+ PR [[https://qt4cg.org/dashboard/#pr-851][#851]]: 822: XQuery, XQFO: Edits (pool)

Proposal: accept without discussion?

Accepted.

*** Substantive PRs
:PROPERTIES:
:CUSTOM_ID: substantive
:END:

The following substantive PRs were open when this agenda was prepared.

+ PR [[https://qt4cg.org/dashboard/#pr-855][#855]]: 844 New sequence functions: names
+ PR [[https://qt4cg.org/dashboard/#pr-849][#849]]: 847 Allow uri-structure-record keys to have empty sequence values
+ PR [[https://qt4cg.org/dashboard/#pr-832][#832]]: 77 Add map:deep-update and array:deep-update
+ PR [[https://qt4cg.org/dashboard/#pr-798][#798]]: 479: fn:deep-equal: Input order
+ PR [[https://qt4cg.org/dashboard/#pr-795][#795]]: 655: fn:sort-with
+ PR [[https://qt4cg.org/dashboard/#pr-737][#737]]: 295: Boost the capability of recursive record types
+ PR [[https://qt4cg.org/dashboard/#pr-529][#529]]: 528: revision of json(), and renaming to elements-to-maps()

*** Proposed for V4.0
:PROPERTIES:
:CUSTOM_ID: proposed-40
:END:

The following issues are labled “proposed for V4.0”.

+ Issue [[https://github.com/qt4cg/qtspecs/issues/850][#850]]: fn:parse-html: Finalization
+ Issue [[https://github.com/qt4cg/qtspecs/issues/829][#829]]: fn:boolean: EBV support for more item types
+ Issue [[https://github.com/qt4cg/qtspecs/issues/716][#716]]: Generators in XPath
+ Issue [[https://github.com/qt4cg/qtspecs/issues/689][#689]]: fn:stack-trace: keep or drop?
+ Issue [[https://github.com/qt4cg/qtspecs/issues/583][#583]]: array:replace(), etc
+ Issue [[https://github.com/qt4cg/qtspecs/issues/557][#557]]: fn:unparsed-binary: accessing and manipulating binary types
+ Issue [[https://github.com/qt4cg/qtspecs/issues/340][#340]]: fn:format-number: Specifying decimal format
+ Issue [[https://github.com/qt4cg/qtspecs/issues/260][#260]]: array:index-of
+ Issue [[https://github.com/qt4cg/qtspecs/issues/33][#33]]: json parsing number type option
+ Issue [[https://github.com/qt4cg/qtspecs/issues/31][#31]]: Extend FLWOR expressions to maps

* Technical Agenda
:PROPERTIES:
:CUSTOM_ID: technical-agenda
:END:

** PR #855: 844 New sequence functions: names
:PROPERTIES:
:CUSTOM_ID: h-E01573AE-CAC0-43ED-94F6-05094B3AB8A1
:END:

See PR [[https://qt4cg.org/dashboard/#pr-855][#855]].

CG walks us through the issue and the PR.

+ CG: ~…with-sequence~ becomes ~…-with-subsequence~
+ CG: Discussion of ~items-after~, ~items-before~, ~items-starting-where~, and ~items-ending-where~
  + … Using “subsequence” here would make the names even longer
  + … One suggestion was a single function that has more arguments
  + … Other languages have imperative sounding functions “take-while” and “drop-while”…
  + … “Items” functions might be more expected for folks from the functional background
  + … Some functions use verbs in the names.
  + … Trying to avoid very long names.
+ DN: I think this is a useful issue, but it just scratches the surface.
  + … It’s telling us about the symptom, not the cause of the problem.
  + … When we have to talk about items, members, pairs, etc. And
    sometimes we need to have functions in the fn, array, and map namespaces.
  + … I think MK made a useful suggestion about having more general
    types of objects.
  + … I think if we have one general, abstract type of collection then
    we could have all of these functions in different namespaces
    replaced by a single function.
+ CG: I think that’s a good observation; in #843, I’ve listed all of
  the function duplication we already have. And we have new functions
  that we have to discuss if we need multiple equivalent versions of them.
+ JL: What’s the argument for leaving off the inclusion version; is it
  just the name, or is it that there’s no use case.
+ CG: Those are two points: one solution is that we could take the two
  functions that allow you to drop the first or last value.
  + … Or in many cases you can do it with just a couple of existing functions.
  + … Some of the functions will be more common than others; you can
    always find arguments for all four, but are people really going to
    be aware of them all?
  + … Many of these use cases can be written with other existing functions.
+ JL: Then in the notes, I think it would be good to show some of
  these use cases in the examples.
+ RD: There are really two challenges in creating common sequence,
  array, and map functions. One is that an array or map is a single
  item sequence. So doing a count on that object will return 1,
  whereas array:size and map:size will return the number of elements.
  + … We can’t change that behavior.
  + … The other challenge is that the different functions have
    slightly different semantics. If you try to get a an item in an
    index of an array that doesn’t exist, it’ll throw an exception.
    But sequences just return an empty sequence. So you’ve got those
    semantic differences.
+ CG: Yes, it would definitely be easier if we could start over!
+ MK: I agree with everything RD said. Procedurally, do we focus on
  the big issues per DN, or do we take a small step as CG is
  proposing.
  + … In terms of the detail of the PR, I sympathise with goals. But
    if we’re going to cut down from four to two, we’ve picked the
    wrong two!
  + … We also have index-where that you can use to construct what you
    want.
  + … One could argue that the family of four functions is excessive. But I’d keep
    ~subsequence-before~ and ~subsequence-starting-where~.
+ CG: What about ~subsequence-where~?
+ MK: I think it makes simple cases more difficult.
+ JK: Subsequence-where doesn’t imply that they’re contiguous.
+ CG: Yes, that’s true.
+ MK: One could do it all by adding keywoard arguments to the existing
  subsequence function.
+ CG: We could have ~subsequence-from~ and ~subsequence-before~
+ DN: I want to second what MK said. I think we’re making things more
  complex. That’s not good for users. In order to cure the symptoms,
  we’re making things more complicated.
+ CG: The root cause is a really complex problem.
+ DN: We should work on the root cause. I don’t think we’ve made the necessary effort yet.
+ NW: Can we do it the other way around? Make complete parity across the namespaces?
+ MK: It doesn’t work. There are semantic differences between arrays,
  maps, and sequences.
+ NW: :-(
+ SF: I hear the arguments that we can’t do it because of major incompatibilities.
  + … But we could solve this problem by having functions in a new namespace.
  + … If you want a particular semantics, you could point to at a
    specific namespace. That would eliminate the constraints on
    changing logic and versions.
+ NW: More namespaces is better! It’s an interesting approach.
+ RD: With this proposal, we’ve changed items to subsequence. That’s
  uncontroversial and we should do it. The other change, combining the
  functions is more controversial. We could separate the two.
  + … Maybe we could investigate further and continue the analysis that CG has done.
+ CG: I think we can drop ~subsequence-where~.
  + Rename items to subsequence
  + How to rename the existing four functions and maybe deal with take-while and drop-while
+ MSM: For the record, I hate replacing a two syllable word with a
  three syllable one but I don’t see a better alternative.

ACTION: CG to make a PR for changing items to subsequence in some functions.

** PR #849: 847 Allow uri-structure-record keys to have empty sequence values
:PROPERTIES:
:CUSTOM_ID: h-FF4B88D7-D575-41AE-A6EE-8AB73B7FB618
:END:

See PR [[https://qt4cg.org/dashboard/#pr-849][#849]].

NW introduces the question: what’s the goup’s opinion, should we allow
empty sequences in the ~uri-structure-record~?

+ MK: I’m in favor of making the fields optional.
+ RD: +1
+ NW: Okay, I’ll get this one tidied up for next week.

** PR #832: 77 Add map:deep-update and array:deep-update
:PROPERTIES:
:CUSTOM_ID: h-1A7F9ACF-9EC6-4C8E-A13F-FDFD6545C2B5
:END:

See PR [[https://qt4cg.org/dashboard/#pr-832][#832]].

Not ready for discussion.

** PR #798: 479: fn:deep-equal: Input order
:PROPERTIES:
:CUSTOM_ID: h-5CBFFA21-18EA-4136-BBF6-06E60CF0ADF5
:END:

See PR [[https://qt4cg.org/dashboard/#pr-798][#798]].

CG walks us through the PR.

+ CG: The idea is simple, in XQuery 3.1 there were no options on
  ~fn:deep-equal~. In 4.0, we have a lot of options.
  + … I propose a more general option ~ordered~ or ~unordered~ that
    simply allows you to enforce order or to allow permutations.
  + … If you include this option, then you can use all the other
    options as well.
+ MK: Did you say it was easy to implement?
+ CG: Yes!
+ MK: Congratulations!

Some discussion of how performance is impacted by an implementation.

+ MK: An implementation with quadratic performance isn’t difficult! 
+ MK: I have a slight concern that we’re bundling too much into one
  function, but in principle it makes sense.
+ DN: Maybe I don’t understand. If ~unordered=true~ means that any
  sequence can be unordered (even element children), I think it’s very
  confusing. If a schema says the children can be any order, but
  another element says they have a particular order, would be gross
  violation of the schema.
+ CG shows an example with lists of atomic values.
+ DN: I think it makes sense for atomic values.
+ MK: My reading is that it only applies at the top level.
+ DN: Then that needs to be made very clear! It needs to be emphasized.

Some discussion of how to improve the prose.

+ MK: Perhaps it could be clarified in the description in the table.
+ JL: I understand the mechanism for elements and their children. Is
  there any requirement for unordered comparisons further down?
+ NW: Sometimes you just have to write your own function!
+ RD: I was wondering if it could be useful in the element case for a
  test assertion of some sort, but if this is only at the top level…
  If you had unordered elements specified but unordered set to false,
  then that would work equivalently if the unordered elements were the
  same at the top level.
+ MK: No, this is always the children.

Some further discussion of this use case. 

+ JL: Is there any argument for a wildcard on unordered elements?
+ CG: Not sure. It has been discussed.

Proposal: Accept this PR?

Acccepted.

ACTION: CG to make the list of options in deep-equal alphabetical again

ACTION: CG to attempt to clarify that the unordered option in deep-equal only applies to the top-level sequence

** Issue #829: fn:boolean: EBV support for more item types
:PROPERTIES:
:CUSTOM_ID: h-81B61E64-8200-4AC1-AACB-7FC685775CAF
:END:

Issue [[https://github.com/qt4cg/qtspecs/issues/829][#829]].

+ CG: We have EBV for a number of conditionals. It comes form XPath
  1.0 and has the semantics from there.
  + … I think it would be useful to apply this to more types. Today
    you get an error for maps and arrays. We could also consider the
    binary types.
  + … We could just return ~true~ if an item exists, or we could look
    into it. So an empty array could be either ~true~ or ~false~.
  + … Then you wouldn’t have to write ~array:size() != 0~
+ MK: I think the big problem is that doing it the obvious way (empty
  maps and arrays are true) is different from Javascript.
+ JK: But it’s the same as Python
+ CG: Are there languages where it’s an error?

Java, for example, and other strongly typed languages.

+ DN: We have more than one way to do this already? Don’t we have
  ~exists~ and ~empty~ in the array and map namespaces?
  + … I don’t see the needs for this. We already have ways to do this.
+ CG: My experience is based on some user feedback. Users unfamiliar
  with XPath 1.0 just don’t understand why it’s sometimes an error.
+ JK: Am I right in thinking that EBV is mostly frequently supported
  in predicate filters in XPath expresions?
+ MK: Yes, that’s probably right.
+ JK: So what does ~array(*)~ mean in that case?

Some discussion of the use case. Something like ~[$a]~ where ~$a~ is
an array.

+ RD: Here’s an example:

#+BEGIN_SRC XPath
let $a := array {}
return if ($a) then 1 else 2
#+END_SRC

+ CG: It would be nice if it didn’t give an exception.
+ MK: Most advice is to be explicit.
+ CG: But it’s very convenient that so much of XPath is concise!
+ DN: I am not saying I support this, but looking at the table for
  computing booleans, it’s very complicated.
  + … It should be made easier. Getting the size of a big array just
    to see if it exists is very inefficient.
+ MK: But that’s an easy optimization.
+ CG: If you have EBV for sequences, you need the same check.

Who is in favor of extending EBV to cover more types.

In favor 4, opposed 3.5.

+ NW: There’s no consensus yet. We’ll just leave that issue for now.

* Any other business?
:PROPERTIES:
:CUSTOM_ID: any-other-business
:END:

+ DN: I did my action item.
+ NW: Thank you, DN.

* Adjourned
:PROPERTIES:
:CUSTOM_ID: adjourned
:END:
