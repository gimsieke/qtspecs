<!DOCTYPE HTML><html><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><meta charset="UTF-8"><meta http-equiv="x-ua-compatible" content="ie=edge"><meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1"><link rel="stylesheet" href="/css/status.css"><title>@qt4cg statuses in 2024</title></head><body><main><article><h1>@qt4cg statuses in 2024</h1><p>This page displays status
              updates
              about the QT4 CG project from 2024.</p><p>See also <a href="../">recent statuses</a>.</p><div class="toots">
<div class="toot" id="closed-978"><h2>Issue #978 closed<span class="toot-id"> #closed-978</span></h2><div class="pubdate">13 Feb at 17:21:34 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/978">https://github.com/qt4cg/qtspecs/pull/978</a></div><p>948 Reflected the comments of the CG on the specification of scan-left and scan-right</p></div>
<div class="toot" id="minutes-02-13"><h2>QT4 CG meeting 065 draft minutes<span class="toot-id"> #minutes-02-13</span></h2><div class="pubdate">13 Feb at 17:20:00 GMT</div><div class="link">Link: <a href="https://qt4cg.org/meeting/minutes/2024/02-13">https://qt4cg.org/meeting/minutes/2024/02-13</a></div><p>Draft minutes published.</p></div>
<div class="toot" id="closed-720"><h2>Issue #720 closed<span class="toot-id"> #closed-720</span></h2><div class="pubdate">13 Feb at 17:18:22 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/720">https://github.com/qt4cg/qtspecs/issues/720</a></div><p>From Records to Objects</p></div>
<div class="toot" id="closed-985"><h2>Issue #985 closed<span class="toot-id"> #closed-985</span></h2><div class="pubdate">13 Feb at 17:18:21 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/985">https://github.com/qt4cg/qtspecs/pull/985</a></div><p>720 Add lookup arrow expressions (method invocations)</p></div>
<div class="toot" id="closed-949"><h2>Issue #949 closed<span class="toot-id"> #closed-949</span></h2><div class="pubdate">13 Feb at 17:15:45 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/949">https://github.com/qt4cg/qtspecs/issues/949</a></div><p>Partial Function Applications: Allow return of function name</p></div>
<div class="toot" id="closed-972"><h2>Issue #972 closed<span class="toot-id"> #closed-972</span></h2><div class="pubdate">13 Feb at 17:15:44 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/972">https://github.com/qt4cg/qtspecs/pull/972</a></div><p>949 Partial Function Applications: Allow return of function name</p></div>
<div class="toot" id="closed-42"><h2>Issue #42 closed<span class="toot-id"> #closed-42</span></h2><div class="pubdate">13 Feb at 17:13:19 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/42">https://github.com/qt4cg/qtspecs/issues/42</a></div><p>Relax type incompatibility in order by clause (impl. dep. instead of XPST0004)</p></div>
<div class="toot" id="closed-55"><h2>Issue #55 closed<span class="toot-id"> #closed-55</span></h2><div class="pubdate">13 Feb at 17:13:05 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/55">https://github.com/qt4cg/qtspecs/issues/55</a></div><p>Provide an XML version of the stack trace</p></div>
<div class="toot" id="closed-79"><h2>Issue #79 closed<span class="toot-id"> #closed-79</span></h2><div class="pubdate">13 Feb at 17:12:58 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/79">https://github.com/qt4cg/qtspecs/issues/79</a></div><p>fn:deep-normalize-space($e as node())</p></div>
<div class="toot" id="closed-989"><h2>Issue #989 closed<span class="toot-id"> #closed-989</span></h2><div class="pubdate">13 Feb at 17:12:52 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/989">https://github.com/qt4cg/qtspecs/issues/989</a></div><p>character sequence constructor 'a' to 'z'</p></div>
<div class="toot" id="closed-994"><h2>Issue #994 closed<span class="toot-id"> #closed-994</span></h2><div class="pubdate">13 Feb at 17:12:44 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/994">https://github.com/qt4cg/qtspecs/issues/994</a></div><p>Invoking maps &amp; arrays: allow sequences?</p></div>
<div class="toot" id="closed-1009"><h2>Issue #1009 closed<span class="toot-id"> #closed-1009</span></h2><div class="pubdate">13 Feb at 17:08:23 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1009">https://github.com/qt4cg/qtspecs/issues/1009</a></div><p>QT4CG-064-03, QT4CG-064-04: Examples, Return type of `fallback`</p></div>
<div class="toot" id="closed-1010"><h2>Issue #1010 closed<span class="toot-id"> #closed-1010</span></h2><div class="pubdate">13 Feb at 17:08:21 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1010">https://github.com/qt4cg/qtspecs/pull/1010</a></div><p>1009 Examples, Return type of parse-json:fallback</p></div>
<div class="toot" id="closed-916"><h2>Issue #916 closed<span class="toot-id"> #closed-916</span></h2><div class="pubdate">13 Feb at 15:33:23 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/916">https://github.com/qt4cg/qtspecs/pull/916</a></div><p>720 Allow methods in maps with access to $this</p></div>
<div class="toot" id="created-1023"><h2>Pull request #1023 created<span class="toot-id"> #created-1023</span></h2><div class="pubdate">13 Feb at 12:39:33 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1023">https://github.com/qt4cg/qtspecs/pull/1023</a></div><details><summary>1020 explain consequences of function coercion</summary><div class="markup"><p>Adds explanatory material to explain my interpretation of the spec and the consequences on backwards compatibility. No change to the spec is proposed. (To review the PR, I suggest reading the change markings in the XQuery spec.)</p>
<p>Fix issue #1020</p>
</div></details></div>
<div class="toot" id="created-1022"><h2>Pull request #1022 created<span class="toot-id"> #created-1022</span></h2><div class="pubdate">13 Feb at 11:51:44 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1022">https://github.com/qt4cg/qtspecs/pull/1022</a></div><details><summary>999 Allow comments in regular expressions</summary><div class="markup"><p>Fix #999</p>
</div></details></div>
<div class="toot" id="created-1021"><h2>Issue #1021 created<span class="toot-id"> #created-1021</span></h2><div class="pubdate">12 Feb at 12:46:10 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1021">https://github.com/qt4cg/qtspecs/issues/1021</a></div><details><summary>Extend `fn:doc`, `fn:collection` and `fn:uri-collection` with options maps</summary><div class="markup"><p><code>fn:doc</code>, <code>fn:collection</code> and <code>fn:uri-collection</code> currently expect only a single argument, a URI.</p>
<p>There is no way of adding additional parameters to those functions.</p>
<p>Several implementations of XPath have worked around that limitation by</p>
<ol>
<li>passing of parameters via query string as part of the URI:</li>
</ol>
<ul>
<li>see https://www.saxonica.com/documentation10/index.html#!sourcedocs/collections</li>
<li>exist-db's implementation of <code>uri-collection</code> works similarly</li>
</ul>
<ol start="2">
<li>create custom functions in other namespaces to add an options map as a second parameter</li>
</ol>
<ul>
<li><code>saxon:doc</code> in Saxon https://www.saxonica.com/documentation10/index.html#!changes/extensions/9.7-9.8</li>
<li><code>fetch:doc</code> in baseX https://docs.basex.org/wiki/Fetch_Module#fetch:doc</li>
</ul>
<p>While both approaches do work well, they do fall flat in terms of interoperability and discoverability.
A script written for Saxon leveraging <code>saxon:doc</code> will not work on baseX in vice versa even though they offer options with some overlap.
And a developer looking at the language specification will not discover that these options even exist.</p>
<p>I would like to add a second signature to the above functions with an options map as a second argument.</p>
<pre><code class="language-xquery">fn:doc($href as xs:string?) as document-node()?
fn:doc($href as xs:string?, $options as map(xs:string, *)? := ()) as document-node()?
</code></pre>
<p>NOTE: Looking at the other two functions below I believe the first parameter should be defined as <code>$href as xs:string? := ()</code></p>
<pre><code class="language-xquery">fn:collection( $uri as&nbsp;xs:string? :=&nbsp;())&nbsp;as&nbsp;item()*
fn:collection( $uri as&nbsp;xs:string? :=&nbsp;(), $options as map(xs:string, *)? := ())&nbsp;as&nbsp;item()*
</code></pre>
<pre><code class="language-xquery">fn:uri-collection( $uri as&nbsp;xs:string? :=&nbsp;())&nbsp;as&nbsp;xs:anyURI*
fn:uri-collection( $uri as&nbsp;xs:string? :=&nbsp;(), $options as map(xs:string, *)? := ())&nbsp;as&nbsp;xs:anyURI*
</code></pre>
<p>Since a lot of those options depend on the current runtime most of them will be "free" options.
This will also help us get to a specification quickly and circumvent long infighting about some very specific details.</p>
<p>I do see, however, a good chance of specifying a small set of options that would work across implementations.</p>
<h2>Possible standard options</h2>
<h3>For <code>fn:doc</code></h3>
<ul>
<li><code>validation</code>: wether and how to validate the input files against a schema</li>
<li><code>whitespace</code>: (<code>strip-space</code>, <code>stripws</code>) what to do with whitespace in the input document</li>
<li><code>parser</code>: could be used to define a different parser (for html documents)</li>
</ul>
<h3>For <code>collection</code> and <code>uri-collection</code> I see the following:</h3>
<ul>
<li><code>recurse</code>: traverse collection trees down into its subcollections</li>
<li><code>stable</code>: this is already vaguely mentioned in the spec and would benefit from a clearer specification</li>
<li><code>type</code>: (aka <code>media-type</code> or <code>content-type</code>) while the allowed values will be implementation defined the key should be standardised</li>
</ul>
<p>This would bring the above functions to follow a pattern developers are already familiar with (see <code>fn:serialize</code> and others)</p>
<p>Thanks for initial input by @ChristianGruen, Liam Quin and @michaelhkay</p>
</div></details></div>
<div class="toot" id="agenda-02-13"><h2>QT4 CG meeting 065 draft agenda<span class="toot-id"> #agenda-02-13</span></h2><div class="pubdate">12 Feb at 11:45:00 GMT</div><div class="link">Link: <a href="https://qt4cg.org/meeting/agenda/2024/02-13">https://qt4cg.org/meeting/agenda/2024/02-13</a></div><p>Draft agenda published.</p></div>
<div class="toot" id="created-1020"><h2>Issue #1020 created<span class="toot-id"> #created-1020</span></h2><div class="pubdate">11 Feb at 23:56:50 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1020">https://github.com/qt4cg/qtspecs/issues/1020</a></div><details><summary>When to apply the coercion rules</summary><div class="markup"><p>The rules for function calling say that the coercion rules are applied to the values supplied as function arguments; they are also applied in other circumstances such as when binding values to variables. The coercion rules are applied (as far as the spec is concerned) whether or not the supplied value already matches the required type.</p>
<p>Saxon has always attempted to optimise this process: if the supplied value is already an instance of the required type, no coercion takes place.</p>
<p>I have discovered at least one case where this assumption is incorrect: the coercion rules are not idempotent in the case where the supplied value matches the required type. This case concerns function coercion, exemplified by the new test case FunctionCall-058: if the expected type of a callback parameter is <code>function(xs:integer) as xs:boolean</code>, and the supplied value for the callback is a function that accepts <code>xs:decimal</code>, then the coercion rules say that a call to the supplied function that supplies an <code>xs:decimal</code> must be rejected as a type error even though the supplied function accepts it.</p>
<p>Note that this means we have introduced a rather subtle backwards incompatibility. In XQuery 3.1, coercion was not applied to variable bindings, so the following would work (the supplied function matches the declared type of the variable):</p>
<pre><code>declare variable $f as function(xs:integer) as xs:boolean 
              := function($x as item()) as xs:boolean {string($x)};
return $f("banana");
</code></pre>
<p>(see new tests VarDecl065/066)</p>
<p>In 4.0 I believe this is supposed to throw a type error, because the supplied function is wrapped in a wrapper function that checks that the supplied argument is an integer.</p>
<p>We have extended the coercion rules considerably in 4.0, and we need to be confident that there are no other similar cases where the coercion rules are no longer idempotent.</p>
</div></details></div>
<div class="toot" id="created-1019"><h2>Issue #1019 created<span class="toot-id"> #created-1019</span></h2><div class="pubdate">11 Feb at 15:23:07 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1019">https://github.com/qt4cg/qtspecs/issues/1019</a></div><details><summary>XQFO: Unknown option parameters</summary><div class="markup"><p>The current <a href="https://qt4cg.org/specifications/xpath-functions-40/Overview.html#option-parameter-conventions">option parameter conventions</a> are:</p>
<blockquote>
<ol start="4">
<li>It is not an error if the options map contains options with names other than those described in this specification. Implementations MAY attach an ·implementation-defined· meaning to such entries, and MAY define errors that arise if such entries are present with invalid values. Implementations MUST ignore such entries unless they have a specific ·implementation-defined· meaning. Implementations that define additional options in this way SHOULD use values of type <code>xs:QName</code> as the option names, using an appropriate namespace.</li>
</ol>
</blockquote>
<p>The obvious consequence is that wrongly typed or unsupported options are not reported as such:</p>
<pre><code class="language-xquery">serialize($node, map { 'format': 'html' })
</code></pre>
<p>I think we should still allow proprietary options, but raise errors when an option is neither defined in the specification nor supported by the given implementation. On the one hand, this will help users to spot typos (e.g., <code>byte-order-mask</code> or instead of <code>byte-order-mark</code>). On the other hand, options that are supported by one implementation will be rejected, which feels reasonable to me, as options usually change either the result, or the way how the input is treated.</p>
<p>If we believe that this change is too disruptive, we could tolerate entries with <code>xs:QName</code> keys.</p>
</div></details></div>
<div class="toot" id="created-1018"><h2>Issue #1018 created<span class="toot-id"> #created-1018</span></h2><div class="pubdate">11 Feb at 07:01:28 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1018">https://github.com/qt4cg/qtspecs/issues/1018</a></div><details><summary>Output of parse-csv()</summary><div class="markup"><p>I propose making some simplifications to the output of parse-csv() to make it more amenable to processing.</p>
<ol>
<li>Represent each row as a map, rather than as a structure with a data field and an accessor function. Note that implementations worried about memory usage can devise a custom map implementation optimised for the case where many maps have the same regular structure. (cf recent thread about Javascript "shapes")</li>
<li>The key for a field in this map should be an integer if (i) column-names is set to false, or (ii) the column in question does not have a unique header name; in other cases it should be the name from the header.</li>
<li>Replace the top-level <code>columns</code> record with a simple array of field names. It's easy enough to map names to positions using index-of.</li>
</ol>
<p>I also propose changing the name to <code>csv-to-maps</code> for consistency with <code>csv-to-table</code> and <code>csv-to-arrays</code>.</p>
<p>We should advocate use of csv-to-arrays where data is to be accessed positionally, and csv-to-maps where it is to be accessed by column names, and optimise the design accordingly.</p>
<p>Looking at a use case, the first example (§15.4.7.1) would be unnecessary if as proposed we change csv-to-xml to generate XHTML directly, But if it were needed, it would change from</p>
<pre><code>let $csv := fn:parse-csv(`name,city{$crlf}Bob,Berlin`)
return &lt;table&gt;
   &lt;thead&gt;{
      for $column in $csv?columns?fields
         return &lt;th&gt;{ $column }&lt;/th&gt;
   }&lt;/thead&gt;
   &lt;tbody&gt;{
      for $row in $csv?rows return &lt;tr&gt;
         { for $field in $row?fields return &lt;td&gt;{ $field }&lt;/td&gt; }
      &lt;/tr&gt;
   }&lt;/tbody&gt;
&lt;/table&gt;
</code></pre>
<p>to</p>
<pre><code>let $csv := fn:parse-csv(`name,city{$crlf}Bob,Berlin`)
return &lt;table&gt;
   &lt;thead&gt;{
      for $column in $csv?columns
         return &lt;th&gt;{ $column }&lt;/th&gt;
   }&lt;/thead&gt;
   &lt;tbody&gt;{
      for $row in $csv?rows return &lt;tr&gt;
         { for $column in $csv?columns return &lt;td&gt;{ $row?$column }&lt;/td&gt; }
      &lt;/tr&gt;
   }&lt;/tbody&gt;
&lt;/table&gt;

</code></pre>
</div></details></div>
<div class="toot" id="created-1017"><h2>Issue #1017 created<span class="toot-id"> #created-1017</span></h2><div class="pubdate">11 Feb at 06:20:37 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1017">https://github.com/qt4cg/qtspecs/issues/1017</a></div><details><summary>Change csv-to-xml() to produce an XHTML table</summary><div class="markup"><p>I propose (a) renaming <code>csv-to-xml</code> as <code>csv-to-table</code>, and (b) changing the output to be an XHTML table. Specifically, instead of outputting</p>
<pre><code>&lt;csv xmlns="http://www.w3.org/2005/xpath-functions"&gt;
   &lt;columns&gt;
      &lt;column&gt;name&lt;/column&gt;
      &lt;column&gt;city&lt;/column&gt;
   &lt;/columns&gt;
   &lt;rows&gt;
      &lt;row&gt;
         &lt;field column="name"&gt;Bob&lt;/field&gt;
         &lt;field column="city"&gt;Berlin&lt;/field&gt;
      &lt;/row&gt;
      &lt;row&gt;
         &lt;field column="name"&gt;Alice&lt;/field&gt;
         &lt;field column="city"&gt;Aachen&lt;/field&gt;
      &lt;/row&gt;
   &lt;/rows&gt;
&lt;/csv&gt;
</code></pre>
<p>it should output:</p>
<pre><code>&lt;table xmlns="http://www.w3.org/1999/xhtml"&gt;
   &lt;thead&gt;
      &lt;tr&gt;
          &lt;th&gt;name&lt;/th&gt;
          &lt;th&gt;city&lt;/th&gt;
      &lt;/tr&gt;
   &lt;/thead&gt;
   &lt;tbody&gt;
      &lt;tr&gt;
         &lt;td title="name"&gt;Bob&lt;/td&gt;
         &lt;td title="city"&gt;Berlin&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
         &lt;td title="name"&gt;Alice&lt;/td&gt;
         &lt;td title="city"&gt;Aachen&lt;/td&gt;
      &lt;/tr&gt;
   &lt;/thead&gt;
&lt;/table&gt;
</code></pre>
<h3>Benefits:</h3>
<p>(a) the data is just as easy to manipulate or transform as the current output
(b) it can be copied directly into HTML transformation output if required
(c) it is familiar to users
(d) we don't have to write, test, and document a schema
(e) there may well be libraries that can perform further transformations on the structure, for example conversion to other table representations, extraction to spreadsheet formats, etc.</p>
</div></details></div>
<div class="toot" id="created-1016"><h2>Issue #1016 created<span class="toot-id"> #created-1016</span></h2><div class="pubdate">10 Feb at 21:02:24 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1016">https://github.com/qt4cg/qtspecs/issues/1016</a></div><details><summary>Editorial comments on fn:parse-csv()</summary><div class="markup"><p>(a) The spec says:</p>
<blockquote>
<p>The first argument is CSV data, as defined in ..., in the form of a sequence of xs:string values.</p>
</blockquote>
<p>But in fact, the argument is a single (optional) xs:string value, not a sequence.</p>
<p>(b) The spec says:</p>
<blockquote>
<p>If $csv is the empty sequence, implementations must return a parsed-csv-structure-record whose rows entry is the empty sequence.</p>
<p>If $csv is the empty sequence, but column name extraction has been requested, or explicit column names have been supplied, then the parsed-csv-structure-record returned by implementations must have a rows entry whose value is the empty sequence.</p>
</blockquote>
<p>The second paragraph seems to add nothing to the first.</p>
<p>(c) And the phrase "<em>implementations must return XXX</em>" is unidiomatic. The normal form of words is "<em>the function returns XXX</em>".</p>
<p>(d) The grammar of the sentence "Handling of delimiters, and whitespace trimming, are handled using..." is inelegant.</p>
<p>(e) References to the record type names (such as parsed-csv-structure-record) should be hyperlinked.</p>
</div></details></div>
<div class="toot" id="created-1015"><h2>Pull request #1015 created<span class="toot-id"> #created-1015</span></h2><div class="pubdate">09 Feb at 12:52:40 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1015">https://github.com/qt4cg/qtspecs/pull/1015</a></div><details><summary>1013 [XSLT] Clarify effect of accumulator capture on non-element nodes</summary><div class="markup"><p>Adds a sentence saying that when an accumulator rule with capture="yes" matches a non-element node, the capture attribute has no effect.</p>
<p>Fix #1013</p>
</div></details></div>
<div class="toot" id="created-1014"><h2>Issue #1014 created<span class="toot-id"> #created-1014</span></h2><div class="pubdate">08 Feb at 13:43:32 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1014">https://github.com/qt4cg/qtspecs/issues/1014</a></div><details><summary>Predicates, sequences of numbers: Feedback</summary><div class="markup"><p>Feedback on #996:</p>
<h3>Successful result: early exit</h3>
<p>If the EBV is computed, and if the first item is a node, the remaining items are ignored:</p>
<pre><code class="language-xquery">'OK'[ &lt;a/&gt;, 1, 'x' ]  →  'OK'
</code></pre>
<p>I would suggest doing the same for predicates that start with a number:</p>
<ul>
<li>If a comparison is successful, an implementation should be allowed to skip the remaining comparisons.</li>
<li>If <code>$seq</code> starts with a number, <code>E[$seq]</code> and <code>E[position() = $seq]</code> will become equivalent:</li>
</ul>
<pre><code class="language-xquery">$seq[1 to 100, 'x']
$seq[position() = (1 to 100, 'x')]
</code></pre>
<p>Obviously, an error still needs to be raised if a comparisons leads to a type error.</p>
<h3>Error Codes</h3>
<p>If we don’t equate <code>E[$seq]</code> and <code>E[position() = $seq]</code>, it would be useful to stick with <code>FORG0006</code> (instead of <code>XPTY0004</code>) [1]:</p>
<ul>
<li>It would be confusing to get <code>FORG0006</code> for <code>E['x', 1]</code> and <code>XPTY0004</code> for <code>E[1, 'x']</code>.</li>
<li>If a processor uses unified implementations for EBV and predicate checks, it leads to additional effort just because the error code differs.</li>
</ul>
<p>If we use different error codes, existing tests need to be revised ([2], maybe others).</p>
<p>[1] https://github.com/qt4cg/qtspecs/pull/996/files#diff-b37a92a9eb3ab9ba48a00de9627a1124466b9c86ecb2b4989d04be3942c597a6R8240
[2] https://github.com/qt4cg/qt4tests/blob/70e52c690a26bbeee0641af14ccb319a2cc98081/prod/Predicate.xml#L1158-L1165</p>
</div></details></div>
<div class="toot" id="closed-1012"><h2>Issue #1012 closed<span class="toot-id"> #closed-1012</span></h2><div class="pubdate">08 Feb at 10:50:17 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1012">https://github.com/qt4cg/qtspecs/pull/1012</a></div><p>Fix some incorrect examples in the F&amp;O spec</p></div>
<div class="toot" id="created-1013"><h2>Issue #1013 created<span class="toot-id"> #created-1013</span></h2><div class="pubdate">08 Feb at 09:14:57 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1013">https://github.com/qt4cg/qtspecs/issues/1013</a></div><details><summary>[XSLT] Need to say what happens when a capturing accumulator rule matches a non-element node</summary><div class="markup"><p>The option capture="yes" has been added to <code>xsl:accumulator-rule</code>; its purpose is to indicate that the entire subtree under an element is to be captured during streamed processing of the document, and is made available as an in-memory tree once the element end tag has been processed.</p>
<p>We need to say what happens when such a rule matches a node other than an element. I think it makes sense for the capture="yes" to be ignored, optionally with a warning.</p>
</div></details></div>
<div class="toot" id="created-1012"><h2>Pull request #1012 created<span class="toot-id"> #created-1012</span></h2><div class="pubdate">08 Feb at 00:57:07 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1012">https://github.com/qt4cg/qtspecs/pull/1012</a></div><details><summary>Fix some incorrect examples in the F&amp;O spec</summary><div class="markup"><p>No issue raised; the errors are revealed by the generated QT4 tests.</p>
</div></details></div>
<div class="toot" id="created-1011"><h2>Issue #1011 created<span class="toot-id"> #created-1011</span></h2><div class="pubdate">07 Feb at 20:52:49 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1011">https://github.com/qt4cg/qtspecs/issues/1011</a></div><details><summary>fn:transform() improvements</summary><div class="markup"><ol>
<li>The spec talks about how to invoke an XSLT 1.0, 2.0, or 3.0 processor, but not a 4.0 processor.</li>
<li>There is no way of supplying a source document in a way that allows streaming. Saxon has added a <code>source-location</code> parameter for this purpose; this should be in the standard.</li>
<li>If the stylesheet is to read streamed input, then there also needs to be control over whether and how it does schema validation.</li>
<li>When calling from XSLT, the best default for <code>base-output-uri</code> is probably the value of <code>current-output-uri()</code>. The default is currently implementation-defined, but we should recommend this possibility.</li>
<li>The post-process option was added with the aspiration that it would enable secondary result documents (xsl:result-document output) to be written directly (e.g. to filestore) as a side-effect. However, it fails to achieve this. There should probably be an option to request this even though we cannot define its semantics precisely.</li>
</ol>
</div></details></div>
<div class="toot" id="created-1010"><h2>Pull request #1010 created<span class="toot-id"> #created-1010</span></h2><div class="pubdate">07 Feb at 16:09:42 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1010">https://github.com/qt4cg/qtspecs/pull/1010</a></div><details><summary>1009 Examples, Return type of parse-json:fallback</summary><div class="markup"><p>Issue: #1009</p>
<p>I’ve used this PR to fix some other buggy examples in the XQFO spec.</p>
</div></details></div>
<div class="toot" id="created-1009"><h2>Issue #1009 created<span class="toot-id"> #created-1009</span></h2><div class="pubdate">07 Feb at 13:59:20 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1009">https://github.com/qt4cg/qtspecs/issues/1009</a></div><details><summary>QT4CG-064-03, QT4CG-064-04: Examples, Return type of `fallback`</summary><div class="markup"><p>Thanks for the attentive inspection of #975.</p>
<p>The type <code>xs:untypedAtomic</code> for the <code>fallback</code> function of <code>fn:parse-json</code> made no sense indeed: JSON escape sequence can never be converted to numbers. The return type will be <code>xs:anyAtomicType</code> instead of <code>item()</code> (the result will be converted to a string).</p>
<p>I’ll revise the rules and add some examples.</p>
</div></details></div>
<div class="toot" id="closed-977"><h2>Issue #977 closed<span class="toot-id"> #closed-977</span></h2><div class="pubdate">07 Feb at 13:09:37 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/977">https://github.com/qt4cg/qtspecs/pull/977</a></div><p>Ignore this, it's just a test</p></div>
<div class="toot" id="created-1008"><h2>Pull request #1008 created<span class="toot-id"> #created-1008</span></h2><div class="pubdate">07 Feb at 11:12:30 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1008">https://github.com/qt4cg/qtspecs/pull/1008</a></div><details><summary>1002 Add fn:take-while function (replacing subsequence-before)</summary><div class="markup"><p>Adds function <code>fn:take-while</code>, replacing/reinstating previously proposed <code>items-before()</code> and <code>subsequence-before()</code>.</p>
<p>Fix #1002</p>
</div></details></div>
<div class="toot" id="created-1007"><h2>Issue #1007 created<span class="toot-id"> #created-1007</span></h2><div class="pubdate">07 Feb at 09:45:19 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1007">https://github.com/qt4cg/qtspecs/issues/1007</a></div><details><summary>How to invert a predicate function</summary><div class="markup"><p>It's nice to be able to write</p>
<p><code>index-where($in, contains(?, 'e'))</code></p>
<p>to select all the items that contain an 'e'.</p>
<p>What should we write in order to select all the items that do not contain an 'e'? All formulations seem a bit clumsy in comparison:</p>
<p><code>index-where($in, fn{not(contains(., 'e'))})</code>
<code>index-where($in, chain((contains(?, 'e'), not#1))</code></p>
<p>Perhaps this is a sufficiently common requirement that it would be helpful to allow</p>
<p><code>index-where($in, inverse(contains(?, 'e')))</code></p>
<p>where <code>inverse($predicate)</code> is defined as <code>fn($it, $pos){not($predicate($it, $pos))}</code></p>
</div></details></div>
<div class="toot" id="created-1006"><h2>Issue #1006 created<span class="toot-id"> #created-1006</span></h2><div class="pubdate">07 Feb at 07:34:40 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1006">https://github.com/qt4cg/qtspecs/issues/1006</a></div><details><summary>regular expression addition - word boundaries</summary><div class="markup"><p>Could we provide support for the regex character sequence <code>\w</code> for matching word boundaries?</p>
<p>It’s already support by some processors via vendor-specific flags, and would be very helpful even if didn’t over the full Unicode range.</p>
</div></details></div>
<div class="toot" id="created-1005"><h2>Issue #1005 created<span class="toot-id"> #created-1005</span></h2><div class="pubdate">07 Feb at 07:26:23 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1005">https://github.com/qt4cg/qtspecs/issues/1005</a></div><details><summary>regular expressions - whitespace</summary><div class="markup"><p>There is some confusion about the rationale for defining the multi-character escape for whitespaces in a <a href="https://xmlcom.slack.com/archives/C011NLXE4DU/p1707158555769749">recent discussion</a> on Slack:</p>
<ul>
<li><code>\s</code> is limited to <code>[#x20\t\n\r]</code></li>
<li>In contrast, <code>\w\</code> covers <code>[#x0000-#x10FFFF]-[\p{P}\p{Z}\p{C}]</code>, i.e., considers the full Unicode range</li>
</ul>
<p>Do we know the reason?</p>
<p>I assume it’s both too late and out of scope to change that in our specs, but maybe we can improve the XQFO spec and…</p>
<ul>
<li>mention why <code>\s</code> does not include <code>\p{Zs}</code> or <code>\p{Z}</code></li>
<li>add an example for looking up non-breaking spaces… for example:</li>
</ul>
<pre><code class="language-xquery">matches(
  string-join(('my', 'pleasure'), char(0xA0)),
  '\p{Z}'
)
</code></pre>
</div></details></div>
<div class="toot" id="closed-1004"><h2>Issue #1004 closed<span class="toot-id"> #closed-1004</span></h2><div class="pubdate">07 Feb at 06:56:28 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1004">https://github.com/qt4cg/qtspecs/pull/1004</a></div><p>Updated as agreed 2024-02-06. </p></div>
<div class="toot" id="created-1004"><h2>Pull request #1004 created<span class="toot-id"> #created-1004</span></h2><div class="pubdate">07 Feb at 06:43:08 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1004">https://github.com/qt4cg/qtspecs/pull/1004</a></div><details><summary>Updated as agreed 2024-02-06. </summary><div class="markup"><p>The forms char('#32`) and char('#x20') are dropped.</p>
</div></details></div>
<div class="toot" id="closed-963"><h2>Issue #963 closed<span class="toot-id"> #closed-963</span></h2><div class="pubdate">07 Feb at 06:41:57 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/963">https://github.com/qt4cg/qtspecs/issues/963</a></div><p>Errors in forming function items (continued)</p></div>
<div class="toot" id="closed-888"><h2>Issue #888 closed<span class="toot-id"> #closed-888</span></h2><div class="pubdate">07 Feb at 06:41:57 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/888">https://github.com/qt4cg/qtspecs/issues/888</a></div><p>Reclassify XPDY0002 as a type error</p></div>
<div class="toot" id="closed-992"><h2>Issue #992 closed<span class="toot-id"> #closed-992</span></h2><div class="pubdate">07 Feb at 06:41:56 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/992">https://github.com/qt4cg/qtspecs/pull/992</a></div><p>888, 963: Error handling for unsatisfied context dependencies</p></div>
<div class="toot" id="created-1003"><h2>Pull request #1003 created<span class="toot-id"> #created-1003</span></h2><div class="pubdate">07 Feb at 00:05:22 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1003">https://github.com/qt4cg/qtspecs/pull/1003</a></div><details><summary>919 Use EBV in boolean callbacks</summary><div class="markup"><p>Changes functions with a $predicate callback function to use the effective boolean value of the result, mainly to allow things like <code>index-where(*, fn{self::x})</code>.</p>
<p>Fix #919</p>
</div></details></div>
<div class="toot" id="minutes-02-06"><h2>QT4 CG meeting 064 draft minutes<span class="toot-id"> #minutes-02-06</span></h2><div class="pubdate">06 Feb at 18:00:00 GMT</div><div class="link">Link: <a href="https://qt4cg.org/meeting/minutes/2024/02-06">https://qt4cg.org/meeting/minutes/2024/02-06</a></div><p>Draft minutes published.</p></div>
<div class="toot" id="closed-187"><h2>Issue #187 closed<span class="toot-id"> #closed-187</span></h2><div class="pubdate">06 Feb at 17:50:00 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/187">https://github.com/qt4cg/qtspecs/issues/187</a></div><p>Add a 'while' clause to FLWOR expressions</p></div>
<div class="toot" id="closed-943"><h2>Issue #943 closed<span class="toot-id"> #closed-943</span></h2><div class="pubdate">06 Feb at 17:49:59 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/943">https://github.com/qt4cg/qtspecs/pull/943</a></div><p>187 Add FLWOR expression while clause</p></div>
<div class="toot" id="closed-260"><h2>Issue #260 closed<span class="toot-id"> #closed-260</span></h2><div class="pubdate">06 Feb at 17:46:54 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/260">https://github.com/qt4cg/qtspecs/issues/260</a></div><p>array:index-of</p></div>
<div class="toot" id="closed-968"><h2>Issue #968 closed<span class="toot-id"> #closed-968</span></h2><div class="pubdate">06 Feb at 17:46:52 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/968">https://github.com/qt4cg/qtspecs/pull/968</a></div><p>260 array:index-of</p></div>
<div class="toot" id="closed-969"><h2>Issue #969 closed<span class="toot-id"> #closed-969</span></h2><div class="pubdate">06 Feb at 17:43:40 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/969">https://github.com/qt4cg/qtspecs/pull/969</a></div><p>843-partial Standard, array &amp; map functions: Equivalencies</p></div>
<div class="toot" id="closed-973"><h2>Issue #973 closed<span class="toot-id"> #closed-973</span></h2><div class="pubdate">06 Feb at 17:40:54 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/973">https://github.com/qt4cg/qtspecs/issues/973</a></div><p>fn:parse-json, fn:json-to-xml: `number-parser`, `fallback`</p></div>
<div class="toot" id="closed-975"><h2>Issue #975 closed<span class="toot-id"> #closed-975</span></h2><div class="pubdate">06 Feb at 17:40:52 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/975">https://github.com/qt4cg/qtspecs/pull/975</a></div><p>973 fn:parse-json, fn:json-to-xml: number-parser, fallback</p></div>
<div class="toot" id="closed-984"><h2>Issue #984 closed<span class="toot-id"> #closed-984</span></h2><div class="pubdate">06 Feb at 17:37:43 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/984">https://github.com/qt4cg/qtspecs/pull/984</a></div><p>959-partial Add fn:seconds function</p></div>
<div class="toot" id="closed-993"><h2>Issue #993 closed<span class="toot-id"> #closed-993</span></h2><div class="pubdate">06 Feb at 17:34:29 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/993">https://github.com/qt4cg/qtspecs/pull/993</a></div><p>989 (partial) Allow char() to take integer argument</p></div>
<div class="toot" id="closed-830"><h2>Issue #830 closed<span class="toot-id"> #closed-830</span></h2><div class="pubdate">06 Feb at 17:31:34 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/830">https://github.com/qt4cg/qtspecs/issues/830</a></div><p>Revise appendix D.4 of F+O: Illustrative user-written functions</p></div>
<div class="toot" id="closed-997"><h2>Issue #997 closed<span class="toot-id"> #closed-997</span></h2><div class="pubdate">06 Feb at 17:31:33 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/997">https://github.com/qt4cg/qtspecs/pull/997</a></div><p>830 Drop F+O appendix D.4</p></div>
<div class="toot" id="closed-816"><h2>Issue #816 closed<span class="toot-id"> #closed-816</span></h2><div class="pubdate">06 Feb at 17:28:28 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/816">https://github.com/qt4cg/qtspecs/issues/816</a></div><p>Predicates: Support for numeric sequences </p></div>
<div class="toot" id="closed-996"><h2>Issue #996 closed<span class="toot-id"> #closed-996</span></h2><div class="pubdate">06 Feb at 17:28:27 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/996">https://github.com/qt4cg/qtspecs/pull/996</a></div><p>816 Allow a predicate in a filter expression to be a sequence of numbers</p></div>
<div class="toot" id="closed-995"><h2>Issue #995 closed<span class="toot-id"> #closed-995</span></h2><div class="pubdate">06 Feb at 17:25:36 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/995">https://github.com/qt4cg/qtspecs/pull/995</a></div><p>937 revised in light of CG feedback</p></div>
<div class="toot" id="closed-628"><h2>Issue #628 closed<span class="toot-id"> #closed-628</span></h2><div class="pubdate">06 Feb at 17:22:23 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/628">https://github.com/qt4cg/qtspecs/issues/628</a></div><p>distinct-values and duplicate-values: order of results</p></div>
<div class="toot" id="closed-987"><h2>Issue #987 closed<span class="toot-id"> #closed-987</span></h2><div class="pubdate">06 Feb at 17:22:22 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/987">https://github.com/qt4cg/qtspecs/pull/987</a></div><p>628 Define result order for distinct-values and duplicate-values</p></div>
<div class="toot" id="closed-911"><h2>Issue #911 closed<span class="toot-id"> #closed-911</span></h2><div class="pubdate">06 Feb at 17:19:03 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/911">https://github.com/qt4cg/qtspecs/issues/911</a></div><p>Type "Promotion" in the coercion rules</p></div>
<div class="toot" id="closed-980"><h2>Issue #980 closed<span class="toot-id"> #closed-980</span></h2><div class="pubdate">06 Feb at 17:19:02 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/980">https://github.com/qt4cg/qtspecs/pull/980</a></div><p>911 Coercion to allow double to decimal etc</p></div>
<div class="toot" id="closed-966"><h2>Issue #966 closed<span class="toot-id"> #closed-966</span></h2><div class="pubdate">06 Feb at 17:14:35 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/966">https://github.com/qt4cg/qtspecs/issues/966</a></div><p>Rewrite spec of deep lookup operator: edits</p></div>
<div class="toot" id="closed-979"><h2>Issue #979 closed<span class="toot-id"> #closed-979</span></h2><div class="pubdate">06 Feb at 17:14:34 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/979">https://github.com/qt4cg/qtspecs/pull/979</a></div><p>966 Minor fixes to deep lookup </p></div>
<div class="toot" id="closed-964"><h2>Issue #964 closed<span class="toot-id"> #closed-964</span></h2><div class="pubdate">06 Feb at 17:12:24 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/964">https://github.com/qt4cg/qtspecs/issues/964</a></div><p>fn:has-attributes</p></div>
<div class="toot" id="closed-970"><h2>Issue #970 closed<span class="toot-id"> #closed-970</span></h2><div class="pubdate">06 Feb at 17:11:15 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/970">https://github.com/qt4cg/qtspecs/issues/970</a></div><p>XQFO: Context item → value</p></div>
<div class="toot" id="closed-971"><h2>Issue #971 closed<span class="toot-id"> #closed-971</span></h2><div class="pubdate">06 Feb at 17:11:13 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/971">https://github.com/qt4cg/qtspecs/pull/971</a></div><p>970 XQFO: Context item → value</p></div>
<div class="toot" id="created-1002"><h2>Issue #1002 created<span class="toot-id"> #created-1002</span></h2><div class="pubdate">06 Feb at 10:10:22 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1002">https://github.com/qt4cg/qtspecs/issues/1002</a></div><details><summary>Reinstate subsequence-before</summary><div class="markup"><p>There's a question on StackOverflow today:</p>
<p>https://stackoverflow.com/questions/77944304/</p>
<p>that makes me think dropping <code>subsequence-before</code> might have been a mistake (the replacement, <code>subsequence-where</code>, doesn't allow the end condition to be exclusive).</p>
<p>The question is how to find all the consecutive <code>list</code> elements that follow a given <code>para</code> element. That would be solved with <code>subsequence-before(following-sibling::*, fn{not(self::list)})</code>. Doing it with <code>subsequence-where</code> is much harder - you need to drop the final element in the result if it is not a <code>list</code> element, while also taking into account that the result might be empty.</p>
<p>I would like to propose reinstating subsequence-before; or perhaps inverting the predicate and naming it <code>subsequence-while()</code>, so it becomes <code>subsequence-while(following-sibling::*, fn{self::list})</code> assuming we accept the proposal in issue #919 to allow a callback predicate to use EBV.</p>
</div></details></div>
<div class="toot" id="created-1001"><h2>Issue #1001 created<span class="toot-id"> #created-1001</span></h2><div class="pubdate">05 Feb at 13:32:23 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1001">https://github.com/qt4cg/qtspecs/issues/1001</a></div><details><summary>fn:subsequence-where: equivalent `fn:slice` expression</summary><div class="markup"><p>I probably should have tagged #940 with »Request Changes«, as I believe the equivalent expression with <code>fn:slice</code> needs to be fixed (or removed if it turns out to be too quirky): https://github.com/qt4cg/qtspecs/pull/940#issuecomment-1919399348.</p>
</div></details></div>
<div class="toot" id="agenda-02-06"><h2>QT4 CG meeting 064 draft agenda<span class="toot-id"> #agenda-02-06</span></h2><div class="pubdate">05 Feb at 12:30:00 GMT</div><div class="link">Link: <a href="https://qt4cg.org/meeting/agenda/2024/02-06">https://qt4cg.org/meeting/agenda/2024/02-06</a></div><p>Draft agenda published.</p></div>
<div class="toot" id="closed-940"><h2>Issue #940 closed<span class="toot-id"> #closed-940</span></h2><div class="pubdate">05 Feb at 12:19:08 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/940">https://github.com/qt4cg/qtspecs/pull/940</a></div><p>878 Add subsequence-where function</p></div>
<div class="toot" id="created-1000"><h2>Issue #1000 created<span class="toot-id"> #created-1000</span></h2><div class="pubdate">04 Feb at 08:34:08 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1000">https://github.com/qt4cg/qtspecs/issues/1000</a></div><details><summary>XQFO Code in the Rules sections</summary><div class="markup"><p>In #978, it’s being discussed what is the best language for presenting code in the Rules sections of the XQFO specification. Currently, XPath is used for compact equivalencies, for example…</p>
<pre><code class="language-xquery">(: array:size :)
count(array:members($array))

(: fn:remove :)
$input[not(position() = $positions)].
</code></pre>
<p>...while XQuery is used for more complex expressions, including function declarations, or when the XPath representation would be syntactically more complex. Examples:</p>
<pre><code class="language-xquery">(: fn:deep-equal :)
declare function equal-strings(
  $string1   as xs:string,
  $string2   as xs:string, 
  $collation as xs:string,
  $options   as map(*)
) as xs:boolean {
  let $n1 := if ($options?whitespace = "normalize"))
             then normalize-unicode(?, $options?normalization-form) 
             else identity#1
  let $n2 := if ($options?normalize-space)
             then normalize-space#1 
             else identity#1               
  return compare($n1($n2($string1)), $n1($n2($string2)), $collation) eq 0    
}

(: fn:index-where :)
for $item at $pos in $input
where $predicate($item, $pos)
return $pos

(: …flatten, fold-left, while-do, others :)
</code></pre>
<p>Finally, we have many cases in which XPath/XQuery code is omitted, either because the presented feature is basic enough, because the equivalent code would get too complicated, or (e.g., for <code>fn:doc</code>) because it does not provide means to express the feature.</p>
<p>We should strive for consistency and decide which language(s) the majority of us believes is the best choice…</p>
<ol>
<li>XPath &amp; XQuery (what we currently have)</li>
<li>XPath only</li>
<li>XPath, XQuery and XSLT (whatever seems most appropriate)</li>
<li>Other pseudocode</li>
</ol>
</div></details></div>
<div class="toot" id="created-999"><h2>Issue #999 created<span class="toot-id"> #created-999</span></h2><div class="pubdate">04 Feb at 04:00:09 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/999">https://github.com/qt4cg/qtspecs/issues/999</a></div><details><summary>regular expression addition - comments</summary><div class="markup"><p>The original Perl regular expression syntax allows comments with the x flag. They use # to introduce comments up to a newline.</p>
<p>Maybe we could support XPath-style comments in regular expressions, such as <code>(:#.......#:)</code> when the x flag is present?</p>
<p>Today i use <code>(?:comment: stuff here )?</code> but this requires that "stuff here" can be compiled into a regular expression!</p>
</div></details></div>
<div class="toot" id="created-998"><h2>Issue #998 created<span class="toot-id"> #created-998</span></h2><div class="pubdate">04 Feb at 03:57:52 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/998">https://github.com/qt4cg/qtspecs/issues/998</a></div><details><summary>regular expression addition - lookbehind assertions and lookahead assertions</summary><div class="markup"><p>look-ahead assertions are i think the most useful things not found in qt regular expressions, and also look-behind.</p>
<p>This lets you do things like</p>
<pre><code>  replace( ., '
     / ( [^/]+ ) (*positive_lookahead: /)
    ', '...', 'x')
</code></pre>
<p>replacing components between /..../ but not consuming the trailing /, so that
/a/b/c/d/ comes out as /../../../../</p>
<p>Perl uses
(?=pattern), (*pla:pattern), (*positive_lookahead:pattern)
(?!pattern), (*nla:pattern), (*negative_lookahead:pattern)
to match only if the pattern is (or is not) followed by a match to pattern,</p>
<p>and
(?&lt;=pattern), \K, (*plb:pattern), (*popsitive_lookbehind:pattern)
(?&lt;!pattern), (*nlb:pattern), (*negative_lookbehind:pattern)
for zero-width look-behind assertions.</p>
<p>Note, libpcre (and older Perl version) restrict lookbehind assertions to fixed length. You can write
(?&lt;=dog|cat) food
to match " food" preceded by "dog" or "cat", but you cannot write
(?&lt;=dogs?|cats?) barking</p>
<p>\C is also forbidden, as are capturing subgroups. But the facility is still very useful, and reduces the need for repeated substitutions.</p>
<p>I propose adding only the first form in each case, not the newer "*" forms, which are less widely supported.</p>
</div></details></div>
<div class="toot" id="created-997"><h2>Pull request #997 created<span class="toot-id"> #created-997</span></h2><div class="pubdate">03 Feb at 22:29:35 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/997">https://github.com/qt4cg/qtspecs/pull/997</a></div><details><summary>830 Drop F+O appendix D.4</summary><div class="markup"><p>This PR drops the non-normative appendix D.4, which contained illustrative user-written functions. It was a very patchy and disorganised collection of functions which were primarily there because someone had proposed adding a function to the standard library and the WG had turned down the suggestion on the grounds that users could easily write the function themselves. It's not worth the effort of rewriting the appendix to take 4.0 enhancements into account.</p>
<p>Fix #830</p>
</div></details></div>
<div class="toot" id="created-996"><h2>Pull request #996 created<span class="toot-id"> #created-996</span></h2><div class="pubdate">03 Feb at 18:16:17 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/996">https://github.com/qt4cg/qtspecs/pull/996</a></div><details><summary>816 Allow a predicate in a filter expression to be a sequence of numbers</summary><div class="markup"><p>Fix #816</p>
</div></details></div>
<div class="toot" id="created-995"><h2>Pull request #995 created<span class="toot-id"> #created-995</span></h2><div class="pubdate">03 Feb at 03:34:18 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/995">https://github.com/qt4cg/qtspecs/pull/995</a></div><details><summary>937 revised in light of CG feedback</summary><div class="markup"><p>This revises #937 (catalyzed by #779) in light CG discussion that approved the PR.</p>
<ul>
<li>Output is now <code>xs:hexBinary?</code></li>
<li>Second parameter <code>$algorithm</code> replaced with an option map. In the specs I avoided <code>fos:values/fos:value</code>, because this would disallow for case/space normalization, and it would effectively disallow any implement-defined algorithms not on the list of three algorithms, and trigger the dynamic error described in rule 6 in the <a href="https://qt4cg.org/specifications/xpath-functions-40/Overview.html#option-parameter-conventions">option parameter conventions</a>.</li>
<li>Options map has only one option. It doesn't make sense to provide an option changing the kind of output.</li>
<li>I think this is the first example of an options map where the <code>fos:meaning</code> has rich text (paragraphs, unordered lists). It builds and renders fine locally.</li>
<li>Extra note on the output format.</li>
<li>Examples are expressed as chained functions, to illustrate how to get the customary string values.</li>
</ul>
</div></details></div>
<div class="toot" id="created-994"><h2>Issue #994 created<span class="toot-id"> #created-994</span></h2><div class="pubdate">02 Feb at 20:12:06 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/994">https://github.com/qt4cg/qtspecs/issues/994</a></div><details><summary>Invoking maps &amp; arrays: allow sequences?</summary><div class="markup"><p>Can’t we support integer sequences as arguments in dynamic function calls on maps and arrays?</p>
<p>The following query is already valid…</p>
<pre><code class="language-xquery">[ 3, 4, 5 ] ? (2, 1)
</code></pre>
<p>…but the number of users who are able to decode this syntax is very limited. It would be easier to allow:</p>
<pre><code class="language-xquery">[ 3, 4, 5 ](2, 1)
</code></pre>
<p>I would expect the results to be returned in the supplied order (<code>4</code> and <code>3</code>).</p>
</div></details></div>
<div class="toot" id="created-993"><h2>Pull request #993 created<span class="toot-id"> #created-993</span></h2><div class="pubdate">02 Feb at 18:39:42 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/993">https://github.com/qt4cg/qtspecs/pull/993</a></div><details><summary>989 (partial) Allow char() to take integer argument</summary><div class="markup"><p>Addresses the use case in issue #989. (But leave the issue open for now).</p>
<p>Discussion point: should we drop the options <code>char("#32")</code> and <code>char("#x20")</code> as they now seem redundant?</p>
</div></details></div>
<div class="toot" id="created-992"><h2>Pull request #992 created<span class="toot-id"> #created-992</span></h2><div class="pubdate">02 Feb at 18:17:51 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/992">https://github.com/qt4cg/qtspecs/pull/992</a></div><details><summary>888, 963: Error handling for unsatisfied context dependencies</summary><div class="markup"><p>Fix #963 by providing more detail on the expected error handling for partial function application.</p>
<p>Fix #888 by making XPDY0002 a type error rather than a dynamic error.</p>
</div></details></div>
<div class="toot" id="created-991"><h2>Issue #991 created<span class="toot-id"> #created-991</span></h2><div class="pubdate">02 Feb at 17:52:23 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/991">https://github.com/qt4cg/qtspecs/issues/991</a></div><details><summary>Invisible-xml - missing details</summary><div class="markup"><p>The spec for invisible-xml doesn't say whether the parsing function returns an element node or a document node.</p>
<p>It should also say, for completeness, that the parsing function is "nondeterministic with respect to node identity" - that is, if you parse the same input twice, its undefined whether you get the same node twice, or different nodes.</p>
</div></details></div>
<div class="toot" id="created-990"><h2>Issue #990 created<span class="toot-id"> #created-990</span></h2><div class="pubdate">02 Feb at 10:20:40 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/990">https://github.com/qt4cg/qtspecs/issues/990</a></div><details><summary>Transitive closure on non-nodes</summary><div class="markup"><p>In PR #988 I inadvertently used the transitive-closure function to process non-nodes; that's not supported by the current specification of the function.</p>
<p>The only difficulty in extending it is how to define a suitable identity comparator so we know when to terminate. Probably this should be done using a callback, defaulting to <code>op('is')</code>. In the use case of PR #988, the comparator could be supplied as <code>false#0</code> - the step function is acyclic, so we can treat all items reached as distinct.</p>
</div></details></div>
<div class="toot" id="created-989"><h2>Issue #989 created<span class="toot-id"> #created-989</span></h2><div class="pubdate">01 Feb at 12:19:31 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/989">https://github.com/qt4cg/qtspecs/issues/989</a></div><details><summary>character sequence constructor 'a' to 'z'</summary><div class="markup"><p>Although you can write 'a' to 'z' as</p>
<pre><code class="language-xpath">   (string-to-codepoints('a') to string-to-codepoints('z') ! codepoints-to-string()
</code></pre>
<p>i’m not sure this is easily discoverable.</p>
<p>Note, 'a' to 'z' is obviously dependent on the current collation - if you're using EBCDIC may the dogs help you. I’m assuming, however, any two Unicode characters could appear in the string literals, and it’d be an error to have more than one character in either string.</p>
<p>This means 'ċ' to 'ŗ’ would be an error, not equivalent to 'c' to 'r' (taking the first character of each string), since those are not precomposed forms.</p>
<p>Mostly, i tend to write this because of other languages - e.g. Perl has 'a' .. 'ÿ' or whatever, as does Ruby.</p>
<p>ICU in Python has UnicodeSet('[[:Ll:]&amp;[:Latin:]]') which is powerful but grokhard (&amp; here is intersect i think).</p>
<p>Although 'a' to 'z' is probably what i've seen &amp; used most often, 'a' to 'f' and '0' to '9' are also obvious candidates.</p>
</div></details></div>
<div class="toot" id="created-988"><h2>Pull request #988 created<span class="toot-id"> #created-988</span></h2><div class="pubdate">01 Feb at 11:59:16 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/988">https://github.com/qt4cg/qtspecs/pull/988</a></div><details><summary>960 Pinned and labeled values</summary><div class="markup"><p>This PR introduces the concepts of pinned and labelled values and the way in which they can be used to obtain additional information about the results of a deep lookup or map/array navigation operation. The changes at this stage are confined to a new section in the data model spec introducing the concept of labeled items, and a new section in the XPath language spec showing how these are used when navigating maps and arrays. This is a first step; if the WG approves of the general approach, there will be a lot more detail to add in due course.</p>
<p>The PR addresses a number of open issues:</p>
<p>Issue #960 - flattening of results from $map??KS
Issue #711 - using annotations for navigation of JSON trees
Issue #596 - pinned values: transforming trees
Issue #350 - CompPath (composite objects path) expressions
Issue #334 - Transient properties: selection and update in maps and arrays
Issue #262 - navigation in deep-structured arrays
Issue #108 - template match using values of tunnel parameters</p>
<p>It does not claim to resolve them all, but I believe it provides the groundwork for doing so.</p>
</div></details></div>
<div class="toot" id="created-987"><h2>Pull request #987 created<span class="toot-id"> #created-987</span></h2><div class="pubdate">31 Jan at 22:45:37 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/987">https://github.com/qt4cg/qtspecs/pull/987</a></div><details><summary>628 Define result order for distinct-values and duplicate-values</summary><div class="markup"><p>Fix #628</p>
</div></details></div>
<div class="toot" id="created-986"><h2>Issue #986 created<span class="toot-id"> #created-986</span></h2><div class="pubdate">31 Jan at 17:07:07 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/986">https://github.com/qt4cg/qtspecs/issues/986</a></div><details><summary>Numeric Comparisons</summary><div class="markup"><p>We've been trying to change the semantics of numeric comparison without breaking existing applications. As a result, the current status quo is very messy. Let's review where we are.</p>
<p>The eq/lt operators, given mixed operand types, convert decimal operands to double and compare as double. No change from 3.1. This comparison is not transitive in edge cases. The <code>=</code> and <code>&lt;</code> operators are defined in terms of <code>eq</code> and <code>lt</code>.</p>
<p>Map key comparisons compare as "infinite precision decimal". No change from 3.1. This comparison is now exposed as fn:atomic-equal().</p>
<p>deep-equal() refers to atomic-equal(), which is a change in behaviour from 3.1.</p>
<p>distinct-values() refers to deep-equal(), which is a change in behaviour - deliberate, because it needs to be transitive.</p>
<p>index-of() refers to eq. No change from 3.1.</p>
<p>compare() has been newly introduced; like atomic-equal() it uses infinite precision decimal for comparison.</p>
<p>sort() uses compare(). This is a change from 3.1; again needed because transitivity is important.</p>
<p>min() and max() use compare(). This is a change from 3.1.</p>
<p>The new highest() and lowest() functions use sort().</p>
<p>XSLT for-each-group refers to distinct-values().</p>
<p>XSLT xsl:sort currently refers to numeric-compare() and will presumably change to use compare().</p>
<p>XSLT xsl:merge refers to xsl:sort</p>
<p>XQuery "group by" refers to deep-equal()</p>
<p>XQuery "order by" refers to compare()</p>
<p>So:</p>
<ul>
<li>Nearly everything now uses decimal comparison where the operands are of mixed type</li>
<li>There are many different ways that we say this - it's often indirect. There are only two comparison methods, but you have to follow a chain of references to work out which one applies.</li>
<li>The two exceptions that still do comparison the 3.1 way (converting both operands to xs:double) are (a) the eq/lt/=/&lt; operators, and (b) the index-of and array:index-of functions.</li>
</ul>
<p>There are definitely things that now break. For example I was working on tests yesterday with assertions in the form deep-equal(nodes/number(.), (8.2, 5.4, 6.5)) - that is, comparing doubles to decimals. The nodes actually contain the strings "8.2", "5.4", "6.5". The test was failing because converting the string "8.2" to a double and then converting the double to a decimal does not produce the decimal value 8.2.</p>
<p>This mixed bag really doesn't seem acceptable. What options do we have?</p>
<ol>
<li>Be bold: make everything uniformly use transitive comparisons, and accept that some user code will break.</li>
<li>Be timid: use transitive comparisons only where it really matters (distinct-values, grouping, sorting) and use promotion to double everywhere else.</li>
<li>Compromise: introduce a compatibility mode, or a context option that allows users to control the behaviour, or another set of comparison operators.</li>
</ol>
<p>Any other ideas?</p>
</div></details></div>
<div class="toot" id="created-985"><h2>Pull request #985 created<span class="toot-id"> #created-985</span></h2><div class="pubdate">31 Jan at 12:29:36 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/985">https://github.com/qt4cg/qtspecs/pull/985</a></div><details><summary>720 Add lookup arrow expressions (method invocations)</summary><div class="markup"><p>Fix #720.</p>
<p>Replaces #916.</p>
</div></details></div>
<div class="toot" id="closed-948"><h2>Issue #948 closed<span class="toot-id"> #closed-948</span></h2><div class="pubdate">31 Jan at 10:10:03 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/948">https://github.com/qt4cg/qtspecs/issues/948</a></div><p>fn:scan-left and fn:scan-right - produce accumulation of results</p></div>
<div class="toot" id="created-984"><h2>Pull request #984 created<span class="toot-id"> #created-984</span></h2><div class="pubdate">31 Jan at 10:00:20 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/984">https://github.com/qt4cg/qtspecs/pull/984</a></div><details><summary>959-partial Add fn:seconds function</summary><div class="markup"><p>Issue: #959</p>
</div></details></div>
<div class="toot" id="created-983"><h2>Issue #983 created<span class="toot-id"> #created-983</span></h2><div class="pubdate">31 Jan at 09:30:37 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/983">https://github.com/qt4cg/qtspecs/issues/983</a></div><details><summary>fn:reduce (or fn:fold without initial value)</summary><div class="markup"><p>Various languages (Kotlin, F#, Haskell, Rust, Scala, others) offer two functions for what we summarize as folds: one that accepts an initial value and another one that consumes the first item of the input as initial value. The first function is usually called <code>fold</code>, the latter is called <code>reduce</code>, but some languages (like JavaScript) pack the functionality into a single function.</p>
<p>We have the same options:</p>
<ol>
<li>We could tweak <code>fn:fold-left</code> and <code>fn:fold-right</code> in a way that the <code>zero</code> argument is ignored if it’s not explicitly supplied:</li>
</ol>
<pre><code class="language-xquery">fold-left(1 to 5, action := op('*'))
</code></pre>
<p>However, the behavior would then differ from <code>fold-left(1 to 5, (), action := op('*'))</code>, which is something we tried to avoid in more recent functions (there are functions like <code>fn:name</code>, though, that behave similarly: <code>fn:name(())</code> and <code>fn:name()</code> does something different).</p>
<ol start="2">
<li>We could also introduce a separate function <code>fn:reduce</code> (or 2 variants, resp. 4 if we include arrays):</li>
</ol>
<pre><code class="language-xquery">fn:reduce(
  $input   as item()*,
  $action  as function(item()*, item()) as item()*
) as item()*
</code></pre>
<p>This would allow us to do  <code>reduce(1 to 5, op('*'))</code>, and for some people, a reduce function will be more familiar than a fold.</p>
<p>On Wikipedia, there’s a good summary on <a href="https://en.wikipedia.org/wiki/Fold_(higher-order_function)#In_various_languages">folds in various languages</a>.</p>
</div></details></div>
<div class="toot" id="created-982"><h2>Issue #982 created<span class="toot-id"> #created-982</span></h2><div class="pubdate">31 Jan at 08:57:02 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/982">https://github.com/qt4cg/qtspecs/issues/982</a></div><details><summary>Add position argument to scan-left and scan-right</summary><div class="markup"><p>We have added an optional position argument to nearly all callback functions that are invoked once for each item in a sequence. This argument is omitted from the new scan-left and scan-right functions. It should be added for consistency.</p>
<p>One of the proposed use cases for scan-left and scan-right is for debugging calls on fold-left and fold-right. This use case requires that the callback functions in the two cases are compatible.</p>
<p>Background note: the optional position argument is modelled on Javascript, where it is permitted in all the common higher-order functions such as <code>filter</code>, <code>forEach</code>, <code>reduce</code> and <code>reduceRight</code> (which are the Javascript equivalent of fold-left and fold-right). Javascript doesn't appear to offer an equivalent of <code>scan-left</code> and <code>scan-right</code>.</p>
</div></details></div>
<div class="toot" id="created-981"><h2>Issue #981 created<span class="toot-id"> #created-981</span></h2><div class="pubdate">31 Jan at 00:34:34 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/981">https://github.com/qt4cg/qtspecs/issues/981</a></div><details><summary>Identify optional arguments in callback functions</summary><div class="markup"><p>It was pointed out today that is not obvious, looking at a function signature like</p>
<pre><code>fn:filter(
  $input as&nbsp;item()*, | &nbsp;
  $predicate as&nbsp;function(item(), xs:integer) as xs:boolean | &nbsp;
)&nbsp;as&nbsp;item()*
</code></pre>
<p>that the second argument of the <code>$predicate</code> function is optional.</p>
<p>At least in the documentation, it would be useful to capture this in some way. Being "optional" here means that it makes sense, semantically, to supply an arity-1 function, in which case the caller will not supply the second argument.</p>
<p>Perhaps it would also be useful to go beyond documentation, and attach some syntax and semantics to it. Specifically, if the signature of the callback function indicates that the first N arguments are required, then supplying a function item of arity less than N will result in a type error.</p>
</div></details></div>
<div class="toot" id="created-980"><h2>Pull request #980 created<span class="toot-id"> #created-980</span></h2><div class="pubdate">30 Jan at 23:59:02 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/980">https://github.com/qt4cg/qtspecs/pull/980</a></div><details><summary>911 Coercion to allow double to decimal etc</summary><div class="markup"><p>Fix #911 The coercion rules are changed to allow implicit casts among numeric types, for example a double can be supplied where the required type is decimal. (The term "promotion" is now used only for operators, where the two operands must be converted to a common type.)</p>
</div></details></div>
<div class="toot" id="created-979"><h2>Pull request #979 created<span class="toot-id"> #created-979</span></h2><div class="pubdate">30 Jan at 23:11:51 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/979">https://github.com/qt4cg/qtspecs/pull/979</a></div><details><summary>966 Minor fixes to deep lookup </summary><div class="markup"><p>Fix #966</p>
<p>Apply suggestions in Christian Grün's comments on PR #927.</p>
</div></details></div>
<div class="toot" id="created-978"><h2>Pull request #978 created<span class="toot-id"> #created-978</span></h2><div class="pubdate">30 Jan at 21:14:30 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/978">https://github.com/qt4cg/qtspecs/pull/978</a></div><details><summary>948 Reflected the comments of the CG on the specification of scan-left and scan-right</summary><div class="markup"><p>Reflected the comments of the CG on the specification of scan-left and scan-right</p>
</div></details></div>
<div class="toot" id="created-977"><h2>Pull request #977 created<span class="toot-id"> #created-977</span></h2><div class="pubdate">30 Jan at 17:42:40 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/977">https://github.com/qt4cg/qtspecs/pull/977</a></div><details><summary>Ignore this, it's just a test</summary><div class="markup"><p>I'm trying to work out why sometimes PR succeeds when it contains markup errors...</p>
</div></details></div>
<div class="toot" id="closed-976"><h2>Issue #976 closed<span class="toot-id"> #closed-976</span></h2><div class="pubdate">30 Jan at 17:32:10 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/976">https://github.com/qt4cg/qtspecs/pull/976</a></div><p>Fix markup errors with fos:notes</p></div>
<div class="toot" id="created-976"><h2>Pull request #976 created<span class="toot-id"> #created-976</span></h2><div class="pubdate">30 Jan at 17:32:03 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/976">https://github.com/qt4cg/qtspecs/pull/976</a></div><p>Fix markup errors with fos:notes</p></div>
<div class="toot" id="minutes-01-30"><h2>QT4 CG meeting 063 draft minutes<span class="toot-id"> #minutes-01-30</span></h2><div class="pubdate">30 Jan at 17:15:00 GMT</div><div class="link">Link: <a href="https://qt4cg.org/meeting/minutes/2024/01-30">https://qt4cg.org/meeting/minutes/2024/01-30</a></div><p>Draft minutes published.</p></div>
<div class="toot" id="closed-957"><h2>Issue #957 closed<span class="toot-id"> #closed-957</span></h2><div class="pubdate">30 Jan at 17:00:54 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/957">https://github.com/qt4cg/qtspecs/pull/957</a></div><p>948 Added fn:scan-left and fn:scan-right</p></div>
<div class="toot" id="closed-965"><h2>Issue #965 closed<span class="toot-id"> #closed-965</span></h2><div class="pubdate">30 Jan at 16:59:32 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/965">https://github.com/qt4cg/qtspecs/pull/965</a></div><p>XQFO: minor edits and bug fixes</p></div>
<div class="toot" id="created-975"><h2>Pull request #975 created<span class="toot-id"> #created-975</span></h2><div class="pubdate">29 Jan at 16:32:27 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/975">https://github.com/qt4cg/qtspecs/pull/975</a></div><details><summary>973 fn:parse-json, fn:json-to-xml: number-parser, fallback</summary><div class="markup"><p>Issue: #973.</p>
<p>In addition, I fixed the description for the <code>fallback</code> option <code>fn:parse-json</code>, as it seemed incomplete to me:</p>
<blockquote>
<p>The function is called when the JSON input contains a special character (as defined under the escape option) that is valid according to the JSON grammar, whether the special character is represented in the input directly or as an escape sequence.</p>
</blockquote>
</div></details></div>
<div class="toot" id="closed-974"><h2>Issue #974 closed<span class="toot-id"> #closed-974</span></h2><div class="pubdate">29 Jan at 12:32:15 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/974">https://github.com/qt4cg/qtspecs/issues/974</a></div><p>Rules for context-dependent function references in XSLT (e.g. regex-group#1)</p></div>
<div class="toot" id="agenda-01-30"><h2>QT4 CG meeting 063 draft agenda<span class="toot-id"> #agenda-01-30</span></h2><div class="pubdate">29 Jan at 12:30:00 GMT</div><div class="link">Link: <a href="https://qt4cg.org/meeting/agenda/2024/01-30">https://qt4cg.org/meeting/agenda/2024/01-30</a></div><p>Draft agenda published.</p></div>
<div class="toot" id="created-974"><h2>Issue #974 created<span class="toot-id"> #created-974</span></h2><div class="pubdate">29 Jan at 12:25:30 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/974">https://github.com/qt4cg/qtspecs/issues/974</a></div><details><summary>Rules for context-dependent function references in XSLT (e.g. regex-group#1)</summary><div class="markup"><p>I'm not sure where we are on this one.</p>
<p>Does regex-group#1 capture the "current matching substrings" component of the dynamic context?</p>
<p>XSLT 4.0 test case analyze-string-101 suggests that it does, and that this represents a change from 3.0 -- there are separate versions of the test with different expected results for the two cases.</p>
<p>But §5.4 of the XSLT 4.0 spec still ends with the sentence:</p>
<p><code>This rule does not extend to the XSLT extensions to the dynamic context defined in this section. If a dynamic function call is made that depends on the XSLT part of the dynamic context (for example, regex-group#1(2)), then the relevant components of the context are cleared as described in the table above.</code></p>
<p>I suspect this sentence should have been deleted, but need to track down the history.</p>
</div></details></div>
<div class="toot" id="created-973"><h2>Issue #973 created<span class="toot-id"> #created-973</span></h2><div class="pubdate">29 Jan at 12:24:20 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/973">https://github.com/qt4cg/qtspecs/issues/973</a></div><details><summary>fn:parse-json, fn:json-to-xml: `number-parser`, `fallback`</summary><div class="markup"><ol>
<li>See #33: <code>number-parser</code> option needs to be added to <code>fn:json-to-xml</code>.</li>
<li>Similar to <code>fn:replace</code>, I would suggest using <code>function(xs:untypedAtomic) as item()?)</code> as signature for both the <code>fallback</code> and the <code>number-parser</code> option, and (for <code>fallback</code>) to invoke <code>fn:string#1</code> on the result. This way, explicit casts in the code get obsolete. Queries like the following one…</li>
</ol>
<pre><code class="language-xquery">parse-json(
  '-123',
  map { 'number-parser': fn($n) { $n =&gt; number() =&gt; abs() }
)
</code></pre>
<p>…can then be simplified to <code>parse-json('-123', abs#1)</code>.</p>
</div></details></div>
<div class="toot" id="created-972"><h2>Pull request #972 created<span class="toot-id"> #created-972</span></h2><div class="pubdate">29 Jan at 11:28:08 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/972">https://github.com/qt4cg/qtspecs/pull/972</a></div><details><summary>949 Partial Function Applications: Allow return of function name</summary><div class="markup"><p>Issue: #949. The major change is the rule for the <code>name</code> property of partial function applications for static function calls.</p>
<p>In addition, I have unified the presentation of the different function item expressions.</p>
<p>Affects test cases like <code>xqhof40</code> (which need to be fixed with or without this PR).</p>
</div></details></div>
<div class="toot" id="created-971"><h2>Pull request #971 created<span class="toot-id"> #created-971</span></h2><div class="pubdate">29 Jan at 10:20:33 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/971">https://github.com/qt4cg/qtspecs/pull/971</a></div><details><summary>970 XQFO: Context item → value</summary><div class="markup"><p>Issue: #970</p>
</div></details></div>
<div class="toot" id="created-970"><h2>Issue #970 created<span class="toot-id"> #created-970</span></h2><div class="pubdate">28 Jan at 10:38:53 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/970">https://github.com/qt4cg/qtspecs/issues/970</a></div><details><summary>XQFO: Context item → value</summary><div class="markup"><p>Resulting from #129 (related: #755): Many rules in the XQFO spec still refer to the context item, which is currently defined as follows:</p>
<blockquote>
<p>When the context value is a single item, it can also be referred to as the context item; when it is a single node, it can also be referred to as the context node.</p>
</blockquote>
<p>We need to make clear what’s going to happen if the context value is not a single item:</p>
<ul>
<li>In many cases, this can simply be done by replacing “context item” with “context value”.</li>
<li>In some cases (e.g. for <code>fn:string#0</code>), we should specify that an error is raised (usually <code>XPTY0004</code>) if the input is not a single item.</li>
</ul>
</div></details></div>
<div class="toot" id="closed-878"><h2>Issue #878 closed<span class="toot-id"> #closed-878</span></h2><div class="pubdate">25 Jan at 08:42:28 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/878">https://github.com/qt4cg/qtspecs/issues/878</a></div><p>Proposed extension to subsequence</p></div>
<div class="toot" id="created-969"><h2>Pull request #969 created<span class="toot-id"> #created-969</span></h2><div class="pubdate">24 Jan at 18:19:41 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/969">https://github.com/qt4cg/qtspecs/pull/969</a></div><details><summary>843-partial Standard, array &amp; map functions: Equivalencies</summary><div class="markup"><p>Issue: #843</p>
<p>Maybe we should keep the issue open after merging this PR.</p>
</div></details></div>
<div class="toot" id="created-968"><h2>Pull request #968 created<span class="toot-id"> #created-968</span></h2><div class="pubdate">24 Jan at 17:57:10 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/968">https://github.com/qt4cg/qtspecs/pull/968</a></div><details><summary>260 array:index-of</summary><div class="markup"><p>Issue: #260</p>
</div></details></div>
<div class="toot" id="created-967"><h2>Issue #967 created<span class="toot-id"> #created-967</span></h2><div class="pubdate">24 Jan at 13:22:30 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/967">https://github.com/qt4cg/qtspecs/issues/967</a></div><details><summary>XPath Appendix I: Comparisons</summary><div class="markup"><p>Adopted from https://github.com/qt4cg/qtspecs/issues/260#issuecomment-1908033129</p>
<blockquote>
<p>It would be useful if all functions that perform comparison included a cross-reference to the new XPath Appendix I; and I note that appendix doesn't seem to mention index-of.</p>
</blockquote>
<p>@michaelhkay I’ve taken the liberty of assigning this to you, as I wasn’t sure what this is about.</p>
</div></details></div>
<div class="toot" id="closed-874"><h2>Issue #874 closed<span class="toot-id"> #closed-874</span></h2><div class="pubdate">24 Jan at 09:51:47 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/874">https://github.com/qt4cg/qtspecs/pull/874</a></div><p>878 Proposed extension to subsequence</p></div>
<div class="toot" id="created-966"><h2>Issue #966 created<span class="toot-id"> #created-966</span></h2><div class="pubdate">23 Jan at 20:23:41 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/966">https://github.com/qt4cg/qtspecs/issues/966</a></div><details><summary>Rewrite spec of deep lookup operator: edits</summary><div class="markup"><p>@michaelhkay I've created a little new issue to keep track of the 3 minor suggestions that I made in the PR that we merged today: https://github.com/qt4cg/qtspecs/pull/927</p>
</div></details></div>
<div class="toot" id="created-965"><h2>Pull request #965 created<span class="toot-id"> #created-965</span></h2><div class="pubdate">23 Jan at 18:20:57 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/965">https://github.com/qt4cg/qtspecs/pull/965</a></div><p>XQFO: minor edits and bug fixes</p></div>
<div class="toot" id="closed-818"><h2>Issue #818 closed<span class="toot-id"> #closed-818</span></h2><div class="pubdate">23 Jan at 17:52:30 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/818">https://github.com/qt4cg/qtspecs/issues/818</a></div><p>Foxpath integration</p></div>
<div class="toot" id="closed-693"><h2>Issue #693 closed<span class="toot-id"> #closed-693</span></h2><div class="pubdate">23 Jan at 17:52:25 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/693">https://github.com/qt4cg/qtspecs/issues/693</a></div><p>QT4 Tests without counterpart in the specs</p></div>
<div class="toot" id="closed-639"><h2>Issue #639 closed<span class="toot-id"> #closed-639</span></h2><div class="pubdate">23 Jan at 17:52:16 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/639">https://github.com/qt4cg/qtspecs/issues/639</a></div><p>fn:void: Naming, Arguments</p></div>
<div class="toot" id="closed-937"><h2>Issue #937 closed<span class="toot-id"> #closed-937</span></h2><div class="pubdate">23 Jan at 17:50:18 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/937">https://github.com/qt4cg/qtspecs/pull/937</a></div><p>779 hash function</p></div>
<div class="toot" id="closed-946"><h2>Issue #946 closed<span class="toot-id"> #closed-946</span></h2><div class="pubdate">23 Jan at 17:46:27 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/946">https://github.com/qt4cg/qtspecs/issues/946</a></div><p>fn:iterate-while → fn:while-do, fn:do-until</p></div>
<div class="toot" id="closed-962"><h2>Issue #962 closed<span class="toot-id"> #closed-962</span></h2><div class="pubdate">23 Jan at 17:46:26 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/962">https://github.com/qt4cg/qtspecs/pull/962</a></div><p>946 fn:iterate-while → fn:while-do, fn:do-until</p></div>
<div class="toot" id="closed-951"><h2>Issue #951 closed<span class="toot-id"> #closed-951</span></h2><div class="pubdate">23 Jan at 17:42:00 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/951">https://github.com/qt4cg/qtspecs/issues/951</a></div><p>Parameters with default values: fn:lang, fn:id, fn:idref, fn:element-with-id</p></div>
<div class="toot" id="closed-958"><h2>Issue #958 closed<span class="toot-id"> #closed-958</span></h2><div class="pubdate">23 Jan at 17:41:58 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/958">https://github.com/qt4cg/qtspecs/pull/958</a></div><p>951 Parameters with default values: fn:lang, fn:id, fn:idref, fn:element-id</p></div>
<div class="toot" id="closed-945"><h2>Issue #945 closed<span class="toot-id"> #closed-945</span></h2><div class="pubdate">23 Jan at 17:38:07 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/945">https://github.com/qt4cg/qtspecs/issues/945</a></div><p>Module import: apparent contradiction</p></div>
<div class="toot" id="closed-952"><h2>Issue #952 closed<span class="toot-id"> #closed-952</span></h2><div class="pubdate">23 Jan at 17:38:06 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/952">https://github.com/qt4cg/qtspecs/pull/952</a></div><p>945 module import contradiction</p></div>
<div class="toot" id="closed-950"><h2>Issue #950 closed<span class="toot-id"> #closed-950</span></h2><div class="pubdate">23 Jan at 17:34:48 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/950">https://github.com/qt4cg/qtspecs/pull/950</a></div><p>Minor edits (examples, rules)</p></div>
<div class="toot" id="closed-939"><h2>Issue #939 closed<span class="toot-id"> #closed-939</span></h2><div class="pubdate">23 Jan at 17:31:38 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/939">https://github.com/qt4cg/qtspecs/issues/939</a></div><p>Remove fn:numeric-compare</p></div>
<div class="toot" id="closed-941"><h2>Issue #941 closed<span class="toot-id"> #closed-941</span></h2><div class="pubdate">23 Jan at 17:31:37 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/941">https://github.com/qt4cg/qtspecs/pull/941</a></div><p>939 Remove fn:numeric-compare</p></div>
<div class="toot" id="closed-936"><h2>Issue #936 closed<span class="toot-id"> #closed-936</span></h2><div class="pubdate">23 Jan at 17:28:30 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/936">https://github.com/qt4cg/qtspecs/pull/936</a></div><p>877 revised rules for op:binary-less-than</p></div>
<div class="toot" id="closed-861"><h2>Issue #861 closed<span class="toot-id"> #closed-861</span></h2><div class="pubdate">23 Jan at 17:25:03 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/861">https://github.com/qt4cg/qtspecs/issues/861</a></div><p>Precise meaning of $E??KS</p></div>
<div class="toot" id="closed-927"><h2>Issue #927 closed<span class="toot-id"> #closed-927</span></h2><div class="pubdate">23 Jan at 17:25:02 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/927">https://github.com/qt4cg/qtspecs/pull/927</a></div><p>861 Rewrite spec of deep lookup operator</p></div>
<div class="toot" id="minutes-01-23"><h2>QT4 CG meeting 062 draft minutes<span class="toot-id"> #minutes-01-23</span></h2><div class="pubdate">23 Jan at 17:15:00 GMT</div><div class="link">Link: <a href="https://qt4cg.org/meeting/minutes/2024/01-23">https://qt4cg.org/meeting/minutes/2024/01-23</a></div><p>Draft minutes published.</p></div>
<div class="toot" id="created-964"><h2>Issue #964 created<span class="toot-id"> #created-964</span></h2><div class="pubdate">23 Jan at 12:30:08 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/964">https://github.com/qt4cg/qtspecs/issues/964</a></div><details><summary>fn:has-attributes</summary><div class="markup"><p>Trivial (motivated by a user request):</p>
<p>As there is an <code>fn:has-children</code> function, it seems surprising that there is no <code>fn:has-attributes</code> function.</p>
<p>I would suggest…</p>
<ul>
<li>adding this function to the spec, or</li>
<li>indicating in a note (for <code>fn:has-children</code>) why this function is missing.</li>
</ul>
</div></details></div>
<div class="toot" id="created-963"><h2>Issue #963 created<span class="toot-id"> #created-963</span></h2><div class="pubdate">23 Jan at 08:29:29 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/963">https://github.com/qt4cg/qtspecs/issues/963</a></div><details><summary>Errors in forming function items (continued)</summary><div class="markup"><p>In #894, the following rule was added to the definition of <strong>Named Function References</strong>:</p>
<blockquote>
<p>An error is raised if the identified function depends on components of the static or dynamic context that are not present, or that have unsuitable values. […] <code>DC0001</code> is raised for the call <code>fn:id#1</code> if the context item is not a node in a tree that is rooted at a document node.</p>
</blockquote>
<p>We should be consistent and add this rule to <strong>Partial Function Applications</strong> and <strong>Inline Function Expressions</strong> as well. Perhaps such rules could be defined just once for all affected function item constructors in the parent section?</p>
<p>Also, the error code doesn’t seem to be properly defined in the spec, it shows <code>[ERROR errorref DC0001 NOT FOUND]</code> (maybe that’s intentional at this editing stage.)</p>
</div></details></div>
<div class="toot" id="agenda-01-23"><h2>QT4 CG meeting 062 draft agenda<span class="toot-id"> #agenda-01-23</span></h2><div class="pubdate">22 Jan at 14:30:00 GMT</div><div class="link">Link: <a href="https://qt4cg.org/meeting/agenda/2024/01-23">https://qt4cg.org/meeting/agenda/2024/01-23</a></div><p>Draft agenda published.</p></div>
<div class="toot" id="created-962"><h2>Pull request #962 created<span class="toot-id"> #created-962</span></h2><div class="pubdate">20 Jan at 14:24:51 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/962">https://github.com/qt4cg/qtspecs/pull/962</a></div><details><summary>946 fn:iterate-while → fn:while-do, fn:do-until</summary><div class="markup"><p>My first thought was to name the second function <code>fn:do-while</code>, but <code>fn:do-until</code> with an inversed predicate seemed more appropriate to me.</p>
<p>Issue: #946</p>
</div></details></div>
<div class="toot" id="created-961"><h2>Issue #961 created<span class="toot-id"> #created-961</span></h2><div class="pubdate">20 Jan at 10:11:12 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/961">https://github.com/qt4cg/qtspecs/issues/961</a></div><details><summary>Simulating Objects: Performance</summary><div class="markup"><p>Related to #953, #917 and #916, I wonder whether we are aware enough of the essential differences when we think of objects in a functional language:</p>
<ul>
<li>Mutable objects are extremely efficient, as an update is a simple main-memory value change.</li>
<li>Immutable data structures need to be fully copied if a single value changes. As a result, the update of a map with, let’s say, 1 string and 50 functions would be a new map with 1 string and 50 functions. Even with efficient immutable map implementations that we have, I doubt that it makes sense to create full copies with 1+50 entries, of which only 1 string will be different.</li>
<li>Imagine a FLWOR expression that creates 1000 of such maps, with possibly 1 value that’s different in each instance. We don’t need 1000 copies of 50 functions; the memory consumption would be much smaller if we only stored relevant values.</li>
</ul>
<p>This thread is not about premature optimization; I just want to be sure we think about the obstacles when using maps for objects. Maybe the solutions are already on the horizon; maybe we could tackle some of the concerns with the definition of default values…</p>
<pre><code class="language-xquery">declare record person(
  name   as xs:string,
  title  := (),
  full   := fn { string-join((?title, ?name), ' ') }
);
</code></pre>
<p>…and maps with type annotations. If we don’t materialize defaults, the embedded annotation would indeed need to effect functions like <code>map:get</code>, as questioned by Michael in https://github.com/qt4cg/qtspecs/pull/953#issuecomment-1896078605.</p>
</div></details></div>
<div class="toot" id="created-960"><h2>Issue #960 created<span class="toot-id"> #created-960</span></h2><div class="pubdate">19 Jan at 16:24:21 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/960">https://github.com/qt4cg/qtspecs/issues/960</a></div><details><summary>Should ??KS flatten the results</summary><div class="markup"><p>Currently the result of <code>??KS</code> (like <code>?KS</code>) is flattened. So if you do <code>??dimensions</code> and the value of each <code>dimensions</code> entry is a sequence of zero or more numbers, the result munges them all together into a single sequence (dropping any empty values in the process).</p>
<p>Should we change this, for example to return a sequence of arrays, or an array of sequences?</p>
<p>This makes life a bit more difficult in the simple case where all the values are singletons -- and notably, when constructing a path such as <code>??A??B??C</code> -- but it makes it possible to handle the more general case where they aren't all singletons.</p>
</div></details></div>
<div class="toot" id="created-959"><h2>Issue #959 created<span class="toot-id"> #created-959</span></h2><div class="pubdate">18 Jan at 17:06:07 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/959">https://github.com/qt4cg/qtspecs/issues/959</a></div><details><summary>Milliseconds ↔ xs:dayTimeDuration, Unix time ↔ xs:dateTime</summary><div class="markup"><p>We should extend the constructor functions to convert integers (millisecond, and the Unix time, starting from <code>1970-01-01T00:00:00Z</code>) to <code>xs:dayTimeDuration</code> and <code>xs:dateTime</code> instances…</p>
<pre><code class="language-xquery">xs:dateTime(12345),
xs:dayTimeDuration(12345)
</code></pre>
<p>…and it should be possible to convert the values back to integers.</p>
<p>Related: https://docs.basex.org/wiki/Conversion_Module#Dates_and_Durations</p>
</div></details></div>
<div class="toot" id="created-958"><h2>Pull request #958 created<span class="toot-id"> #created-958</span></h2><div class="pubdate">18 Jan at 13:39:17 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/958">https://github.com/qt4cg/qtspecs/pull/958</a></div><details><summary>951 Parameters with default values: fn:lang, fn:id, fn:idref, fn:element-id</summary><div class="markup"><p>Editorial (#951): Reverts the changes made in #901 for 4 context-dependent functions.</p>
</div></details></div>
<div class="toot" id="created-957"><h2>Pull request #957 created<span class="toot-id"> #created-957</span></h2><div class="pubdate">18 Jan at 01:31:27 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/957">https://github.com/qt4cg/qtspecs/pull/957</a></div><details><summary>948 Added fn:scan-left and fn:scan-right</summary><div class="markup"><p>As discussed at https://github.com/qt4cg/qtspecs/issues/948</p>
</div></details></div>
<div class="toot" id="created-956"><h2>Pull request #956 created<span class="toot-id"> #created-956</span></h2><div class="pubdate">17 Jan at 17:41:02 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/956">https://github.com/qt4cg/qtspecs/pull/956</a></div><details><summary>850-partial Editorial improvements to parse-html()</summary><div class="markup"><p>Related to issue #850, but doesn't close it entirely.</p>
</div></details></div>
<div class="toot" id="created-955"><h2>Issue #955 created<span class="toot-id"> #created-955</span></h2><div class="pubdate">17 Jan at 12:00:36 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/955">https://github.com/qt4cg/qtspecs/issues/955</a></div><details><summary>Options parameters as record types</summary><div class="markup"><p>In the new parse-html() function, the content of the options parameter is described using a record type. This differs from other functions, that describe the type as map(*), and have a statement that "the option parameter conventions apply".</p>
<p>Ideally we should use record types for all options parameters. However we need to check carefully that this does not affect edge-case compatibility, for example implicit conversions or the acceptability of extensions. If we can't do that then we should bring parse-html() into line with other functions such as parse-json().</p>
</div></details></div>
<div class="toot" id="created-954"><h2>Issue #954 created<span class="toot-id"> #created-954</span></h2><div class="pubdate">17 Jan at 00:45:02 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/954">https://github.com/qt4cg/qtspecs/issues/954</a></div><details><summary>Establish a default value for the XSLT fixed-namespaces attribute</summary><div class="markup"><p>The newly-defined <a href="https://qt4cg.org/specifications/xslt-40/Overview.html#fixed-namespaces"><strong>fixed-namespaces</strong> attribute</a> on the <em><code>xsl:stylesheet</code></em> element is a huge positive step towards improving programmer's productivity by removing the need to provide up to 9 namespace declarations in every stylesheet module, thus reducing unnecessary cluttering, simplifying and slimming the code and increasing its readability.</p>
<p>It seems like an accidental omission that the current text doesn't specify a default value for this attribute. If there is a well-chosen default value, this would even further decrease the requirements for the programmer to engage in such a non-problem-solving activity as entering memorized strings, and would prevent errors such as either not providing the correct values for the namespace-uris or forgetting to specify this new attribute.</p>
<p>One obvious candidate for a default value of the <strong>fixed-namespaces</strong> attribute is <code>#standard</code>, which means that without having to press even a single additional key, the XSLT programmer gets all standard namespaces automatically bound to the well-known prefixes:</p>
<p><code>xsl</code> <code>xml</code> <code>xs</code> <code>xsi</code> <code>fn</code>  <code>math</code> <code>map</code> <code>array</code> <code>err</code></p>
<h3>Proposal:</h3>
<p>Please, augment the current text by specifying that the default value for the <strong>fixed-namespaces</strong> attribute is <code>#standard</code></p>
</div></details></div>
<div class="toot" id="created-953"><h2>Pull request #953 created<span class="toot-id"> #created-953</span></h2><div class="pubdate">16 Jan at 23:10:17 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/953">https://github.com/qt4cg/qtspecs/pull/953</a></div><details><summary>617 Define record constructors</summary><div class="markup"><p>Fix #617</p>
<p>Note that this is a first step. Noticeably we can't yet use these constructor functions to create records that have methods. It's nevertheless a big step forward.</p>
</div></details></div>
<div class="toot" id="created-952"><h2>Pull request #952 created<span class="toot-id"> #created-952</span></h2><div class="pubdate">16 Jan at 18:52:58 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/952">https://github.com/qt4cg/qtspecs/pull/952</a></div><details><summary>945 module import contradiction</summary><div class="markup"><p>Soem editorial clarifications regarding XQuery module import and schema import.</p>
<p>Fix #945</p>
</div></details></div>
<div class="toot" id="closed-928"><h2>Issue #928 closed<span class="toot-id"> #closed-928</span></h2><div class="pubdate">16 Jan at 17:33:04 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/928">https://github.com/qt4cg/qtspecs/pull/928</a></div><p>Minor edits through ch. 15</p></div>
<div class="toot" id="closed-947"><h2>Issue #947 closed<span class="toot-id"> #closed-947</span></h2><div class="pubdate">16 Jan at 17:30:10 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/947">https://github.com/qt4cg/qtspecs/pull/947</a></div><p>Reorganise F+O chapter 15 [editorial]</p></div>
<div class="toot" id="closed-530"><h2>Issue #530 closed<span class="toot-id"> #closed-530</span></h2><div class="pubdate">16 Jan at 17:26:54 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/530">https://github.com/qt4cg/qtspecs/issues/530</a></div><p>Escaping of forward slash in JSON output method</p></div>
<div class="toot" id="closed-942"><h2>Issue #942 closed<span class="toot-id"> #closed-942</span></h2><div class="pubdate">16 Jan at 17:26:53 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/942">https://github.com/qt4cg/qtspecs/pull/942</a></div><p>530 Fix typo, escape-solidus not escape-uri-attributes</p></div>
<div class="toot" id="closed-880"><h2>Issue #880 closed<span class="toot-id"> #closed-880</span></h2><div class="pubdate">16 Jan at 17:26:52 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/880">https://github.com/qt4cg/qtspecs/pull/880</a></div><p>872 Symmetry: fn:items-at → fn:get</p></div>
<div class="toot" id="minutes-01-16"><h2>QT4 CG meeting 061 draft minutes<span class="toot-id"> #minutes-01-16</span></h2><div class="pubdate">16 Jan at 17:25:00 GMT</div><div class="link">Link: <a href="https://qt4cg.org/meeting/minutes/2024/01-16">https://qt4cg.org/meeting/minutes/2024/01-16</a></div><p>Draft minutes published.</p></div>
<div class="toot" id="closed-930"><h2>Issue #930 closed<span class="toot-id"> #closed-930</span></h2><div class="pubdate">16 Jan at 17:23:48 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/930">https://github.com/qt4cg/qtspecs/issues/930</a></div><p>Obsolete comment under fn:deep-equal()</p></div>
<div class="toot" id="closed-933"><h2>Issue #933 closed<span class="toot-id"> #closed-933</span></h2><div class="pubdate">16 Jan at 17:23:47 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/933">https://github.com/qt4cg/qtspecs/pull/933</a></div><p>930 drop obsolete note about comments and PIs</p></div>
<div class="toot" id="closed-932"><h2>Issue #932 closed<span class="toot-id"> #closed-932</span></h2><div class="pubdate">16 Jan at 17:20:21 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/932">https://github.com/qt4cg/qtspecs/pull/932</a></div><p>931 Add rules for duration precision</p></div>
<div class="toot" id="closed-931"><h2>Issue #931 closed<span class="toot-id"> #closed-931</span></h2><div class="pubdate">16 Jan at 17:20:21 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/931">https://github.com/qt4cg/qtspecs/issues/931</a></div><p>Precision of duration arithmetic</p></div>
<div class="toot" id="closed-737"><h2>Issue #737 closed<span class="toot-id"> #closed-737</span></h2><div class="pubdate">16 Jan at 17:17:31 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/737">https://github.com/qt4cg/qtspecs/pull/737</a></div><p>295: Boost the capability of recursive record types</p></div>
<div class="toot" id="created-951"><h2>Issue #951 created<span class="toot-id"> #created-951</span></h2><div class="pubdate">16 Jan at 13:58:32 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/951">https://github.com/qt4cg/qtspecs/issues/951</a></div><details><summary>Parameters with default values: fn:lang, fn:id, fn:idref, fn:element-with-id</summary><div class="markup"><p>Since #895, absent optional arguments and empty sequences in built-in functions are treated identically. Exceptions are functions that already had different rules for such cases (e.g., <code>fn:node(())</code> always returns an empty sequence, no matter what the context is).</p>
<p>I noticed we should also exclude <code>fn:lang</code>, <code>fn:id</code>, <code>fn:idref</code>, and <code>fn:element-with-id</code>: Otherwise, a compiler won’t be able to statically assess if a function call is dependent on the context.</p>
</div></details></div>
<div class="toot" id="created-950"><h2>Pull request #950 created<span class="toot-id"> #created-950</span></h2><div class="pubdate">16 Jan at 11:53:16 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/950">https://github.com/qt4cg/qtspecs/pull/950</a></div><details><summary>Minor edits (examples, rules)</summary><div class="markup"><ul>
<li>Examples were fixed.</li>
<li>The equivalent expression for <code>map:values</code> was changed to <code>$map?*</code>.</li>
</ul>
</div></details></div>
<div class="toot" id="created-949"><h2>Issue #949 created<span class="toot-id"> #created-949</span></h2><div class="pubdate">16 Jan at 11:21:07 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/949">https://github.com/qt4cg/qtspecs/issues/949</a></div><details><summary>Partial Function Applications: Allow return of function name</summary><div class="markup"><p>Without wanting to revive #889, an important observation I picked up is that named function references and “partially applied functions without applications” can be considered identical. That is, there should be no reason to distinguish between <code>count#1</code> and <code>count(?)</code>.</p>
<p>Currently, however, partially applied functions are currently defined to lose the reference to the original function and its arity (and some Qt4 tests ensure that this is the case: https://github.com/qt4cg/qt4tests/blob/8649941e0e695ff8fb4cb27c52e99590cc88126f/misc/HigherOrderFunctions.xml#L1933).</p>
<p>From a user perspective, I see no reason why the two cases should be treated differently, and I would argue that we should either treat them identically or (at least) allow implementations to treat them identically, i.e., allowing an implementation to return <code>count</code> for <code>function-name(count(?))</code>.</p>
</div></details></div>
<div class="toot" id="created-948"><h2>Issue #948 created<span class="toot-id"> #created-948</span></h2><div class="pubdate">15 Jan at 18:59:21 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/948">https://github.com/qt4cg/qtspecs/issues/948</a></div><details><summary>fn:scan-left and fn:scan-right - produce accumulation of results</summary><div class="markup"><h1>fn:scan-left and fn:scan-right - produce accumulation of results</h1>
<p>In XPath 4.0 so far we still don't have a convenient way to express the functionality of producing a series of accumulated (accrued) results when applying a folding function over a collection (sequence, array, ...) of items. The general use-case for this is the task to produce a sequence of running totals when applying an operation over a sequence of data points: <strong>produce the partial sums of loan payments</strong> over fixed periods, <strong>produce the compounded amounts  of a deposit</strong> with fixed interest rate over years, ..., etc.</p>
<p>Two functions (shamelessly borrowed from Haskell):</p>
<ul>
<li><strong>fn:scan-left</strong></li>
<li><strong>fn:scan-right</strong></li>
</ul>
<hr>
<h2>fn:scan-left</h2>
<p>This function has a similar signature to that of <strong><em><code>fn:fold-left</code></em></strong> and produces the same final result, however it produces the complete (ordered) sequence of all partial results from every new value the accumulator gets during the evaluation of <strong><em><code>fn:fold-left</code></em></strong>.</p>
<h3>Signature</h3>
<pre><code class="language-xq">fn:scan-left($input	as item()*,	
             $zero	as item()*,	
             $action	as function(item()*, item()) as item()*	
) as array(*)*
</code></pre>
<h3>Properties</h3>
<p>This function is <a href="https://qt4cg.org/specifications/xpath-functions-40/Overview.html#dt-deterministic">·deterministic·</a>, <a href="https://qt4cg.org/specifications/xpath-functions-40/Overview.html#dt-context-independent">·context-independent·</a>, and <a href="https://qt4cg.org/specifications/xpath-functions-40/Overview.html#dt-focus-independent">·focus-independent·</a>.</p>
<h3>Rules</h3>
<p>The function is equivalent to the following implementation in XPath(return clause added for completeness):</p>
<pre><code class="language-xq">let $scan-left-inner := function($seq as item()*, 
                                 $zero as item(), 
                                 $fun as function(item()*, item()) as item()*,
                                 $self as function(*)
                               ) as array(*)*                               
{
  let $result := [$zero]
   return
     if(empty($seq)) then $result
       else
         (
           $result, $self(tail($seq), $fun($zero, head($seq)), $fun, $self)  
         )
},

$scan-left := function($seq as item()*, 
                       $zero as item(), 
                       $fun as function(item()*, item()) as item()*
                     ) as array(*)*  
{
  $scan-left-inner($seq, $zero, $fun, $scan-left-inner)
}  

  return
    $scan-left(1 to 10, 0, op('+'))
</code></pre>
<h3>Examples:</h3>
<pre><code class="language-xq"> $scan-left(1 to 10, 0, op('+'))
</code></pre>
<p>produces:</p>
<pre><code class="language-xq">[0]
[1]
[3]
[6]
[10]
[15]
[21]
[28]
[36]
[45]
[55]
</code></pre>
<p><img src="https://github.com/qt4cg/qtspecs/assets/10605892/603c0584-31bb-431f-b928-875058111128" alt="image"></p>
<h2>fn:scan-right</h2>
<p>This function has a similar signature to that of <strong><em><code>fn:fold-right</code></em></strong> and produces the same final result, however it produces the complete (ordered) sequence of all partial results from every new value the accumulator gets during the evaluation of <strong><em><code>fn:fold-right</code></em></strong>.</p>
<h3>Signature</h3>
<pre><code class="language-xq">fn:scan-right($input	as item()*,	
              $zero	as item()*,	
              $action	as function(item()*, item()) as item()*	
) as array(*)*
</code></pre>
<h3>Properties</h3>
<p>This function is <a href="https://qt4cg.org/specifications/xpath-functions-40/Overview.html#dt-deterministic">·deterministic·</a>, <a href="https://qt4cg.org/specifications/xpath-functions-40/Overview.html#dt-context-independent">·context-independent·</a>, and <a href="https://qt4cg.org/specifications/xpath-functions-40/Overview.html#dt-focus-independent">·focus-independent·</a>.</p>
<h3>Rules</h3>
<p>The function is equivalent to the following implementation in XPath(return clause added for completeness):</p>
<pre><code class="language-xq">let  $scan-right-inner := function($seq as item()*,
                                   $zero as item()*,
                                   $f as function(item(), item()*) as item()*,                          
                                   $self as function(*)
                                  ) as array(*)*
{
    if(empty($seq)) then [$zero]
      else
        let $rightResult := $self(tail($seq), $zero, $f, $self)
         return
            ([$f(head($seq), head($rightResult))], $rightResult)
},

$scan-right := function($seq as item()*,
                        $zero as item()*,
                        $f as function(item(), item()*) as item()*
                       ) as array(*)*
{
  $scan-right-inner($seq, $zero, $f, $scan-right-inner)
}   

return
  $scan-right(1 to 10, 0, op('+'))  
</code></pre>
<h3>Examples:</h3>
<pre><code class="language-xq"> $scan-right(1 to 10, 0, op('+'))
</code></pre>
<p>produces:</p>
<pre><code class="language-xq">[55]
[54]
[52]
[49]
[45]
[40]
[34]
[27]
[19]
[10]
[0]
</code></pre>
<p><img src="https://github.com/qt4cg/qtspecs/assets/10605892/68f5010d-133d-4bcf-8096-609a3d26697f" alt="image"></p>
</div></details></div>
<div class="toot" id="agenda-01-16"><h2>QT4 CG meeting 061 draft agenda<span class="toot-id"> #agenda-01-16</span></h2><div class="pubdate">15 Jan at 14:40:00 GMT</div><div class="link">Link: <a href="https://qt4cg.org/meeting/agenda/2024/01-16">https://qt4cg.org/meeting/agenda/2024/01-16</a></div><p>Draft agenda published.</p></div>
<div class="toot" id="closed-899"><h2>Issue #899 closed<span class="toot-id"> #closed-899</span></h2><div class="pubdate">15 Jan at 15:21:40 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/899">https://github.com/qt4cg/qtspecs/issues/899</a></div><p>Simplifying the language - types have behaviour.</p></div>
<div class="toot" id="created-947"><h2>Pull request #947 created<span class="toot-id"> #created-947</span></h2><div class="pubdate">15 Jan at 10:39:12 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/947">https://github.com/qt4cg/qtspecs/pull/947</a></div><details><summary>Reorganise F+O chapter 15 [editorial]</summary><div class="markup"><p>This PR reorganizes the subsections of F+O chapter 15 (the XML/HTML/JSON/CSV/IXML chapter). There is no change to content apart from a couple of introductory sentences. I'm planning to do some fine-grained work on the content in due course, but to make that easier to review it seems best to do the top-level reorganisation first. I'm therefore hoping that this PR will go through quickly "on the nod" so I can use it as a baseline for the detail changes.</p>
</div></details></div>
<div class="toot" id="created-946"><h2>Issue #946 created<span class="toot-id"> #created-946</span></h2><div class="pubdate">12 Jan at 16:10:46 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/946">https://github.com/qt4cg/qtspecs/issues/946</a></div><details><summary>fn:iterate-while → fn:while-do, fn:do-until</summary><div class="markup"><p>First feedback shows that <code>fn:iterate-while</code> is helpful, but the name needs to be improved: It implies that the first iteration occurs before the invocation of the test… Which could sometimes be helpful, too.</p>
<p>I suggest renaming the function to <code>fn:while-do</code> (“do” is commonly used when while loops are specified), and adding <code>fn:do-until</code>.</p>
</div></details></div>
<div class="toot" id="created-945"><h2>Issue #945 created<span class="toot-id"> #created-945</span></h2><div class="pubdate">12 Jan at 15:41:25 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/945">https://github.com/qt4cg/qtspecs/issues/945</a></div><details><summary>Module import: apparent contradiction</summary><div class="markup"><p>XQuery 5.12 paragraph 2 says:</p>
<blockquote>
<p>If a module A imports module B, the static context of module A will contain the [in-scope schema definitions]... of module B.</p>
</blockquote>
<p>Paragraph 10 says:</p>
<blockquote>
<p>A [module import] imports only functions, variable declarations, and item type declaratons; it does not import other objects from the imported modules, such as [in-scope schema definitions] or [statically known namespaces].</p>
</blockquote>
<p>They can't both be right, surely?</p>
</div></details></div>
<div class="toot" id="created-944"><h2>Issue #944 created<span class="toot-id"> #created-944</span></h2><div class="pubdate">12 Jan at 11:18:52 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/944">https://github.com/qt4cg/qtspecs/issues/944</a></div><details><summary>Coercion rules: implicit types</summary><div class="markup"><p>Since 2.0, the coercion rules (formerly function conversion rules) have allowed implicit conversion from decimal to double, decimal to float, and float to double on function calls; other conversions such as double to decimal or float to decimal are not allowed. This has never made very much sense because in some implementations, decimal to float is a lossy conversion whereas float to decimal is not.</p>
<p>One option would be to allow conversion from any numeric type to any other.</p>
<p>The main caveat here is that I don't think it makes sense to allow a double such as 1.5e0 to be supplied where the required type is xs:integer. We have introduced new conversions that make it possible to supply a decimal where an integer is expected, but only if the decimal is in the value space of integer.</p>
<p>A possible formulation would be:</p>
<p>If the required type is a numeric type (that is, xs:decimal, xs:double, xs:float, or any type derived from these), and if the supplied value is a numeric value, then the supplied value is cast to the required primitive type, and if the result is in the value space of the actual required type it is then relabelled as an instance of the actual required type (if not, the conversion fails).</p>
<p>This means that supplying 1.0e0 for an argument expecting xs:integer (or xs:positiveInteger, etc) would work (it would cast to xs:decimal and then relabel as xs:integer), but supplying 1.1e0 would fail.</p>
</div></details></div>
<div class="toot" id="created-943"><h2>Pull request #943 created<span class="toot-id"> #created-943</span></h2><div class="pubdate">11 Jan at 10:28:42 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/943">https://github.com/qt4cg/qtspecs/pull/943</a></div><details><summary>187 Add FLWOR expression while clause</summary><div class="markup"><p>Fix #187</p>
</div></details></div>
<div class="toot" id="created-942"><h2>Pull request #942 created<span class="toot-id"> #created-942</span></h2><div class="pubdate">10 Jan at 16:42:17 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/942">https://github.com/qt4cg/qtspecs/pull/942</a></div><details><summary>530 Fix typo, escape-solidus not escape-uri-attributes</summary><div class="markup"><p>Fix #530.</p>
<p>On half a dozen occasions, <code>escape-uri-attributes</code> is used where <code>escape-solidus</code> is clearly intended.</p>
</div></details></div>
<div class="toot" id="closed-886"><h2>Issue #886 closed<span class="toot-id"> #closed-886</span></h2><div class="pubdate">10 Jan at 14:28:06 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/886">https://github.com/qt4cg/qtspecs/issues/886</a></div><p>Binary map keys</p></div>
<div class="toot" id="created-941"><h2>Pull request #941 created<span class="toot-id"> #created-941</span></h2><div class="pubdate">10 Jan at 12:20:37 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/941">https://github.com/qt4cg/qtspecs/pull/941</a></div><details><summary>939 Remove fn:numeric-compare</summary><div class="markup"><p>Issue: #939</p>
</div></details></div>
<div class="toot" id="created-940"><h2>Pull request #940 created<span class="toot-id"> #created-940</span></h2><div class="pubdate">10 Jan at 12:05:08 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/940">https://github.com/qt4cg/qtspecs/pull/940</a></div><details><summary>878 Add subsequence-where function</summary><div class="markup"><p>Supersedes PR #874</p>
<p>Following discussion of PR #874 which proposed an extended subsequence() function with options to define the start and end position by predicates, this new PR proposes instead a subsequence-where() function that allows the start and end position to be defined by predicates, leaving the existing subsequence() function unchanged.</p>
<p>The items-before/after/starting-where/ending-where quartet are dropped.</p>
<p>The new function is inclusive at both ends. To start at the item after the one that matches the start condition, apply tail() to the result. To finish before the item that matches the end condition, apply trunk() to the result.</p>
</div></details></div>
<div class="toot" id="closed-893"><h2>Issue #893 closed<span class="toot-id"> #closed-893</span></h2><div class="pubdate">10 Jan at 11:55:20 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/893">https://github.com/qt4cg/qtspecs/issues/893</a></div><p>fn:compare: Support for arbitrary atomic types</p></div>
<div class="toot" id="closed-918"><h2>Issue #918 closed<span class="toot-id"> #closed-918</span></h2><div class="pubdate">10 Jan at 09:19:54 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/918">https://github.com/qt4cg/qtspecs/pull/918</a></div><p>Minor cx through chap. 14</p></div>
<div class="toot" id="created-939"><h2>Issue #939 created<span class="toot-id"> #created-939</span></h2><div class="pubdate">10 Jan at 09:12:34 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/939">https://github.com/qt4cg/qtspecs/issues/939</a></div><details><summary>Remove fn:numeric-compare</summary><div class="markup"><p>Related action: <a href="https://qt4cg.org/meeting/minutes/2024/01-09.html">QT4CG-060-04</a></p>
<p>@michaelhkay I proposed to merge <code>fn:numeric-compare</code> into <code>fn:compare</code> in #866; your response was:</p>
<blockquote>
<p>Folding fn:numeric-compare into fn:compare is more feasible, but you've then got one function that does two different jobs; there's no type safety to ensure that the arguments have compatible types, and you need ad-hoc rules to say which combinations of arguments are valid and which aren't. The merit of two separate functions is that each is a total function over the domain implied by its signature.</p>
</blockquote>
<p>Do you think the concerns are still relevant, or should we tackle this?</p>
</div></details></div>
<div class="toot" id="created-938"><h2>Issue #938 created<span class="toot-id"> #created-938</span></h2><div class="pubdate">10 Jan at 04:30:09 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/938">https://github.com/qt4cg/qtspecs/issues/938</a></div><details><summary>Canonical serialization</summary><div class="markup"><p>This issue picks up suggestions from #779 regarding canonical serialization, and solicits from the community group input on if such a function is desirable, and what such a function might look like.</p>
<p>In the context of #779, the idea was that two XML documents with different physical representations, but semantically equivalent, could be serialized to a canonical form, with a hash value applied to each confirming identity. Of course, with canonical operation, a simple string comparison would be sufficient, absent any hashing.</p>
<p>XML Signature was suggested as one approach, with some hesitation. I would like to suggest, instead, that we look to implement <a href="https://www.w3.org/TR/xml-c14n/">Canonical XML Version 1.1</a> (herein <strong>CX1.1</strong>), perhaps with map options that calibrate how CX1.1 is implemented. I have no experience using CX1.1, so user input is welcome.</p>
<p>Another point of discussion is whether this merits a new function, e.g., <code>fn:canonical-serialize</code>, or should be built upon <code>fn:serialize</code>. A problem with the latter option, is that such an approach makes no sense without the <code>method</code> option specified as <code>xml</code>. Another approach would be to go deeper, into the serialization spec, and expand the <code>xml</code> method to ensure a canonical option.</p>
<p>I believe that this function would be extremely useful. When preparing test suites, output could be saved as secondary documents as canonical XML, and any subsequent regression tests could adjust comparanda to canonical XML, and very precise node-wise comparisons could be made.</p>
<p>I look forward to everyone's input.</p>
</div></details></div>
<div class="toot" id="created-937"><h2>Pull request #937 created<span class="toot-id"> #created-937</span></h2><div class="pubdate">10 Jan at 04:03:02 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/937">https://github.com/qt4cg/qtspecs/pull/937</a></div><details><summary>779 hash function</summary><div class="markup"><p>First draft of hash function, proposed in #779.</p>
<p>Error message left as to-do item; guidance from editors appreciated.</p>
<p>I opted to leave out wrapper/cryptographic functionality, such as salting, and to demonstrate via example how it could be done by a developer on their own. In my opinion what we need here is a simple atomic function that can be incorporated into other molecular functions.</p>
<p>I may tinker with the prose description up to CG discussion, so comments are welcome.</p>
</div></details></div>
<div class="toot" id="created-936"><h2>Pull request #936 created<span class="toot-id"> #created-936</span></h2><div class="pubdate">10 Jan at 02:30:08 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/936">https://github.com/qt4cg/qtspecs/pull/936</a></div><details><summary>877 revised rules for op:binary-less-than</summary><div class="markup"><p>Rule 3 for <code>op:binary-less-than</code> was a bit of a mess (see #877), and needed to be expressed as a recursive operation.</p>
<p>My proposed revision depends of phraseology drawn from <code>fn:decode-from-uri</code>, <code>fn:deep-equal</code>, and 5.3.2 Unicode Codepoint Collation (here slightly adjusted from unordered to ordered list).</p>
</div></details></div>
<div class="toot" id="closed-876"><h2>Issue #876 closed<span class="toot-id"> #closed-876</span></h2><div class="pubdate">10 Jan at 01:24:16 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/876">https://github.com/qt4cg/qtspecs/issues/876</a></div><p>Placement of fn:in-scope-namespaces(), fn:in-scope-prefixes(), fn:namespace-uri-for-prefix()</p></div>
<div class="toot" id="closed-909"><h2>Issue #909 closed<span class="toot-id"> #closed-909</span></h2><div class="pubdate">09 Jan at 17:54:43 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/909">https://github.com/qt4cg/qtspecs/pull/909</a></div><p>893 fn:compare: Support for arbitrary atomic types</p></div>
<div class="toot" id="closed-860"><h2>Issue #860 closed<span class="toot-id"> #closed-860</span></h2><div class="pubdate">09 Jan at 17:51:34 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/860">https://github.com/qt4cg/qtspecs/issues/860</a></div><p>Unary Lookup when the context value is a sequence</p></div>
<div class="toot" id="closed-926"><h2>Issue #926 closed<span class="toot-id"> #closed-926</span></h2><div class="pubdate">09 Jan at 17:51:33 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/926">https://github.com/qt4cg/qtspecs/pull/926</a></div><p>860 Editorial rearrangement of spec for shallow lookup</p></div>
<div class="toot" id="closed-780"><h2>Issue #780 closed<span class="toot-id"> #closed-780</span></h2><div class="pubdate">09 Jan at 17:42:48 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/780">https://github.com/qt4cg/qtspecs/issues/780</a></div><p>format-number() etc incompatibility</p></div>
<div class="toot" id="closed-925"><h2>Issue #925 closed<span class="toot-id"> #closed-925</span></h2><div class="pubdate">09 Jan at 17:42:47 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/925">https://github.com/qt4cg/qtspecs/pull/925</a></div><p>780 Document incompatibility in format-number etc</p></div>
<div class="toot" id="closed-935"><h2>Issue #935 closed<span class="toot-id"> #closed-935</span></h2><div class="pubdate">09 Jan at 17:41:41 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/935">https://github.com/qt4cg/qtspecs/pull/935</a></div><p>Fix the fo test catalog</p></div>
<div class="toot" id="created-935"><h2>Pull request #935 created<span class="toot-id"> #created-935</span></h2><div class="pubdate">09 Jan at 17:41:31 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/935">https://github.com/qt4cg/qtspecs/pull/935</a></div><details><summary>Fix the fo test catalog</summary><div class="markup"><p>A duplicate name was introduced.</p>
</div></details></div>
<div class="toot" id="closed-648"><h2>Issue #648 closed<span class="toot-id"> #closed-648</span></h2><div class="pubdate">09 Jan at 17:36:20 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/648">https://github.com/qt4cg/qtspecs/issues/648</a></div><p>Schema for FN namespace should block extension and substitution</p></div>
<div class="toot" id="closed-924"><h2>Issue #924 closed<span class="toot-id"> #closed-924</span></h2><div class="pubdate">09 Jan at 17:36:19 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/924">https://github.com/qt4cg/qtspecs/pull/924</a></div><p>648 Disallow user modifications to schema for FN namespace</p></div>
<div class="toot" id="closed-913"><h2>Issue #913 closed<span class="toot-id"> #closed-913</span></h2><div class="pubdate">09 Jan at 17:30:07 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/913">https://github.com/qt4cg/qtspecs/issues/913</a></div><p>XQFO: under/unused variable apparatus</p></div>
<div class="toot" id="closed-923"><h2>Issue #923 closed<span class="toot-id"> #closed-923</span></h2><div class="pubdate">09 Jan at 17:30:06 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/923">https://github.com/qt4cg/qtspecs/pull/923</a></div><p>913-new-examples-for-local-name-etc</p></div>
<div class="toot" id="closed-915"><h2>Issue #915 closed<span class="toot-id"> #closed-915</span></h2><div class="pubdate">09 Jan at 17:27:14 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/915">https://github.com/qt4cg/qtspecs/issues/915</a></div><p>[Editorial] Incorrect terminology: function implementation is now function body</p></div>
<div class="toot" id="closed-922"><h2>Issue #922 closed<span class="toot-id"> #closed-922</span></h2><div class="pubdate">09 Jan at 17:27:13 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/922">https://github.com/qt4cg/qtspecs/pull/922</a></div><p>915 function body terminology</p></div>
<div class="toot" id="closed-914"><h2>Issue #914 closed<span class="toot-id"> #closed-914</span></h2><div class="pubdate">09 Jan at 17:23:53 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/914">https://github.com/qt4cg/qtspecs/pull/914</a></div><p>XQFO minor edits</p></div>
<div class="toot" id="closed-912"><h2>Issue #912 closed<span class="toot-id"> #closed-912</span></h2><div class="pubdate">09 Jan at 17:20:53 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/912">https://github.com/qt4cg/qtspecs/pull/912</a></div><p>XQFO: Minor edits</p></div>
<div class="toot" id="closed-906"><h2>Issue #906 closed<span class="toot-id"> #closed-906</span></h2><div class="pubdate">09 Jan at 17:17:39 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/906">https://github.com/qt4cg/qtspecs/issues/906</a></div><p>fn:deep-equal: unordered → ordered</p></div>
<div class="toot" id="closed-907"><h2>Issue #907 closed<span class="toot-id"> #closed-907</span></h2><div class="pubdate">09 Jan at 17:17:37 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/907">https://github.com/qt4cg/qtspecs/pull/907</a></div><p>906 fn:deep-equal: unordered → ordered</p></div>
<div class="toot" id="closed-898"><h2>Issue #898 closed<span class="toot-id"> #closed-898</span></h2><div class="pubdate">09 Jan at 17:14:02 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/898">https://github.com/qt4cg/qtspecs/issues/898</a></div><p>Drop the requirement for document-uri() uniqueness</p></div>
<div class="toot" id="closed-905"><h2>Issue #905 closed<span class="toot-id"> #closed-905</span></h2><div class="pubdate">09 Jan at 17:14:01 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/905">https://github.com/qt4cg/qtspecs/pull/905</a></div><p>898 - relax the constraints on document-uri</p></div>
<div class="toot" id="closed-821"><h2>Issue #821 closed<span class="toot-id"> #closed-821</span></h2><div class="pubdate">09 Jan at 17:11:13 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/821">https://github.com/qt4cg/qtspecs/issues/821</a></div><p>Annotations: Make default namespace explicit</p></div>
<div class="toot" id="closed-904"><h2>Issue #904 closed<span class="toot-id"> #closed-904</span></h2><div class="pubdate">09 Jan at 17:11:12 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/904">https://github.com/qt4cg/qtspecs/pull/904</a></div><p>821 Annotations: Make default namespace explicit</p></div>
<div class="toot" id="closed-895"><h2>Issue #895 closed<span class="toot-id"> #closed-895</span></h2><div class="pubdate">09 Jan at 17:07:46 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/895">https://github.com/qt4cg/qtspecs/issues/895</a></div><p>Parameters with default values: allow empty sequences</p></div>
<div class="toot" id="closed-901"><h2>Issue #901 closed<span class="toot-id"> #closed-901</span></h2><div class="pubdate">09 Jan at 17:07:45 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/901">https://github.com/qt4cg/qtspecs/pull/901</a></div><p>895 Parameters with default values: allow empty sequences</p></div>
<div class="toot" id="created-934"><h2>Issue #934 created<span class="toot-id"> #created-934</span></h2><div class="pubdate">08 Jan at 18:00:09 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/934">https://github.com/qt4cg/qtspecs/issues/934</a></div><details><summary>String comparison in deep-equal</summary><div class="markup"><p>The code showing how strings should be compared in deep-equal has gone awry, it doesn't match the prose. In equal-strings(), the lines</p>
<pre><code>let $n1 := if ($options?whitespace = "normalize"))
             then normalize-unicode(?, $options?normalization-form) 
             else identity#1
  let $n2 := if ($options?normalize-space)
             then normalize-space#1 
             else identity#1      
</code></pre>
<p>should read:</p>
<pre><code>let $n1 := if ($options?whitespace = 'normalize')
             then normalize-space#1 
             else identity#1    
let $n2 := if ($options?normalization-form))
             then normalize-unicode(?, $options?normalization-form) 
             else identity#1
  
</code></pre>
<p>Actually, the whole thing can now be expressed more concisely using fn:chain:</p>
<pre><code>declare function equal-strings(
  $string1   as xs:string,
  $string2   as xs:string, 
  $collation as xs:string,
  $options   as map(*)
) as xs:boolean {
  let $norm := fn:chain(?,
                        (normalize-unicode(?, $options?normalization-form)[$options?whitespace = "normalize"],
                         normalize-space#1[$options?normalize-space]))          
  return compare($norm($string1), $norm($string2), $collation) eq 0    
}
</code></pre>
</div></details></div>
<div class="toot" id="created-933"><h2>Pull request #933 created<span class="toot-id"> #created-933</span></h2><div class="pubdate">08 Jan at 12:49:52 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/933">https://github.com/qt4cg/qtspecs/pull/933</a></div><details><summary>930 drop obsolete note about comments and PIs</summary><div class="markup"><p>Fix #930</p>
<p>The note is obsolete because adjacent text nodes are now combined after stripping comments and PIs.</p>
</div></details></div>
<div class="toot" id="created-932"><h2>Pull request #932 created<span class="toot-id"> #created-932</span></h2><div class="pubdate">08 Jan at 12:42:19 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/932">https://github.com/qt4cg/qtspecs/pull/932</a></div><details><summary>931 Add rules for duration precision</summary><div class="markup"><p>Fix #931</p>
<p>Adds rules for the precision of durations and operations on durations, analogous to the existing rules for dates/times.</p>
</div></details></div>
<div class="toot" id="created-931"><h2>Issue #931 created<span class="toot-id"> #created-931</span></h2><div class="pubdate">07 Jan at 10:21:40 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/931">https://github.com/qt4cg/qtspecs/issues/931</a></div><details><summary>Precision of duration arithmetic</summary><div class="markup"><p>We specify that dates/times are manipulated at least to millisecond precision, but we have no similar statement for durations.</p>
<p>See https://stackoverflow.com/questions/77752844</p>
<p>michael.hor257k points out:</p>
<blockquote>
<p>The 2.0 specification states: "The result is obtained by casting $arg to an xs:dayTimeDuration ... and then computing the seconds component as described in 10.3.2.3 Canonical representation." And then: "The canonical representation of xs:dayTimeDuration restricts ... the value of the seconds component to xs:decimal valued from 0.0 to 59.999... ", with reference to XML Schema Part 2: Datatypes which mandates "a minimum fractional second precision of milliseconds or three decimal digits". None of this appears in the 3.0 spec, though the examples still show a decimal digit being extracted. –</p>
</blockquote>
</div></details></div>
<div class="toot" id="closed-929"><h2>Issue #929 closed<span class="toot-id"> #closed-929</span></h2><div class="pubdate">07 Jan at 10:19:16 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/929">https://github.com/qt4cg/qtspecs/issues/929</a></div><p>map:values() - Would it be better to return an array?</p></div>
<div class="toot" id="created-930"><h2>Issue #930 created<span class="toot-id"> #created-930</span></h2><div class="pubdate">06 Jan at 17:13:22 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/930">https://github.com/qt4cg/qtspecs/issues/930</a></div><details><summary>Obsolete comment under fn:deep-equal()</summary><div class="markup"><p>The notes for fn:deep-equal() include the paragraph:</p>
<blockquote>
<p>By default, the contents of comments and processing instructions are significant only if these nodes appear directly as items in the two sequences being compared. The content of a comment or processing instruction that appears as a descendant of an item in one of the sequences being compared does not affect the result. However, the presence of a comment or processing instruction, if it causes a text node to be split into two text nodes, may affect the result.</p>
</blockquote>
<p>This is no longer true: we fixed it so that adjacent text nodes are merged after stripping comments and PIs.</p>
</div></details></div>
<div class="toot" id="created-929"><h2>Issue #929 created<span class="toot-id"> #created-929</span></h2><div class="pubdate">06 Jan at 08:34:03 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/929">https://github.com/qt4cg/qtspecs/issues/929</a></div><details><summary>map:values() - Would it be better to return an array?</summary><div class="markup"><p>The new function <code>map:values()</code> returns the values present in a map, flattened into a sequence.</p>
<p>This loses information if the values are not all singletons.</p>
<p>Would it be better to return an array?</p>
<p>That is, to return <code>array:build(map:pairs($map), fn{?value}))</code></p>
</div></details></div>
<div class="toot" id="created-928"><h2>Pull request #928 created<span class="toot-id"> #created-928</span></h2><div class="pubdate">06 Jan at 02:47:50 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/928">https://github.com/qt4cg/qtspecs/pull/928</a></div><details><summary>Minor edits through ch. 15</summary><div class="markup"><p>Light edits here for consistency, clarity. I didn't touch the CSV prose much, knowing it is subject to major revisions.</p>
</div></details></div>
<div class="toot" id="created-927"><h2>Pull request #927 created<span class="toot-id"> #created-927</span></h2><div class="pubdate">04 Jan at 18:14:09 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/927">https://github.com/qt4cg/qtspecs/pull/927</a></div><details><summary>861 Rewrite spec of deep lookup operator</summary><div class="markup"><p>Fix #861</p>
<p>This is a complete rewrite of the spec for deep-lookup, hopefully clarifying some edge cases and fixing bugs, but not intended to introduce any major changes.</p>
</div></details></div>
<div class="toot" id="created-926"><h2>Pull request #926 created<span class="toot-id"> #created-926</span></h2><div class="pubdate">04 Jan at 12:55:03 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/926">https://github.com/qt4cg/qtspecs/pull/926</a></div><details><summary>860 Editorial rearrangement of spec for shallow lookup</summary><div class="markup"><p>Rearranges the spec for lookup expressions so that unary lookup is now defined in terms of postfix lookup, not the other way around; this simplifies the rules when the context value is not a singleton, or when the key specifier expression is context-dependent.</p>
<p>Fix #860</p>
</div></details></div>
<div class="toot" id="created-925"><h2>Pull request #925 created<span class="toot-id"> #created-925</span></h2><div class="pubdate">03 Jan at 23:39:31 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/925">https://github.com/qt4cg/qtspecs/pull/925</a></div><details><summary>780 Document incompatibility in format-number etc</summary><div class="markup"><p>Fix #780</p>
<p>Changes the XSLT and F+O specs to document a minor incompatibility arising from the change to functions such as <code>format-number()</code> to accept an argument of type <code>union(xs:string, xs:QName)</code> rather than <code>xs:string</code>.</p>
<p>In addition, in XSLT, all such functions now accept <code>union(xs:string, xs:QName)</code> rather than <code>union(xs:QName, xs:string)</code>. This is primarily to make them all consistent.</p>
</div></details></div>
<div class="toot" id="created-924"><h2>Pull request #924 created<span class="toot-id"> #created-924</span></h2><div class="pubdate">03 Jan at 19:59:15 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/924">https://github.com/qt4cg/qtspecs/pull/924</a></div><details><summary>648 Disallow user modifications to schema for FN namespace</summary><div class="markup"><p>Fix #648</p>
</div></details></div>
<div class="toot" id="closed-889"><h2>Issue #889 closed<span class="toot-id"> #closed-889</span></h2><div class="pubdate">03 Jan at 19:34:49 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/889">https://github.com/qt4cg/qtspecs/issues/889</a></div><p>Rename "Named Function Reference"</p></div>
<div class="toot" id="created-923"><h2>Pull request #923 created<span class="toot-id"> #created-923</span></h2><div class="pubdate">02 Jan at 23:02:41 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/923">https://github.com/qt4cg/qtspecs/pull/923</a></div><details><summary>913-new-examples-for-local-name-etc</summary><div class="markup"><p>I have created new (executable) examples for functions name, local-name, namespace-uri, node-name, count, number.</p>
<p>There are of course many other functions that would benefit from the same treatment.</p>
<p>Fix #913</p>
</div></details></div>
<div class="toot" id="created-922"><h2>Pull request #922 created<span class="toot-id"> #created-922</span></h2><div class="pubdate">01 Jan at 21:23:47 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/922">https://github.com/qt4cg/qtspecs/pull/922</a></div><details><summary>915 function body terminology</summary><div class="markup"><p>Fix #915</p>
</div></details></div>
<div class="toot" id="created-921"><h2>Pull request #921 created<span class="toot-id"> #created-921</span></h2><div class="pubdate">01 Jan at 20:14:53 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/921">https://github.com/qt4cg/qtspecs/pull/921</a></div><details><summary>920 Allow xsl:break and xsl:next-iteration within branch of xsl:switch</summary><div class="markup"><p>Allow xsl:break and xsl:next-iteration within branch of xsl:switch</p>
<p>Fix #920</p>
</div></details></div></div></article></main></body></html>