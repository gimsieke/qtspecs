<!DOCTYPE HTML><html><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><meta charset="UTF-8"><meta http-equiv="x-ua-compatible" content="ie=edge"><meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1"><link rel="stylesheet" href="/css/status.css"><title>@qt4cg statuses in 2023</title></head><body><main><article><h1>@qt4cg statuses in 2023</h1><p>This page displays status
              updates
              about the QT4 CG project from 2023.</p><p>See also <a href="../">recent statuses</a>.</p><div class="toots">
<div class="toot" id="agenda-06-13"><h2>QT4 CG meeting 038 draft agenda<span class="toot-id"> #agenda-06-13</span></h2><div class="pubdate">11 Jun at 18:20:00 GMT</div><div class="link">Link: <a href="https://qt4cg.org/meeting/agenda/2023/06-13">https://qt4cg.org/meeting/agenda/2023/06-13</a></div><p>Draft agenda published.</p></div>
<div class="toot" id="created-545"><h2>Pull request #545 created<span class="toot-id"> #created-545</span></h2><div class="pubdate">09 Jun at 20:52:44 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/545">https://github.com/qt4cg/qtspecs/pull/545</a></div><details><summary>513: after arrow operator, inline function no longer needs parens</summary><div class="markup"><p>Resolves issue #513 by removing the requirement for an inline function expression on the RHS of an arrow operator to be enclosed in parentheses.</p>
</div></details></div>
<div class="toot" id="created-544"><h2>Pull request #544 created<span class="toot-id"> #created-544</span></h2><div class="pubdate">09 Jun at 16:51:23 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/544">https://github.com/qt4cg/qtspecs/pull/544</a></div><details><summary>536: disallow mixing of symbols in operator tokens</summary><div class="markup"><p>As proposed in issue #536, this change disallows mixing of ordinary and full-width angle brackets in the same token.</p>
</div></details></div>
<div class="toot" id="created-543"><h2>Pull request #543 created<span class="toot-id"> #created-543</span></h2><div class="pubdate">09 Jun at 15:24:46 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/543">https://github.com/qt4cg/qtspecs/pull/543</a></div><details><summary>382 simplify rules for whitespace in fn:deep-equal</summary><div class="markup"><p>My previous attempt to make a pull request for this change got lost somewhere in the process; here is a renewed attempt. The changes are in response to comments made during the review of the orginal deep-equal() proposal, recorded in issue #382</p>
</div></details></div>
<div class="toot" id="closed-497"><h2>Issue #497 closed<span class="toot-id"> #closed-497</span></h2><div class="pubdate">09 Jun at 11:44:36 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/497">https://github.com/qt4cg/qtspecs/issues/497</a></div><p>https://qt4cg.org/specifications/xpath-functions-40/Overview-diff.html#func-map-pairs has wrong function syntax order</p></div>
<div class="toot" id="created-542"><h2>Pull request #542 created<span class="toot-id"> #created-542</span></h2><div class="pubdate">09 Jun at 11:36:39 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/542">https://github.com/qt4cg/qtspecs/pull/542</a></div><details><summary>Fixes a simple error in the description of XSLT error XTSE4020</summary><div class="markup"><p>A comment to issue #82 identified this typo.</p>
</div></details></div>
<div class="toot" id="created-541"><h2>Pull request #541 created<span class="toot-id"> #created-541</span></h2><div class="pubdate">09 Jun at 11:34:40 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/541">https://github.com/qt4cg/qtspecs/pull/541</a></div><details><summary>Fix typo in XPath §2.4.5 - E1 should be tagged as code not as var.</summary><div class="markup"><p>A trivial markup error that leads to the meta-variable E1 being wrongly rendered.</p>
</div></details></div>
<div class="toot" id="closed-66"><h2>Issue #66 closed<span class="toot-id"> #closed-66</span></h2><div class="pubdate">09 Jun at 11:27:11 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/66">https://github.com/qt4cg/qtspecs/issues/66</a></div><p>ThinArrowTarget should use FunctionBody</p></div>
<div class="toot" id="closed-78"><h2>Issue #78 closed<span class="toot-id"> #closed-78</span></h2><div class="pubdate">09 Jun at 11:26:16 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/78">https://github.com/qt4cg/qtspecs/issues/78</a></div><p>Specify strict order of evaluation for a subexpression </p></div>
<div class="toot" id="closed-98"><h2>Issue #98 closed<span class="toot-id"> #closed-98</span></h2><div class="pubdate">09 Jun at 10:22:35 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/98">https://github.com/qt4cg/qtspecs/issues/98</a></div><p>Support ignoring whitespace/indentation differences in fn:deep-equal.</p></div>
<div class="toot" id="closed-125"><h2>Issue #125 closed<span class="toot-id"> #closed-125</span></h2><div class="pubdate">09 Jun at 10:20:26 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/125">https://github.com/qt4cg/qtspecs/issues/125</a></div><p>array:partition → fn:partition: empty results; examples</p></div>
<div class="toot" id="closed-384"><h2>Issue #384 closed<span class="toot-id"> #closed-384</span></h2><div class="pubdate">09 Jun at 09:20:58 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/384">https://github.com/qt4cg/qtspecs/issues/384</a></div><p>Definition of "effective value" in XSLT</p></div>
<div class="toot" id="closed-418"><h2>Issue #418 closed<span class="toot-id"> #closed-418</span></h2><div class="pubdate">09 Jun at 09:18:13 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/418">https://github.com/qt4cg/qtspecs/issues/418</a></div><p>array and map attribute in xsl:iterate and xsl:for-each-group</p></div>
<div class="toot" id="closed-503"><h2>Issue #503 closed<span class="toot-id"> #closed-503</span></h2><div class="pubdate">09 Jun at 09:14:48 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/503">https://github.com/qt4cg/qtspecs/issues/503</a></div><p>Reinstate focus functions</p></div>
<div class="toot" id="closed-381"><h2>Issue #381 closed<span class="toot-id"> #closed-381</span></h2><div class="pubdate">09 Jun at 09:13:34 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/381">https://github.com/qt4cg/qtspecs/issues/381</a></div><p>Deep-equal comparisons without errors</p></div>
<div class="toot" id="closed-520"><h2>Issue #520 closed<span class="toot-id"> #closed-520</span></h2><div class="pubdate">09 Jun at 09:11:45 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/520">https://github.com/qt4cg/qtspecs/issues/520</a></div><p>Function identity</p></div>
<div class="toot" id="closed-530"><h2>Issue #530 closed<span class="toot-id"> #closed-530</span></h2><div class="pubdate">09 Jun at 09:09:26 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/530">https://github.com/qt4cg/qtspecs/issues/530</a></div><p>Escaping of forward slash in JSON output method</p></div>
<div class="toot" id="created-540"><h2>Issue #540 created<span class="toot-id"> #created-540</span></h2><div class="pubdate">08 Jun at 09:24:38 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/540">https://github.com/qt4cg/qtspecs/issues/540</a></div><details><summary>Add fn:system-property() to XQuery</summary><div class="markup"><p>XSLT has specific additions to the XPath function library to facilitate identifying the running implementation:</p>
<ul>
<li>https://www.w3.org/TR/xslt-30/#func-system-property</li>
<li>https://www.w3.org/TR/xslt-30/#func-available-system-properties</li>
</ul>
<p>These would be useful for XQuery too. There should be something better than the fragile sadness of
https://github.com/AndrewSales/XQS/blob/461a90a8e2f49d9ef646ff6940c6962f18c0f43a/port.xqm#L3-L12</p>
</div></details></div>
<div class="toot" id="created-539"><h2>Issue #539 created<span class="toot-id"> #created-539</span></h2><div class="pubdate">06 Jun at 20:20:06 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/539">https://github.com/qt4cg/qtspecs/issues/539</a></div><details><summary>FLOWR where clause with a "do when false" option</summary><div class="markup"><p>This is a request for an enhancement.</p>
<p>Fairly often, I'll have a query arranged as</p>
<p>let $step1 := <em>do some processing</em>
where exists($step1)
let $step2 := <em>processing based on step1</em>
where exists($step2)</p>
<p>and so on.</p>
<p>This is a convenient pattern until I want to emit some sort of message about where the process stops.</p>
<p>It would be convenient to have</p>
<p>where <em>expression</em> else <em>expression</em></p>
<p>with the else as an optional extension of the where clause to allow emitting information about which where clause the FLOWR expression stopped on.</p>
<p>It might be more congruent to the style of the language as</p>
<p>where <em>expression</em> return <em>expression</em></p>
<p>but then again having multiple return keywords isn't obviously a good thing.</p>
</div></details></div>
<div class="toot" id="minutes-06-06"><h2>QT4 CG meeting 037 draft minutes<span class="toot-id"> #minutes-06-06</span></h2><div class="pubdate">06 Jun at 17:10:00 GMT</div><div class="link">Link: <a href="https://qt4cg.org/meeting/minutes/2023/06-06">https://qt4cg.org/meeting/minutes/2023/06-06</a></div><p>Draft minutes published.</p></div>
<div class="toot" id="closed-531"><h2>Issue #531 closed<span class="toot-id"> #closed-531</span></h2><div class="pubdate">06 Jun at 16:06:45 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/531">https://github.com/qt4cg/qtspecs/issues/531</a></div><p>grammar production LambdaParams has "(" and ")" incorrectly under the choice</p></div>
<div class="toot" id="closed-532"><h2>Issue #532 closed<span class="toot-id"> #closed-532</span></h2><div class="pubdate">06 Jun at 16:06:44 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/532">https://github.com/qt4cg/qtspecs/pull/532</a></div><p>fix error in LambdaParams rule</p></div>
<div class="toot" id="closed-534"><h2>Issue #534 closed<span class="toot-id"> #closed-534</span></h2><div class="pubdate">06 Jun at 16:06:30 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/534">https://github.com/qt4cg/qtspecs/pull/534</a></div><p>530: escape solidus in JSON</p></div>
<div class="toot" id="closed-535"><h2>Issue #535 closed<span class="toot-id"> #closed-535</span></h2><div class="pubdate">06 Jun at 16:06:18 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/535">https://github.com/qt4cg/qtspecs/pull/535</a></div><p>Editorial: add an entry to the changes appendix</p></div>
<div class="toot" id="created-538"><h2>Pull request #538 created<span class="toot-id"> #created-538</span></h2><div class="pubdate">06 Jun at 13:25:12 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/538">https://github.com/qt4cg/qtspecs/pull/538</a></div><details><summary>Attempt to allow xs:string to be 'promoted to' xs:anyURI</summary><div class="markup"><p>I think it might be a little cheeky to call it "promotion" in both directions, but this really has more to do with a kind of conversion, so I'm willing to let it slide.</p>
<p>If accepted, this PR resolves ACTION QT4CG-035-03.</p>
</div></details></div>
<div class="toot" id="closed-537"><h2>Issue #537 closed<span class="toot-id"> #closed-537</span></h2><div class="pubdate">05 Jun at 16:27:07 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/537">https://github.com/qt4cg/qtspecs/pull/537</a></div><p>Editorial: present F&amp;O examples as tables.</p></div>
<div class="toot" id="created-537"><h2>Pull request #537 created<span class="toot-id"> #created-537</span></h2><div class="pubdate">05 Jun at 14:28:56 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/537">https://github.com/qt4cg/qtspecs/pull/537</a></div><details><summary>Editorial: present F&amp;O examples as tables.</summary><div class="markup"><p>This is a purely editorial change to the stylesheet that formats examples in the F&amp;O spec; it changes the presentation to be a two-column table containing expressions and results. The intention is to reduce clutter and to improve the readability where code samples (either expressions or results) need multi-line rendition.</p>
<p>In the vast majority of cases the change is clearly (IMHO) an improvement, but further tweaking is possible:</p>
<ul>
<li>There may be scope for tailoring the CSS (for example, I don't like the fact that table cells are centred vertically).</li>
<li>Some of the tables (e.g. parse-uri examples) take too much horizontal space; the code should be edited to reduce the line length</li>
<li>Examples are sometimes introduced with a free-standing paragraph tag rather than with fo:preamble, which separates the introduction from the code into a separate table row.</li>
<li>Some of the examples that were designed for inline rendition could usefully take advantage of the opportunity to turn them into multi-line code samples.</li>
</ul>
</div></details></div>
<div class="toot" id="agenda-06-06"><h2>QT4 CG meeting 037 draft agenda<span class="toot-id"> #agenda-06-06</span></h2><div class="pubdate">05 Jun at 09:20:00 GMT</div><div class="link">Link: <a href="https://qt4cg.org/meeting/agenda/2023/06-06">https://qt4cg.org/meeting/agenda/2023/06-06</a></div><p>Draft agenda published.</p></div>
<div class="toot" id="created-536"><h2>Issue #536 created<span class="toot-id"> #created-536</span></h2><div class="pubdate">03 Jun at 15:41:40 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/536">https://github.com/qt4cg/qtspecs/issues/536</a></div><details><summary>Re: Mathematical Operator Symbols</summary><div class="markup"><p>#460</p>
<p><code>=!&gt;</code> is not mentioned in A 3.3</p>
<p>Also, I do not think it makes sense to allow mixing both characters in one operator, like in <code>＜&lt;</code>. It combines the disadvantages of <code>&lt;&lt;</code> and <code>＜＜</code> without any advantages</p>
</div></details></div>
<div class="toot" id="created-535"><h2>Pull request #535 created<span class="toot-id"> #created-535</span></h2><div class="pubdate">03 Jun at 14:22:06 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/535">https://github.com/qt4cg/qtspecs/pull/535</a></div><p>Editorial: add an entry to the changes appendix</p></div>
<div class="toot" id="created-534"><h2>Pull request #534 created<span class="toot-id"> #created-534</span></h2><div class="pubdate">31 May at 17:27:30 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/534">https://github.com/qt4cg/qtspecs/pull/534</a></div><details><summary>530: escape solidus in JSON</summary><div class="markup"><p>Add <code>escape-solidus</code> serialization parameter for the JSON output method.</p>
</div></details></div>
<div class="toot" id="created-533"><h2>Pull request #533 created<span class="toot-id"> #created-533</span></h2><div class="pubdate">31 May at 15:58:57 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/533">https://github.com/qt4cg/qtspecs/pull/533</a></div><details><summary>413: Spec for CSV parsing with fn:parse-csv()</summary><div class="markup"><p>This is a spec proposal for <code>fn:parse-csv()</code> from #413.</p>
<p>I've tried to cover off most of what was discussed in that issue, but I have avoided dealing with backlash escapes (per @ChristianGruen's early comment), sticking with the RFC 4180 quoting approach.</p>
<p>There are some issues with the structure where I tried to follow the existing structure of chapter 15, but that leaves the function definition in 15.4 separated by a lot of text before the wider format discussion in 15.7. The split between function def and context affects the JSON and HTML parsing functions too, so I have avoided trying to fix that as well in this PR.</p>
<p>If this meets with approval, I'll squash commits and rebase before merging.</p>
</div></details></div>
<div class="toot" id="created-532"><h2>Pull request #532 created<span class="toot-id"> #created-532</span></h2><div class="pubdate">31 May at 07:30:03 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/532">https://github.com/qt4cg/qtspecs/pull/532</a></div><details><summary>fix error in LambdaParams rule</summary><div class="markup"><p>fixes https://github.com/qt4cg/qtspecs/issues/531#issue-1733539612</p>
<p>LambdaParam | "(" | (LambdaParam ("," LambdaParam)<em>)? | ")" should be:
LambdaParam | ( "(" (LambdaParam ("," LambdaParam)</em>)? ")" )</p>
</div></details></div>
<div class="toot" id="created-531"><h2>Issue #531 created<span class="toot-id"> #created-531</span></h2><div class="pubdate">31 May at 07:14:11 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/531">https://github.com/qt4cg/qtspecs/issues/531</a></div><details><summary>grammar production LambdaParams has "(" and ")" incorrectly under the choice</summary><div class="markup"><p>The grammar production
<code>LambdaParams ::= LambdaParam  |  "("  |  (LambdaParam  (","  LambdaParam)*)?  |  ")"</code>
should be
<code>LambdaParams ::= LambdaParam  |  ("(" (LambdaParam  (","  LambdaParam)*)? ")")</code></p>
</div></details></div>
<div class="toot" id="created-530"><h2>Issue #530 created<span class="toot-id"> #created-530</span></h2><div class="pubdate">31 May at 06:00:48 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/530">https://github.com/qt4cg/qtspecs/issues/530</a></div><details><summary>Escaping of forward slash in JSON output method</summary><div class="markup"><p>The fact that we escape forward slash in the JSON output method has proved unpopular with quite a few users.</p>
<p>The rationale for doing it is discussed at https://stackoverflow.com/questions/1580647/json-why-are-forward-slashes-escaped</p>
<p>The short summary is that it's only needed when JSON is inserted into an HTML <code>script</code> element, and then only when immediately followed by <code>&gt;</code>.</p>
<p>There's a workaround using character maps but it's really clumsy.</p>
<p>I don't want to escape forward slashes by default in the xdm-to-json() function because they appear so often in namespaces and it adds an awful lot of visual clutter. That means that our JSON formatter needs an option to suppress this escaping, which means we might as well provide user control over it as an output property...</p>
<p>Adding a new output property just for this purpose is rather heavyweight both in the specs and in our implementation, but I can't think of a better solution. So I propose adding <code>escape-solidus</code>, values yes/no, default (for compatibility) yes.</p>
<p>Yes, someone will ask about the name. Surely no-one calls it a solidus? Well, Unicode does, and I think we should use the official name. And it avoids arguing about whether it should be slash or forwards-slash or forward-slash. At least I'm not proposing virgule.</p>
</div></details></div>
<div class="toot" id="closed-367"><h2>Issue #367 closed<span class="toot-id"> #closed-367</span></h2><div class="pubdate">30 May at 22:19:55 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/367">https://github.com/qt4cg/qtspecs/issues/367</a></div><p>Focus for RHS of thin arrow expressions</p></div>
<div class="toot" id="minutes-05-30"><h2>QT4 CG meeting 036 draft minutes<span class="toot-id"> #minutes-05-30</span></h2><div class="pubdate">30 May at 17:15:00 GMT</div><div class="link">Link: <a href="https://qt4cg.org/meeting/minutes/2023/05-30">https://qt4cg.org/meeting/minutes/2023/05-30</a></div><p>Draft minutes published.</p></div>
<div class="toot" id="closed-524"><h2>Issue #524 closed<span class="toot-id"> #closed-524</span></h2><div class="pubdate">30 May at 16:17:45 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/524">https://github.com/qt4cg/qtspecs/pull/524</a></div><p>503: reinstate focus functions</p></div>
<div class="toot" id="closed-525"><h2>Issue #525 closed<span class="toot-id"> #closed-525</span></h2><div class="pubdate">30 May at 16:17:00 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/525">https://github.com/qt4cg/qtspecs/pull/525</a></div><p>520: add function identity and use it in deep-equal</p></div>
<div class="toot" id="closed-519"><h2>Issue #519 closed<span class="toot-id"> #closed-519</span></h2><div class="pubdate">30 May at 16:16:26 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/519">https://github.com/qt4cg/qtspecs/pull/519</a></div><p>237: Revise tokenisation appendix</p></div>
<div class="toot" id="closed-527"><h2>Issue #527 closed<span class="toot-id"> #closed-527</span></h2><div class="pubdate">30 May at 16:16:02 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/527">https://github.com/qt4cg/qtspecs/pull/527</a></div><p>Editorial: more corrections to F+O examples</p></div>
<div class="toot" id="created-529"><h2>Pull request #529 created<span class="toot-id"> #created-529</span></h2><div class="pubdate">29 May at 11:22:35 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/529">https://github.com/qt4cg/qtspecs/pull/529</a></div><details><summary>528: revision of json(), and renaming to xdm-to-json()</summary><div class="markup"><p>Revises the detail of the proposed json() function, including a name change to xdm-to-json().</p>
<p>The proposed changes give us a starting point for implementation, but I would expect there might be further tweaks to the spec once we try applying the function to real examples.</p>
</div></details></div>
<div class="toot" id="agenda-05-30"><h2>QT4 CG meeting 036 draft agenda<span class="toot-id"> #agenda-05-30</span></h2><div class="pubdate">29 May at 07:53:00 GMT</div><div class="link">Link: <a href="https://qt4cg.org/meeting/agenda/2023/05-30">https://qt4cg.org/meeting/agenda/2023/05-30</a></div><p>Draft agenda published.</p></div>
<div class="toot" id="created-528"><h2>Issue #528 created<span class="toot-id"> #created-528</span></h2><div class="pubdate">28 May at 20:08:08 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/528">https://github.com/qt4cg/qtspecs/issues/528</a></div><details><summary>Review of the fn:json() function</summary><div class="markup"><p>I've been writing tests for the fn:json function, whose spec I haven't read for quite a while, so it's an opportunity (a) to request WG review of the spec, and (b) for some minor comments.</p>
<ol>
<li>I think a better name for the function might be <code>fn:to-json</code>. Any other suggestions?</li>
<li>Where we specify that a JSON object should be output with particular properties, I think we should be consistent about whether or not we prescribe the order. Writing tests is a lot easier if the order is always prescribed!</li>
<li>Document nodes: it would be better to output both the document URI and the base URI where available.</li>
<li>Under "The children of the element are processed as follows" there are four rules. In the case where an element has just one element node child, I think rule 4 should apply rather than rule 3.</li>
<li>Under Processing-Instruction nodes: typo "A JSON object with a two properties".</li>
<li>The section starting "Strings are escaped as follows" should be promoted up a level.</li>
<li>Representing functions: I propose a different set of rules. (a) for a function that is a reference to a built-in or user-defined function definition, output "Q{uri}local#arity". (b) for an anonymous function, output "#anonymous-function". The rationale is that the JSON output here isn't going to be useful except as a placeholder to indicate that a function item is present.</li>
<li>We might want to be more prescriptive about how numbers are formatted (or to provide user options)</li>
<li>Like many XML-to-JSON libraries, there's the problem that two instances of the same element type might be output very differently depending on which children are present. For example the representation of a book with two authors might be very different from a book with one author. I would suggest that rather than the boolean <code>element-map</code> option, we allow the options to include a list of element names for which <code>object</code> representation rather than <code>array</code> representation is to be used.</li>
</ol>
</div></details></div>
<div class="toot" id="created-527"><h2>Pull request #527 created<span class="toot-id"> #created-527</span></h2><div class="pubdate">28 May at 10:24:27 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/527">https://github.com/qt4cg/qtspecs/pull/527</a></div><details><summary>Editorial: more corrections to F+O examples</summary><div class="markup"><p>Fixes errors in the fn:replace examples, updates elsewhere to reflect changes to the syntax of lambda expressions and focus functions.</p>
</div></details></div>
<div class="toot" id="created-526"><h2>Issue #526 created<span class="toot-id"> #created-526</span></h2><div class="pubdate">26 May at 21:22:22 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/526">https://github.com/qt4cg/qtspecs/issues/526</a></div><details><summary>load-xquery-module() needs changes to account for functions with an arity range</summary><div class="markup"><p>The spec of <code>load-xquery-module()</code> assumes that each function declaration in a query module has a single integer arity; this doesn't allow for default parameters which mean it now has an arity range.</p>
<p>Because the returned map contains function items, which always have a fixed arity, I think it needs to contain one entry for each arity in the arity range. This involves evaluating the defaults for any parameters that have a default value defined; if the default value is context dependent, this is going to have to use the context of the <code>load-xquery-module()</code> function call, which isn't very meaningful, but I can't see what else to do.</p>
<p>An alternative is to only include one function item in the result, corresponding to the maximum arity.</p>
<p>If we introduce sequence-variadic functions, the arity range becomes infinite, which makes both of these ideas problematic. But presumably sequence-variadic functions will be callable with all the values supplied in a single array?</p>
</div></details></div>
<div class="toot" id="created-525"><h2>Pull request #525 created<span class="toot-id"> #created-525</span></h2><div class="pubdate">26 May at 09:27:33 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/525">https://github.com/qt4cg/qtspecs/pull/525</a></div><details><summary>520: add function identity and use it in deep-equal</summary><div class="markup"><p>I believe this PR resolves issues</p>
<p>issue #520 - function identity
issue #333 - equality of function items
issue #381 - deep-equal comparison without errors</p>
<p>The PR introduces a concept of function identity in the data model, and for all expressions that create functions, explains what the identity of the returned function is.</p>
<p>The concept of function identity is used initially in two places: in fn:deep-equal(), when the operands include function items; and in the F+O prose defining the concept of determinism, which in turn is relied on by the definition of memo functions in XSLT.</p>
<p>I had hoped to go further and address issue #119, generalising what kinds of values are allowed as keys in maps, but as explained in a comment on that issue, I hit obstacles.</p>
</div></details></div>
<div class="toot" id="created-524"><h2>Pull request #524 created<span class="toot-id"> #created-524</span></h2><div class="pubdate">25 May at 10:09:47 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/524">https://github.com/qt4cg/qtspecs/pull/524</a></div><details><summary>503: reinstate focus functions</summary><div class="markup"><p>This PR reinstates "focus functions", using the syntax <code>function{EXPR}</code> rather than <code>-&gt;{EXPR}</code>. If accepted, this resolves issue #503.</p>
</div></details></div>
<div class="toot" id="created-523"><h2>Issue #523 created<span class="toot-id"> #created-523</span></h2><div class="pubdate">24 May at 23:28:50 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/523">https://github.com/qt4cg/qtspecs/issues/523</a></div><details><summary>Dealing with component name conflicts with library packages</summary><div class="markup"><h2>Override with visibility='hidden'</h2>
<pre><code class="language-xml">&lt;override&gt;
   &lt;template name='foo' visibility='hidden'/&gt;
&lt;/override&gt;
</code></pre>
<p>This change allows the using package to override a component without running into a potential naming conflict with another component in the using package or in another used package. Because the visibility is hidden, the component is not invokable from the using package.</p>
<h2>Accept with alias</h2>
<pre><code class="language-xml">&lt;accept component='template' names='foo' aliases='fu'/&gt;
</code></pre>
<p>This change allows the using package to accept components but with a different name.</p>
</div></details></div>
<div class="toot" id="closed-522"><h2>Issue #522 closed<span class="toot-id"> #closed-522</span></h2><div class="pubdate">24 May at 07:48:58 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/522">https://github.com/qt4cg/qtspecs/pull/522</a></div><p>function-catalog.xml: Original line endings reverted (modified by GitHub’s 'direct edit' feature)</p></div>
<div class="toot" id="created-522"><h2>Pull request #522 created<span class="toot-id"> #created-522</span></h2><div class="pubdate">24 May at 07:48:39 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/522">https://github.com/qt4cg/qtspecs/pull/522</a></div><details><summary>function-catalog.xml: Original line endings reverted (modified by GitHub’s 'direct edit' feature)</summary><div class="markup"><p>I learned it’s NOT advisable to use GitHub’s features to directly edit files in the browser. The newlines of <code>function-catalog.xml</code> of the original file seem to be changed.</p>
<p>This PR is restoring the original newlines.
Sorry for that.</p>
</div></details></div>
<div class="toot" id="created-521"><h2>Pull request #521 created<span class="toot-id"> #created-521</span></h2><div class="pubdate">23 May at 18:50:56 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/521">https://github.com/qt4cg/qtspecs/pull/521</a></div><p>518: Add transitive-closure() function</p></div>
<div class="toot" id="minutes-05-23"><h2>QT4 CG meeting 035 draft minutes<span class="toot-id"> #minutes-05-23</span></h2><div class="pubdate">23 May at 17:20:00 GMT</div><div class="link">Link: <a href="https://qt4cg.org/meeting/minutes/2023/05-23">https://qt4cg.org/meeting/minutes/2023/05-23</a></div><p>Draft minutes published.</p></div>
<div class="toot" id="closed-504"><h2>Issue #504 closed<span class="toot-id"> #closed-504</span></h2><div class="pubdate">23 May at 16:18:56 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/504">https://github.com/qt4cg/qtspecs/issues/504</a></div><p>Merge map:keys and map:keys-where</p></div>
<div class="toot" id="closed-515"><h2>Issue #515 closed<span class="toot-id"> #closed-515</span></h2><div class="pubdate">23 May at 16:18:54 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/515">https://github.com/qt4cg/qtspecs/pull/515</a></div><p>504: Merge map:keys and map:keys-where</p></div>
<div class="toot" id="closed-396"><h2>Issue #396 closed<span class="toot-id"> #closed-396</span></h2><div class="pubdate">23 May at 16:15:20 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/396">https://github.com/qt4cg/qtspecs/pull/396</a></div><p>333: Deep-equal, no failure when comparing functions</p></div>
<div class="toot" id="created-520"><h2>Issue #520 created<span class="toot-id"> #created-520</span></h2><div class="pubdate">23 May at 11:58:37 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/520">https://github.com/qt4cg/qtspecs/issues/520</a></div><details><summary>Function identity</summary><div class="markup"><p>To make deep-equal error-free for all arguments (issue #333), and to support the introduction of sets (issue #34), we need to be able to test whether two functions are "the same function". This is a proposed pragmatic solution.</p>
<p>We change the data model for functions so that functions, like nodes, have an identity that is acquired when the function is created; two functions are identical if and only if they have the same identity.</p>
<p>In general any expression that returns a new function allocates it an identity that is different from all other existing functions (as with nodes). However:</p>
<ul>
<li>Repeated evaluation of a function reference such as count#1 returns the same function each time, provided that the target function is context-free.</li>
<li>Optimizers are allowed to rewrite expressions (for example by loop-lifting, etc) so that expressions that would in principle return distinct functions actually return the same function, provided the optimizer can determine that the two functions are equivalent in all respects other than their identity. For example if the expression <code>contains(?, 'xxx')</code> appears in a loop, the expression can be lifted out of the loop so there is no requirement that it returns different functions each time (as there is with nodes)</li>
</ul>
<p>Benefits of this approach:</p>
<ul>
<li>identical($x, $x) is always true (function identity survives binding to variables)</li>
<li>functions obtained by repeated evaluation of the same expression in the same context are likely to return identical results in cases that are simple enough for an optimizer to analyse</li>
<li>the results are likely to be reasonably intuitive</li>
<li>optimisers aren't constrained by rules on identity to restrict the rewrites they can attempt</li>
</ul>
<p>This does mean that expressions that return functions become a little impure - but only in the same way that expressions that create nodes are a little impure. The impurity is well understood and tolerated.</p>
<p>Maps and arrays do not have identity as a property separate from their content.</p>
</div></details></div>
<div class="toot" id="created-519"><h2>Pull request #519 created<span class="toot-id"> #created-519</span></h2><div class="pubdate">23 May at 10:50:52 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/519">https://github.com/qt4cg/qtspecs/pull/519</a></div><details><summary>237: Revise tokenisation appendix</summary><div class="markup"><p>This PR is an extensive revision to the rules for tokenisation that corrects a number of errors:</p>
<ul>
<li>The problem mentioned in issue 237, namely the lack of clarity in the "longest token rule". This PR fixes this by clarifying what this rule means and where it applies. In particular it tackles the issue of "complex terminals" such as element constructor expressions and string templates where a symbol that is a single token at one level (in the sense that whitespace is constrained) also contains enclosed expressions.</li>
<li>Some productions/tokens were misclassified or omitted from the relevant lists of tokens in the appendix. This has been fixed in part by using general rules in the grammar2spec stylesheet to generate lists of tokens, rather than relying on annotations in the grammar file.</li>
</ul>
<p>The PR includes changes to the grammar2spec stylesheet.</p>
</div></details></div>
<div class="toot" id="created-518"><h2>Issue #518 created<span class="toot-id"> #created-518</span></h2><div class="pubdate">22 May at 16:45:24 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/518">https://github.com/qt4cg/qtspecs/issues/518</a></div><details><summary>transitive-closure() function</summary><div class="markup"><p>I've just found myself writing, yet again, a transitive closure function, and I feel we could add this to the spec.</p>
<p>I'm afraid it's another case where we really need set operations and therefore a universal equality operator. For the moment I'll just define it over nodes, which shelves the problem.</p>
<p><code>fn:transitive-closure($start as node()*, $step as function($node as node()) as node()*) as node()*</code></p>
<p>returns the set of all nodes reachable from a node in $start by zero or more applications of the $step function, in document order with duplicates removed.</p>
<p>Can probably define it formally something like</p>
<pre><code>let $next-iteration := $start =!&gt; $step()
return if (empty($next-iteration except $start))
           then $start
           else transitive-closure($start | $next-iteration, $step)
</code></pre>
</div></details></div>
<div class="toot" id="created-517"><h2>Issue #517 created<span class="toot-id"> #created-517</span></h2><div class="pubdate">21 May at 01:43:18 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/517">https://github.com/qt4cg/qtspecs/issues/517</a></div><details><summary>FO: fn:multi-compose : Evaluate a chain of functions in order</summary><div class="markup"><h1><strong>FO: fn:multi-compose : Evaluate a chain of functions</strong></h1>
<p>As per Wikipedia:</p>
<p>" In&nbsp;<a href="https://en.wikipedia.org/wiki/Mathematics">mathematics</a>,&nbsp;<strong>function composition</strong>&nbsp;is an operation&nbsp; ∘ &nbsp;that takes two&nbsp;<a href="https://en.wikipedia.org/wiki/Function_(mathematics)">functions</a>&nbsp;<em>f</em>&nbsp;and&nbsp;<em>g</em>, and produces a function&nbsp;</p>
<p><em>h</em>&nbsp;=&nbsp;<em>g</em>&nbsp; ∘  <em>f</em>&nbsp;such that&nbsp;<em>h</em>(<em>x</em>) =&nbsp;<em>g</em>(<em>f</em>(<em>x</em>)).</p>
<p>In this operation, the function&nbsp;<em>g</em>&nbsp;is&nbsp;<a href="https://en.wikipedia.org/wiki/Function_application">applied</a>&nbsp;to the result of applying the function&nbsp;<em>f</em>&nbsp;to&nbsp;<em>x</em>. That is, the functions&nbsp;</p>
<p><em>f</em> :&nbsp;<em>X</em>&nbsp;→&nbsp;<em>Y</em>&nbsp;and&nbsp;<em>g</em> :&nbsp;<em>Y</em>&nbsp;→&nbsp;<em>Z</em>&nbsp;</p>
<p>are&nbsp;<strong>composed</strong>&nbsp;to yield a function that maps&nbsp;<em>x</em>&nbsp;in&nbsp;<a href="https://en.wikipedia.org/wiki/Domain_of_a_function">domain</a>&nbsp;<em>X</em>&nbsp;to&nbsp;<em>g</em>(<em>f</em>(<em>x</em>))&nbsp;in&nbsp;<a href="https://en.wikipedia.org/wiki/Codomain">codomain</a>&nbsp;<em>Z</em>.</p>
<p>Intuitively, if&nbsp;<em>z</em>&nbsp;is a function of&nbsp;<em>y</em>, and&nbsp;<em>y</em>&nbsp;is a function of&nbsp;<em>x</em>, then&nbsp;<em>z</em>&nbsp;is a function of&nbsp;<em>x</em>.</p>
<p>The resulting&nbsp;<em>composite</em>&nbsp;function is denoted&nbsp;<em>g</em> ∘ <em>f</em>&nbsp;:&nbsp;<em>X</em>&nbsp;→&nbsp;<em>Z</em>, defined by:</p>
<p>&nbsp;(<em>g</em> ∘ <em>f</em> )(<em>x</em>) =&nbsp;<em>g</em>(<em>f</em>(<em>x</em>))&nbsp;for all&nbsp;<em>x</em>&nbsp;in&nbsp;<em>X</em>
"</p>
<hr>
<p>In this Proposal we generalize function composition to the case when a sequence of functions are composed together, so that the last one is applied on an argument $x, then  the last-but-one is applied on the result of this application, and so on … until finally the first function in the sequence is applied on the result produced so far.</p>
<p>This is an effective way of chaining a sequence of functions together, and we don’t need to invent or use any special operators or syntax, but we just pass this sequence of functions as argument to <strong><em>fn:multi-compose</em></strong>.</p>
<p><strong>fn:multi-compose := function($funs as function(*)*, $x)</strong></p>
<p><strong>Here is an XPath 3.0 implementation of fn:multi-compose</strong>:</p>
<pre><code class="language-xq">let $apply := function($f, $x) {fn:apply($f, [$x])},
    $multi-compose := function($funs as function(*)*, $x)
                  {
                    fold-right($funs, $x, $apply)
                  },
    (: The functions $incr and $times are needed just to show this example :) 
    $incr := function($x) {op("+")(?, $x)},
    $times := function($y) {op("*")(?, $y)}                 
                  
 return
   $multi-compose(($times(5), $incr(1)), 2)
</code></pre>
<p>As wanted, the result of evaluating this is</p>
<p>15: (2 +1) * 5</p>
<h2>Remarks</h2>
<ol>
<li>
<p>In this implementation the type of the 2nd (last) argument of <strong><em>$multi-compose</em></strong> and <strong><em>$apply</em></strong> is <code>item()*</code> (any) and as such it is omitted. In case the function to be applied first, needs  more than one argument, all of its arguments must be presented in the function call as a single sequence , and are passed (in order) as the members of a single array, as already implemented by the standard <strong><a href="https://www.w3.org/TR/xpath-functions-31/#func-apply">fn:apply</a></strong>.</p>
</li>
<li>
<p>It is a dynamic error if any of the function applications produces a result which does not belong to the Domain of the function immediately preceding it in the function sequence.</p>
</li>
</ol>
</div></details></div>
<div class="toot" id="closed-181"><h2>Issue #181 closed<span class="toot-id"> #closed-181</span></h2><div class="pubdate">20 May at 18:32:46 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/181">https://github.com/qt4cg/qtspecs/issues/181</a></div><p>HOF Sequence Functions with Positional Arguments</p></div>
<div class="toot" id="created-516"><h2>Issue #516 created<span class="toot-id"> #created-516</span></h2><div class="pubdate">20 May at 18:12:06 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/516">https://github.com/qt4cg/qtspecs/issues/516</a></div><details><summary>Add position argument to filter/for-each callbacks</summary><div class="markup"><p>The coercion rules now allow a supplied function item to have lower arity than the signature of the declared type; the effect is that the information supplied in the additional arguments is ignored.</p>
<p>One of the intended use cases for this was to allow existing higher-order functions to be extended while retaining backwards compatibility. For example, in <code>fn:filter</code>, we can change the required type of the predicate function from <code>function(item()) as xs:boolean</code> to <code>function(item(), xs:positiveInteger) as xs:boolean</code>, with the second argument supplying the position of the item being tested. A function that isn't interested in the position can just ignore it, so existing calls will continue to work.</p>
<p>I propose that we add a position argument to the callbacks for:</p>
<pre><code>fn:filter
fn:for-each
fn:for-each-pair
fn:partition
fn:items-after
fn:items-before
fn:items-starting-where
fn:items-ending-where
array:filter
array:for-each
array:for-each-pair
</code></pre>
<p>Other candidates include</p>
<pre><code>fn:all
fn:some
fn:index-where
array:index-where
</code></pre>
<p>but I suggest we leave these unless someone can think of a use case.</p>
</div></details></div>
<div class="toot" id="agenda-05-23"><h2>QT4 CG meeting 035 draft agenda<span class="toot-id"> #agenda-05-23</span></h2><div class="pubdate">20 May at 10:15:00 GMT</div><div class="link">Link: <a href="https://qt4cg.org/meeting/agenda/2023/05-23">https://qt4cg.org/meeting/agenda/2023/05-23</a></div><p>Draft agenda published.</p></div>
<div class="toot" id="closed-471"><h2>Issue #471 closed<span class="toot-id"> #closed-471</span></h2><div class="pubdate">20 May at 10:04:45 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/471">https://github.com/qt4cg/qtspecs/issues/471</a></div><p>Unify formatting (function calls, code blocks, quotes) in the specification</p></div>
<div class="toot" id="closed-511"><h2>Issue #511 closed<span class="toot-id"> #closed-511</span></h2><div class="pubdate">20 May at 10:04:43 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/511">https://github.com/qt4cg/qtspecs/pull/511</a></div><p>471: &lt;code&gt; elements, simple/typographic quotes</p></div>
<div class="toot" id="created-515"><h2>Pull request #515 created<span class="toot-id"> #created-515</span></h2><div class="pubdate">20 May at 09:57:04 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/515">https://github.com/qt4cg/qtspecs/pull/515</a></div><p>504: Merge map:keys and map:keys-where</p></div>
<div class="toot" id="created-514"><h2>Issue #514 created<span class="toot-id"> #created-514</span></h2><div class="pubdate">20 May at 08:44:03 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/514">https://github.com/qt4cg/qtspecs/issues/514</a></div><details><summary>Lambda expression: Annotations</summary><div class="markup"><p><strong>Edit 2023-05-21:</strong> Feedback was incorporated.</p>
<p>In the current grammar rules, there are subtle differences in the <code>InlineFunctionExpr</code> and <code>LambdaExpr</code> rules that we should dissolve.</p>
<p>Annotations are not supported in lambda expressions, which I believe is an unnecessary restriction:</p>
<pre><code class="language-xquery">(: currently legal :)
let $delete-texts := %updating function($nodes) { delete nodes $nodes//text() }
return $delete-texts(//city)

(: currently illegal :)
let $delete-texts := %updating ($nodes) -&gt; { delete nodes $nodes//text() }
return $delete-texts(//city)
</code></pre>
<p>It should suffice to extend one rule in the grammar:</p>
<pre><code>(: old :)
LambdaExpr  ::=  LambdaParams "-&gt;" EnclosedExpr
(: new :)
LambdaExpr  ::=  Annotation* LambdaParams "-&gt;" EnclosedExpr
</code></pre>
<hr>
<p>We could also type declarations (as @michaelhkay has indicated below, though, this might not be as simple to realize as I hoped):</p>
<pre><code class="language-xquery">(: currently legal :)
let $find-john := function($node as node()) as xs:boolean { contains($node, 'john') }
return $find-john($node)

(: currently illegal :)
let $find-john := ($node as node()) as xs:boolean -&gt; { contains($node, 'john') }
return $find-john($node)
</code></pre>
<p>The type declarations cannot be allowed if parentheses are omitted (unless we make them mandatory):</p>
<pre><code class="language-xquery">(: without parens :)
$i -&gt; { ... }

(: parens :)
($i as xs:int) as xs:int -&gt; { ... }
</code></pre>
<p>These are the current grammar rules:</p>
<pre><code>FunctionItemExpr    ::=  NamedFunctionRef | InlineFunctionExpr | LambdaExpr
InlineFunctionExpr  ::=  Annotation* "function" FunctionSignature FunctionBody
FunctionSignature   ::=  "(" ParamList? ")" TypeDeclaration?
ParamList           ::=  Param ("," Param)*
Param               ::=  "$" EQName TypeDeclaration?
FunctionBody        ::=  EnclosedExpr
LambdaExpr          ::=  LambdaParams "-&gt;" EnclosedExpr
LambdaParams        ::=  LambdaParam | "(" | (LambdaParam ("," LambdaParam)*)? | ")"
LambdaParam         ::=  "$" VarName
</code></pre>
<p>As the <code>InlineFunctionExpr</code> and <code>LambdaExpr</code> both generate anonymous functions, we shouldn’t make a difference, and this is what I would recommend:</p>
<pre><code>FunctionItemExpr    ::=  NamedFunctionRef | InlineFunctionExpr
InlineFunctionExpr  ::=  Annotation* (InlineFunction | LambdaFunction) FunctionBody
InlineFunction      ::=  "function" FunctionSignature
LambdaFunction      ::=  (Param | FunctionSignature)) "-&gt;"
FunctionSignature   ::=  "(" ParamList? ")" TypeDeclaration?
ParamList           ::=  TypedParam ("," TypedParam)*
TypedParam          ::=  Param TypeDeclaration?
Param               ::=  "$" VarName
</code></pre>
<p>Disclaimer: I could have raised this earlier, but I didn’t want to prolong the ongoing discussion on the open pull requests.</p>
</div></details></div>
<div class="toot" id="created-513"><h2>Issue #513 created<span class="toot-id"> #created-513</span></h2><div class="pubdate">20 May at 08:00:24 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/513">https://github.com/qt4cg/qtspecs/issues/513</a></div><details><summary>Arrow operator: Inline functions without parens</summary><div class="markup"><p>See also https://github.com/qt4cg/qtspecs/issues/435#issuecomment-1508228624: If an inline function expression is used as the right-hand operand of the arrow operators, parentheses must be used:</p>
<pre><code class="language-xquery">(: now :)
$seq =&gt; (function($x) { ... })()
(: desirable :)
$seq =&gt; function($x) { ... }()
</code></pre>
<p>This could be changed by adding the <code>InlineFunctionExpr</code> to the <code>ArrowDynamicFunction</code> rule:</p>
<blockquote>
<p>[115]  SequenceArrowTarget  ::=  "=&gt;" ((ArrowStaticFunction ArgumentList) | (ArrowDynamicFunction PositionalArgumentList))
[151]  ArrowStaticFunction  ::=  EQName
[152]  ArrowDynamicFunction  ::=  VarRef | ParenthesizedExpr | <code>InlineFunctionExpr</code>
[142]  ArgumentList  ::=  "(" ((PositionalArguments ("," KeywordArguments)?) | KeywordArguments)? ")"
[143]  PositionalArgumentList  ::=  "(" PositionalArguments? ")"</p>
</blockquote>
<p>It will be best to tackle this after we’ve resolved #503, and we’ll have to check if the simplification doesn’t cause ambiguities.</p>
</div></details></div>
<div class="toot" id="closed-53"><h2>Issue #53 closed<span class="toot-id"> #closed-53</span></h2><div class="pubdate">19 May at 20:01:03 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/53">https://github.com/qt4cg/qtspecs/issues/53</a></div><p>Allow function keyword inline functions without parameters</p></div>
<div class="toot" id="closed-436"><h2>Issue #436 closed<span class="toot-id"> #closed-436</span></h2><div class="pubdate">19 May at 20:00:53 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/436">https://github.com/qt4cg/qtspecs/issues/436</a></div><p>Allow inline function expressions in arrow operator call chains</p></div>
<div class="toot" id="closed-435"><h2>Issue #435 closed<span class="toot-id"> #closed-435</span></h2><div class="pubdate">19 May at 20:00:35 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/435">https://github.com/qt4cg/qtspecs/issues/435</a></div><p>Remove the inlined function expression variant of the thin arrow operator</p></div>
<div class="toot" id="created-512"><h2>Pull request #512 created<span class="toot-id"> #created-512</span></h2><div class="pubdate">19 May at 14:47:33 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/512">https://github.com/qt4cg/qtspecs/pull/512</a></div><details><summary>256: Context for default function parameter expressions</summary><div class="markup"><p>This is a renewed attempt to tackle issue 256, which concerns how to define the static and dynamic context for default value expressions for optional function parameters in XQuery and XSLT. The resolution is to define the static and dynamic context for these expressions in detail.</p>
<p>To make this work, some refinement of the static and dynamic context definitions is needed:</p>
<ul>
<li>default collation is moved from the static context to the dynamic context, with a note that it is always known statically except in the case when defining the default for a function parameter.</li>
<li>static base URI (in the static context) and executable base URI (in the dynamic context) are now formally separated; previously we fudged this by saying they could be different, but without recognizing separate context components</li>
<li>the base URI for resolving relative collation URIs is now implementation defined. This allows implementors to use either the compile-time or run-time base URI, or some other URI defined using a processor API.</li>
</ul>
</div></details></div>
<div class="toot" id="created-511"><h2>Pull request #511 created<span class="toot-id"> #created-511</span></h2><div class="pubdate">19 May at 13:10:45 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/511">https://github.com/qt4cg/qtspecs/pull/511</a></div><details><summary>471: &lt;code&gt; elements, simple/typographic quotes</summary><div class="markup"><p>That was a work-intensive one, as expected, but I’m optimistic that the PR improves the overall situation.
I’ll be happy to see subsequent PRs if I missed something (e.g., I didn’t touch <code>ebnf.xml</code>).</p>
<p>Closes #471</p>
</div></details></div>
<div class="toot" id="closed-509"><h2>Issue #509 closed<span class="toot-id"> #closed-509</span></h2><div class="pubdate">19 May at 09:08:43 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/509">https://github.com/qt4cg/qtspecs/pull/509</a></div><p>471 (2): Remove more fn: prefixes</p></div>
<div class="toot" id="closed-510"><h2>Issue #510 closed<span class="toot-id"> #closed-510</span></h2><div class="pubdate">19 May at 09:08:28 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/510">https://github.com/qt4cg/qtspecs/pull/510</a></div><p>471 (3): Render false/true/NaN/INF/-INF/+INF as code</p></div>
<div class="toot" id="closed-375"><h2>Issue #375 closed<span class="toot-id"> #closed-375</span></h2><div class="pubdate">19 May at 08:48:02 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/375">https://github.com/qt4cg/qtspecs/pull/375</a></div><p>256: Context for default parameter values</p></div>
<div class="toot" id="closed-507"><h2>Issue #507 closed<span class="toot-id"> #closed-507</span></h2><div class="pubdate">19 May at 08:06:13 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/507">https://github.com/qt4cg/qtspecs/pull/507</a></div><p>125: Rename array:partition as fn:partition</p></div>
<div class="toot" id="closed-505"><h2>Issue #505 closed<span class="toot-id"> #closed-505</span></h2><div class="pubdate">18 May at 17:25:58 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/505">https://github.com/qt4cg/qtspecs/pull/505</a></div><p>418: Correct and expand an XSLT example</p></div>
<div class="toot" id="closed-447"><h2>Issue #447 closed<span class="toot-id"> #closed-447</span></h2><div class="pubdate">18 May at 17:24:32 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/447">https://github.com/qt4cg/qtspecs/pull/447</a></div><p>435, 53, 436: lambda expressions, thin arrows</p></div>
<div class="toot" id="closed-410"><h2>Issue #410 closed<span class="toot-id"> #closed-410</span></h2><div class="pubdate">18 May at 16:57:55 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/410">https://github.com/qt4cg/qtspecs/issues/410</a></div><p>Converting doubles to decimals, fractional digits</p></div>
<div class="toot" id="closed-455"><h2>Issue #455 closed<span class="toot-id"> #closed-455</span></h2><div class="pubdate">18 May at 16:57:52 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/455">https://github.com/qt4cg/qtspecs/pull/455</a></div><p>410: Converting doubles to decimals, fractional digits</p></div>
<div class="toot" id="closed-483"><h2>Issue #483 closed<span class="toot-id"> #closed-483</span></h2><div class="pubdate">18 May at 16:53:32 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/483">https://github.com/qt4cg/qtspecs/pull/483</a></div><p>452: window: make 'start' and 'when' optional</p></div>
<div class="toot" id="created-510"><h2>Pull request #510 created<span class="toot-id"> #created-510</span></h2><div class="pubdate">18 May at 16:14:22 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/510">https://github.com/qt4cg/qtspecs/pull/510</a></div><details><summary>471 (3): Render false/true/NaN/INF/-INF/+INF as code</summary><div class="markup"><p><code>NaN</code>, <code>INF</code>, <code>-INF</code> and <code>+INF</code> was easy, boolean values were trickier:</p>
<ul>
<li>I used <code>&lt;code&gt;</code> for “The result/value/option/property is true/false”, “is set to true/false” and similar.</li>
<li>I didn’t tag “This is true/false”, “The condition is true/false”  and similar.</li>
</ul>
<p>I hope there won’t be too many conflicts if this is directly merged after #509.</p>
</div></details></div>
<div class="toot" id="created-509"><h2>Pull request #509 created<span class="toot-id"> #created-509</span></h2><div class="pubdate">18 May at 12:38:02 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/509">https://github.com/qt4cg/qtspecs/pull/509</a></div><details><summary>471 (2): Remove more fn: prefixes</summary><div class="markup"><p>I’ve removed additional <code>fn:</code> prefixes from examples and <code>eg</code> code blocks. I have kept prefixes in the rules and formal code snippets untouched.</p>
<p>In the initial comment of #471, I have listed the remaining cleanups for which I want to prepare PRs.
I’ll wait until this and possibly some other PRs have been merged.</p>
</div></details></div>
<div class="toot" id="created-508"><h2>Issue #508 created<span class="toot-id"> #created-508</span></h2><div class="pubdate">17 May at 12:53:56 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/508">https://github.com/qt4cg/qtspecs/issues/508</a></div><details><summary>New Map &amp; Array Functions: Inconsistencies</summary><div class="markup"><h3>XQFO 3.1</h3>
<p>…provides the following functions/constructs for creating and accessing maps &amp; arrays:</p>
<p>Maps | Singleton Maps
:--- | :---
Decompose | –
Compose | <code>map:merge($maps)</code>
Create single | <code>map:entry($key, $value)</code><br><code>map { $key: $value }</code>
Extract keys | <code>map:keys($map)</code>
Extract values (flat) | <code>$map?*</code>
<strong>Arrays</strong> | <strong>Singleton Arrays</strong>
Decompose | –
Compose | <code>array:join($arrays)</code>
Create single | <code>[ $value ]</code>
Extract values (flat) | –</p>
<h3>XQFO 4.0 Draft</h3>
<p>…provides new functions for singletons and map representations:</p>
<p>Maps | Singleton Maps | Pairs (Key-Value Pair Maps)
:--- | :--- | :---
Decompose | <strong><code>map:entries($map)</code></strong> | <strong><code>map:pairs($map)</code></strong>
Compose | <code>map:merge($maps)</code> | <strong><code>map:of($pairs)</code></strong>
Create single | <code>map:entry($key, $value)</code><br><code>map { $key: $value }</code> | –<br><strong><code>map { 'key': $key, 'value': $value }</code></strong>
Extract keys | <code>map:keys($map)</code> | <strong><code>$pairs?key</code></strong>
Extract values (flat) | <strong><code>map:values($map)</code></strong><br><code>$map?*</code> | <strong><code>$pairs?value</code></strong>
<strong>Arrays</strong> | <strong>Singleton Arrays</strong> | <strong>Members (Value Maps)</strong>
Decompose | – | <strong><code>array:members($array)</code></strong>
Compose | <code>array:join($arrays)</code> | <strong><code>array:of($members)</code></strong>
Create single | <code>[ $value ]</code> | <strong><code>array { 'value': $value }</code></strong>
Extract values (flat) | <strong><code>array:values($array)</code></strong> | <strong><code>$members?value</code></strong></p>
<p>The following terminology can be derived from the function names:</p>
<ul>
<li>A key-value pair map with a single map pair is called a <strong>Pair</strong>.</li>
<li>A value map with a single array member is called a <strong>Member</strong>.</li>
<li>A singleton map is called an <strong>Entry</strong> (due to <code>map:entry</code>)</li>
<li>We have no name for a singleton array.</li>
</ul>
<h3>Complete the Picture</h3>
<p>I believe we should:</p>
<ol>
<li>rename <code>map:of</code> to <code>map:of-pairs</code> or <code>map:merge-pairs</code> (as a hint that singletons are not the expected input)</li>
<li>rename <code>array:of</code> to <code>array:of-members</code> or <code>array:join-members</code> (as a hint…)</li>
<li>add <code>map:pair</code> for creating a single pair</li>
<li>add <code>array:split</code> (<code>array:tokenize</code>, …?) for decomposing arrays to singleton arrays</li>
</ol>
<p>I’m not sure if we should add array functions for creating singletons or value maps; we also have <code>array:build</code>.</p>
</div></details></div>
<div class="toot" id="created-507"><h2>Pull request #507 created<span class="toot-id"> #created-507</span></h2><div class="pubdate">17 May at 11:38:06 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/507">https://github.com/qt4cg/qtspecs/pull/507</a></div><details><summary>125: Rename array:partition as fn:partition</summary><div class="markup"><p>Reworked this PR to deal with merge conflicts. Technical change was already accepted. Made a correction to the "equivalent expression" published in the spec, which has now been tested (and was found wanting...)</p>
</div></details></div>
<div class="toot" id="closed-454"><h2>Issue #454 closed<span class="toot-id"> #closed-454</span></h2><div class="pubdate">17 May at 09:23:54 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/454">https://github.com/qt4cg/qtspecs/pull/454</a></div><p>125: array:partition</p></div>
<div class="toot" id="created-506"><h2>Issue #506 created<span class="toot-id"> #created-506</span></h2><div class="pubdate">17 May at 09:08:06 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/506">https://github.com/qt4cg/qtspecs/issues/506</a></div><details><summary>fn:error: parameter names</summary><div class="markup"><p>We should rename the <code>$error-object</code> parameter to <code>$value</code>, as it will be bound to <code>$err:value</code> later on:</p>
<pre><code class="language-xquery">try {
  error(value := 123)
} catch * {
  $err:value
}
</code></pre>
<p>Next, “object” is rarely used in the specs.</p>
</div></details></div>
<div class="toot" id="closed-467"><h2>Issue #467 closed<span class="toot-id"> #closed-467</span></h2><div class="pubdate">17 May at 08:20:49 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/467">https://github.com/qt4cg/qtspecs/issues/467</a></div><p>map:keys-where: Return Keys That Match a Predicate</p></div>
<div class="toot" id="created-505"><h2>Pull request #505 created<span class="toot-id"> #created-505</span></h2><div class="pubdate">17 May at 08:14:09 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/505">https://github.com/qt4cg/qtspecs/pull/505</a></div><details><summary>418: Correct and expand an XSLT example</summary><div class="markup"><p>Makes a further correction to an example identified in issue #418, and adds to the example giving an alternative solution</p>
</div></details></div>
<div class="toot" id="created-504"><h2>Issue #504 created<span class="toot-id"> #created-504</span></h2><div class="pubdate">17 May at 07:46:32 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/504">https://github.com/qt4cg/qtspecs/issues/504</a></div><details><summary>Merge map:keys and map:keys-where</summary><div class="markup"><p>I propose that we merge <code>map:keys</code> and <code>map:keys-where</code> into a single function, with <code>map:keys#1</code> behaving like it does now, and <code>map:keys#2</code> taking over from <code>map:keys-where#2</code>. Effectively the default for the second argument becomes <code>true#0</code>.</p>
</div></details></div>
<div class="toot" id="closed-30"><h2>Issue #30 closed<span class="toot-id"> #closed-30</span></h2><div class="pubdate">17 May at 06:16:28 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/30">https://github.com/qt4cg/qtspecs/issues/30</a></div><p>Improve the discoverability and parseability of the mathematical operator symbols</p></div>
<div class="toot" id="closed-204"><h2>Issue #204 closed<span class="toot-id"> #closed-204</span></h2><div class="pubdate">17 May at 06:16:02 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/204">https://github.com/qt4cg/qtspecs/issues/204</a></div><p>Non-ascii alternative operator symbols</p></div>
<div class="toot" id="closed-460"><h2>Issue #460 closed<span class="toot-id"> #closed-460</span></h2><div class="pubdate">17 May at 06:15:24 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/460">https://github.com/qt4cg/qtspecs/issues/460</a></div><p>Mathematical Operator Symbols</p></div>
<div class="toot" id="closed-485"><h2>Issue #485 closed<span class="toot-id"> #closed-485</span></h2><div class="pubdate">17 May at 06:13:40 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/485">https://github.com/qt4cg/qtspecs/issues/485</a></div><p>Predeclared namespaces in XQuery</p></div>
<div class="toot" id="closed-443"><h2>Issue #443 closed<span class="toot-id"> #closed-443</span></h2><div class="pubdate">17 May at 06:12:59 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/443">https://github.com/qt4cg/qtspecs/issues/443</a></div><p>@select on xsl:matching-substring and xsl:non-matching-substring</p></div>
<div class="toot" id="closed-32"><h2>Issue #32 closed<span class="toot-id"> #closed-32</span></h2><div class="pubdate">17 May at 06:12:16 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/32">https://github.com/qt4cg/qtspecs/issues/32</a></div><p>try/catch: New variable for all error information</p></div>
<div class="toot" id="closed-452"><h2>Issue #452 closed<span class="toot-id"> #closed-452</span></h2><div class="pubdate">17 May at 06:11:12 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/452">https://github.com/qt4cg/qtspecs/issues/452</a></div><p>window: make 'start' and 'when' optional</p></div>
<div class="toot" id="created-503"><h2>Issue #503 created<span class="toot-id"> #created-503</span></h2><div class="pubdate">16 May at 23:09:58 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/503">https://github.com/qt4cg/qtspecs/issues/503</a></div><details><summary>Reinstate focus functions</summary><div class="markup"><p>As a result of accepting PR #447, we have lost the ability to write simple "focus functions" that take the context item as an implicit argument, for example <code>sort(//emp, (), -&gt;{@salary})</code>.</p>
<p>The new status quo is that people have to write <code>sort(//emp, (), $e-&gt;{$e/@salary})</code> which feels clumsy in comparison.</p>
<p>This issue examines options for reinstating such a capability, and perhaps making it more powerful.</p>
<p>A reason for dropping the syntax was that it didn't play well with the "thin arrow" operator in pipelines, but we have now changed the symbol for that to <code>=!&gt;</code> so the objection no longer applies so strongly.</p>
<p>Ideally we want something that not only replaces focus functions (arity one arguments accepting an argument of type item()), but also meets some or all of the following additional requirements:</p>
<ul>
<li>
<p>Works well on the RHS of the <code>=&gt;</code> and <code>=!&gt;</code> operators, in a construct that we might write as <code>$list =!&gt; {.+1}()</code>.</p>
</li>
<li>
<p>Also allows arity-one functions whose argument is a sequence (<code>item()*</code>)</p>
</li>
</ul>
<p>This becomes a lot easier if we can solve issue #129 which generalises the context item to a context value. Let's assume we do that, and keep an open mind for the moment as to whether the generalized context value is referenced as <code>.</code> or <code>~</code>. I'll use <code>~</code> for now. So we want a compact notation for functions of arity one in which the function body refers to the argument value as <code>~</code>. For aesthetic reasons, because it's going to be used on the RHS of an arrow operator, we really don't want to introduce it with a leading arrow like the previous syntax <code>-&gt;{.+1}</code>. Use of "bare braces" (simply <code>{~+1}</code>) is very tempting, but I think there is a good argument for leaving that part of the syntactic space unused, for extensibility and for diagnostics. I think my preference is for <code>fn{~+1}</code>. Using a keyword (such as map, array, validate) before a braced expression is a uniform device and keeps the grammar coherent.</p>
<p>So in a callback such as fn:sort, we can write <code>sort(//emp, (), fn{@salary})</code>, and in a pipeline we can write <code>$list =!&gt; fn{.+1}()</code>. (To allow this, all we need to do is to generalise what's allowed as an <code>ArrowDynamicFunction</code>).</p>
<p>A separate question is whether we can (and should) allow the empty argument list to be omitted. I think I'm persuaded by the arguments that it's better to keep it, as a visual signal that the function is being applied, not just returned.</p>
</div></details></div>
<div class="toot" id="minutes-05-16"><h2>QT4 CG meeting 034 draft minutes<span class="toot-id"> #minutes-05-16</span></h2><div class="pubdate">16 May at 17:33:00 GMT</div><div class="link">Link: <a href="https://qt4cg.org/meeting/minutes/2023/05-16">https://qt4cg.org/meeting/minutes/2023/05-16</a></div><p>Draft minutes published.</p></div>
<div class="toot" id="closed-478"><h2>Issue #478 closed<span class="toot-id"> #closed-478</span></h2><div class="pubdate">16 May at 16:17:23 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/478">https://github.com/qt4cg/qtspecs/pull/478</a></div><p>467: map:keys-where</p></div>
<div class="toot" id="closed-481"><h2>Issue #481 closed<span class="toot-id"> #closed-481</span></h2><div class="pubdate">16 May at 16:15:48 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/481">https://github.com/qt4cg/qtspecs/issues/481</a></div><p>When we have array:build and map:build, then why do we also need array:of and map:of ?</p></div>
<div class="toot" id="closed-466"><h2>Issue #466 closed<span class="toot-id"> #closed-466</span></h2><div class="pubdate">16 May at 16:12:50 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/466">https://github.com/qt4cg/qtspecs/pull/466</a></div><p>460: Fix math symbols</p></div>
<div class="toot" id="closed-487"><h2>Issue #487 closed<span class="toot-id"> #closed-487</span></h2><div class="pubdate">16 May at 16:12:38 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/487">https://github.com/qt4cg/qtspecs/pull/487</a></div><p>485: Predeclare the prefixes math, map, array, and err</p></div>
<div class="toot" id="closed-489"><h2>Issue #489 closed<span class="toot-id"> #closed-489</span></h2><div class="pubdate">16 May at 16:12:24 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/489">https://github.com/qt4cg/qtspecs/pull/489</a></div><p>443: Allow select attribute on xsl:[non-]matching-substring</p></div>
<div class="toot" id="closed-492"><h2>Issue #492 closed<span class="toot-id"> #closed-492</span></h2><div class="pubdate">16 May at 16:12:06 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/492">https://github.com/qt4cg/qtspecs/pull/492</a></div><p>Fix examples, change filepath definition slightly</p></div>
<div class="toot" id="closed-493"><h2>Issue #493 closed<span class="toot-id"> #closed-493</span></h2><div class="pubdate">16 May at 16:11:53 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/493">https://github.com/qt4cg/qtspecs/pull/493</a></div><p>32: try/catch: New variable for all error information</p></div>
<div class="toot" id="closed-500"><h2>Issue #500 closed<span class="toot-id"> #closed-500</span></h2><div class="pubdate">16 May at 09:15:16 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/500">https://github.com/qt4cg/qtspecs/issues/500</a></div><p>Fix errant typographic quotes in XPath Data Model</p></div>
<div class="toot" id="closed-502"><h2>Issue #502 closed<span class="toot-id"> #closed-502</span></h2><div class="pubdate">16 May at 09:15:15 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/502">https://github.com/qt4cg/qtspecs/pull/502</a></div><p>Fix typographic quotes in XPath Data Model</p></div>
<div class="toot" id="created-502"><h2>Pull request #502 created<span class="toot-id"> #created-502</span></h2><div class="pubdate">16 May at 08:22:47 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/502">https://github.com/qt4cg/qtspecs/pull/502</a></div><details><summary>Fix typographic quotes in XPath Data Model</summary><div class="markup"><p>Close #500</p>
<p>On closer inspection, there were only a few places where typographic quotes <em>were not</em> used in prose. I've fixed those. I think the DM spec could probably use an editorial pass to add <code>code</code> around some literals, but I'm not doing that in this PR.</p>
<p>I've left typographic quotes around code and literals because I don't think straight quotes would be an improvement: the literal <code>“&lt;code&gt;3&lt;/code&gt;”</code> doesn't need straight quotes because the quotes are not part of the literal.</p>
</div></details></div>
<div class="toot" id="created-501"><h2>Issue #501 created<span class="toot-id"> #created-501</span></h2><div class="pubdate">15 May at 09:05:31 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/501">https://github.com/qt4cg/qtspecs/issues/501</a></div><details><summary>Error handling: Rethrow errors; finally block</summary><div class="markup"><h3>Re-throw errors</h3>
<p>In https://github.com/qt4cg/qtspecs/pull/493, a function/expression was suggested to re-throw errors:</p>
<pre><code class="language-xquery">try {
  (: wild stuff :)
} catch * {
  module:log($err:description),
  rethrow($err:map)
}
</code></pre>
<h4>Alternatives</h4>
<ul>
<li>Use and extend the existing error function: <code>fn:error(rethrow := $err:map)</code></li>
<li>Use an expression: <code>throw $err:map</code></li>
</ul>
<p>In principle, the error information can also be constructed by the user. If we extend <code>fn:error</code> to also accept a map, it could be used to both throw and re-throw errors. Missing information in the map could be added as if <code>fn:error</code> is raised.</p>
<pre><code class="language-xquery">let $map := map { 'column-number': 12, 'line-number': 3 }
return fn:error(xs:QName('oob'), 'Out of bounds', map := $map)
</code></pre>
<h3>Finally clause</h3>
<p>It can be helpful to have a code block that is always executed, even if errors occur:</p>
<pre><code class="language-xquery">let $tmp := file:create-temp-file()
return try {
  (: I/O stuff :)
} finally {
  file:delete($tmp)
}
</code></pre>
</div></details></div>
<div class="toot" id="created-500"><h2>Issue #500 created<span class="toot-id"> #created-500</span></h2><div class="pubdate">15 May at 08:46:49 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/500">https://github.com/qt4cg/qtspecs/issues/500</a></div><details><summary>Fix errant typographic quotes in XPath Data Model</summary><div class="markup"><p>In a comment on #471, @ChristianGruen observes that there are some errant typographic quotes in code examples in the XPath Data Model specification. I assume these are errors, mostly likely on my part, and should be corrected.</p>
</div></details></div>
<div class="toot" id="closed-499"><h2>Issue #499 closed<span class="toot-id"> #closed-499</span></h2><div class="pubdate">15 May at 08:21:01 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/499">https://github.com/qt4cg/qtspecs/pull/499</a></div><p>Use natural language sort order for glossary</p></div>
<div class="toot" id="created-499"><h2>Pull request #499 created<span class="toot-id"> #created-499</span></h2><div class="pubdate">14 May at 18:50:41 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/499">https://github.com/qt4cg/qtspecs/pull/499</a></div><details><summary>Use natural language sort order for glossary</summary><div class="markup"><p>This is a small stylesheet change which has the effect that the glossary in the XQuery specification (and elsewhere) now uses natural language sort order, so upper-case terms like <code>Gregorian</code> and <code>NaN</code> now appear in their proper alphabetic sequence.</p>
</div></details></div>
<div class="toot" id="agenda-05-12"><h2>QT4 CG meeting 034 draft agenda<span class="toot-id"> #agenda-05-12</span></h2><div class="pubdate">12 May at 17:10:00 GMT</div><div class="link">Link: <a href="https://qt4cg.org/meeting/agenda/2023/05-12">https://qt4cg.org/meeting/agenda/2023/05-12</a></div><p>Draft agenda published.</p></div>
<div class="toot" id="closed-48"><h2>Issue #48 closed<span class="toot-id"> #closed-48</span></h2><div class="pubdate">12 May at 12:20:36 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/48">https://github.com/qt4cg/qtspecs/pull/48</a></div><p>Create a schema-for-xslt40.xsd file for the current draft spec.</p></div>
<div class="toot" id="closed-412"><h2>Issue #412 closed<span class="toot-id"> #closed-412</span></h2><div class="pubdate">12 May at 12:14:41 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/412">https://github.com/qt4cg/qtspecs/pull/412</a></div><p>409, QT4CG-027-01: xsl:next-match</p></div>
<div class="toot" id="closed-494"><h2>Issue #494 closed<span class="toot-id"> #closed-494</span></h2><div class="pubdate">12 May at 09:39:10 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/494">https://github.com/qt4cg/qtspecs/pull/494</a></div><p>Remove legacy materials from the working master branch</p></div>
<div class="toot" id="closed-495"><h2>Issue #495 closed<span class="toot-id"> #closed-495</span></h2><div class="pubdate">12 May at 09:07:55 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/495">https://github.com/qt4cg/qtspecs/issues/495</a></div><p>separator example in https://qt4cg.org/specifications/xslt-40/Overview-diff.html#for-each-separator has xsl:sequence-of instead of xsl:sequence element</p></div>
<div class="toot" id="closed-498"><h2>Issue #498 closed<span class="toot-id"> #closed-498</span></h2><div class="pubdate">12 May at 09:07:54 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/498">https://github.com/qt4cg/qtspecs/pull/498</a></div><p>Fix typo, replace sequence-of with sequence</p></div>
<div class="toot" id="created-498"><h2>Pull request #498 created<span class="toot-id"> #created-498</span></h2><div class="pubdate">12 May at 08:07:34 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/498">https://github.com/qt4cg/qtspecs/pull/498</a></div><details><summary>Fix typo, replace sequence-of with sequence</summary><div class="markup"><p>Fix #495</p>
</div></details></div>
<div class="toot" id="created-497"><h2>Issue #497 created<span class="toot-id"> #created-497</span></h2><div class="pubdate">12 May at 08:03:21 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/497">https://github.com/qt4cg/qtspecs/issues/497</a></div><details><summary>https://qt4cg.org/specifications/xpath-functions-40/Overview-diff.html#func-map-pairs has wrong function syntax order</summary><div class="markup"><p>In https://qt4cg.org/specifications/xpath-functions-40/Overview-diff.html#func-map-pairs the explanation of the new function <code>map:pairs</code> is given as:</p>
<pre><code>map:for-each($map, ($k, $v) -&gt; {map{"key":$k, "value":$v}})
</code></pre>
<p>I think the right syntax would be <code>map:for-each($map, -&gt; ($k, $v) {map{"key":$k, "value":$v}})</code>.</p>
</div></details></div>
<div class="toot" id="closed-496"><h2>Issue #496 closed<span class="toot-id"> #closed-496</span></h2><div class="pubdate">12 May at 08:01:03 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/496">https://github.com/qt4cg/qtspecs/pull/496</a></div><p>Ignore legacy directories entirely</p></div>
<div class="toot" id="created-496"><h2>Pull request #496 created<span class="toot-id"> #created-496</span></h2><div class="pubdate">12 May at 08:00:49 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/496">https://github.com/qt4cg/qtspecs/pull/496</a></div><details><summary>Ignore legacy directories entirely</summary><div class="markup"><p>This PR is supposed to fix the action that builds PRs so that it ignores directories we never edit.</p>
</div></details></div>
<div class="toot" id="created-495"><h2>Issue #495 created<span class="toot-id"> #created-495</span></h2><div class="pubdate">12 May at 07:37:30 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/495">https://github.com/qt4cg/qtspecs/issues/495</a></div><details><summary>separator example in https://qt4cg.org/specifications/xslt-40/Overview-diff.html#for-each-separator has xsl:sequence-of instead of xsl:sequence element</summary><div class="markup"><p>While looking through the XSLT 4 draft spec, I have found the following example in https://qt4cg.org/specifications/xslt-40/Overview-diff.html#for-each-separator:</p>
<pre><code>&lt;xsl:for-each select="6, 3, 9" separator="|"&gt;
   &lt;xsl:sort select="."/&gt;
   &lt;xsl:sequence-of select="., .+1"/&gt;
&lt;/xsl:for-each&gt;
</code></pre>
<p><code>xsl:sequence-of</code> should be <code>xsl:sequence</code>.</p>
</div></details></div>
<div class="toot" id="created-494"><h2>Pull request #494 created<span class="toot-id"> #created-494</span></h2><div class="pubdate">11 May at 17:41:22 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/494">https://github.com/qt4cg/qtspecs/pull/494</a></div><details><summary>Remove legacy materials from the working master branch</summary><div class="markup"><p>This is <em>intended to be</em> an entirely uninteresting change. This PR removes a whole bunch of historical artifacts from the <code>master</code> branch, things like the requirements and use-cases documents that we aren't maintaining for QT4, the errata which don't apply to QT4, etc.</p>
<p>I will push a separate branch, <code>legacy-documentation</code>, to the repository that contains all of the the files removed by this PR so that the aren't lost and can easily be recovered. (I won't do that as a PR, I'll just push it to the repository.)</p>
<p>In the meantime, I think this trimmed down master branch works just fine and it's a lot simpler and easier to explain.</p>
<p>This PR <em>does</em> remove support for the legacy ant builds, but I doubt they've worked for a while now.</p>
</div></details></div>
<div class="toot" id="created-493"><h2>Pull request #493 created<span class="toot-id"> #created-493</span></h2><div class="pubdate">11 May at 13:24:24 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/493">https://github.com/qt4cg/qtspecs/pull/493</a></div><p>32: try/catch: New variable for all error information</p></div>
<div class="toot" id="created-492"><h2>Pull request #492 created<span class="toot-id"> #created-492</span></h2><div class="pubdate">11 May at 12:09:45 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/492">https://github.com/qt4cg/qtspecs/pull/492</a></div><details><summary>Fix examples, change filepath definition slightly</summary><div class="markup"><p>This PR fixes the examples in the <code>parse-uri()</code> function. It also makes a small change to the <code>filepath</code> property, eliding it when the scheme is known not to be file.</p>
</div></details></div>
<div class="toot" id="created-491"><h2>Pull request #491 created<span class="toot-id"> #created-491</span></h2><div class="pubdate">11 May at 11:37:09 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/491">https://github.com/qt4cg/qtspecs/pull/491</a></div><details><summary>Fix more examples in the FO 4.0 spec</summary><div class="markup"><p>Further corrections to example code in the F+O specification, found by testing (app-spec-examples in the test suite).</p>
</div></details></div>
<div class="toot" id="created-490"><h2>Issue #490 created<span class="toot-id"> #created-490</span></h2><div class="pubdate">10 May at 22:03:16 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/490">https://github.com/qt4cg/qtspecs/issues/490</a></div><details><summary>Control over schema validation in parse-xml(), doc(), etc.</summary><div class="markup"><p>I'm struggling with a problem with the stylesheet that generates QT4 tests from the examples in the function catalog, and I think it's an example of a more general problem in schema-aware processing.</p>
<p>The spec gives this example (for json-to-xml):</p>
<pre><code>The expression json-to-xml('{"x": "\\", "y": "\u0025"}', map{'escape': true()}) returns 
(with whitespace added for legibility):

&lt;map xmlns="http://www.w3.org/2005/xpath-functions"&gt;
  &lt;string escaped="true" key="x"&gt;\\&lt;/string&gt;
  &lt;string key="y"&gt;%&lt;/string&gt;
&lt;/map&gt;
</code></pre>
<p>But the test we actually generate expects the result:</p>
<pre><code>&lt;map xmlns="http://www.w3.org/2005/xpath-functions"&gt;
    &lt;string escaped="true" key="x" escaped-key="false"&gt;\\&lt;/string&gt;
    &lt;string key="y" escaped="false" escaped-key="false"&gt;%&lt;/string&gt;
&lt;/map&gt;
</code></pre>
<p>and the test is failing because the result produced by Saxon correctly excludes the <code>escaped-key="false"</code> attributes which the test is expecting. How did the attributes get there?</p>
<p>The answer is that the stylesheet is doing <code>parse-xml()</code> followed by some transformation to normalise whitespace, followed by <code>serialize()</code>. The <code>parse-xml()</code> call is invoking schema validation, which adds default attributes.</p>
<p>We probably don't want schema validation here; if we do want it, we probably don't want default attribute values to be expanded. But parse-xml() doesn't give us the choice. It says it's implementation-defined and it gives no options for the user to control it. Saxon provides configuration-level options but they aren't fine-grained enough to use here.</p>
<p>Without being able to control this, the only option seems to be for the stylesheet to transform the result to take out the defaulted attributes that the schema processor has added.</p>
<p>We need options on functions like <code>doc()</code> and <code>parse-xml()</code> to control whether and how schema validation is performed.</p>
<p>One of the options we need whenever we do validation is probably "validate+strip" - validate the input, report errors if it's invalid, but return the untyped data that was supplied to the validator, not the type-annotated data with expanded defaults.</p>
</div></details></div>
<div class="toot" id="created-489"><h2>Pull request #489 created<span class="toot-id"> #created-489</span></h2><div class="pubdate">10 May at 10:50:01 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/489">https://github.com/qt4cg/qtspecs/pull/489</a></div><p>443: Allow select attribute on xsl:[non-]matching-substring</p></div>
<div class="toot" id="closed-488"><h2>Issue #488 closed<span class="toot-id"> #closed-488</span></h2><div class="pubdate">10 May at 10:46:30 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/488">https://github.com/qt4cg/qtspecs/pull/488</a></div><p>433: Allow select attribute on xsl:[non-]matching-substring</p></div>
<div class="toot" id="created-488"><h2>Pull request #488 created<span class="toot-id"> #created-488</span></h2><div class="pubdate">10 May at 09:26:40 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/488">https://github.com/qt4cg/qtspecs/pull/488</a></div><details><summary>433: Allow select attribute on xsl:[non-]matching-substring</summary><div class="markup"><p>Allow a <code>select</code> attribute on <code>xsl:[non-]matching-substring</code> in place of the contained sequence constructor.</p>
</div></details></div>
<div class="toot" id="closed-484"><h2>Issue #484 closed<span class="toot-id"> #closed-484</span></h2><div class="pubdate">10 May at 08:01:11 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/484">https://github.com/qt4cg/qtspecs/pull/484</a></div><p>Update FO test generation stylesheet</p></div>
<div class="toot" id="closed-486"><h2>Issue #486 closed<span class="toot-id"> #closed-486</span></h2><div class="pubdate">10 May at 08:00:44 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/486">https://github.com/qt4cg/qtspecs/pull/486</a></div><p>Fix some errors in examples, as revealed by testing</p></div>
<div class="toot" id="created-487"><h2>Pull request #487 created<span class="toot-id"> #created-487</span></h2><div class="pubdate">10 May at 07:59:28 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/487">https://github.com/qt4cg/qtspecs/pull/487</a></div><details><summary>485: Predeclare the prefixes math, map, array, and err</summary><div class="markup"><p>In 3.1 XQuery processors were allowed to predeclare these prefixes; in 4.0 they are now required to do so.</p>
</div></details></div>
<div class="toot" id="created-486"><h2>Pull request #486 created<span class="toot-id"> #created-486</span></h2><div class="pubdate">09 May at 23:22:28 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/486">https://github.com/qt4cg/qtspecs/pull/486</a></div><details><summary>Fix some errors in examples, as revealed by testing</summary><div class="markup"><p>Corrects errors in examples; changes other examples to make them testable. Further test failures remain to be investigated (some may be bugs in the Saxon implementation; others require improvements to the test generation mechanism).</p>
</div></details></div>
<div class="toot" id="created-485"><h2>Issue #485 created<span class="toot-id"> #created-485</span></h2><div class="pubdate">09 May at 20:30:27 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/485">https://github.com/qt4cg/qtspecs/issues/485</a></div><details><summary>Predeclared namespaces in XQuery</summary><div class="markup"><p>XQuery defines that the prefixes xml, xs, xsi, fn, and local are predeclared, and states:</p>
<p>Additional predeclared namespace prefixes may be added to the [statically known namespaces]) by an implementation.</p>
<p>I propose that we add map, array, and math to this list, so that these can be used interoperably without pre-declaring them. It is already permitted for an implementation to do this, but it is not required. The change is backwards compatible, because user-defined namespace declarations override predeclared declarations.</p>
</div></details></div>
<div class="toot" id="created-484"><h2>Pull request #484 created<span class="toot-id"> #created-484</span></h2><div class="pubdate">09 May at 19:56:48 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/484">https://github.com/qt4cg/qtspecs/pull/484</a></div><details><summary>Update FO test generation stylesheet</summary><div class="markup"><p>Updates the stylesheet that generates tests from examples in the FO spec; plus supply a missing record definition in the function catalog so that it becomes ID/IDREF valid.</p>
</div></details></div>
<div class="toot" id="closed-63"><h2>Issue #63 closed<span class="toot-id"> #closed-63</span></h2><div class="pubdate">09 May at 18:31:51 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/63">https://github.com/qt4cg/qtspecs/issues/63</a></div><p>fn:slice, array:slice: Signatures, Examples</p></div>
<div class="toot" id="closed-477"><h2>Issue #477 closed<span class="toot-id"> #closed-477</span></h2><div class="pubdate">09 May at 18:31:20 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/477">https://github.com/qt4cg/qtspecs/pull/477</a></div><p>63: array:slice (editorial)</p></div>
<div class="toot" id="closed-29"><h2>Issue #29 closed<span class="toot-id"> #closed-29</span></h2><div class="pubdate">09 May at 18:31:12 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/29">https://github.com/qt4cg/qtspecs/issues/29</a></div><p>array:values (resolved: map:values, map:entries)</p></div>
<div class="toot" id="closed-473"><h2>Issue #473 closed<span class="toot-id"> #closed-473</span></h2><div class="pubdate">09 May at 18:27:21 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/473">https://github.com/qt4cg/qtspecs/issues/473</a></div><p>NaN ne NaN</p></div>
<div class="toot" id="closed-321"><h2>Issue #321 closed<span class="toot-id"> #closed-321</span></h2><div class="pubdate">09 May at 18:26:18 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/321">https://github.com/qt4cg/qtspecs/issues/321</a></div><p>relax $input in fn:serialize</p></div>
<div class="toot" id="closed-325"><h2>Issue #325 closed<span class="toot-id"> #closed-325</span></h2><div class="pubdate">09 May at 18:25:46 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/325">https://github.com/qt4cg/qtspecs/issues/325</a></div><p>Operator precedence table needs updating</p></div>
<div class="toot" id="closed-482"><h2>Issue #482 closed<span class="toot-id"> #closed-482</span></h2><div class="pubdate">09 May at 18:24:30 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/482">https://github.com/qt4cg/qtspecs/pull/482</a></div><p>473: NaN Comparisons (bug fix)</p></div>
<div class="toot" id="closed-476"><h2>Issue #476 closed<span class="toot-id"> #closed-476</span></h2><div class="pubdate">09 May at 18:24:05 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/476">https://github.com/qt4cg/qtspecs/pull/476</a></div><p>29: array:values</p></div>
<div class="toot" id="closed-475"><h2>Issue #475 closed<span class="toot-id"> #closed-475</span></h2><div class="pubdate">09 May at 18:23:52 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/475">https://github.com/qt4cg/qtspecs/pull/475</a></div><p>471: fn: prefix removed from function calls in the examples</p></div>
<div class="toot" id="closed-472"><h2>Issue #472 closed<span class="toot-id"> #closed-472</span></h2><div class="pubdate">09 May at 18:23:41 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/472">https://github.com/qt4cg/qtspecs/pull/472</a></div><p>321: Add new note and examples demonstrating adaptive serialization method</p></div>
<div class="toot" id="closed-468"><h2>Issue #468 closed<span class="toot-id"> #closed-468</span></h2><div class="pubdate">09 May at 18:23:21 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/468">https://github.com/qt4cg/qtspecs/pull/468</a></div><p>325 Update operator precedence table</p></div>
<div class="toot" id="closed-462"><h2>Issue #462 closed<span class="toot-id"> #closed-462</span></h2><div class="pubdate">09 May at 18:22:25 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/462">https://github.com/qt4cg/qtspecs/pull/462</a></div><p>434: Added examples for parse-integer()</p></div>
<div class="toot" id="created-483"><h2>Pull request #483 created<span class="toot-id"> #created-483</span></h2><div class="pubdate">08 May at 09:05:31 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/483">https://github.com/qt4cg/qtspecs/pull/483</a></div><p>452: window: make 'start' and 'when' optional</p></div>
<div class="toot" id="created-482"><h2>Pull request #482 created<span class="toot-id"> #created-482</span></h2><div class="pubdate">07 May at 20:05:18 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/482">https://github.com/qt4cg/qtspecs/pull/482</a></div><details><summary>473: NaN Comparisons (bug fix)</summary><div class="markup"><p>Drops the incorrect statement suggesting that NaN xx NaN is always false, for all six operators xx. In fact NaN ne NaN is true, as statements elsewhere in the spec make clear. Specifically, the operator mapping appendix of the XPath/XQuery language spec makes clear that <code>X ne Y</code> maps to <code>not(op:numeric-equal(X, Y))</code>.</p>
</div></details></div>
<div class="toot" id="created-481"><h2>Issue #481 created<span class="toot-id"> #created-481</span></h2><div class="pubdate">07 May at 18:43:24 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/481">https://github.com/qt4cg/qtspecs/issues/481</a></div><details><summary>When we have array:build and map:build, then why do we also need array:of and map:of ?</summary><div class="markup"><p>Looking at the current specification of the pairs of functions: (<strong><em><a href="https://qt4cg.org/specifications/xpath-functions-40/Overview.html#func-array-build">array:build</a></em></strong>, <strong><em><a href="https://qt4cg.org/specifications/xpath-functions-40/Overview.html#func-array-of">array:of</a></em></strong>) and (<strong><em><a href="https://qt4cg.org/specifications/xpath-functions-40/Overview.html#func-map-build">map:build</a></em></strong>, <strong><em><a href="https://qt4cg.org/specifications/xpath-functions-40/Overview.html#func-map-of">map:of</a></em></strong>), it is impossible not to notice that the second function in each of these pairs is a weak duplicate of the first.</p>
<p>Also, the examples provided for <strong><em>array:build</em></strong> and <strong><em>array:of</em></strong>, seem to have a good deal of common content / duplication / overlap.</p>
<p>Another issue is that <strong><em>array:of</em></strong> requires as input a sequence of  <strong>value records</strong>, whose definition is challenging to understand (and whose meaning seems to be solely to represent a sequence of sequences), and what is also really challenging is how to construct this argument to <strong><em>array:of</em></strong>. If this is unnatural and challenging, one would probably prefer to use just <strong><em>array:build</em></strong>.</p>
<p>Is there an example where it is possible to construct an array (or a map) with <strong><em>array:of</em></strong> (or with <strong><em>map:of</em></strong>) but it is impossible (or significantly more difficult) to construct the same array/map with the function <strong><em>array:build</em></strong> (or with <strong><em>map:build</em></strong>)?</p>
<p>If there are no such significant and convincing examples, then why do we need the <strong><em>xxx:of</em></strong> functions?</p>
<p>Thus the question naturally arises:  "<strong><em>Why is the function <code>xxx:of</code> necessary at all?</em></strong>"</p>
</div></details></div>
<div class="toot" id="created-480"><h2>Issue #480 created<span class="toot-id"> #created-480</span></h2><div class="pubdate">07 May at 18:22:51 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/480">https://github.com/qt4cg/qtspecs/issues/480</a></div><details><summary>Allow type promotion of xs:string to xs:anyURI</summary><div class="markup"><p>If it hasn't already been considered and ruled out, I'd like to propose adding a type promotion rule to XPath 4 that would allow <code>xs:string</code> to be type-promoted to <code>xs:anyURI</code>, so that functions with parameters whose types are declared as <code>xs:anyURI</code> can directly take <code>xs:string</code> values, without having to first cast these to <code>xs:anyURI</code>.</p>
<p>This would empower function authors to select <code>xs:anyURI</code> as a type - signaling that they’re expecting a URI - without forcing users of the function into explicitly casting their string-typed URIs.</p>
<p>The motivation behind this proposal is that many eXist users are frustrated when using the eXist extension functions that properly declare parameters as <code>xs:anyURI</code>. If this proposal isn’t adopted, that’s ok; we’ll just eliminate the use of <code>xs:anyURI</code> in our functions, as proposed in https://github.com/eXist-db/exist/issues/4632. But this would a bit unfortunate for authors of functions who see the use of <code>xs:anyURI</code> as a proper expression of intent in their functions.</p>
<p>The change would be to https://www.w3.org/TR/xpath-31/#promotion - and I guess would be a 3rd item, called "String type promotion", saying:</p>
<blockquote>
<p>A value of type <code>xs:string</code> can be promoted to the type <code>xs:anyURI</code>. The result of this promotion is created by casting the original value to the type <code>xs:anyURI</code>.</p>
</blockquote>
</div></details></div>
<div class="toot" id="created-479"><h2>Issue #479 created<span class="toot-id"> #created-479</span></h2><div class="pubdate">07 May at 11:33:05 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/479">https://github.com/qt4cg/qtspecs/issues/479</a></div><details><summary>fn:deep-equal: Input order</summary><div class="markup"><p>#383 is about the specific order of children of element nodes.</p>
<p>I think we should also provide an option to ignore the top-level order of the input items:</p>
<pre><code class="language-xquery">(: returns true: both input arguments contain the same items, but in a different order :)
deep-equal(
  (1 to 10),
  reverse(1 to 10),
  map { 'unordered': true() }
)

(: returns false: the compared elements are different :)
deep-equal(
  &lt;a&gt;&lt;b/&gt;&lt;c/&gt;&lt;/a&gt;,
  &lt;a&gt;&lt;c/&gt;&lt;b/&gt;&lt;/a&gt;,
  map { 'unordered': true() }
)

(: returns false: the second sequence contains duplicates :)
deep-equal(
  (1, 2),
  (2, 1, 1),
  map { 'unordered': true() }
)
</code></pre>
</div></details></div>
<div class="toot" id="created-478"><h2>Pull request #478 created<span class="toot-id"> #created-478</span></h2><div class="pubdate">07 May at 10:53:10 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/478">https://github.com/qt4cg/qtspecs/pull/478</a></div><p>467: map:keys-where</p></div>
<div class="toot" id="created-477"><h2>Pull request #477 created<span class="toot-id"> #created-477</span></h2><div class="pubdate">07 May at 10:04:42 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/477">https://github.com/qt4cg/qtspecs/pull/477</a></div><p>63: array:slice (editorial)</p></div>
<div class="toot" id="created-476"><h2>Pull request #476 created<span class="toot-id"> #created-476</span></h2><div class="pubdate">07 May at 09:59:33 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/476">https://github.com/qt4cg/qtspecs/pull/476</a></div><p>29: array:values</p></div>
<div class="toot" id="closed-423"><h2>Issue #423 closed<span class="toot-id"> #closed-423</span></h2><div class="pubdate">05 May at 17:49:05 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/423">https://github.com/qt4cg/qtspecs/issues/423</a></div><p>[XSLT 4.0] 2.2 Notation is incomplete</p></div>
<div class="toot" id="created-475"><h2>Pull request #475 created<span class="toot-id"> #created-475</span></h2><div class="pubdate">05 May at 16:02:17 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/475">https://github.com/qt4cg/qtspecs/pull/475</a></div><details><summary>471: fn: prefix removed from function calls in the examples</summary><div class="markup"><p>#471: I’ve removed the <code>fn:</code> prefixes from the function calls in the examples.</p>
<p>I have left pretty much all <code>true</code>/<code>false</code> strings untouched, since I’m not sure what would be the most consistent approach to clean them up. It will be better anyway to create a separate PR for that.</p>
</div></details></div>
<div class="toot" id="closed-474"><h2>Issue #474 closed<span class="toot-id"> #closed-474</span></h2><div class="pubdate">05 May at 13:14:02 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/474">https://github.com/qt4cg/qtspecs/pull/474</a></div><p>Per comments on #465, improve presentation of multi-line expressions</p></div>
<div class="toot" id="closed-465"><h2>Issue #465 closed<span class="toot-id"> #closed-465</span></h2><div class="pubdate">05 May at 12:16:12 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/465">https://github.com/qt4cg/qtspecs/pull/465</a></div><p>80: fn:iterate-while: Examples revised</p></div>
<div class="toot" id="created-474"><h2>Pull request #474 created<span class="toot-id"> #created-474</span></h2><div class="pubdate">05 May at 11:52:32 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/474">https://github.com/qt4cg/qtspecs/pull/474</a></div><details><summary>Per comments on #465, improve presentation of multi-line expressions</summary><div class="markup"><p>This PR addresses points raised in the comments on #465.</p>
<p>If an <code>fos:expression</code> element is a code block, nest an <code>eg</code> inside it:</p>
<pre><code class="language-xml">               &lt;fos:expression&gt;&lt;eg&gt;&lt;![CDATA[let $input := 3936256
return fn:iterate-while(
  $input,
  function($result) { abs($result * $result - $input) &gt;= 0.0000000001 },
  function($guess) { ($guess + $input div $guess) div 2 }
)]]&gt;&lt;/eg&gt;&lt;/fos:expression&gt;
</code></pre>
<p>I found four examples where an <code>fos:expression</code> contained more than one newline and I added <code>eg</code> wrappers in those cases.</p>
<p>There are many more <code>fos:expression</code> elements that contain a single newline, but automatically formatting them as code blocks was often unsuccessful. Many of those cases seem to be just newlines entered for authoring convenience.</p>
<p>I also fixed the CSS for code blocks and attempte to remove trailing newlines from code blocks.</p>
</div></details></div>
<div class="toot" id="created-473"><h2>Issue #473 created<span class="toot-id"> #created-473</span></h2><div class="pubdate">04 May at 17:18:56 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/473">https://github.com/qt4cg/qtspecs/issues/473</a></div><details><summary>NaN ne NaN</summary><div class="markup"><p>It seems that ever since 2.0, the section in Functions and Operators "Comparison Operators on Numeric Values" (currently §4.3) has stated "If either, or both, operands are NaN, false is returned."</p>
<p>This is incorrect. If the operator is <code>ne</code>, then the correct result is true.</p>
<p>(And editorially, the first two commas in this sentence should be dropped).</p>
</div></details></div>
<div class="toot" id="created-472"><h2>Pull request #472 created<span class="toot-id"> #created-472</span></h2><div class="pubdate">04 May at 15:21:17 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/472">https://github.com/qt4cg/qtspecs/pull/472</a></div><details><summary>321: Add new note and examples demonstrating adaptive serialization method</summary><div class="markup"><p>Per <a href="https://github.com/qt4cg/qtspecs/issues/321">Issue 321</a>, I've added a new note and two additional simple examples noting the adaptive serialization method to draw attention to this feature in the existing specs.</p>
</div></details></div>
<div class="toot" id="created-471"><h2>Issue #471 created<span class="toot-id"> #created-471</span></h2><div class="pubdate">04 May at 13:03:07 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/471">https://github.com/qt4cg/qtspecs/issues/471</a></div><details><summary>Unify formatting (function calls, code blocks, quotes) in the specification</summary><div class="markup"><p><strong>Todos (2023-05-18)</strong>:</p>
<ul>
<li>[x] Initial cleanup of <code>fn:</code> prefixes → <a href="https://github.com/qt4cg/qtspecs/pull/475">#475</a></li>
<li>[x] Remove more <code>fn:</code> prefixes → <a href="https://github.com/qt4cg/qtspecs/pull/509">#509</a>
<ul>
<li><code>fn:</code> prefixes in examples that raise an error.</li>
<li><code>fn:</code> prefixes in <code>eg</code> code blocks</li>
<li>other documents: <code>expressions.xml</code>, <code>query-examples.xml</code>, …</li>
</ul>
</li>
<li>[x] Render <code>false</code>, <code>true</code>, <code>NaN</code>, <code>INF</code>, <code>+INF</code> as code → <a href="https://github.com/qt4cg/qtspecs/pull/510">#510</a></li>
<li>[x] Render string values as code and use quotes: <code>"yes"</code>, <code>"true"</code>, <code>"0"</code> → <a href="https://github.com/qt4cg/qtspecs/pull/511">#511</a></li>
<li>[x] Omit quotes for single characters: <code>\b</code>, <code>\f</code>, … → <a href="https://github.com/qt4cg/qtspecs/pull/511">#511</a></li>
<li>[x] Rewrite simple to typographic quotes → <a href="https://github.com/qt4cg/qtspecs/pull/511">#511</a></li>
</ul>
<hr>
<p>Inspired by https://github.com/qt4cg/qtspecs/pull/454#issuecomment-1534633089 ff.</p>
<p>The syntax of the examples in the XQFO specification is inconsistent. Sometimes, functions in the standard function namespace have an <code>fn</code> prefix…</p>
<ul>
<li><code>fn:fold-right(1 to 5, "", fn:concat(?, ".", ?))</code></li>
<li><code>fn:substring("motor car", 6)</code></li>
</ul>
<p>…sometimes they don’t…</p>
<ul>
<li><code>data(123)</code></li>
<li><code>concat("http://www.example.com/", encode-for-uri("~bébé"))</code></li>
</ul>
<p>…sometimes it’s both:</p>
<ul>
<li><code>fn:fold-right(1 to 5, "$zero", concat("$f(", ?, ", ", ?, ")"))</code></li>
<li><code>fn:concat(01, 02, 03, 04, true())</code></li>
<li><code>fn:tokenize(fn:unparsed-text($href), '\r\n|\r|\n')[not(position()=last() and .='')]</code></li>
</ul>
<p>Should we drop or keep the prefix – or doesn’t it really matter? If there’s interest, I can create a PR (I’d tend to drop the prefixes).</p>
<p>In addition, there doesn’t seem to be a consistent rule for representing booleans. We have:</p>
<p>Syntax | Comment
--- | ---
…returns false | mostly used in the rules (seems appropriate to me)
…returns <code>false</code> | used in the rules; maybe we should use replace it with the first syntax?
…the result is <code>fn:false()</code> | used in the rules; maybe we should use replace it with the first syntax?
…returns <code>false()</code> | mostly used in the examples (seems appropriate to me)</p>
</div></details></div>
<div class="toot" id="created-470"><h2>Pull request #470 created<span class="toot-id"> #created-470</span></h2><div class="pubdate">04 May at 11:34:57 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/470">https://github.com/qt4cg/qtspecs/pull/470</a></div><details><summary>369 add fixed-prefixes attribute in XSLT</summary><div class="markup"><p>A solution to some of the problems identified in issue #369. This proposal affects XSLT only.</p>
</div></details></div>
<div class="toot" id="created-469"><h2>Issue #469 created<span class="toot-id"> #created-469</span></h2><div class="pubdate">04 May at 07:09:33 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/469">https://github.com/qt4cg/qtspecs/issues/469</a></div><details><summary>array:of, map:of: Signatures, Examples</summary><div class="markup"><p>Just trivia:</p>
<p>a) The parameter name of <code>array:of</code> is <a href="https://qt4cg.org/specifications/xpath-functions-40/Overview.html#func-array-of"><code>$input</code></a>.
&nbsp;&nbsp;&nbsp;&nbsp;<code>$members</code> may be a better choice (or we should change <code>map:of($pairs)</code> to <code>map:of($input)</code>).</p>
<p>b) The type of <code>$pairs</code> is <a href="https://qt4cg.org/specifications/xpath-functions-40/Overview.html#func-map-of"><code>record(key as xs:anyAtomicType, value as item()*, *)*</code></a>.
&nbsp;&nbsp;&nbsp;&nbsp;Shouldn’t it be <code>record(key as xs:anyAtomicType, value as item()*)*</code> (without the trailing <code>, *</code>)?
&nbsp;&nbsp;&nbsp;&nbsp;If the current syntax is correct, an explanatory comment could be helpful.</p>
<p>c) One <code>map:of</code> example needs to be fixed: <code>map:of((map:entry(0, "no"), map:entry(1, "yes")))</code>.</p>
<p>See #508 for the proposal to rename <code>map:of</code> to <code>map:of-pairs</code>.</p>
</div></details></div>
<div class="toot" id="created-468"><h2>Pull request #468 created<span class="toot-id"> #created-468</span></h2><div class="pubdate">03 May at 21:59:06 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/468">https://github.com/qt4cg/qtspecs/pull/468</a></div><details><summary>325 Update operator precedence table</summary><div class="markup"><p>Add "otherwise" and thin arrow to the table. Editorial.</p>
</div></details></div>
<div class="toot" id="created-467"><h2>Issue #467 created<span class="toot-id"> #created-467</span></h2><div class="pubdate">03 May at 11:09:26 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/467">https://github.com/qt4cg/qtspecs/issues/467</a></div><details><summary>map:keys-where: Return Keys That Match a Predicate</summary><div class="markup"><p><strong>Edit, 23/05/17:</strong> Reopened to discuss <code>map:keys($map, $predicate)</code> as an alternative.</p>
<hr>
<h3>Motivation</h3>
<p>We have <code>fn:index-where</code> and <code>array:index-where</code> to locate items/members in a sequence/an array that match a specific predicate, and we could introduce an equivalent function for maps. A recent use case can be found in https://github.com/qt4cg/qtspecs/issues/413#issuecomment-1531288167d.</p>
<h3>Proposal</h3>
<h4>Summary</h4>
<p>Returns keys of map entries for which the value matches a supplied predicate.</p>
<h4>Signature</h4>
<pre><code class="language-xquery">map:keys-where(
  $map        as map(*),
  $predicate  as function(item()*) as xs:boolean
) as xs:anyAtomicValue*
</code></pre>
<h4>Properties</h4>
<p>This function is ·deterministic·, ·context-independent·, and ·focus-independent·.</p>
<h4>Rules</h4>
<p>The function takes any ·map· as its <code>$map</code> argument and applies the supplied function to the value of each map entry. The function supplied as <code>$predicate</code> takes the value of the corresponding map entry as an argument, and the result is a sequence containing the keys of those entries for which the function returns true.</p>
<p>More formally, the function returns the result of the expression:</p>
<pre><code class="language-xquery">map:for-each(
  $map,
  function($key, $value) {
    if($predicate($value)) then $key else ()
  }
)
</code></pre>
<h4>Examples</h4>
<pre><code class="language-xquery">let $numbers := map { 0: 'zero', 1: 'one', 2: 'two', 3: 'three' }
return map:keys-where($numbers, function($string) { $string = 'two' })
</code></pre>
<h3>Comments</h3>
<ul>
<li><strong>Edit (2023-05-04):</strong> Renamed from <code>map:key-where</code> to <code>map:keys-where</code>.</li>
<li>Similar functions (<code>index-of</code>, <code>index-where</code>) use the singular form.</li>
<li>An alternative would be to add an optional <code>$predicate</code> function argument to <code>map:keys</code>.</li>
<li>If we decide to introduce a shorter syntax (see <a href="https://github.com/qt4cg/qtspecs/issues/129">#129</a> and <a href="https://github.com/qt4cg/qtspecs/issues/129">#436</a>), we could have:</li>
</ul>
<pre><code class="language-xquery">map:keys-where($numbers, { . = 'two ' })
</code></pre>
</div></details></div>
<div class="toot" id="created-466"><h2>Pull request #466 created<span class="toot-id"> #created-466</span></h2><div class="pubdate">02 May at 23:36:04 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/466">https://github.com/qt4cg/qtspecs/pull/466</a></div><details><summary>460: Fix math symbols</summary><div class="markup"><p>(1) drops the mathematical operator symbols appendix, which allowed an extensive range of non-ASCII characters as synonyms for language keywords, (2) retains × and ÷ as synonyms for multiplication and division, (3) allows full-width <code>&lt;</code> and <code>&gt;</code> in operator symbols in place of the usual ASCII characters, to avoid the need for XML escaping.</p>
</div></details></div>
<div class="toot" id="minutes-05-02"><h2>QT4 CG meeting 033 draft minutes<span class="toot-id"> #minutes-05-02</span></h2><div class="pubdate">02 May at 17:20:00 GMT</div><div class="link">Link: <a href="https://qt4cg.org/meeting/minutes/2023/05-02">https://qt4cg.org/meeting/minutes/2023/05-02</a></div><p>Draft minutes published.</p></div>
<div class="toot" id="closed-449"><h2>Issue #449 closed<span class="toot-id"> #closed-449</span></h2><div class="pubdate">02 May at 16:27:49 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/449">https://github.com/qt4cg/qtspecs/pull/449</a></div><p>Actions from review of PR #420</p></div>
<div class="toot" id="closed-456"><h2>Issue #456 closed<span class="toot-id"> #closed-456</span></h2><div class="pubdate">02 May at 16:26:55 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/456">https://github.com/qt4cg/qtspecs/pull/456</a></div><p>Revises numeric literal syntax</p></div>
<div class="toot" id="closed-458"><h2>Issue #458 closed<span class="toot-id"> #closed-458</span></h2><div class="pubdate">02 May at 16:26:42 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/458">https://github.com/qt4cg/qtspecs/pull/458</a></div><p>Update parse-integer and format-integer following review</p></div>
<div class="toot" id="closed-224"><h2>Issue #224 closed<span class="toot-id"> #closed-224</span></h2><div class="pubdate">02 May at 16:25:46 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/224">https://github.com/qt4cg/qtspecs/issues/224</a></div><p>Infrastructure changes/improvements</p></div>
<div class="toot" id="closed-461"><h2>Issue #461 closed<span class="toot-id"> #closed-461</span></h2><div class="pubdate">02 May at 16:25:45 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/461">https://github.com/qt4cg/qtspecs/pull/461</a></div><p>Make code more visually distinct</p></div>
<div class="toot" id="created-465"><h2>Pull request #465 created<span class="toot-id"> #created-465</span></h2><div class="pubdate">02 May at 12:37:49 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/465">https://github.com/qt4cg/qtspecs/pull/465</a></div><details><summary>80: fn:iterate-while: Examples revised</summary><div class="markup"><p>This PR is editorial. I’ve reformatted the examples for <code>fn:iterate-while</code>…</p>
<p><img src="https://user-images.githubusercontent.com/196589/235667578-896f8ef3-8d11-49fb-81b5-352d522a99a3.png" alt="image"></p>
<p>…to make them better readable.</p>
</div></details></div>
<div class="toot" id="agenda-05-02"><h2>QT4 CG meeting 033 draft agenda<span class="toot-id"> #agenda-05-02</span></h2><div class="pubdate">01 May at 17:10:00 GMT</div><div class="link">Link: <a href="https://qt4cg.org/meeting/agenda/2023/05-02">https://qt4cg.org/meeting/agenda/2023/05-02</a></div><p>Draft agenda published.</p></div>
<div class="toot" id="created-464"><h2>Issue #464 created<span class="toot-id"> #created-464</span></h2><div class="pubdate">29 Apr at 21:01:45 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/464">https://github.com/qt4cg/qtspecs/issues/464</a></div><details><summary>Serialization sequence normalization step 3 needs clarification</summary><div class="markup"><p>The specifications currently read:</p>
<blockquote>
<p>If the item-separator serialization parameter is absent, then for each subsequence of adjacent strings in S2, copy a single string to the new sequence equal to the values of the strings in the subsequence concatenated in order, each separated by a single space. Copy all other items to the new sequence. Otherwise, copy each item in S2 to the new sequence, inserting between each pair of items a string whose value is equal to the value of the item-separator parameter. The new sequence is S3.</p>
</blockquote>
<p>As written ("If...then.... Otherwise...."), this implies that the process whereby a block of adjacent strings are joined into a single string is performed only when the item separator parameter is absent. I.e., if the item-separator parameter is not absent, it will not be used to string-join adjacent groups of strings. Perhaps that is as intended, but I want to make sure.</p>
<p>Also, as written, this implies that when the parameter is absent, the sequence begins by finding all subsequences of adjacent strings, performing concatenation. Then all non-strings are added to the sequence. That seems wrong, because it appears to advise the processor to rearrange the sequence of input items.</p>
<p>I propose a revision along these lines:</p>
<blockquote>
<p>Copy each item in S2 to a new sequence. If a given pair of adjacent items are both strings, then separate them with a string whose value is equal to the value of the item-separator parameter or is a single space if the item-separator parameter is absent. If a given pair of adjacent items are not both strings, insert between each pair of items a string whose value is equal to the value of the item-separator parameter. Once this is finished, take each adjacent group of strings and concatenate them into a single string. The new sequence is S3.</p>
</blockquote>
<p>My revision is based upon what I imagine happens, but implementers will know better than I.</p>
<p>I am working on some editorial touch-ups of the Serialization specifications, and can incorporate comments/suggestions made in this thread in that larger enterprise.</p>
</div></details></div>
<div class="toot" id="created-463"><h2>Issue #463 created<span class="toot-id"> #created-463</span></h2><div class="pubdate">28 Apr at 20:09:30 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/463">https://github.com/qt4cg/qtspecs/issues/463</a></div><details><summary>fn:parts() - extract the parts of a (not-really) atomic value</summary><div class="markup"><p>We have a whole raft of functions to extract the parts of date, time, and duration values: month-from-dateTime(), etc etc.</p>
<p>These aren't particularly convenient to use, for example getting multiple components of a duration is clumsy; and there are gaps, for example there are no functions to extract the parts of a <code>gMonthDay</code>.</p>
<p>I propose a general-purpose function <code>fn:parts()</code> which turns any of these composite atomic values into a map, enabling you to replace a call on <code>get-month-from-dateTime($value)</code> with <code>parts($value)?month</code>.</p>
<p>So far this dupllicates existing functionality perhaps with a bit of added convenience. However, the mechanism is much more extensible and flexible than what we have now:</p>
<ul>
<li>we can apply it to atomic types that currently have no decomposition operators, such as gMonthDay</li>
<li>we can easily add additional components such as <code>day-of-week</code> or <code>quarter</code> or <code>day-of-year</code> or <code>julian-day</code> that are currently not available, or only available clumsily using format-dateTime().</li>
<li>the parts() function is polymorphic, so the same code can be used to get the year (say) from a date, a dateTime, or a gYearMonth.</li>
</ul>
</div></details></div>
<div class="toot" id="created-462"><h2>Pull request #462 created<span class="toot-id"> #created-462</span></h2><div class="pubdate">27 Apr at 23:19:43 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/462">https://github.com/qt4cg/qtspecs/pull/462</a></div><details><summary>434: Added examples for parse-integer()</summary><div class="markup"><p>Supplemental examples related to pr #434 .</p>
</div></details></div>
<div class="toot" id="created-461"><h2>Pull request #461 created<span class="toot-id"> #created-461</span></h2><div class="pubdate">27 Apr at 11:56:50 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/461">https://github.com/qt4cg/qtspecs/pull/461</a></div><details><summary>Make code more visually distinct</summary><div class="markup"><p>Close #224</p>
<p>Thanks @ChristianGruen for the reminder that this was still open!</p>
</div></details></div>
<div class="toot" id="created-460"><h2>Issue #460 created<span class="toot-id"> #created-460</span></h2><div class="pubdate">27 Apr at 10:57:22 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/460">https://github.com/qt4cg/qtspecs/issues/460</a></div><details><summary>Mathematical Operator Symbols</summary><div class="markup"><p>Appendix B.3 of the specification proposes a set of non-ASCII symbols that can be used in place of language keywords, for example "∃" for "some" and "∀" for "every".</p>
<p>I haven't detected a great deal of enthusiasm for this idea, and I can see it causing some confusion, partly because Unicode offers such a wide choice of symbols some of which are visually very similar.</p>
<p>I propose retaining a much smaller set of these symbols:</p>
<ul>
<li>
<p>"÷" (xF7) for "div" because the symbol is widely recognised and "div" here is pretty ugly</p>
</li>
<li>
<p>"≺" (x227A) and "≻" (x227B) as alternatives to "&lt;" and "&gt;" in all operator symbols (other than XML markup contexts) that use these characters: for readability in contexts, especially XSLT, where the "&lt;" and "&gt;" characters need to be escaped</p>
</li>
</ul>
</div></details></div>
<div class="toot" id="closed-4"><h2>Issue #4 closed<span class="toot-id"> #closed-4</span></h2><div class="pubdate">27 Apr at 10:32:00 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/4">https://github.com/qt4cg/qtspecs/issues/4</a></div><p>[XPath] [XQuery] Better names for ThinArrowTarget and FatArrowTarget</p></div>
<div class="toot" id="closed-59"><h2>Issue #59 closed<span class="toot-id"> #closed-59</span></h2><div class="pubdate">27 Apr at 10:27:07 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/59">https://github.com/qt4cg/qtspecs/issues/59</a></div><p>[FO] fn:replace no longer has the 3 an 4 argument variants</p></div>
<div class="toot" id="created-459"><h2>Issue #459 created<span class="toot-id"> #created-459</span></h2><div class="pubdate">27 Apr at 07:29:30 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/459">https://github.com/qt4cg/qtspecs/issues/459</a></div><details><summary>Eager and lazy evaluation</summary><div class="markup"><p>In #359, different approaches were discussed for eager and lazy evaluation. This issue could be used to</p>
<ol>
<li>clarify if we have the same notion of eagerness and laziness, and</li>
<li>define language constructs for how eager/lazy evaluation.</li>
</ol>
</div></details></div>
<div class="toot" id="created-458"><h2>Pull request #458 created<span class="toot-id"> #created-458</span></h2><div class="pubdate">26 Apr at 17:35:11 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/458">https://github.com/qt4cg/qtspecs/pull/458</a></div><details><summary>Update parse-integer and format-integer following review</summary><div class="markup"><p>Following review and acceptance of the parse-integer and format-integer functions, make changes suggested during the review. See actions QT4G-032-03 to -06.</p>
</div></details></div>
<div class="toot" id="created-457"><h2>Issue #457 created<span class="toot-id"> #created-457</span></h2><div class="pubdate">26 Apr at 06:32:41 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/457">https://github.com/qt4cg/qtspecs/issues/457</a></div><details><summary>Support parsing numeric, alphabetic, and additive number systems.</summary><div class="markup"><p>This proposal is based on the work done in https://www.w3.org/TR/css-counter-styles-3/ when defining CSS rules for formatting the numbers in list items.</p>
<p>The idea is to define 3 parsing strategies:</p>
<ol>
<li><code>numeric</code> -- number-like systems such as decimal;</li>
<li><code>alphabetic</code> -- alphabetical-like systems such as spreadsheet columns (A, B, ..., Z, AA, AB, ...)</li>
<li><code>additive</code> -- systems like roman and hebrew where the symbol represents a fixed value that is added together</li>
</ol>
<p>Parsing these, we have 3 properties:</p>
<ol>
<li><code>system as enum("numeric", "alphabetic", "additive") := "numeric"</code> -- which of the parsing strategies (number systems) to use;</li>
<li><code>symbols as xs:string := "0123456789"</code> -- the list of characters used to represent a digit;</li>
<li><code>additive-symbols as map(xs:integer, xs:string) := map {}</code> -- a map of the symbols in an additive system with the corresponding value of that symbol.</li>
</ol>
<p>Consideration 1 -- Should these also allow any whitespace and optional "+"/"-" symbols like the radix-based parse-integer?</p>
<p>Consideration 2 -- Should we define decimal format options for these, so the decimal format name can format/represent other number systems (binary, hex, hebrew, tamil, roman numerals, etc.). -- Note: this would make <code>system</code>, <code>symbols</code>, and <code>additive-symbols</code> properties of the decimal format object with the above defaults. The formatting would work in the same way as it is defined in the CSS Counter Styles specification.</p>
<h2>Design 1 -- Separate functions</h2>
<pre><code>fn:parse-numeric-integer($value as xs:string,
                         $symbols as xs:string := "0123456789") as xs:integer

fn:parse-alphabetic-integer($value as xs:string,
                            $symbols as xs:string := "ABCDEFGHIJKLMNOPQRSTUVWXYZ") as xs:integer

fn:parse-additive-integer($value as xs:string,
                          $additive-symbols as map(xs:integer, xs:string)) as xs:integer
</code></pre>
<h2>Design 2 -- Combined functions</h2>
<pre><code>fn:parse-integer($value as xs:string,
                 $system as xs:string := "numeric",
                 $symbols as xs:string := "0123456789",
                 $additive-symbols as map(xs:integer, xs:string) := map {}) as xs:integer

fn:parse-integer($value as xs:string,
                 $radix as xs:integer) as xs:integer
</code></pre>
</div></details></div>
<div class="toot" id="created-456"><h2>Pull request #456 created<span class="toot-id"> #created-456</span></h2><div class="pubdate">25 Apr at 18:55:27 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/456">https://github.com/qt4cg/qtspecs/pull/456</a></div><details><summary>Revises numeric literal syntax</summary><div class="markup"><p>Following actions from review on 25 Apri 2023 (QT4CG-032-02), revises the new syntax of numeric literals to disallow trailing underscores. Also adds more notes and examples.</p>
</div></details></div>
<div class="toot" id="minutes-04-25"><h2>QT4 CG meeting 032 draft minutes<span class="toot-id"> #minutes-04-25</span></h2><div class="pubdate">25 Apr at 17:30:00 GMT</div><div class="link">Link: <a href="https://qt4cg.org/meeting/minutes/2023/04-25">https://qt4cg.org/meeting/minutes/2023/04-25</a></div><p>Draft minutes published.</p></div>
<div class="toot" id="closed-429"><h2>Issue #429 closed<span class="toot-id"> #closed-429</span></h2><div class="pubdate">25 Apr at 16:32:44 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/429">https://github.com/qt4cg/qtspecs/issues/429</a></div><p>Hexadecimal and binary literals</p></div>
<div class="toot" id="closed-241"><h2>Issue #241 closed<span class="toot-id"> #closed-241</span></h2><div class="pubdate">25 Apr at 16:32:09 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/241">https://github.com/qt4cg/qtspecs/issues/241</a></div><p>Functions integer-to-string and string-to-integer with radix</p></div>
<div class="toot" id="closed-434"><h2>Issue #434 closed<span class="toot-id"> #closed-434</span></h2><div class="pubdate">25 Apr at 16:31:49 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/434">https://github.com/qt4cg/qtspecs/pull/434</a></div><p>Functions to parse and format hex integers</p></div>
<div class="toot" id="closed-433"><h2>Issue #433 closed<span class="toot-id"> #closed-433</span></h2><div class="pubdate">25 Apr at 16:31:09 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/433">https://github.com/qt4cg/qtspecs/pull/433</a></div><p>Add hex and binary literals and allow underscores</p></div>
<div class="toot" id="created-455"><h2>Pull request #455 created<span class="toot-id"> #created-455</span></h2><div class="pubdate">25 Apr at 13:40:00 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/455">https://github.com/qt4cg/qtspecs/pull/455</a></div><details><summary>410: Converting doubles to decimals, fractional digits</summary><div class="markup"><p>@michaelhkay In this PR, I tried to undo the changes that were introduced to make comparisons transitive. I haven’t made any changes to <code>distinct-values</code> and <code>group by</code>, because I am uncertain if I have spotted all the relevant parts of the specification. Maybe/hopefully we can address them in a next step.</p>
<p>Any feedback is welcome.</p>
</div></details></div>
<div class="toot" id="closed-293"><h2>Issue #293 closed<span class="toot-id"> #closed-293</span></h2><div class="pubdate">24 Apr at 12:48:20 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/293">https://github.com/qt4cg/qtspecs/issues/293</a></div><p>Error in fn:doc-available specification</p></div>
<div class="toot" id="closed-430"><h2>Issue #430 closed<span class="toot-id"> #closed-430</span></h2><div class="pubdate">24 Apr at 12:48:18 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/430">https://github.com/qt4cg/qtspecs/pull/430</a></div><p>fn:doc et al, error handling: inconsistencies. Closes #293</p></div>
<div class="toot" id="created-454"><h2>Pull request #454 created<span class="toot-id"> #created-454</span></h2><div class="pubdate">24 Apr at 12:42:18 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/454">https://github.com/qt4cg/qtspecs/pull/454</a></div><details><summary>125: array:partition</summary><div class="markup"><p>This PR revisits array:partition, with extra editorial clarification of the spec; including but not confined to fixing issue #125.</p>
<p>I suggest we schedule this PR for discussion since we have not previously discussed it.</p>
<p>One question for the group is what the name of the function should be (including the choice of namespace).</p>
<p>Another is whether the polarity of the callback function should be changed (from <code>break-when</code> to <code>continue-when</code> or similar).</p>
<p>We could also consider returning an array of sequences rather than a sequence of arrays. (But in my view sequences of arrays are rather easier to manage at the moment.)</p>
</div></details></div>
<div class="toot" id="closed-453"><h2>Issue #453 closed<span class="toot-id"> #closed-453</span></h2><div class="pubdate">24 Apr at 11:17:13 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/453">https://github.com/qt4cg/qtspecs/pull/453</a></div><p>Fix issue #86 (incorrect default timezone format)</p></div>
<div class="toot" id="created-453"><h2>Pull request #453 created<span class="toot-id"> #created-453</span></h2><div class="pubdate">24 Apr at 11:00:58 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/453">https://github.com/qt4cg/qtspecs/pull/453</a></div><details><summary>Fix issue #86 (incorrect default timezone format)</summary><div class="markup"><p>Trivial bug fix.</p>
</div></details></div>
<div class="toot" id="closed-89"><h2>Issue #89 closed<span class="toot-id"> #closed-89</span></h2><div class="pubdate">24 Apr at 10:49:53 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/89">https://github.com/qt4cg/qtspecs/issues/89</a></div><p>[XQuery] DirPIConstructor permits ':' in the PI name.</p></div>
<div class="toot" id="agenda-04-25"><h2>QT4 CG meeting 032 draft agenda<span class="toot-id"> #agenda-04-25</span></h2><div class="pubdate">24 Apr at 09:10:00 GMT</div><div class="link">Link: <a href="https://qt4cg.org/meeting/agenda/2023/04-25">https://qt4cg.org/meeting/agenda/2023/04-25</a></div><p>Draft agenda published.</p></div>
<div class="toot" id="created-452"><h2>Issue #452 created<span class="toot-id"> #created-452</span></h2><div class="pubdate">21 Apr at 23:09:53 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/452">https://github.com/qt4cg/qtspecs/issues/452</a></div><details><summary>window: make 'start' and 'when' optional</summary><div class="markup"><p>Every time I use <code>tumbling window</code>, I write <code>start when true()</code>.    If start would be optional, default to true, that would be easier</p>
</div></details></div>
<div class="toot" id="closed-450"><h2>Issue #450 closed<span class="toot-id"> #closed-450</span></h2><div class="pubdate">20 Apr at 13:50:36 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/450">https://github.com/qt4cg/qtspecs/pull/450</a></div><p>Fix issue #418 (editorial corrections)</p></div>
<div class="toot" id="closed-438"><h2>Issue #438 closed<span class="toot-id"> #closed-438</span></h2><div class="pubdate">20 Apr at 13:49:59 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/438">https://github.com/qt4cg/qtspecs/issues/438</a></div><p>What are the "non-whitespace control characters"?</p></div>
<div class="toot" id="closed-442"><h2>Issue #442 closed<span class="toot-id"> #closed-442</span></h2><div class="pubdate">20 Apr at 13:49:57 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/442">https://github.com/qt4cg/qtspecs/pull/442</a></div><p>Attempt to clearify XML serialization of control characters</p></div>
<div class="toot" id="created-451"><h2>Issue #451 created<span class="toot-id"> #created-451</span></h2><div class="pubdate">20 Apr at 06:51:32 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/451">https://github.com/qt4cg/qtspecs/issues/451</a></div><details><summary>Multiple Schemas</summary><div class="markup"><p>There are many situations in which a single transformation wants to deal with multiple schemas: for example when transforming from v1 of some industry standard to v2 of the same standard, or when processing a collection of input documents each of which references its own schema using <code>xsi:schemaLocation</code>.</p>
<p>This is currently possible only if the schemas are compatible (that is, if the union of the schemas is itself a valid schema). And even where it is possible, validation against the union of S1 and S2 may produce a different outcome from validation against S2, for example because a strict wildcard allows content that S2 would not allow. Substitution groups are a particular problem: if v1 and v2 have elements with different substitution group membership, then validating against the union of v1 and v2 allows the union of the substitution groups, which means that you haven't actually verified that the result document is valid against v2.</p>
<p>The problem is confounded by considerations that are outside the scope of the spec. What happens when you run two different stylesheets against the same source document? If the source document has been validated against S1, this means that both stylesheets must use schemas that are supersets of S1. The way this requirement is managed in Saxon is to introduce the concept of a Configuration in which transformations run; a Configuration has a single schema, and all source documents and stylesheets within the Configuration must use compatible subsets of this schema. A source document validated using one Configuration cannot be used in a different Configuration, because the type annotations would be meaningless against a different schema.</p>
<p>My proposal is to introduce the idea of a named schema (that is, a named collection of schema components). When we do <code>xsl:import-schema</code>, we can give the imported schema a name, and there is no requirement that the components in this schema should be compatible with the components in any other schema. When we refer to a schema type (for example in <code>$s cast as QName</code>) we should be able to qualify the type name with a schema name (we can postpone discussions of syntax, let's say <code>cast as my:part-number§v1</code> for now). When we request validation, we should be able to nominate the schema to be used for validation, for example <code>&lt;xsl:element name="e" validation="strict" schema="v2"&gt;</code>.</p>
<p>The trickiest part is handling source documents, mainly because validation of source documents (especially those read using doc() or collection()) is at present almost entirely implementation-defined. I believe that we need explicit options to request validation of source documents against a specific schema. There should also be an option to validate a document against the schema identified in its own <code>xsi:schemaLocation</code>, in which case there should be no requirement that that schema is compatible with any schema known statically to the stylesheet.</p>
</div></details></div>
<div class="toot" id="closed-49"><h2>Issue #49 closed<span class="toot-id"> #closed-49</span></h2><div class="pubdate">19 Apr at 15:09:01 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/49">https://github.com/qt4cg/qtspecs/issues/49</a></div><p>[XQuery] The 'member' keyword is still present on ForMemberBinding</p></div>
<div class="toot" id="closed-74"><h2>Issue #74 closed<span class="toot-id"> #closed-74</span></h2><div class="pubdate">19 Apr at 15:06:00 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/74">https://github.com/qt4cg/qtspecs/issues/74</a></div><p>[FO] Support parsing HTML</p></div>
<div class="toot" id="closed-87"><h2>Issue #87 closed<span class="toot-id"> #closed-87</span></h2><div class="pubdate">19 Apr at 15:04:34 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/87">https://github.com/qt4cg/qtspecs/issues/87</a></div><p>[XSL] Support for "master files"</p></div>
<div class="toot" id="closed-109"><h2>Issue #109 closed<span class="toot-id"> #closed-109</span></h2><div class="pubdate">19 Apr at 15:02:26 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/109">https://github.com/qt4cg/qtspecs/issues/109</a></div><p>[xslt4] xsl:note for structured documentation</p></div>
<div class="toot" id="closed-113"><h2>Issue #113 closed<span class="toot-id"> #closed-113</span></h2><div class="pubdate">19 Apr at 14:59:58 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/113">https://github.com/qt4cg/qtspecs/issues/113</a></div><p>[xslt] Constructing arrays</p></div>
<div class="toot" id="closed-239"><h2>Issue #239 closed<span class="toot-id"> #closed-239</span></h2><div class="pubdate">19 Apr at 14:55:54 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/239">https://github.com/qt4cg/qtspecs/issues/239</a></div><p>Terminology concerning function items and their access to static and dynamic context</p></div>
<div class="toot" id="closed-373"><h2>Issue #373 closed<span class="toot-id"> #closed-373</span></h2><div class="pubdate">19 Apr at 14:52:39 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/373">https://github.com/qt4cg/qtspecs/issues/373</a></div><p>apparent copy/paste error in annotation documentation of simple type yes-or-no-or-maybe</p></div>
<div class="toot" id="created-450"><h2>Pull request #450 created<span class="toot-id"> #created-450</span></h2><div class="pubdate">19 Apr at 14:50:00 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/450">https://github.com/qt4cg/qtspecs/pull/450</a></div><p>Fix issue #418 (editorial corrections)</p></div>
<div class="toot" id="created-449"><h2>Pull request #449 created<span class="toot-id"> #created-449</span></h2><div class="pubdate">19 Apr at 13:52:08 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/449">https://github.com/qt4cg/qtspecs/pull/449</a></div><details><summary>Actions from review of PR #420</summary><div class="markup"><p>Actions from review of PR #420 (QT4CG-031-01, -02); new functions <code>map:entries()</code> and <code>map:values()</code> from issue #29</p>
</div></details></div>
<div class="toot" id="closed-445"><h2>Issue #445 closed<span class="toot-id"> #closed-445</span></h2><div class="pubdate">19 Apr at 07:59:56 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/445">https://github.com/qt4cg/qtspecs/pull/445</a></div><p>Editorial updates to XSLT spec</p></div>
<div class="toot" id="created-448"><h2>Issue #448 created<span class="toot-id"> #created-448</span></h2><div class="pubdate">19 Apr at 05:43:07 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/448">https://github.com/qt4cg/qtspecs/issues/448</a></div><details><summary>Support extended dateTime formats of ISO-8601:2019?</summary><div class="markup"><p>The ISO 8601:2019 <a href="https://www.iso.org/obp/ui#iso:std:iso:8601:-2:ed-1:v1:en:term:3.1.1.4">standard</a> supports extended dateTime formats including support for uncertain or approximate times and new quantifiers. Apparently, the extension are documented in <a href="https://www.loc.gov/standards/datetime/">Extended Date/Time Format (EDTF) Specification</a> from the US LoC.</p>
</div></details></div>
<div class="toot" id="created-447"><h2>Pull request #447 created<span class="toot-id"> #created-447</span></h2><div class="pubdate">18 Apr at 23:24:02 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/447">https://github.com/qt4cg/qtspecs/pull/447</a></div><details><summary>435, 53, 436: lambda expressions, thin arrows</summary><div class="markup"><p>Addresses issue 436 by introducing syntax similar to Java, C#, and JS for anonymous inline functions (lamda expressions). This involves finding a new symbol for the existing "thin arrow" operator; it also gives an opportunity to show how lambda expressions can be used in pipelines.</p>
<p>Some points for WG consideration:</p>
<p>(a) Do we really want the curly braces around the function body to be mandatory?</p>
<p>(b) What symbol should we use for the mapping arrow? I've used <code>=!&gt;</code> as it suggests to me the combination of function application and sequence mapping.</p>
<p>(c) Should we reinstate the special syntax for arity-one "focus functions" (<code>-&gt;{@salary})</code> ) which is dropped in this proposal</p>
<p>(d) I haven't necessarily worked through all the changes to examples needed, e.g.. in the XSLT and F+O specs.</p>
</div></details></div>
<div class="toot" id="closed-437"><h2>Issue #437 closed<span class="toot-id"> #closed-437</span></h2><div class="pubdate">18 Apr at 19:33:53 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/437">https://github.com/qt4cg/qtspecs/issues/437</a></div><p>xsl:where-populated and table with header</p></div>
<div class="toot" id="minutes-04-18"><h2>QT4 CG meeting 031 draft minutes<span class="toot-id"> #minutes-04-18</span></h2><div class="pubdate">18 Apr at 18:03:00 GMT</div><div class="link">Link: <a href="https://qt4cg.org/meeting/minutes/2023/04-18">https://qt4cg.org/meeting/minutes/2023/04-18</a></div><p>Draft minutes published.</p></div>
<div class="toot" id="closed-357"><h2>Issue #357 closed<span class="toot-id"> #closed-357</span></h2><div class="pubdate">18 Apr at 17:10:08 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/357">https://github.com/qt4cg/qtspecs/issues/357</a></div><p>Representing key-value pairs</p></div>
<div class="toot" id="closed-420"><h2>Issue #420 closed<span class="toot-id"> #closed-420</span></h2><div class="pubdate">18 Apr at 17:10:07 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/420">https://github.com/qt4cg/qtspecs/pull/420</a></div><p>Issue 357 Map composition and decomposition</p></div>
<div class="toot" id="closed-446"><h2>Issue #446 closed<span class="toot-id"> #closed-446</span></h2><div class="pubdate">18 Apr at 17:10:06 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/446">https://github.com/qt4cg/qtspecs/pull/446</a></div><p>Fix merge conflicts in PR #420</p></div>
<div class="toot" id="created-446"><h2>Pull request #446 created<span class="toot-id"> #created-446</span></h2><div class="pubdate">18 Apr at 17:01:40 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/446">https://github.com/qt4cg/qtspecs/pull/446</a></div><details><summary>Fix merge conflicts in PR #420</summary><div class="markup"><p>Close #420
Close #357</p>
</div></details></div>
<div class="toot" id="created-445"><h2>Pull request #445 created<span class="toot-id"> #created-445</span></h2><div class="pubdate">18 Apr at 16:54:05 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/445">https://github.com/qt4cg/qtspecs/pull/445</a></div><details><summary>Editorial updates to XSLT spec</summary><div class="markup"><p>This PR fixes editorial issues in the XSLT 4.0 spec: issue #373, issue #384, issue #423. It also updates the XSD schema for XSLT 4.0 to incorporate most of the syntax changes that have been made to date (though further checking is needed), and updates some 3.0/3.1 references to 4.0 references.</p>
</div></details></div>
<div class="toot" id="closed-444"><h2>Issue #444 closed<span class="toot-id"> #closed-444</span></h2><div class="pubdate">18 Apr at 16:31:04 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/444">https://github.com/qt4cg/qtspecs/pull/444</a></div><p>Resolve merge conflict for PR 420</p></div>
<div class="toot" id="created-444"><h2>Pull request #444 created<span class="toot-id"> #created-444</span></h2><div class="pubdate">18 Apr at 16:29:39 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/444">https://github.com/qt4cg/qtspecs/pull/444</a></div><details><summary>Resolve merge conflict for PR 420</summary><div class="markup"><p>Close #420
Close #357</p>
</div></details></div>
<div class="toot" id="created-443"><h2>Issue #443 created<span class="toot-id"> #created-443</span></h2><div class="pubdate">18 Apr at 15:40:00 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/443">https://github.com/qt4cg/qtspecs/issues/443</a></div><details><summary>@select on xsl:matching-substring and xsl:non-matching-substring</summary><div class="markup"><p>In the spirit of making <code>@select</code> or<code> &lt;sequence constructor&gt;</code> the norm, I think the children of <code>xsl:analyze-string</code> have perhaps been overlooked.</p>
</div></details></div>
<div class="toot" id="created-442"><h2>Pull request #442 created<span class="toot-id"> #created-442</span></h2><div class="pubdate">18 Apr at 12:42:54 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/442">https://github.com/qt4cg/qtspecs/pull/442</a></div><details><summary>Attempt to clearify XML serialization of control characters</summary><div class="markup"><p>Fix #438</p>
<p>Clarify that the control characters #x1 through X1f and #x7f through #x9f must be output as character references except for the whitespace characters #x9, #xA, #xD, and #85.</p>
</div></details></div>
<div class="toot" id="closed-439"><h2>Issue #439 closed<span class="toot-id"> #closed-439</span></h2><div class="pubdate">18 Apr at 10:45:47 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/439">https://github.com/qt4cg/qtspecs/issues/439</a></div><p>ExprSingle no longer allows OrExpr</p></div>
<div class="toot" id="closed-440"><h2>Issue #440 closed<span class="toot-id"> #closed-440</span></h2><div class="pubdate">18 Apr at 10:45:30 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/440">https://github.com/qt4cg/qtspecs/pull/440</a></div><p>Fix bug #439 - grammar for ExprSingle</p></div>
<div class="toot" id="closed-441"><h2>Issue #441 closed<span class="toot-id"> #closed-441</span></h2><div class="pubdate">18 Apr at 10:45:07 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/441">https://github.com/qt4cg/qtspecs/pull/441</a></div><p>Make XSLT function formatting consistent with F&amp;O formatting</p></div>
<div class="toot" id="created-441"><h2>Pull request #441 created<span class="toot-id"> #created-441</span></h2><div class="pubdate">18 Apr at 10:44:58 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/441">https://github.com/qt4cg/qtspecs/pull/441</a></div><details><summary>Make XSLT function formatting consistent with F&amp;O formatting</summary><div class="markup"><p>Resolves action QT4CG-023-01, I believe. This is a minimal sort of fix, not an attempt to refactor everything.</p>
</div></details></div>
<div class="toot" id="created-440"><h2>Pull request #440 created<span class="toot-id"> #created-440</span></h2><div class="pubdate">18 Apr at 10:13:54 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/440">https://github.com/qt4cg/qtspecs/pull/440</a></div><details><summary>Fix bug #439 - grammar for ExprSingle</summary><div class="markup"><p>Simple bug fix, shouldn't need any meeting time.</p>
</div></details></div>
<div class="toot" id="created-439"><h2>Issue #439 created<span class="toot-id"> #created-439</span></h2><div class="pubdate">18 Apr at 09:03:37 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/439">https://github.com/qt4cg/qtspecs/issues/439</a></div><details><summary>ExprSingle no longer allows OrExpr</summary><div class="markup"><p>The grammar for ExprSingle seems to have been accidentally changed so it no longer allows an OrExpr as one of the alternatives.</p>
</div></details></div>
<div class="toot" id="created-438"><h2>Issue #438 created<span class="toot-id"> #created-438</span></h2><div class="pubdate">15 Apr at 08:56:18 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/438">https://github.com/qt4cg/qtspecs/issues/438</a></div><details><summary>What are the "non-whitespace control characters"?</summary><div class="markup"><p>In Section 5, XML Serialization, we find:</p>
<blockquote>
<p>A consequence of this rule is that certain characters MUST be output as character references, to ensure that they survive the round trip through serialization and parsing. Specifically, CR, NEL and LINE SEPARATOR characters in text nodes MUST be output respectively as "&amp;#xD;", "&amp;#x85;", and "&amp;#x2028;", or their equivalents; while CR, NL, TAB, NEL and LINE SEPARATOR characters in attribute nodes MUST be output respectively as "&amp;#xD;", "&amp;#xA;", "&amp;#x9;", "&amp;#x85;", and "&amp;#x2028;", or their equivalents. In addition, the non-whitespace control characters #x1 through #x1F and #x7F through #x9F in text nodes and attribute nodes MUST be output as character references.
(The reference to "non-whitespace control characters" appears in a few other places as well, but for basically the same purpose.)</p>
</blockquote>
<p>But what <strong>are</strong> the "non-whitespace control characters"? The spec doesn't say. I think it means <em>all</em> of the C0 and C1 control characters except CR, NL, TAB, and NEL. The fact that vertical tab and line feed might be considered "white space" doesn't really matter anyway since none of the other C0 control characters are allowed in XML 1.0 anyway (encoded or otherwise).</p>
<p>XML 1.0 doesn't actually care about the C1 control characters. There's no reason to encode them, but it does no harm, I suppose. You'd have to encode the C0 and C1 control characters for an XML 1.1 parser, but none of those exist.</p>
<p>I wonder if it might be a little clearer to say</p>
<blockquote>
<p>A consequence of this rule is that certain characters MUST be output as character references, to ensure that they survive the round trip through serialization and parsing. Specifically, CR, NEL and LINE SEPARATOR characters in text nodes MUST be output respectively as "&amp;#xD;", "&amp;#x85;", and "&amp;#x2028;", or their equivalents; while CR, NL, TAB, NEL and LINE SEPARATOR characters in attribute nodes MUST be output respectively as "&amp;#xD;", "&amp;#xA;", "&amp;#x9;", "&amp;#x85;", and "&amp;#x2028;", or their equivalents. In addition, the other control characters #x1 through #x1F (except  #x9, #xA, and #xD) and #x7F through #x9F (except #x85) in text nodes and attribute nodes MUST be output as character references.</p>
</blockquote>
</div></details></div>
<div class="toot" id="agenda-04-18"><h2>QT4 CG meeting 031 draft agenda<span class="toot-id"> #agenda-04-18</span></h2><div class="pubdate">14 Apr at 10:50:00 GMT</div><div class="link">Link: <a href="https://qt4cg.org/meeting/agenda/2023/04-18">https://qt4cg.org/meeting/agenda/2023/04-18</a></div><p>Draft agenda published.</p></div>
<div class="toot" id="created-437"><h2>Issue #437 created<span class="toot-id"> #created-437</span></h2><div class="pubdate">13 Apr at 14:26:24 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/437">https://github.com/qt4cg/qtspecs/issues/437</a></div><details><summary>xsl:where-populated and table with header</summary><div class="markup"><p>Dear all,</p>
<p>I just discover the use of xsl:where-populated but was surprised it cover only a narrow use case of single level of wrapping</p>
<p>My use case is about table and I have to wrap thing into a table with header</p>
<pre><code class="language-xml">&lt;table ... bunch of attributes'
    &lt;thead ....&gt;
    &lt;xsl:for-each ... &gt;
       &lt;tr&gt;  
          &lt;xsl:for-each ... &gt;
              &lt;td&gt;...&lt;/td&gt;
         &lt;/xsl:for-each&gt;
     &lt;/tr&gt;
   &lt;/xsl:for-each&gt;
&lt;/table&gt;
</code></pre>
<p>How can I do that with  xsl:where-populated ?</p>
</div></details></div>
<div class="toot" id="created-436"><h2>Issue #436 created<span class="toot-id"> #created-436</span></h2><div class="pubdate">11 Apr at 17:19:01 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/436">https://github.com/qt4cg/qtspecs/issues/436</a></div><details><summary>Allow inline function expressions in arrow operator call chains</summary><div class="markup"><p>It can be useful to create inline functions for simple operations (e.g. adding 1 to a number) to be used in arrow operator call chains.</p>
<p>The current proposal uses <code>-&gt; { ... }</code> for just the thin arrow operator.</p>
<p>This proposal is split into two parts:</p>
<ol>
<li>restructure the grammar to make the function call usage simpler to follow;</li>
<li>introduce the ability to use inline functions in thin/fat arrow contexts.</li>
</ol>
<h2>Part 1 -- Simplify the Grammar</h2>
<p>I suggest changing the grammar to:</p>
<pre><code>FatArrowTarget           ::= "=&gt;" ( ArrowFunctionCall | ArrowDynamicFunctionCall )
ThinArrowTarget          ::= "-&gt;" ( ArrowFunctionCall | ArrowDynamicFunctionCall )
ArrowFunctionCall        ::= EQName ArgumentList
ArrowDynamicFunctionCall ::= ( VarRef | ParenthesizedExpr ) PositionalArgumentList
</code></pre>
<p>That is, I've grouped the function name/reference with the argument list.</p>
<h2>Part 2 -- Allow Inline Functions</h2>
<pre><code>FatArrowTarget          ::= "=&gt;" ( ArrowFunctionCall | ArrowDynamicFunctionCall | ArrowInlineFunctionCall )
ThinArrowTarget         ::= "-&gt;" ( ArrowFunctionCall | ArrowDynamicFunctionCall | ArrowInlineFunctionCall )
ArrowInlineFunctionCall ::= ( "function" | "fun" ) EnclosedExpr
</code></pre>
<p>Note: here, <code>"fun"</code> is a placeholder for whichever name/symbol we choose in https://github.com/qt4cg/qtspecs/issues/53.</p>
<p>This then allows expressions like <code>(1, 2, 3) -&gt; function { . + 1 }</code> and <code>(1, 2, 3) =&gt; fun { ~ = 1 }</code> (see also https://github.com/qt4cg/qtspecs/issues/129) without overloading the meaning of <code>-&gt;</code>.</p>
</div></details></div>
<div class="toot" id="minutes-04-11"><h2>QT4 CG meeting 030 draft minutes<span class="toot-id"> #minutes-04-11</span></h2><div class="pubdate">11 Apr at 17:17:00 GMT</div><div class="link">Link: <a href="https://qt4cg.org/meeting/minutes/2023/04-11">https://qt4cg.org/meeting/minutes/2023/04-11</a></div><p>Draft minutes published.</p></div>
<div class="toot" id="created-435"><h2>Issue #435 created<span class="toot-id"> #created-435</span></h2><div class="pubdate">11 Apr at 16:33:00 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/435">https://github.com/qt4cg/qtspecs/issues/435</a></div><details><summary>Remove the inlined function expression variant of the thin arrow operator</summary><div class="markup"><p>This proposal is to remove the third bullet/variant from the thin arrow operator so that the new inline function syntax (<code>-&gt; { ... }</code>) cannot be used within the arrow expressions.</p>
<p>This makes the thin/fat arrows consistent in behaviour with each other, with the exception of how they pass the value to the expressions:</p>
<ol>
<li>thin arrow operators pass the values in the sequence one at a time to the associated function;</li>
<li>fat arrow operators pass all the values in the sequence to the associated function in a single call.</li>
</ol>
<h2>Changes</h2>
<ol>
<li>Update the syntax:</li>
</ol>
<pre><code>[46] FatArrowTarget  ::= "=&gt;" ((ArrowStaticFunction ArgumentList) | (ArrowDynamicFunction PositionalArgumentList)) 	
[47] ThinArrowTarget ::= "-&gt;" ((ArrowStaticFunction ArgumentList) | (ArrowDynamicFunction PositionalArgumentList))
</code></pre>
<ol start="2">
<li>Remove the text for the inline function variant:</li>
</ol>
<blockquote>
<p>If the arrow is followed by an <a href="https://qt4cg.org/specifications/xquery-40/xpath-40.html#doc-xpath40-EnclosedExpr">EnclosedExpr</a>:</p>
<p>Given a <a href="https://qt4cg.org/specifications/xquery-40/xpath-40.html#doc-xpath40-UnaryExpr">UnaryExpr</a> U, and an <a href="https://qt4cg.org/specifications/xquery-40/xpath-40.html#doc-xpath40-EnclosedExpr">EnclosedExpr</a> {E}, the expression U -&gt; {E} is equivalent to the expression (U) ! (E).</p>
<p>For example, the expression $x -&gt; {.+1} is equivalent to ($x)!(.+1).</p>
</blockquote>
<ol start="3">
<li>Remove/update the associated examples, e.g. to use <code>let $f := function ($x) { $x + 1 } return $x -&gt; f() -&gt; $f()</code>.</li>
</ol>
</div></details></div>
<div class="toot" id="closed-390"><h2>Issue #390 closed<span class="toot-id"> #closed-390</span></h2><div class="pubdate">11 Apr at 16:16:37 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/390">https://github.com/qt4cg/qtspecs/issues/390</a></div><p>Should parsing and building URIs attempt to special case Windows URIs for UNC names?</p></div>
<div class="toot" id="closed-415"><h2>Issue #415 closed<span class="toot-id"> #closed-415</span></h2><div class="pubdate">11 Apr at 16:16:36 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/415">https://github.com/qt4cg/qtspecs/pull/415</a></div><p>Revise parse/build URI functions for UNC names</p></div>
<div class="toot" id="agenda-04-11"><h2>QT4 CG meeting 030 draft agenda<span class="toot-id"> #agenda-04-11</span></h2><div class="pubdate">09 Apr at 19:35:00 GMT</div><div class="link">Link: <a href="https://qt4cg.org/meeting/agenda/2023/04-11">https://qt4cg.org/meeting/agenda/2023/04-11</a></div><p>Draft agenda published.</p></div>
<div class="toot" id="created-434"><h2>Pull request #434 created<span class="toot-id"> #created-434</span></h2><div class="pubdate">07 Apr at 11:57:37 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/434">https://github.com/qt4cg/qtspecs/pull/434</a></div><details><summary>Functions to parse and format hex integers</summary><div class="markup"><p>Addresses issue #241 by providing functions to parse and format integers in any number base from 2 to 36.</p>
</div></details></div>
<div class="toot" id="created-433"><h2>Pull request #433 created<span class="toot-id"> #created-433</span></h2><div class="pubdate">07 Apr at 09:56:14 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/433">https://github.com/qt4cg/qtspecs/pull/433</a></div><details><summary>Add hex and binary literals and allow underscores</summary><div class="markup"><p>Addresses issue #429. The grammar is extended to allow hex and binary integer literals, and all numeric literals may contain underscores for readability.</p>
</div></details></div>
<div class="toot" id="closed-432"><h2>Issue #432 closed<span class="toot-id"> #closed-432</span></h2><div class="pubdate">07 Apr at 07:43:16 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/432">https://github.com/qt4cg/qtspecs/pull/432</a></div><p>fix attribute name : it is diff instead of role</p></div>
<div class="toot" id="created-432"><h2>Pull request #432 created<span class="toot-id"> #created-432</span></h2><div class="pubdate">06 Apr at 20:01:36 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/432">https://github.com/qt4cg/qtspecs/pull/432</a></div><p>fix attribute name : it is diff instead of role</p></div>
<div class="toot" id="closed-417"><h2>Issue #417 closed<span class="toot-id"> #closed-417</span></h2><div class="pubdate">06 Apr at 15:51:43 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/417">https://github.com/qt4cg/qtspecs/pull/417</a></div><p>Fix residual reference to op:A2S which is no longer defined</p></div>
<div class="toot" id="closed-315"><h2>Issue #315 closed<span class="toot-id"> #closed-315</span></h2><div class="pubdate">06 Apr at 15:51:10 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/315">https://github.com/qt4cg/qtspecs/issues/315</a></div><p>fn:transform inconsistency: initial-mode</p></div>
<div class="toot" id="closed-427"><h2>Issue #427 closed<span class="toot-id"> #closed-427</span></h2><div class="pubdate">06 Apr at 15:51:09 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/427">https://github.com/qt4cg/qtspecs/pull/427</a></div><p>Change fn:transform to use the stylesheet's default mode</p></div>
<div class="toot" id="closed-280"><h2>Issue #280 closed<span class="toot-id"> #closed-280</span></h2><div class="pubdate">06 Apr at 15:50:59 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/280">https://github.com/qt4cg/qtspecs/issues/280</a></div><p>Why is resolve-uri forbidden from resolving against a URI that contains a fragment identifier?</p></div>
<div class="toot" id="closed-426"><h2>Issue #426 closed<span class="toot-id"> #closed-426</span></h2><div class="pubdate">06 Apr at 15:50:58 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/426">https://github.com/qt4cg/qtspecs/pull/426</a></div><p>Resolve #280 by allowing a fragid</p></div>
<div class="toot" id="closed-428"><h2>Issue #428 closed<span class="toot-id"> #closed-428</span></h2><div class="pubdate">06 Apr at 12:05:43 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/428">https://github.com/qt4cg/qtspecs/pull/428</a></div><p>Fix problem in rendering empty &lt;xnt&gt; elements</p></div>
<div class="toot" id="closed-431"><h2>Issue #431 closed<span class="toot-id"> #closed-431</span></h2><div class="pubdate">06 Apr at 12:05:42 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/431">https://github.com/qt4cg/qtspecs/pull/431</a></div><p>Fix problem rendering xnt elements</p></div>
<div class="toot" id="created-431"><h2>Pull request #431 created<span class="toot-id"> #created-431</span></h2><div class="pubdate">06 Apr at 12:05:21 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/431">https://github.com/qt4cg/qtspecs/pull/431</a></div><details><summary>Fix problem rendering xnt elements</summary><div class="markup"><p>Close #428</p>
<p>Hi @michaelhkay . I took a slightly different approach. For unknown reasons long since lost in the mists of time the 'etc' files that act as databases for cross-spec references stored <code>nt</code> elements. That's weird because the <code>nt</code> elements are supposed to point to <code>prod</code> elements. I expect someone (let's be candid, probably me) got confused by the fact that <code>nt</code> elements have a <code>def</code> attribute and thought they were definitions. They're not. I've changed things so that the <code>prod</code> elements are now stored in the database. There's only going to ever be one of those.</p>
<p>I had to tidy up a few things to make that work, and we can't abandon support for <code>nt</code> files in 'etc' documents because we have existing files that don't get regenerated.</p>
<p>I also cleaned up the cross-reference error to <code>StringLiteral</code> in the XSLT spec and patched over a problem with a few link in the XQuery specifications.</p>
<p>There's no useful information from PR formatting of PRs that change the stylesheets, so I'm just going to cross my fingers and merge this. Please pull the latest and let me know if you see any problems!</p>
</div></details></div>
<div class="toot" id="created-430"><h2>Pull request #430 created<span class="toot-id"> #created-430</span></h2><div class="pubdate">06 Apr at 09:32:47 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/430">https://github.com/qt4cg/qtspecs/pull/430</a></div><details><summary>fn:doc et al, error handling: inconsistencies. Closes #293</summary><div class="markup"><p>Resolves action item QT4CG-029-04.</p>
</div></details></div>
<div class="toot" id="created-429"><h2>Issue #429 created<span class="toot-id"> #created-429</span></h2><div class="pubdate">05 Apr at 17:04:05 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/429">https://github.com/qt4cg/qtspecs/issues/429</a></div><details><summary>Hexadecimal and binary literals</summary><div class="markup"><p>Without wanting to challenge our weekly burn-down chart too much, I wonder whether it would be a big deal to support hexadecimal and binary literals in XPath? Examples:</p>
<pre><code class="language-xquery">(: decimal :)     1, 255,
(: hexadecimal :) 0x1, 0X00Ff,
(: binary :)      0b1, 0B11111111, 
</code></pre>
<p>The main question is probably if it conflicts with the existing grammar?</p>
</div></details></div>
<div class="toot" id="created-428"><h2>Pull request #428 created<span class="toot-id"> #created-428</span></h2><div class="pubdate">05 Apr at 16:21:17 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/428">https://github.com/qt4cg/qtspecs/pull/428</a></div><details><summary>Fix problem in rendering empty &lt;xnt&gt; elements</summary><div class="markup"><p>In the F&amp;O spec, function <code>parse-QName</code>,  there is a link to <code>BracedURILiteral</code> repeated 6 times. This happens when an <code>&lt;xnt&gt;</code> element is written with empty content. There are 6 entries in the /etc/ XP40 file for the relevant grammar symbol, and each of them is output. I haven't tried to eliminate the redundancy in the /etc/XP40 file, I have simply changed the code for processing <code>&lt;xnt&gt;</code> so it only considers the first one.</p>
</div></details></div>
<div class="toot" id="closed-411"><h2>Issue #411 closed<span class="toot-id"> #closed-411</span></h2><div class="pubdate">05 Apr at 14:19:14 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/411">https://github.com/qt4cg/qtspecs/pull/411</a></div><p>Remove the note from the parse-html unparsed-entity sections.</p></div>
<div class="toot" id="created-427"><h2>Pull request #427 created<span class="toot-id"> #created-427</span></h2><div class="pubdate">05 Apr at 14:17:12 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/427">https://github.com/qt4cg/qtspecs/pull/427</a></div><details><summary>Change fn:transform to use the stylesheet's default mode</summary><div class="markup"><p>Close #315</p>
</div></details></div>
<div class="toot" id="created-426"><h2>Pull request #426 created<span class="toot-id"> #created-426</span></h2><div class="pubdate">04 Apr at 21:01:57 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/426">https://github.com/qt4cg/qtspecs/pull/426</a></div><details><summary>Resolve #280 by allowing a fragid</summary><div class="markup"><p>Fix #280</p>
<p>(Based off the right branch this time. I hope.)</p>
</div></details></div>
<div class="toot" id="closed-424"><h2>Issue #424 closed<span class="toot-id"> #closed-424</span></h2><div class="pubdate">04 Apr at 21:01:15 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/424">https://github.com/qt4cg/qtspecs/pull/424</a></div><p>Allow fn:resolve-uri to resolve against a base URI that includes a fragment identifier</p></div>
<div class="toot" id="created-425"><h2>Issue #425 created<span class="toot-id"> #created-425</span></h2><div class="pubdate">04 Apr at 20:09:45 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/425">https://github.com/qt4cg/qtspecs/issues/425</a></div><details><summary>Structural proposal (ThinLayer:tm:) : Add a layer of thin spec between XPath and the XPath Derived Language</summary><div class="markup"><p>XPath is ubiquitous and is used even in places where we have no idea
On the other hand XPath is very useful to us as the centerpiece of XSLT, XQuery</p>
<p>In order to allow people to have a more expanded use of XPath without to have to get the whole XSLT, XQuery story, it is perhaps the time to consider adding a thin layer of spec in order to have</p>
<ol>
<li>XPath</li>
<li>Some typing definition mechanism</li>
<li>Some function definition mechanism</li>
</ol>
<p>The idea is also to better integrate this with all Validation technologies (XSD, Relax NG, NVDL, JSONSchema, etc.) and allow EXPath, EXQuery and other to have a standard way to use all this around</p>
<p>We also want people that want to use only XPath (for example in LinQ or inside SQL) to have a broader capacity to interact with XML (instead of being limited to XPath 1.0 with namespaces)</p>
<p>I will try to add more and more precision to this proposal along the line, but I feel it is good enough to be a first stone to break and allow people to help drive this initiative</p>
<p>For the moment the name of this new beast is <strong>XPathWithCustomizableTypesAndFunctions</strong> in our proposal call XPath Next https://github.com/XPath-Next/XPath-Next/blob/first-draft/spec.md</p>
</div></details></div>
<div class="toot" id="minutes-04-04"><h2>QT4 CG meeting 029 draft minutes<span class="toot-id"> #minutes-04-04</span></h2><div class="pubdate">04 Apr at 17:30:00 GMT</div><div class="link">Link: <a href="https://qt4cg.org/meeting/minutes/2023/04-04">https://qt4cg.org/meeting/minutes/2023/04-04</a></div><p>Draft minutes published.</p></div>
<div class="toot" id="created-424"><h2>Pull request #424 created<span class="toot-id"> #created-424</span></h2><div class="pubdate">04 Apr at 17:12:08 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/424">https://github.com/qt4cg/qtspecs/pull/424</a></div><details><summary>Allow fn:resolve-uri to resolve against a base URI that includes a fragment identifier</summary><div class="markup"><p>Fix #280</p>
</div></details></div>
<div class="toot" id="created-423"><h2>Issue #423 created<span class="toot-id"> #created-423</span></h2><div class="pubdate">04 Apr at 14:24:37 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/423">https://github.com/qt4cg/qtspecs/issues/423</a></div><details><summary>[XSLT 4.0] 2.2 Notation is incomplete</summary><div class="markup"><p>"language" and "prefixes" are used in the definition of element but not defined here</p>
<p>On the other hand,  "nmtokens" is defined but not used</p>
</div></details></div>
<div class="toot" id="closed-22"><h2>Issue #22 closed<span class="toot-id"> #closed-22</span></h2><div class="pubdate">04 Apr at 11:32:31 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/22">https://github.com/qt4cg/qtspecs/issues/22</a></div><p>[XPath] Allowing multiple let clauses in LetExpr and for clauses in ForExpr</p></div>
<div class="toot" id="closed-416"><h2>Issue #416 closed<span class="toot-id"> #closed-416</span></h2><div class="pubdate">04 Apr at 10:23:13 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/416">https://github.com/qt4cg/qtspecs/pull/416</a></div><p>NCName is usually lowercase in attribute  type for the rest of the spec</p></div>
<div class="toot" id="closed-422"><h2>Issue #422 closed<span class="toot-id"> #closed-422</span></h2><div class="pubdate">04 Apr at 10:22:50 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/422">https://github.com/qt4cg/qtspecs/pull/422</a></div><p>Fix syntax in examples</p></div>
<div class="toot" id="created-422"><h2>Pull request #422 created<span class="toot-id"> #created-422</span></h2><div class="pubdate">04 Apr at 09:58:49 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/422">https://github.com/qt4cg/qtspecs/pull/422</a></div><details><summary>Fix syntax in examples</summary><div class="markup"><p>attribute namespace-uri corrected to namespace
xsl:sequence-of corrected to xsl:sequence</p>
</div></details></div>
<div class="toot" id="closed-419"><h2>Issue #419 closed<span class="toot-id"> #closed-419</span></h2><div class="pubdate">04 Apr at 09:37:12 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/419">https://github.com/qt4cg/qtspecs/pull/419</a></div><p>fix few syntax issues in the XSLT 4.0 examples </p></div>
<div class="toot" id="created-421"><h2>Issue #421 created<span class="toot-id"> #created-421</span></h2><div class="pubdate">04 Apr at 09:36:07 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/421">https://github.com/qt4cg/qtspecs/issues/421</a></div><details><summary>Make sure the build system syntax checks the syntax of examples</summary><div class="markup"><p>Apparently the code is lying around somewhere...</p>
</div></details></div>
<div class="toot" id="created-420"><h2>Pull request #420 created<span class="toot-id"> #created-420</span></h2><div class="pubdate">04 Apr at 09:26:51 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/420">https://github.com/qt4cg/qtspecs/pull/420</a></div><details><summary>Issue 357 Map composition and decomposition</summary><div class="markup"><p>This PR addresses the issues concerned with map composition and decomposition in issue #357. It adds a function to decompose a map into key-value pairs (map:key-value-pairs), and its inverse (map:of). It adds explanatory material to F+O to explain how these functions relate to each other, and it adds examples to the XSLT spec to show how the interwork with the xsl:array, xsl:map, and xsl:for-each instructions. Note: the map functions have been sorted alphabetically, so the changes will appear more extensive than they are.</p>
</div></details></div>
<div class="toot" id="created-419"><h2>Pull request #419 created<span class="toot-id"> #created-419</span></h2><div class="pubdate">04 Apr at 08:29:09 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/419">https://github.com/qt4cg/qtspecs/pull/419</a></div><p>fix few syntax issues in the XSLT 4.0 examples </p></div>
<div class="toot" id="created-418"><h2>Issue #418 created<span class="toot-id"> #created-418</span></h2><div class="pubdate">04 Apr at 08:22:46 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/418">https://github.com/qt4cg/qtspecs/issues/418</a></div><details><summary>array and map attribute in xsl:iterate and xsl:for-each-group</summary><div class="markup"><p>It seems there is still some places where we can still spot some remnant peices of attribute array and attribute map in the spec</p>
<p>You can find this sentence at two places</p>
<blockquote>
<p>, or constructed from the expressions in the array or map attributes.</p>
</blockquote>
<p>Also there is some examples</p>
<ul>
<li>Example: Grouping entries in a Map</li>
<li>Example: Processing an array using xsl:iterate</li>
</ul>
</div></details></div>
<div class="toot" id="created-417"><h2>Pull request #417 created<span class="toot-id"> #created-417</span></h2><div class="pubdate">03 Apr at 21:56:17 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/417">https://github.com/qt4cg/qtspecs/pull/417</a></div><details><summary>Fix residual reference to op:A2S which is no longer defined</summary><div class="markup"><p>The changes made to redefine array functions in terms of <code>array:members</code> and <code>array:of</code> rather than <code>op:A2S</code> and <code>op:S2A</code> weren't applied to array:get because that was the subject of a separate PR to add the <code>fallback</code> option. This PR corrects the omission.</p>
</div></details></div>
<div class="toot" id="closed-403"><h2>Issue #403 closed<span class="toot-id"> #closed-403</span></h2><div class="pubdate">03 Apr at 21:25:17 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/403">https://github.com/qt4cg/qtspecs/pull/403</a></div><p>Michaelhkay actions 2023 02 01</p></div>
<div class="toot" id="created-416"><h2>Pull request #416 created<span class="toot-id"> #created-416</span></h2><div class="pubdate">03 Apr at 17:48:42 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/416">https://github.com/qt4cg/qtspecs/pull/416</a></div><p>NCName is usually lowercase in attribute  type for the rest of the spec</p></div>
<div class="toot" id="created-415"><h2>Pull request #415 created<span class="toot-id"> #created-415</span></h2><div class="pubdate">03 Apr at 16:39:42 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/415">https://github.com/qt4cg/qtspecs/pull/415</a></div><details><summary>Revise parse/build URI functions for UNC names</summary><div class="markup"><p>Fix #398
Fix #390</p>
<p>This PR attempts to address the questions raised in issues 389 and 390:</p>
<ol>
<li>It adds a <code>unc-path</code> option that is used to guide the parsing and construction of URIs that represent Windows UNC paths</li>
<li>It adds a <code>filepath</code> property to the result of <code>parse-uri</code>. This property represents the local path part of the URI. For file: URIs, this is the local path.</li>
<li>It addresses the use of "<code>|</code>" in URIs to represent the ":" in Windows filenames</li>
<li>It clarifies that percent-decoding a path also involves intepreting the result as a UTF-8 sequence</li>
<li>It clarifies that percend-decoding and encoding apply to the query parts of a URI as well.</li>
</ol>
</div></details></div>
<div class="toot" id="closed-300"><h2>Issue #300 closed<span class="toot-id"> #closed-300</span></h2><div class="pubdate">02 Apr at 12:58:37 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/300">https://github.com/qt4cg/qtspecs/issues/300</a></div><p>[F+O] Ambiguity regarding Unicode normalization (editorial)</p></div>
<div class="toot" id="agenda-04-04"><h2>QT4 CG meeting 029 draft agenda<span class="toot-id"> #agenda-04-04</span></h2><div class="pubdate">31 Mar at 16:35:00 GMT</div><div class="link">Link: <a href="https://qt4cg.org/meeting/agenda/2023/04-04">https://qt4cg.org/meeting/agenda/2023/04-04</a></div><p>Draft agenda published.</p></div>
<div class="toot" id="created-414"><h2>Issue #414 created<span class="toot-id"> #created-414</span></h2><div class="pubdate">31 Mar at 08:04:08 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/414">https://github.com/qt4cg/qtspecs/issues/414</a></div><details><summary>Lift character set restriction of xs:string</summary><div class="markup"><p>Adopted from https://github.com/qt4cg/qtspecs/issues/413#issuecomment-1491469514</p>
<blockquote>
<p>I guess that raises the question of whether it is still appropriate to restrict the character set of xs:string to that of XML 1.0. Are there any benefits in doing so?</p>
</blockquote>
<p>I believe that would simplify things a lot, in particular when working with input/output functions.</p>
</div></details></div>
<div class="toot" id="minutes-03-28"><h2>QT4 CG meeting 028 draft minutes<span class="toot-id"> #minutes-03-28</span></h2><div class="pubdate">30 Mar at 16:50:00 GMT</div><div class="link">Link: <a href="https://qt4cg.org/meeting/minutes/2023/03-28">https://qt4cg.org/meeting/minutes/2023/03-28</a></div><p>Draft minutes published.</p></div>
<div class="toot" id="closed-404"><h2>Issue #404 closed<span class="toot-id"> #closed-404</span></h2><div class="pubdate">30 Mar at 15:52:47 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/404">https://github.com/qt4cg/qtspecs/pull/404</a></div><p>Rework changes from action-qt4cg-019-01 to resolve persistent conflicts.</p></div>
<div class="toot" id="closed-398"><h2>Issue #398 closed<span class="toot-id"> #closed-398</span></h2><div class="pubdate">30 Mar at 15:52:19 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/398">https://github.com/qt4cg/qtspecs/issues/398</a></div><p>User-defined functions clashing with constructor functions</p></div>
<div class="toot" id="closed-406"><h2>Issue #406 closed<span class="toot-id"> #closed-406</span></h2><div class="pubdate">30 Mar at 15:51:58 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/406">https://github.com/qt4cg/qtspecs/pull/406</a></div><p>Revise xsl:array instruction and examples</p></div>
<div class="toot" id="closed-408"><h2>Issue #408 closed<span class="toot-id"> #closed-408</span></h2><div class="pubdate">30 Mar at 15:51:37 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/408">https://github.com/qt4cg/qtspecs/pull/408</a></div><p>Fix issue #398 (clash with constructor functions)</p></div>
<div class="toot" id="created-413"><h2>Issue #413 created<span class="toot-id"> #created-413</span></h2><div class="pubdate">30 Mar at 14:08:28 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/413">https://github.com/qt4cg/qtspecs/issues/413</a></div><details><summary>New function: parse-csv()</summary><div class="markup"><p>I propose a new function parse-csv() that accepts a CSV string (such as might be read from a CSV file using unparsed-text()). CSV is as defined in RFC 4180; implementations may be liberal in what they accept, and may define additional options.</p>
<p>An options parameter includes the option header=true|false to indicate whether the first line should be taken as containing column headings.</p>
<p>The result of the function is a sequence of maps, one map per row of the CSV file (excluding the header). Each map contains one entry per column, the key being taken from the column header if present, or an integer 1...n if not.</p>
</div></details></div>
<div class="toot" id="created-412"><h2>Pull request #412 created<span class="toot-id"> #created-412</span></h2><div class="pubdate">28 Mar at 22:12:29 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/412">https://github.com/qt4cg/qtspecs/pull/412</a></div><details><summary>409, QT4CG-027-01: xsl:next-match</summary><div class="markup"><p>Clarifies the rules for xsl:next-match, especially for 4.0 type patterns, but also clarifying the exposition of rules unchanged since 3.0 or 2.0 (see issue 409)</p>
</div></details></div>
<div class="toot" id="created-411"><h2>Pull request #411 created<span class="toot-id"> #created-411</span></h2><div class="pubdate">28 Mar at 11:51:25 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/411">https://github.com/qt4cg/qtspecs/pull/411</a></div><details><summary>Remove the note from the parse-html unparsed-entity sections.</summary><div class="markup"><p>This applies the review action:</p>
<blockquote>
<p>RD to remove the note in 15.5.15 of functions and operators.</p>
</blockquote>
</div></details></div>
<div class="toot" id="agenda-03-28"><h2>QT4 CG meeting 028 draft agenda<span class="toot-id"> #agenda-03-28</span></h2><div class="pubdate">27 Mar at 13:00:00 GMT</div><div class="link">Link: <a href="https://qt4cg.org/meeting/agenda/2023/03-28">https://qt4cg.org/meeting/agenda/2023/03-28</a></div><p>Draft agenda published.</p></div>
<div class="toot" id="created-410"><h2>Issue #410 created<span class="toot-id"> #created-410</span></h2><div class="pubdate">27 Mar at 10:37:57 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/410">https://github.com/qt4cg/qtspecs/issues/410</a></div><details><summary>Converting doubles to decimals, fractional digits</summary><div class="markup"><p>Adopted from a previous discussion on Slack: The result of the following computation…</p>
<pre><code class="language-xquery">&lt;x&gt;2&lt;/x&gt; + .1
</code></pre>
<p>…is serialized as <code>2.1</code>. If the result is cast to a decimal via <code>xs:decimal(&lt;x&gt;2&lt;/x&gt; + .1)</code>, <code>2.100000000000000088817841970012523233890533447265625</code> is returned, which feels counterintuitive.</p>
<p>Can we possibly change the conversion rules without compromising backward-compatibility?</p>
</div></details></div>
<div class="toot" id="created-409"><h2>Issue #409 created<span class="toot-id"> #created-409</span></h2><div class="pubdate">26 Mar at 11:13:36 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/409">https://github.com/qt4cg/qtspecs/issues/409</a></div><details><summary>XSLT: xsl:next-match and xsl:apply-imports interaction with on-multiple-match</summary><div class="markup"><p>(This is an oversight in the XSLT 3.0 specification.)</p>
<p>It is possible for <code>xsl:next-match</code> or <code>xsl:apply-imports</code> to encounter a conflict - two template rules with the same precedence and priority. In this situation it should do exactly what <code>xsl:apply-templates</code> does when it encounters a conflict, for example it should follow the rules of <code>xsl:mode/@on-multiple-match</code>.</p>
<p>This is all fairly obvious, but it should be stated explicitly (and tested). The spec is written as if conflicts can only occur when finding the first matching rule, and not when finding next-match rules.</p>
</div></details></div>
<div class="toot" id="closed-392"><h2>Issue #392 closed<span class="toot-id"> #closed-392</span></h2><div class="pubdate">24 Mar at 11:00:07 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/392">https://github.com/qt4cg/qtspecs/issues/392</a></div><p>Partial function application: Placeholders with keywords</p></div>
<div class="toot" id="created-408"><h2>Pull request #408 created<span class="toot-id"> #created-408</span></h2><div class="pubdate">24 Mar at 10:29:55 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/408">https://github.com/qt4cg/qtspecs/pull/408</a></div><details><summary>Fix issue #398 (clash with constructor functions)</summary><div class="markup"><p>Add clarification to XSLT and XQuery specs to say that a used-defined function must not clash with a constructor function for an imported atomic type.</p>
</div></details></div>
<div class="toot" id="created-407"><h2>Issue #407 created<span class="toot-id"> #created-407</span></h2><div class="pubdate">23 Mar at 11:39:34 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/407">https://github.com/qt4cg/qtspecs/issues/407</a></div><details><summary>XSLT-specific context properties used in function items</summary><div class="markup"><p>I just stumbled across the fact that current-group#0 doesn't work: see the note in 14.2.1 that says:</p>
<blockquote>
<p>Like other XSLT extensions to the dynamic evaluation context, the [current group] is not retained as part of the closure of a function value. This means that the expression current-group#0 is valid and returns a function value, but any invocation of this function will fail with a dynamic error [see [ERR XTDE1061].</p>
</blockquote>
<p>This restriction is unnecessary and we should remove it. As people become more accustomed to using function items, they don't want to hit restrictions like this, and there's really no good implementation reason for it.</p>
</div></details></div>
<div class="toot" id="created-406"><h2>Pull request #406 created<span class="toot-id"> #created-406</span></h2><div class="pubdate">22 Mar at 18:03:20 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/406">https://github.com/qt4cg/qtspecs/pull/406</a></div><details><summary>Revise xsl:array instruction and examples</summary><div class="markup"><p>This PR revises the design of the xsl:array instruction to align it with the recently agreed specs for the functions <code>array:members</code> and <code>array:of</code>. The <code>composite</code> attribute and the <code>xsl:array-member</code> instruction are dropped; instead the instruction takes a <code>use</code> attribute which is an expression used to compute each array member value from the corresponding item in the value of the select expression or sequence constructor.</p>
</div></details></div>
<div class="toot" id="closed-360"><h2>Issue #360 closed<span class="toot-id"> #closed-360</span></h2><div class="pubdate">21 Mar at 18:12:12 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/360">https://github.com/qt4cg/qtspecs/pull/360</a></div><p>Issue 314 array composition and decomposition</p></div>
<div class="toot" id="closed-405"><h2>Issue #405 closed<span class="toot-id"> #closed-405</span></h2><div class="pubdate">21 Mar at 18:12:11 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/405">https://github.com/qt4cg/qtspecs/pull/405</a></div><p>MK PR #360 with merge conflicts resolved (array compositionand decomposition)</p></div>
<div class="toot" id="created-405"><h2>Pull request #405 created<span class="toot-id"> #created-405</span></h2><div class="pubdate">21 Mar at 18:01:30 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/405">https://github.com/qt4cg/qtspecs/pull/405</a></div><details><summary>MK PR #360 with merge conflicts resolved (array compositionand decomposition)</summary><div class="markup"><p>Close #360</p>
<p>This PR is the same as 360 but fixes merge conflicts.</p>
<p>Accepted at <a href="https://qt4cg.org/meeting/minutes/2023/03-21.html#pr-360">meeting 027</a></p>
<p>Close https://github.com/qt4cg/qtspecs/issues/314</p>
</div></details></div>
<div class="toot" id="closed-400"><h2>Issue #400 closed<span class="toot-id"> #closed-400</span></h2><div class="pubdate">21 Mar at 17:19:13 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/400">https://github.com/qt4cg/qtspecs/issues/400</a></div><p>Priorities for type-based patterns</p></div>
<div class="toot" id="closed-401"><h2>Issue #401 closed<span class="toot-id"> #closed-401</span></h2><div class="pubdate">21 Mar at 17:18:48 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/401">https://github.com/qt4cg/qtspecs/pull/401</a></div><p>Issue 400: ranking of type patterns</p></div>
<div class="toot" id="closed-395"><h2>Issue #395 closed<span class="toot-id"> #closed-395</span></h2><div class="pubdate">21 Mar at 17:17:23 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/395">https://github.com/qt4cg/qtspecs/pull/395</a></div><p>Make the (non-)hierarchical nature of URIs explicit</p></div>
<div class="toot" id="closed-394"><h2>Issue #394 closed<span class="toot-id"> #closed-394</span></h2><div class="pubdate">21 Mar at 17:17:05 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/394">https://github.com/qt4cg/qtspecs/pull/394</a></div><p>Minor correction to fn:parse-uri</p></div>
<div class="toot" id="closed-393"><h2>Issue #393 closed<span class="toot-id"> #closed-393</span></h2><div class="pubdate">21 Mar at 17:16:47 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/393">https://github.com/qt4cg/qtspecs/pull/393</a></div><p>Clarify explanations of functions/function items</p></div>
<div class="toot" id="closed-391"><h2>Issue #391 closed<span class="toot-id"> #closed-391</span></h2><div class="pubdate">21 Mar at 17:16:14 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/391">https://github.com/qt4cg/qtspecs/pull/391</a></div><p>addressed typographical errors; adjusted Unicode character discussion…</p></div>
<div class="toot" id="agenda-03-21"><h2>QT4 CG meeting 027 draft agenda<span class="toot-id"> #agenda-03-21</span></h2><div class="pubdate">21 Mar at 10:30:00 GMT</div><div class="link">Link: <a href="https://qt4cg.org/meeting/agenda/2023/03-21">https://qt4cg.org/meeting/agenda/2023/03-21</a></div><p>Draft agenda published.</p></div>
<div class="toot" id="closed-336"><h2>Issue #336 closed<span class="toot-id"> #closed-336</span></h2><div class="pubdate">20 Mar at 16:00:45 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/336">https://github.com/qt4cg/qtspecs/pull/336</a></div><p>Action QT4CG-019-01 (type of $pattern in fn:tokenize())</p></div>
<div class="toot" id="created-404"><h2>Pull request #404 created<span class="toot-id"> #created-404</span></h2><div class="pubdate">20 Mar at 15:59:39 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/404">https://github.com/qt4cg/qtspecs/pull/404</a></div><details><summary>Rework changes from action-qt4cg-019-01 to resolve persistent conflicts.</summary><div class="markup"><p>I reworked these (purely editorial) changes based on the current master to try and resolve the conflicts once and for all.</p>
</div></details></div>
<div class="toot" id="created-403"><h2>Pull request #403 created<span class="toot-id"> #created-403</span></h2><div class="pubdate">20 Mar at 15:26:46 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/403">https://github.com/qt4cg/qtspecs/pull/403</a></div><p>Michaelhkay actions 2023 02 01</p></div>
<div class="toot" id="created-402"><h2>Issue #402 created<span class="toot-id"> #created-402</span></h2><div class="pubdate">20 Mar at 00:31:10 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/402">https://github.com/qt4cg/qtspecs/issues/402</a></div><details><summary>XSLT patterns: intersect and except</summary><div class="markup"><p>I would like to propose making an incompatible change to the semantics of XSLT patterns using the "except" and "intersect" operators, so that they have their intuitive meaning.</p>
<p>Consider the pattern <code>p except appendix//p</code>. Anyone writing this probably imagines that this will match any <code>p</code> element that does not have an <code>appendix</code> as an ancestor. The intuitive meaning of <code>A except B</code> is to match anything that matches<code>A</code> unless it also matches <code>B</code>.</p>
<p>The actual meaning in the XSLT 3.1 specification is that it matches any node <code>$N</code> that has an ancestor <code>$A</code> such that the result of the XPath expression <code>$A//(p except appendix//p)</code> includes <code>$N</code>.</p>
<p>Consider the XML</p>
<pre><code>&lt;appendix&gt;
  &lt;div&gt;
     &lt;p&gt;...&lt;/p&gt;
  &lt;/div&gt;
&lt;/appendix&gt;
</code></pre>
<p>The <code>&lt;p&gt;</code> element here has an ancestor (the <code>&lt;div&gt;</code> element) where the result of <code>$A//(p except appendix//p)</code> includes the <code>&lt;p&gt;</code> element. So despite having an ancestor <code>appendix</code> this element matches the pattern <code>p except appendix//p</code>. This is not only a counter-intuitive result, it also makes such patterns useless in practice.</p>
<p>Patterns using <code>intersect</code> suffer the same problem, though it is much harder to construct a plausible example.</p>
<p>Patterns that only use the child or attribute axis, for example <code>@* except @code</code>, or <code>* except note</code>, don't suffer from this problem and will retain the same meaning as in 3.1.</p>
<p>The required effect can be achieved by writing <code>p except p[ancestor::appendix]</code>. Because the pattern <code>p[ancestor::appendix]</code> is equivalent to <code>appendix//p</code>, people are very likely to imagine that <code>p except p[ancestor::appendix]</code> is equivalent to <code>p except appendix//p</code>.</p>
<p>Making any incompatible change to the language semantics should be done only with a very strong justification, but I believe that it is justified in this instance. The existing semantics are not only counter-intuitive, they are also sufficiently useless that it is extremely unlikely anyone has existing working code, other than artificial test cases, that relies on the current semantics.</p>
</div></details></div>
<div class="toot" id="closed-387"><h2>Issue #387 closed<span class="toot-id"> #closed-387</span></h2><div class="pubdate">19 Mar at 11:10:26 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/387">https://github.com/qt4cg/qtspecs/pull/387</a></div><p>Add compatibility notes for fn:namespace-uri-for-prefix</p></div>
<div class="toot" id="closed-385"><h2>Issue #385 closed<span class="toot-id"> #closed-385</span></h2><div class="pubdate">19 Mar at 11:09:25 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/385">https://github.com/qt4cg/qtspecs/pull/385</a></div><p>Actions QT4CG-025-07 / -08</p></div>
<div class="toot" id="closed-378"><h2>Issue #378 closed<span class="toot-id"> #closed-378</span></h2><div class="pubdate">19 Mar at 11:06:41 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/378">https://github.com/qt4cg/qtspecs/pull/378</a></div><p>Update the localName and unparsed entity reference notes for parse-html</p></div>
<div class="toot" id="created-401"><h2>Pull request #401 created<span class="toot-id"> #created-401</span></h2><div class="pubdate">15 Mar at 22:02:24 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/401">https://github.com/qt4cg/qtspecs/pull/401</a></div><details><summary>Issue 400: ranking of type patterns</summary><div class="markup"><p>Proposes how to handle type-based match patterns (record tests, in particular) in the absence of explicit priorities, basing the decision on the type hierarchy. Note: user-defined priorities are always considered before any inferred selectivity rules. Also fixes some grammar problems with type patterns. See Issue #400.</p>
</div></details></div>
<div class="toot" id="created-400"><h2>Issue #400 created<span class="toot-id"> #created-400</span></h2><div class="pubdate">15 Mar at 08:13:04 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/400">https://github.com/qt4cg/qtspecs/issues/400</a></div><details><summary>Priorities for type-based patterns</summary><div class="markup"><p>XSLT §6.6 currently has a big TODO:</p>
<p>TODO: define default priorities for type patterns, as suggested in https://www.saxonica.com/papers/xmlprague-2020mhk.pdf section 6.5.1</p>
<p>We need to plug this gap. [Note: it's worth reading that cited section as it points out some of the difficulties].</p>
<p>I'm going to suggest an alternative approach. Rather than allocating a numeric priority to patterns such as <code>record(lat, long)</code>, we allocate them a relative priority -- called their <code>selectivity</code> -- based on the subtype relationship among types. This is a partial ordering. So we extend the rule that currently orders patterns by (1) import precedence, (2) priority, (3) declaration order, to become instead (1) import precedence, (2) selectivity, (3) priority, (4) declaration order.</p>
<p>Type-based patterns (such as <code>type(xs:integer)</code>, <code>record(lat, long)</code>) are defined to have higher selectivity than any non-type-based pattern; all the latter (that is, all XSLT 3.1 patterns) are defined to have equal selectivity, which means the rules for discriminating among 3.1 patterns are unchanged.</p>
<p>For type-based patterns, we define that a pattern based on type T has higher selectivity than a pattern based on type U if T is a subtype of U. If neither is a subtype of the other, then they have equal selectivity.</p>
<p>The type pattern <code>type(T)</code> followed by one or more predicates is deemed to have higher selectivity than type(T) with no predicates, but apart from this, the predicates are ignored. Explicit numeric priorities can be used to define an ordering among type patterns that have the same selectivity.</p>
</div></details></div>
<div class="toot" id="created-399"><h2>Issue #399 created<span class="toot-id"> #created-399</span></h2><div class="pubdate">15 Mar at 03:31:46 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/399">https://github.com/qt4cg/qtspecs/issues/399</a></div><details><summary>fn:deep-equal: Using Multilevel Hierarchy and Abstraction when designing and specifying complex functions</summary><div class="markup"><p>Whenever a function is too-complex, its precise and clear specification becomes problematic and the complexity results in huge volume of text that is difficult to fathom, understand and the correctness of whose meaning becomes less and less obvious.</p>
<p>Solving this problem would benefit all groups of readers, be they future implementors or just curious XPath enthusiasts.</p>
<p>Here I present one well-known and successfully tried in practice solution, which the Romans summarized in the phrase: "<strong><em>Divide et Impera</em></strong>" ("Divide and conquer")</p>
<img src="https://upload.wikimedia.org/wikipedia/commons/thumb/a/a5/Philip-ii-of-macedon.jpg/330px-Philip-ii-of-macedon.jpg">
<p>Below is one possible splitting of the functionality of <strong><a href="https://qt4cg.org/pr/395/xpath-functions-40/autodiff.html#func-deep-equal">fn:deep-equal</a></strong> into different smaller and simpler functions on 5 levels, each level possibly dispatching to a function on  another level. The intermediate-level functions each have their own value and could be used independently of <strong>fn:deep-equal</strong> and of each other. Even though there is the possibility of recursion, we can still get a simple picture and immediate understanding of this functionality, just playing with the following collapsible/expandable representation (click on the corresponding arrow), which fits on a single screen:</p>
<h2>(writing the full specification from this animated picture is left as an exercise for the reader 😂</h2>
<details>
    <summary>deep-equal-sequence</summary>
	  <blockquote>
          <details>
				 <summary>deep-equal-item</summary>
					  <blockquote>
	  					  <p>deep-equal-atomic</p>
						  <details>
								<summary>deep-equal-map</summary>
								  <blockquote>
										  <p>deep-equal-atomic</p>
										  <p>deep-equal-sequence</p>
								  </blockquote>
						  </details>
						  <details>
							  <summary>deep-equal-array</summary>
								  <blockquote>
										  <p>deep-equal-sequence</p>
								  </blockquote>
						  </details>
						  <details>
							  <summary>deep-equal-node</summary>
								  <blockquote>
										  <p>deep-equal-document</p>
										  <details>										  
											  <summary>deep-equal-element</summary>
												  <blockquote>
													  <p>deep-equal-attribute</p>
													  <p>deep-equal-NS</p>
													  <p>deep-equal-PI</p>
													  <p>deep-equal-comment</p>
													  <p>deep-equal-text-node</p>
												  </blockquote>
										  </details>										  
										  <p>deep-equal-attribute</p>
										  <p>deep-equal-NS</p>
										  <p>deep-equal-PI</p>
										  <p>deep-equal-comment</p>
										  <p>deep-equal-text-node</p>
								  </blockquote>
						  </details>
					  </blockquote>
		  </details>
	  </blockquote>
  </details>
</div></details></div>
<div class="toot" id="created-398"><h2>Issue #398 created<span class="toot-id"> #created-398</span></h2><div class="pubdate">14 Mar at 23:39:13 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/398">https://github.com/qt4cg/qtspecs/issues/398</a></div><details><summary>User-defined functions clashing with constructor functions</summary><div class="markup"><p>There is no explicit rule in either XQuery or XSLT that a user-defined function must not clash (in name and arity) with a constructor function for an imported atomic type. It's implicit in the rule that you can't have two conflicting functions in the static context, but it would be helpful to say so explicitly and define an error code.</p>
<p>I have added tests to the XSLT3 and XQuery3 test suites.</p>
<p>See also Saxon bug 5921 - https://saxonica.plan.io/issues/5921</p>
</div></details></div>
<div class="toot" id="created-397"><h2>Issue #397 created<span class="toot-id"> #created-397</span></h2><div class="pubdate">14 Mar at 21:46:13 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/397">https://github.com/qt4cg/qtspecs/issues/397</a></div><details><summary>Type names</summary><div class="markup"><p>The draft specifications propose the introduction of item type declarations that can associate a name with an item type. The feature probably still needs some work, which this issue aims to explore.</p>
<p>The main purpose of introducing named item types is that the ItemType for a record structure or a function signature can become quite complex and lengthy, and you don't want to have to repeat them every time they are used because it means you have to make the same change everywhere when a change occurs. Another motivation is to allow type definitions (for example, of records or functions) to be recursive.</p>
<p>I considered allowing named sequence types rather than just item types, but the rules for where you can and can't have an occurrence indicator get complicated, so I pulled back from that.</p>
<p>It seems natural to say:</p>
<ul>
<li>Item type names are QNames</li>
<li>In XPath, type names (and their mapping to item types) appear in the static context</li>
<li>In XQuery, type names follow the conventions for global variables and function declarations. That suggests they can appear either in the main module or a library module; in a library module they must be in the namespace of the module; they can be annotated as %public or %private; an <code>import module</code> declaration makes the name visible in the importing module.</li>
<li>In XSLT, a name declared in a module is automatically available throughout the stylesheet package, and can be exposed to other packages using the same visibility mechanisms as other stylesheet components. However, I don't think it makes sense to allow a type name to be overridden, either using import precedence or using xsl:override.</li>
</ul>
<p>The question then arises, should item type names be in the same "symbol space" as named atomic and union types? There seem to be several options here:</p>
<p>(a) Item type names are in a different symbol space from atomic types; the are no rules barring the same name being used for a named item type and an atomic type, and they are disambiguated by requiring item type names to be distinguished using some kind of marker syntax such as <code>type(name)</code>, rather than just a bare name.
(b) Item type names are in the same symbol space as atomic types, which means there must be a rule that an item type name must not be the same as an atomic type name that is visible in the same place. We could try and define this rule for individual names, or at the level of namespaces (if there are any atomic/union types in a particular namespace in the static context of any module, then there must be no declared type names in that namespace in that module, either declared in that module or imported from another module).
(c) Atomic type names "shadow" item type names, or vice versa: if the same name is used for both, then one of them takes precedence. Probably not a good idea.</p>
<p>I'm inclined to go for (b). Note that a simple rule that item type names can't be in a reserved namespace will prevent conflict for all non-schema-aware applications, since those applications only access atomic types in the <code>xs</code> namespace.</p>
<p>Now, what about circular definitions?</p>
<p>There are legitimate circular definitions, like <code>declare item type LIST = record(payload as item()*, next? as LIST)</code>, and there are "impossible" definitions, like <code>declare item type THING = THING</code>. Do we have to define the rules needed to ban "impossible" definitions, or can we just leave it that the determination of whether something is an instance of THING is non-terminating? I think we probably need to define the rules, which will require careful thought.</p>
<p>Where can item type names be used? The simple answer is: anywhere an ItemType is allowed. But what about contexts that only allow some ItemTypes and not others? For example, (a) "cast as", (b) as arguments of a LocalUnionType, (c) as the key type in a map type. (The solution in the current draft is that the syntax allows any ItemType to be used in these contexts, and there are semantic rules to constrain what kind of item types are allowed).</p>
<p>If we allow <code>$v cast as my:X</code> where <code>my:X</code> is a declared item type name, should we also allow the constructor function  <code>my:X($v)</code>? That would presumably also mean that item type names and function names cannot overlap.</p>
<p>Should we define any "built-in" item type names? We've been defining built-in functions (such as build-uri and parse-uri) whose signatures use record type definitions. Should we define built-in names for these record definitions?</p>
<p>An editorial issue: I think it's becoming increasingly difficult to get away with overloading the word <code>ItemType</code> to mean both the abstract concept of an item type, and the specific BNF construct used to define it. Same for <code>SequenceType</code>. I think we should probably move to having a defined term "item type" and a BNF construct such as <code>ItemTypeDesignator</code> to represent the two separate meanings.</p>
</div></details></div>
<div class="toot" id="minutes-03-14"><h2>QT4 CG meeting 026 draft minutes<span class="toot-id"> #minutes-03-14</span></h2><div class="pubdate">14 Mar at 17:20:00 GMT</div><div class="link">Link: <a href="https://qt4cg.org/meeting/minutes/2023/03-14">https://qt4cg.org/meeting/minutes/2023/03-14</a></div><p>Draft minutes published.</p></div>
<div class="toot" id="created-396"><h2>Pull request #396 created<span class="toot-id"> #created-396</span></h2><div class="pubdate">13 Mar at 18:04:50 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/396">https://github.com/qt4cg/qtspecs/pull/396</a></div><details><summary>333: Deep-equal, no failure when comparing functions</summary><div class="markup"><p>Refines the spec of fn:deep-equal so it no longer fails when comparing function items, rather it returns a result which in general is implementation-dependent, though it must be false unless the functions are provably equivalent.</p>
</div></details></div>
<div class="toot" id="created-395"><h2>Pull request #395 created<span class="toot-id"> #created-395</span></h2><div class="pubdate">13 Mar at 11:50:35 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/395">https://github.com/qt4cg/qtspecs/pull/395</a></div><details><summary>Make the (non-)hierarchical nature of URIs explicit</summary><div class="markup"><p>The <code>fn:parse-uri</code> function will parse hierarchical or non-hierarchical URIs, however, the parse cannot be reversed if the <code>fn:build-uri</code> function doesn't know whether the scheme is hierarchical. Consider <code>fn:parse-uri("querty:abc")</code>:</p>
<pre><code>map {
  "path":"abc",
  "scheme":"querty",
  "path-segments":["abc"],
  "uri":"querty:abc"
}
</code></pre>
<p>When <code>fn:build-uri</code> parses that map, it produces: <code>querty://abc</code> because the scheme is not known to be non-hierarchical.</p>
<p>This PR changes <code>fn:parse-uri</code> so that it records whether or not the URI was hierarchical and <code>fn:build-uri</code> to use that information.</p>
<p>It's possible that we could finesse this by setting the <code>authority</code> to the empty string for hierarchical URIs, but it seems clearer to be explicit.</p>
<p>This PR also fixes a bug. Previously, if the <code>scheme</code> was not present when building a URI, the URI began with <code>//</code>. That's an error. If the scheme isn't present, there should be no <em>scheme separator</em>.</p>
</div></details></div>
<div class="toot" id="closed-320"><h2>Issue #320 closed<span class="toot-id"> #closed-320</span></h2><div class="pubdate">13 Mar at 11:07:57 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/320">https://github.com/qt4cg/qtspecs/pull/320</a></div><p>Issue 98 - add options parameter to fn:deep-equal</p></div>
<div class="toot" id="created-394"><h2>Pull request #394 created<span class="toot-id"> #created-394</span></h2><div class="pubdate">13 Mar at 10:08:22 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/394">https://github.com/qt4cg/qtspecs/pull/394</a></div><details><summary>Minor correction to fn:parse-uri</summary><div class="markup"><p>The <code>fn:parse-uri()</code> function recognizes "URIs" of the form <code>c:/path/to/thing</code> as implicitly being <code>file:</code> URIs. This small change adds a leading "/" to make the fact that it is a path explicit.</p>
</div></details></div>
<div class="toot" id="closed-25"><h2>Issue #25 closed<span class="toot-id"> #closed-25</span></h2><div class="pubdate">13 Mar at 09:54:10 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/25">https://github.com/qt4cg/qtspecs/issues/25</a></div><p>[XPath] `%variadic("sequence")` does not allow specifying some argument values in the variadic sequence, and in one case even not the variadic sequence itself</p></div>
<div class="toot" id="closed-26"><h2>Issue #26 closed<span class="toot-id"> #closed-26</span></h2><div class="pubdate">13 Mar at 09:52:54 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/26">https://github.com/qt4cg/qtspecs/issues/26</a></div><p>[XPath]A value in the last row (for "sequence-variadic" functions) of the table "Number of Arguments allowed in a Function Call" is incorrect</p></div>
<div class="toot" id="closed-54"><h2>Issue #54 closed<span class="toot-id"> #closed-54</span></h2><div class="pubdate">13 Mar at 09:51:12 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/54">https://github.com/qt4cg/qtspecs/issues/54</a></div><p>[XPath] [XQuery] Keyword arguments don't work with all parameters/keys in static functions.</p></div>
<div class="toot" id="closed-47"><h2>Issue #47 closed<span class="toot-id"> #closed-47</span></h2><div class="pubdate">13 Mar at 09:48:51 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/47">https://github.com/qt4cg/qtspecs/issues/47</a></div><p>[XPath] [XQuery] Allow argument placeholders on keyword arguments</p></div>
<div class="toot" id="agenda-03-14"><h2>QT4 CG meeting 026 draft agenda<span class="toot-id"> #agenda-03-14</span></h2><div class="pubdate">13 Mar at 08:45:00 GMT</div><div class="link">Link: <a href="https://qt4cg.org/meeting/agenda/2023/03-14">https://qt4cg.org/meeting/agenda/2023/03-14</a></div><p>Draft agenda published.</p></div>
<div class="toot" id="closed-386"><h2>Issue #386 closed<span class="toot-id"> #closed-386</span></h2><div class="pubdate">13 Mar at 09:26:50 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/386">https://github.com/qt4cg/qtspecs/pull/386</a></div><p>Action QT4CG-025-05 (markup typo)</p></div>
<div class="toot" id="created-393"><h2>Pull request #393 created<span class="toot-id"> #created-393</span></h2><div class="pubdate">12 Mar at 22:07:08 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/393">https://github.com/qt4cg/qtspecs/pull/393</a></div><details><summary>Clarify explanations of functions/function items</summary><div class="markup"><p>This PR is purely editorial in the sense that it does not attempt to make any changes that would affect an implementation. It's intended to clear up ambiguity and lack of clarity in the description of operations on functions, in particular the way that a function item captures static and dynamic context. It addresses issues #239 and issue #392.</p>
</div></details></div>
<div class="toot" id="created-392"><h2>Issue #392 created<span class="toot-id"> #created-392</span></h2><div class="pubdate">12 Mar at 18:56:05 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/392">https://github.com/qt4cg/qtspecs/issues/392</a></div><details><summary>Partial function application: Placeholders with keywords</summary><div class="markup"><p>It's clear that the following is allowed:</p>
<p><code>format-date(current-date(), '[Y]-[M]-[D]', place:=?, language:=?, calendar:="AD")</code></p>
<p>The resulting function item takes two arguments (place and language) but in what order? Is it the order of parameters in the original function definition, or the order in which they appear in the partial function application?</p>
<p>I think it should be the latter, but this needs to be made explicit in the spec.</p>
<p>Note that this doesn't only apply to optional parameters as in the above example, it applies equally, for example to</p>
<p><code>starts-with(substring=?, value=?)</code></p>
<p>While we're on the subject, we should also ask whether</p>
<p><code>concat(value83 := ?)</code></p>
<p>is legal, and if so, what it means.</p>
</div></details></div>
<div class="toot" id="created-391"><h2>Pull request #391 created<span class="toot-id"> #created-391</span></h2><div class="pubdate">11 Mar at 05:25:50 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/391">https://github.com/qt4cg/qtspecs/pull/391</a></div><details><summary>addressed typographical errors; adjusted Unicode character discussion…</summary><div class="markup"><p>… for internal local consistency, clarity</p>
<p>This being my first PR, I opted to include beyond the typos I noted in #289 another small block of hopefully uncontroversial edits as a test balloon.</p>
</div></details></div>
<div class="toot" id="closed-278"><h2>Issue #278 closed<span class="toot-id"> #closed-278</span></h2><div class="pubdate">10 Mar at 18:04:19 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/278">https://github.com/qt4cg/qtspecs/issues/278</a></div><p>array bound checking</p></div>
<div class="toot" id="closed-289"><h2>Issue #289 closed<span class="toot-id"> #closed-289</span></h2><div class="pubdate">10 Mar at 18:03:47 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/289">https://github.com/qt4cg/qtspecs/pull/289</a></div><p>Proposal to add fallback behaviour to map:get and array:get</p></div>
<div class="toot" id="created-390"><h2>Issue #390 created<span class="toot-id"> #created-390</span></h2><div class="pubdate">10 Mar at 17:59:35 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/390">https://github.com/qt4cg/qtspecs/issues/390</a></div><details><summary>Should parsing and building URIs attempt to special case Windows URIs for UNC names?</summary><div class="markup"><p>Depending on the platform and language APIs involved, we see <code>file:</code> URIs encoded in a variety of different ways. It doesn't help that there's no official RFC for <code>file:</code> URIs.</p>
<ul>
<li><code>file:/path/part</code> is a <code>file:</code> URI with no host and a path of <code>/path/part</code>.</li>
<li><code>file:///path.part</code> is a <code>file:</code> URI with an explicitly empty host and a path of <code>/path/part</code>.</li>
<li><code>file://path/part</code> is a <code>file:</code> URI with an authority of <code>path</code> and a path of <code>/part</code>. I think one common way to interpret this is as if it was <code>file:/part</code>. That is, in <code>file:</code> URIs, although a different host is possible, it's often just ignored.</li>
<li><code>c:\path\part</code> is most usefully interpreted as <code>file:/c:/path/part</code>, a <code>file:</code> URI with no host and a path of <code>/c:/path/part</code>. These are only going to be useful on a Windows system, so it isn't a problem to treat them the same way on all platforms. (Aside: I don't actually know if the path part should be <code>c:/path/part</code> instead, but it's currently got the leading slash in <code>fn:parse-uri()</code>.)</li>
</ul>
<p>And then there's this: <code>file:////name/path/part</code>.</p>
<p>One interpretation is, "look, we accept <code>file:/</code> and <code>file:///</code> so let's just accept <code>file://</code> and <code>file://///////</code>, etc. as the same." And I think that's generally right, with the single special exception of <code>file:////</code>. The problem is that on Windows, this is a very common way to encode the URI for a UNC path, that is: <code>\\name\path\part</code> which is a Windows UNC path for <code>\path\part</code> on a host named <code>name</code> (via whatever networking protocol backs UNC).</p>
<p>You'd think that this should be <code>file://name/path/part</code>, but I think because browsers and maybe other tools just discard the authority part of a <code>file:</code> URI (or maybe because these are <em>paths</em> in some Windows sense?), that's not how they're encoded.</p>
<blockquote>
<p>Aside: Yes, I'm sure you also see <code>file:\\\\name\path\part</code> and <code>file:c:\path\part</code> and other forms as well. Those are out of scope, they're simply, flatly, completely wrong. You can't use <code>\</code> as a delimiter in a URI. RFC 3986 is authoritative on this point. Step one of dealing with random strings we think should be URIs is replacing all <code>\</code> with <code>/</code> because RFC 3986.</p>
</blockquote>
<p>It's problematic to deal with <code>file:////</code> as a special case, but it's also problematic to leave out support for a common pattern on a widely deployed operating system.</p>
<p>Recognizing four slashes after <code>file:</code> and treating that specially isn't hard. The hard part is how do we encode this in the map that <code>fn:parse-uri</code> produces bearing in mind that the result should round-trip if you push it back through <code>fn:build-uri</code>.</p>
<p>Consider <code>file:////uncname/path/part</code></p>
<p>Today, that is parsed as:</p>
<pre><code>map {
  "uri": "file:////uncname/path/part",
  "scheme": "file",
  "authority": "uncname",
  "host": "uncname",
  "path": "/path/to/file",
  "path-segments": array { "", "path", "to", "file" }
}
</code></pre>
<p>and that doesn’t round trip. If you feed that to <code>fn:build-uri</code>, you get <code>file://uncname/path/part</code> and that absolutely doesn’t mean the same thing on a Windows machine.</p>
<p>We could encode the slashes in the <code>authority</code> in which case we also have to encode them in the <code>host</code> because in the presence of <code>host</code>, the <code>authority</code> isn’t used to by <code>fn:build-uri()</code>:</p>
<pre><code>map {
  "uri": "file:////uncname/path/part",
  "scheme": "file",
  "authority": "////uncname",
  "host": "////uncname",
  "path": "/path/to/file",
  "path-segments": array { "", "path", "to", "file" }
}
</code></pre>
<p>It kind of works, but it’s really ugly and it means we have a host value that is a complete kludge. It doesn’t match the RFC rules for hostnames at all.</p>
<p>The other option that occurs to me is to add a “unc-path” property to the map:</p>
<pre><code>map {
  "unc-path": true(),
  "uri": "file:////uncname/path/part",
  "scheme": "file",
  "authority": "uncname",
  "host": "uncname",
  "path": "/path/to/file",
  "path-segments": array { "", "path", "to", "file" }
}
</code></pre>
<p>That works but it introduces all sorts of possibilities for incoherent data, such as an <code>https:</code> URI with a <code>unc-path</code> flag set to <code>true()</code>.</p>
<p>What’s the right answer?</p>
<ol>
<li>Ignore the UNC path special case, it’s the users problem to deal with them.</li>
<li>Recognize them, encode the details in the <code>authority</code> and <code>host</code>.</li>
<li>Recognize them, use a special property like <code>unc-path</code>.</li>
<li>Recognize them, and do this other much better idea I have: ________________</li>
</ol>
</div></details></div>
<div class="toot" id="created-389"><h2>Issue #389 created<span class="toot-id"> #created-389</span></h2><div class="pubdate">09 Mar at 09:31:07 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/389">https://github.com/qt4cg/qtspecs/issues/389</a></div><details><summary>The fn:build-uri function needs to perform URI encoding for path and query segments</summary><div class="markup"><p>The <code>fn:parse-uri</code> function describes decoding, but the <code>fn:build-uri</code> function fails to encode.</p>
</div></details></div>
<div class="toot" id="closed-388"><h2>Issue #388 closed<span class="toot-id"> #closed-388</span></h2><div class="pubdate">08 Mar at 16:35:31 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/388">https://github.com/qt4cg/qtspecs/pull/388</a></div><p>Update the example background color in serialization</p></div>
<div class="toot" id="created-388"><h2>Pull request #388 created<span class="toot-id"> #created-388</span></h2><div class="pubdate">08 Mar at 16:25:12 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/388">https://github.com/qt4cg/qtspecs/pull/388</a></div><details><summary>Update the example background color in serialization</summary><div class="markup"><p>This PR completes my action to fix the dark blue background in examples in the serialization spec. I've made them the same as the examples in the XSLT spec which seem to have been satisfactory.</p>
</div></details></div>
<div class="toot" id="closed-328"><h2>Issue #328 closed<span class="toot-id"> #closed-328</span></h2><div class="pubdate">07 Mar at 21:08:45 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/328">https://github.com/qt4cg/qtspecs/issues/328</a></div><p>Switch Cases: Lift single-item restriction on operands</p></div>
<div class="toot" id="closed-28"><h2>Issue #28 closed<span class="toot-id"> #closed-28</span></h2><div class="pubdate">07 Mar at 21:05:42 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/28">https://github.com/qt4cg/qtspecs/pull/28</a></div><p>[XPath] Support multiple clauses in ForExpr and LetExpr.</p></div>
<div class="toot" id="created-387"><h2>Pull request #387 created<span class="toot-id"> #created-387</span></h2><div class="pubdate">07 Mar at 21:03:39 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/387">https://github.com/qt4cg/qtspecs/pull/387</a></div><details><summary>Add compatibility notes for fn:namespace-uri-for-prefix</summary><div class="markup"><p>Action QT4CG-024-01</p>
</div></details></div>
<div class="toot" id="created-386"><h2>Pull request #386 created<span class="toot-id"> #created-386</span></h2><div class="pubdate">07 Mar at 20:32:18 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/386">https://github.com/qt4cg/qtspecs/pull/386</a></div><p>Action QT4CG-025-05 (markup typo)</p></div>
<div class="toot" id="created-385"><h2>Pull request #385 created<span class="toot-id"> #created-385</span></h2><div class="pubdate">07 Mar at 20:15:34 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/385">https://github.com/qt4cg/qtspecs/pull/385</a></div><details><summary>Actions QT4CG-025-07 / -08</summary><div class="markup"><p>Improves termdef markup; adds error code; updates change history appendix.</p>
</div></details></div>
<div class="toot" id="closed-344"><h2>Issue #344 closed<span class="toot-id"> #closed-344</span></h2><div class="pubdate">07 Mar at 17:22:44 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/344">https://github.com/qt4cg/qtspecs/pull/344</a></div><p>Issue 22: allow "for"/"let" keyword to be repeated in XPath</p></div>
<div class="toot" id="closed-307"><h2>Issue #307 closed<span class="toot-id"> #closed-307</span></h2><div class="pubdate">07 Mar at 17:20:21 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/307">https://github.com/qt4cg/qtspecs/issues/307</a></div><p>Parsing and building URIs comments and queries</p></div>
<div class="toot" id="closed-347"><h2>Issue #347 closed<span class="toot-id"> #closed-347</span></h2><div class="pubdate">07 Mar at 17:20:19 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/347">https://github.com/qt4cg/qtspecs/pull/347</a></div><p>Attempt to clarify fn:parse-uri and fn:build-uri</p></div>
<div class="toot" id="closed-355"><h2>Issue #355 closed<span class="toot-id"> #closed-355</span></h2><div class="pubdate">07 Mar at 17:19:47 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/355">https://github.com/qt4cg/qtspecs/pull/355</a></div><p>Action QT4CG-022-02 - add to imp-def-feature appendix</p></div>
<div class="toot" id="closed-370"><h2>Issue #370 closed<span class="toot-id"> #closed-370</span></h2><div class="pubdate">07 Mar at 17:19:15 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/370">https://github.com/qt4cg/qtspecs/issues/370</a></div><p>Bump XSLT version</p></div>
<div class="toot" id="closed-345"><h2>Issue #345 closed<span class="toot-id"> #closed-345</span></h2><div class="pubdate">07 Mar at 17:18:52 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/345">https://github.com/qt4cg/qtspecs/issues/345</a></div><p>Missing rule for matching atomic values against atomic types</p></div>
<div class="toot" id="closed-363"><h2>Issue #363 closed<span class="toot-id"> #closed-363</span></h2><div class="pubdate">07 Mar at 17:18:36 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/363">https://github.com/qt4cg/qtspecs/pull/363</a></div><p>Fix issue #345 - missing rules for type matching</p></div>
<div class="toot" id="closed-364"><h2>Issue #364 closed<span class="toot-id"> #closed-364</span></h2><div class="pubdate">07 Mar at 17:18:13 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/364">https://github.com/qt4cg/qtspecs/pull/364</a></div><p>Generalize switch expressions in XQuery (issue #328)</p></div>
<div class="toot" id="closed-371"><h2>Issue #371 closed<span class="toot-id"> #closed-371</span></h2><div class="pubdate">07 Mar at 17:17:34 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/371">https://github.com/qt4cg/qtspecs/pull/371</a></div><p>Issue 370: forwards and backwards compatibility for 4.0</p></div>
<div class="toot" id="minutes-03-07"><h2>QT4 CG meeting 025 draft minutes<span class="toot-id"> #minutes-03-07</span></h2><div class="pubdate">07 Mar at 17:15:00 GMT</div><div class="link">Link: <a href="https://qt4cg.org/meeting/minutes/2023/03-07">https://qt4cg.org/meeting/minutes/2023/03-07</a></div><p>Draft minutes published.</p></div>
<div class="toot" id="closed-147"><h2>Issue #147 closed<span class="toot-id"> #closed-147</span></h2><div class="pubdate">07 Mar at 17:13:54 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/147">https://github.com/qt4cg/qtspecs/issues/147</a></div><p>Terse syntax for map entries</p></div>
<div class="toot" id="closed-60"><h2>Issue #60 closed<span class="toot-id"> #closed-60</span></h2><div class="pubdate">07 Mar at 17:13:38 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/60">https://github.com/qt4cg/qtspecs/issues/60</a></div><p>[FO] fn:namespace-uri-for-prefix no longer supports passing a prefix by string</p></div>
<div class="toot" id="closed-45"><h2>Issue #45 closed<span class="toot-id"> #closed-45</span></h2><div class="pubdate">07 Mar at 17:13:13 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/45">https://github.com/qt4cg/qtspecs/issues/45</a></div><p>Second parameter of fn:sum must be neutral element for +</p></div>
<div class="toot" id="created-384"><h2>Issue #384 created<span class="toot-id"> #created-384</span></h2><div class="pubdate">06 Mar at 16:24:20 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/384">https://github.com/qt4cg/qtspecs/issues/384</a></div><details><summary>Definition of "effective value" in XSLT</summary><div class="markup"><p>The term "effective value" is defined in XSLT with a rather narrow definition in the context of attribute value templates. The term is used throughout the spec (sometimes hyperlinked, sometimes not) in a much more general sense, for example the "effective value" of an attribute is the explicit value given to the attribute, or the value after basic normalization such as whitespace stripping, or the default value if the attribute is not present.</p>
<p>This affects the determination of the correct result for test merge-021, where it is a little ambiguous whether two <code>xsl:merge-source/@order</code> attribute have the same "effective value" given that one is defaulted.</p>
</div></details></div>
<div class="toot" id="agenda-03-07"><h2>QT4 CG meeting 025 draft agenda<span class="toot-id"> #agenda-03-07</span></h2><div class="pubdate">05 Mar at 11:15:00 GMT</div><div class="link">Link: <a href="https://qt4cg.org/meeting/agenda/2023/03-07">https://qt4cg.org/meeting/agenda/2023/03-07</a></div><p>Draft agenda published.</p></div>
<div class="toot" id="created-383"><h2>Issue #383 created<span class="toot-id"> #created-383</span></h2><div class="pubdate">28 Feb at 17:21:13 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/383">https://github.com/qt4cg/qtspecs/issues/383</a></div><details><summary>fn:deep-equal: Order of child elements (unordered-elements)</summary><div class="markup"><p>At <a href="https://qt4cg.org/meeting/minutes/2023/02-28.html">meeting 024</a> where PR https://github.com/qt4cg/qtspecs/pull/320 was accepted, there remained an open question of how best to specify that in some circumstances the comparisons should be made without regard to the order of (some) children.</p>
<p>Can the name of the option be improved?</p>
<p>Should the option support wildcard names?</p>
</div></details></div>
<div class="toot" id="created-382"><h2>Issue #382 created<span class="toot-id"> #created-382</span></h2><div class="pubdate">28 Feb at 17:19:32 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/382">https://github.com/qt4cg/qtspecs/issues/382</a></div><details><summary>Improve whitespace handling in deep-equal</summary><div class="markup"><p>At <a href="https://qt4cg.org/meeting/minutes/2023/02-28.html">meeting 024</a> where PR https://github.com/qt4cg/qtspecs/pull/320 was accepted, there remained an open question of how to deal with whitespace.</p>
<p>The current options can be seen as having somewhat overlapping domains. Can this be improved?</p>
</div></details></div>
<div class="toot" id="created-381"><h2>Issue #381 created<span class="toot-id"> #created-381</span></h2><div class="pubdate">28 Feb at 17:18:00 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/381">https://github.com/qt4cg/qtspecs/issues/381</a></div><details><summary>Deep-equal comparisons without errors</summary><div class="markup"><p>At <a href="https://qt4cg.org/meeting/minutes/2023/02-28.html">meeting 024</a> where PR #320 was accepted, there remained an open question of how to deal with errors.</p>
<p>On the one hand, in order for <code>fn:deep-equal</code> to be most easily used as a comparison function in the many contexts where a comparison function is required, it would be best if it simply returned <code>false()</code> rather than raising an error when incomparably items are encountered.</p>
<p>On the other hand, making "return false()" the default will mean that it is possible to construct items that are not equal to themselves, which will certainly violate the expectations of some users.</p>
<p>This conflict needs to be resolved somehow.</p>
</div></details></div>
<div class="toot" id="minutes-02-28"><h2>QT4 CG meeting 024 draft minutes<span class="toot-id"> #minutes-02-28</span></h2><div class="pubdate">28 Feb at 17:15:00 GMT</div><div class="link">Link: <a href="https://qt4cg.org/meeting/minutes/2023/02-28">https://qt4cg.org/meeting/minutes/2023/02-28</a></div><p>Draft minutes published.</p></div>
<div class="toot" id="closed-377"><h2>Issue #377 closed<span class="toot-id"> #closed-377</span></h2><div class="pubdate">28 Feb at 14:49:28 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/377">https://github.com/qt4cg/qtspecs/issues/377</a></div><p>Published XQuery 4.0 spec renders XML predefined entities instead of literal characters</p></div>
<div class="toot" id="closed-380"><h2>Issue #380 closed<span class="toot-id"> #closed-380</span></h2><div class="pubdate">28 Feb at 14:49:27 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/380">https://github.com/qt4cg/qtspecs/pull/380</a></div><p>Removed CDATA sections around markup</p></div>
<div class="toot" id="created-380"><h2>Pull request #380 created<span class="toot-id"> #created-380</span></h2><div class="pubdate">28 Feb at 14:23:20 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/380">https://github.com/qt4cg/qtspecs/pull/380</a></div><details><summary>Removed CDATA sections around markup</summary><div class="markup"><p>Fix #377</p>
<p>I took a minimal approach here. I've removed CDATA sections where the section contained an <code>&amp;</code> but not a <code>&lt;</code>.</p>
<ol>
<li>If the section contains <code>&lt;</code>, then it's  (presumably) necessary to escape the markup</li>
<li>If the section <em>does not</em> contain an <code>&amp;</code>, then it's irrelevant. But not removing it limits the number of places changed by the script</li>
</ol>
</div></details></div>
<div class="toot" id="created-379"><h2>Issue #379 created<span class="toot-id"> #created-379</span></h2><div class="pubdate">28 Feb at 12:09:11 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/379">https://github.com/qt4cg/qtspecs/issues/379</a></div><details><summary>Namespace handling in parse-html</summary><div class="markup"><p>The HTML5/"Living Standard" specification has two modes when it comes to handling namespaces:</p>
<ol>
<li>For XHTML content the document is parsed as XML with full namespace support.</li>
<li>For HTML content, it has pseudo-namespace support.</li>
</ol>
<p>For example, the HTML parsing algorithm:</p>
<ol>
<li>places html, svg, and mathml elements in their corresponding namespaces.</li>
<li>allows certain element/attribute tag names (e.g. <code>xlink:href</code>) to be parsed as QNames.</li>
</ol>
<p>From the XSLT/XQuery perspective, this affects the data model. Specifically, how to model and specify the node-names and the set of namespaces associated with a given element node.</p>
</div></details></div>
<div class="toot" id="created-378"><h2>Pull request #378 created<span class="toot-id"> #created-378</span></h2><div class="pubdate">28 Feb at 08:55:01 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/378">https://github.com/qt4cg/qtspecs/pull/378</a></div><details><summary>Update the localName and unparsed entity reference notes for parse-html</summary><div class="markup"><p>This PR applies the following changes:</p>
<ul>
<li>[x] QT4CG-021-03: RD to change must to will in DOM notes about lowercase</li>
<li>[x] QT4CG-021-04: RD to revise and move the note about unrecognized entities</li>
</ul>
</div></details></div>
<div class="toot" id="created-377"><h2>Issue #377 created<span class="toot-id"> #created-377</span></h2><div class="pubdate">28 Feb at 07:22:53 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/377">https://github.com/qt4cg/qtspecs/issues/377</a></div><details><summary>Published XQuery 4.0 spec renders XML predefined entities instead of literal characters</summary><div class="markup"><p>When rendered in the browser, XML examples in the <a href="https://qt4cg.org/specifications/xquery-40/xquery-40.html">XQuery 4.0 specification</a> show, for example, '<code>&amp;lt;</code>' instead of '<code>&lt;</code>':</p>
<p><img src="https://user-images.githubusercontent.com/2734234/221782371-1d119a80-72b3-4ede-b9c9-0b2b464533c0.png" alt="Screenshot 2023-02-28 at 07 21 49"></p>
</div></details></div>
<div class="toot" id="created-376"><h2>Issue #376 created<span class="toot-id"> #created-376</span></h2><div class="pubdate">27 Feb at 17:16:37 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/376">https://github.com/qt4cg/qtspecs/issues/376</a></div><details><summary>add documentation prefix attribute to xsl:stylesheet</summary><div class="markup"><p>Although the addition of xsl:note is very welcome, i had been hoping for something like the xsl:stylesheet attribute extension-element-prefixes, e.g. ignored-element-prefixes.</p>
<p>The specification would be something like,
Elements and attributes associated with an ignored element prefix are not treated as direct constructors, and are removed when the stylesheet is compiled. For such an element, this is equivalent to having an xsl:use-when attribute with value false on the element; for attributes, they are simply discarded along with their value.</p>
<p>It is not an error for a prefix to be listed both as an ignored element prefix and as an extension element prefix; the result is implementation dependent in this case, but MUST not result in neither an extension being invoked nor the element or attribute being ignored.</p>
<p>Ignored elements may appear anywhere in the input tree, and ignored attributes may appear on any element.</p>
<p>Example:</p>
<pre><code>&lt;xsl:template match="city/park" css:module="main"&gt;
  &lt;css:rule&gt;
    color: green;
    trees: tall;
  &lt;/xsl:rule&gt;
  &lt;div class="park"&gt;
    &lt;xsl:apply-templates /&gt;
  &lt;/div&gt;
&lt;/xsl:template&gt;
</code></pre>
</div></details></div>
<div class="toot" id="created-375"><h2>Pull request #375 created<span class="toot-id"> #created-375</span></h2><div class="pubdate">27 Feb at 17:03:04 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/375">https://github.com/qt4cg/qtspecs/pull/375</a></div><details><summary>256: Context for default parameter values</summary><div class="markup"><p>This is an attempt to resolve issue #256 by providing details of the static and dynamic context for evaluating default parameter values, including providing a mechanism for accessing parts of the static and dynamic context of the caller.</p>
<p>If this PR is accepted we will need to follow up with (a) similar changes to XSLT, and (b) use of the new notation in the signatures of standard functions and operators that have context-dependent default values for parameters.</p>
<p>Note that the PR also breaks up the rather unwieldy sections for Function Declarations and Variable Declarations into more manageable subsections, which has involved some re-ordering; some of the change marking may therefore be spurious.</p>
</div></details></div>
<div class="toot" id="created-374"><h2>Issue #374 created<span class="toot-id"> #created-374</span></h2><div class="pubdate">27 Feb at 10:11:31 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/374">https://github.com/qt4cg/qtspecs/issues/374</a></div><details><summary>Can't view the XSD for XSLT in the browser</summary><div class="markup"><p>If you attempt to open <code>https://qt4cg.org/specifications/xslt-40/schema-for-xslt40.xsd</code> in the browser (in Firefox), you'll get:</p>
<pre><code>Error loading stylesheet: An unknown error has occurred (805303f4)
http://www.w3.org/2008/09/xsd.xsl
</code></pre>
<p>In a Chrome-derived browser I get a blank screen on which even the context menu doesn't work. Digging about in the inspect window leads me to</p>
<pre><code>Unsafe attempt to load URL http://www.w3.org/2008/09/xsd.xsl from frame with URL
https://qt4cg.org/specifications/xslt-40/schema-for-xslt40.xsd. Domains, protocols and ports must match.
</code></pre>
<p>I conclude that the problem is trying to load the XSL for XSD from a different domain. Boo. I guess we should copy those stylesheets to <code>qt4cg.org</code>, or remove the stylesheet PI, or ignore the whole thing on the assumption that we'll eventually publish these specifications in some W3C location and the probem will go away. Maybe.</p>
</div></details></div>
<div class="toot" id="created-373"><h2>Issue #373 created<span class="toot-id"> #created-373</span></h2><div class="pubdate">27 Feb at 09:29:57 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/373">https://github.com/qt4cg/qtspecs/issues/373</a></div><details><summary>apparent copy/paste error in annotation documentation of simple type yes-or-no-or-maybe</summary><div class="markup"><p>The XSD 1.1 schema for XSLT 3 and the one for XSLT 4 (at https://qt4cg.org/specifications/xslt-40/schema-for-xslt40.xsd) has an error in the annotation/documentation section of the simple type <code>yes-or-no-or-maybe</code> as it there says <code>One of the values "yes" or "no" or "omit".</code>. I think that should be <code>One of the values "yes" or "no" or "maybe"</code>, the error probably exists as someone copied the text from the <code>yes-or-no-or-omit</code> type declaration and forgot to adapt the description.</p>
</div></details></div>
<div class="toot" id="created-372"><h2>Issue #372 created<span class="toot-id"> #created-372</span></h2><div class="pubdate">26 Feb at 23:06:13 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/372">https://github.com/qt4cg/qtspecs/issues/372</a></div><details><summary>Separate default namespace for elements from the default namespace for types</summary><div class="markup"><p>Currently the static context provides a "default namespace for elements and types". It's not at all clear why these should be the same. For types, the vast majority of QNames representing types are in the XML Schema namespace, which is never used for elements.</p>
<p>In the current 4.0 drafts the two default namespaces are separated; but this has not been reviewed or agreed by the CG. This issue is raised for discussion of the change, and I will also review the design to see whether it still make sense.</p>
<p>Some observations on the current text for XQuery:</p>
<ol>
<li>In section 2.2.1 (static context) it would be good to give a bit more detail (if only as a forwards reference) about the circumstances in which the default element namespace and the default type namespace are used.</li>
<li>In 3.4 Sequence Types the sentence "[Lexical QNames]appearing in a [sequence type] have their prefixes expanded to namespace URIs by means of the [statically known namespaces] and (where applicable) the [default element namespace] or [default type namespace]" is rather inelegantly worded. If there is a prefix, then the statically known namespaces are used; if there is none, then the relevant default namespace is used, and it would be nice to explain more clearly which one applies.</li>
<li>In 3.6 Item Types, we need to be clearer about references to named/declared item types, and about how the names are resolved. Do we really want these names to be in the same symbol space as atomic types? Perhaps we should have a rule that Item Types (like functions) must be in a namespace and this must not be the same as an imported schema namespace.</li>
<li>In 5.14, Default namespace declaration, there seems to be duplication between the two paragraphs starting "for backwards compatibility reasons"</li>
<li>Appendix C.1 (much though I dislike it) should say something about the initialisation of the default namespaces for elements and for types.</li>
</ol>
<p>Note that issue #65 talks of the need for different default namespaces for input and output elements. I think that's a separate issue.</p>
<p>Observations on the current text for XSLT:</p>
<ol>
<li>In 5.1.2.1 the paragraph "The [xsl:]xpath-default-namespace attribute must be in the [XSLT namespace] if and only if its parent element is not in the XSLT namespace needs to be generalised to [xsl:]default-element-namespace. In fact, this rule should move to the parent section 5.1.2, which needs an introduction.</li>
</ol>
</div></details></div>
<div class="toot" id="created-371"><h2>Pull request #371 created<span class="toot-id"> #created-371</span></h2><div class="pubdate">24 Feb at 16:59:12 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/371">https://github.com/qt4cg/qtspecs/pull/371</a></div><details><summary>Issue 370: forwards and backwards compatibility for 4.0</summary><div class="markup"><p>This is essentially editorial; it updates the XSLT rules for forwards and backwards compatible processing to acknowledge the fact that the current version is now 4.0.</p>
</div></details></div>
<div class="toot" id="created-370"><h2>Issue #370 created<span class="toot-id"> #created-370</span></h2><div class="pubdate">24 Feb at 16:18:07 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/370">https://github.com/qt4cg/qtspecs/issues/370</a></div><details><summary>Bump XSLT version</summary><div class="markup"><p>There are various places where the XSLT spec refers to XSLT 3.0 where it should now refer to 4.0.</p>
</div></details></div>
<div class="toot" id="agenda-02-28"><h2>QT4 CG meeting 024 draft agenda<span class="toot-id"> #agenda-02-28</span></h2><div class="pubdate">24 Feb at 08:25:00 GMT</div><div class="link">Link: <a href="https://qt4cg.org/meeting/agenda/2023/02-28">https://qt4cg.org/meeting/agenda/2023/02-28</a></div><p>Draft agenda published.</p></div>
<div class="toot" id="closed-19"><h2>Issue #19 closed<span class="toot-id"> #closed-19</span></h2><div class="pubdate">22 Feb at 21:34:21 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/19">https://github.com/qt4cg/qtspecs/issues/19</a></div><p>[xslt] annotation-prefixes</p></div>
<div class="toot" id="closed-84"><h2>Issue #84 closed<span class="toot-id"> #closed-84</span></h2><div class="pubdate">22 Feb at 21:32:36 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/84">https://github.com/qt4cg/qtspecs/issues/84</a></div><p>Proposal : allow ignorable &lt;xsl:div&gt; wrapper for documentation or organize the code</p></div>
<div class="toot" id="closed-189"><h2>Issue #189 closed<span class="toot-id"> #closed-189</span></h2><div class="pubdate">22 Feb at 21:29:24 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/189">https://github.com/qt4cg/qtspecs/issues/189</a></div><p>Adopt the coercion rules for variables in XQuery</p></div>
<div class="toot" id="closed-352"><h2>Issue #352 closed<span class="toot-id"> #closed-352</span></h2><div class="pubdate">22 Feb at 21:24:40 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/352">https://github.com/qt4cg/qtspecs/issues/352</a></div><p>The @array attribute of xsl:for-each-group is no more</p></div>
<div class="toot" id="closed-354"><h2>Issue #354 closed<span class="toot-id"> #closed-354</span></h2><div class="pubdate">22 Feb at 10:08:23 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/354">https://github.com/qt4cg/qtspecs/pull/354</a></div><p>Combine multiple signatures of XSLT functions to use defaults</p></div>
<div class="toot" id="closed-353"><h2>Issue #353 closed<span class="toot-id"> #closed-353</span></h2><div class="pubdate">22 Feb at 10:07:34 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/353">https://github.com/qt4cg/qtspecs/pull/353</a></div><p>Issue109 xsl note</p></div>
<div class="toot" id="closed-362"><h2>Issue #362 closed<span class="toot-id"> #closed-362</span></h2><div class="pubdate">22 Feb at 10:06:31 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/362">https://github.com/qt4cg/qtspecs/pull/362</a></div><p>Drop obsolete note in XSLT regarding for-each-group/@array</p></div>
<div class="toot" id="minutes-02-21"><h2>QT4 CG meeting 023 draft minutes<span class="toot-id"> #minutes-02-21</span></h2><div class="pubdate">22 Feb at 09:53:00 GMT</div><div class="link">Link: <a href="https://qt4cg.org/meeting/minutes/2023/02-21">https://qt4cg.org/meeting/minutes/2023/02-21</a></div><p>Draft minutes published.</p></div>
<div class="toot" id="created-369"><h2>Issue #369 created<span class="toot-id"> #created-369</span></h2><div class="pubdate">21 Feb at 17:44:13 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/369">https://github.com/qt4cg/qtspecs/issues/369</a></div><details><summary>Namespaces for Functions</summary><div class="markup"><p>What problem are we trying to solve? Essentially, I think "namespace clutter".</p>
<p>Namespace clutter manifests itself in several different ways.</p>
<ul>
<li>Firstly, declaration clutter in source code. Here's the start of a module in an XSLT Stylesheet of medium complexity:</li>
</ul>
<pre><code>&lt;xsl:stylesheet 
    xmlns:xsl="http://www.w3.org/1999/XSL/Transform" 
    xmlns:xs="http://www.w3.org/2001/XMLSchema" 
    exclude-result-prefixes="#all"
    version="3.0" 
    xmlns="http://ns.saxonica.com/xslt/export" 
    xmlns:doc="http://www.saxonica.com/ns/documentation"
    xmlns:map="http://www.w3.org/2005/xpath-functions/map" 
    xmlns:ex="http://ns.saxonica.com/xslt/export" 
    xmlns:f="MyFunctions" 
    xmlns:t="MyTypes"
    expand-text="true"&gt;
</code></pre>
<p>Eight namespace declarations here, of which 3 are concerned with functions; and  Wit can get a lot worse than that.</p>
<ul>
<li>Secondly, namespace clutter in the static and dynamic context. The namespace bindings shown above don't disappear when the code is compiled; even with exclude-result-prefixes="yes", they have to hang around at run-time just in case someone tries to resolve a QName dynamically. Preserving the namespace context in the expression tree through optimization rewrites is a significant cost that has no user benefit; very rarely are they actually going to use the namespace context at run time.</li>
<li>Thirdly, prefix clutter in the executable code. Writing <code>math:cos(math:cos($x))</code> is just so clumsy compared with <code>cos(cos($x))</code>.</li>
</ul>
<p>I think there are a number of things we can do to reduce this.</p>
<p>First, separate out the namespace context for static resolution of function names as a separate part of the static context, used only for this purpose. Ensure that there is no functionality that depends on knowing this part of the static context at run time, so it can be discarded by the compiler as soon as function names are resolved. Then provide source syntax for binding function prefixes to function namespaces in XSLT and XQuery to populate this part of the static context; there is no reason this has to be done using XML namespace declarations. There is also no reason for having different bindings in force in different parts of a single module. And once we've separated these declarations from XML namespace declarations, there's no reason why we can't provide default bindings. We could also allow bindings to have cross-module scope to reduce duplicated code. Note: the xsl:function-library proposal in the current XSLT 4.0 draft tries to achieve some of these things.</p>
<p>Second, allow functions to be referenced by local name alone where the reference is unambiguous; and perhaps provide some aliasing mechanisms to make more existing names unambiguous.</p>
<p>We've explored a third idea, which is to introduce some kind of polymorphism where function names have local scope and are distinguished by the types of objects to which they are applied. I think that given our type system, this is very hard to achieve and I haven't seen any very satisfactory proposals. We also need to remember that there are considerable costs if we start resolving function names dynamically at run time. I wouldn't rule out making progress in this direction, but I'm not optimistic of coming up with a workable solution. There might be some simple things we could do, like having a single function <code>size()</code> that performs the work of both <code>map:size()</code> and <code>array:size()</code> depending on the argument.</p>
</div></details></div>
<div class="toot" id="closed-318"><h2>Issue #318 closed<span class="toot-id"> #closed-318</span></h2><div class="pubdate">21 Feb at 17:02:29 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/318">https://github.com/qt4cg/qtspecs/issues/318</a></div><p>Serialization HTML/XHTML output methods: meta elements and the charset attribute</p></div>
<div class="toot" id="created-368"><h2>Pull request #368 created<span class="toot-id"> #created-368</span></h2><div class="pubdate">21 Feb at 10:34:36 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/368">https://github.com/qt4cg/qtspecs/pull/368</a></div><details><summary>129: Context item generalized to context value</summary><div class="markup"><p>This is a first cut proposal to generalize the context item to a context value, allowing (for example) array predicates.</p>
<p>The proposal covers XPath and XQuery only at this stage; it doesn't address the consequences for XSLT.</p>
<p>Careful review requested!</p>
<p>Addresses issue #129 and issue #367.</p>
</div></details></div>
<div class="toot" id="created-367"><h2>Issue #367 created<span class="toot-id"> #created-367</span></h2><div class="pubdate">21 Feb at 00:06:18 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/367">https://github.com/qt4cg/qtspecs/issues/367</a></div><details><summary>Focus for RHS of thin arrow expressions</summary><div class="markup"><p>We define <code>A -&gt; F(B, C)</code> as being equivalent to <code>A ! F(., B, C)</code> which means that B and C are evaluated with a focus based on the current item in A, not with the outer focus. This is different from the <code>=&gt;</code> operator. For example if the $E is an element E, with several children called F, then</p>
<p><code>namespace-uri(.) -&gt; fn:QName(name())</code></p>
<p>has a different effect from</p>
<p><code>namespace-uri(.) =&gt; fn:QName(name())</code></p>
<p>whereas it might reasonably be expected that in the case where the LHS produces a single value, the two operators are equivalent. We can't change the meaning of <code>=&gt;</code> because it's defined in 3.1. So should we change the meaning of <code>-&gt;</code> to fall into line?</p>
<p>We could do this easily enough by defining <code>A -&gt; F(B, C)</code> as equivalent to <code>for $a in A return F($a, B, C)</code>.  I think that as well as being more consistent with <code>=&gt;</code>, the result is probably more intuitive. (We could also define it as equivalent to <code>let $f := F(?, B, C) return A ! $f(.)</code>)</p>
<p>For the expression <code>A -&gt; {B}</code>, and for the proposed <code>A =&gt; {B}</code>, I don't think we have any choice other than evaluating B with an inner focus based on A. But at least we can do it consistently for both operators.</p>
</div></details></div>
<div class="toot" id="created-366"><h2>Issue #366 created<span class="toot-id"> #created-366</span></h2><div class="pubdate">20 Feb at 18:43:25 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/366">https://github.com/qt4cg/qtspecs/issues/366</a></div><details><summary>Support xsl:use-package with xsl:package-location</summary><div class="markup"><p>Unless I am misreading the specs (which I do commonly enough), there is currently no way for an XSLT writer using <code>xsl:use-package</code> to indicate where the package is to be found, except outside the XSLT environment. I propose to allow <code>xsl:use-package</code> to contain zero or more <code>xsl:package-location</code> children. I propose the addition of an element and not an attribute, because a package may be in multiple locations, and need nuance, as noted below.</p>
<p>Attributes:</p>
<ul>
<li><code>@href</code>, on the model of <code>xsl:import</code> and <code>xsl:include</code>, would specify by relative or absolute URI where the package is.</li>
<li><code>@priority</code> (default 0) would provide a mechanism to indicate whether the specified <code>xsl:package-location</code> should override (value greater than 0), or simply provide a fallback for (less than or equal to 0), the preconfigured place the package should be retrieved from.</li>
<li><code>@use-when</code> would allow a developer to manage different versions of a package for different cases.</li>
</ul>
<p>Other attributes given to <code>xsl:package-location</code> would need discussion.</p>
</div></details></div>
<div class="toot" id="created-365"><h2>Issue #365 created<span class="toot-id"> #created-365</span></h2><div class="pubdate">20 Feb at 16:41:34 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/365">https://github.com/qt4cg/qtspecs/issues/365</a></div><details><summary>switch, typeswitch: Optional braces</summary><div class="markup"><p>The indentation of switch expressions is often a mess. Now that we allow curly braces for <code>if</code>, it would be nice to also allow optional braces for <code>switch</code> and <code>typeswitch</code>:</p>
<pre><code class="language-xquery">typeswitch($item) {
  case xs:numeric return 'number'
  default return '...'
},
switch($item) {
  case 0 to 9 return 'single digit'
  default return '...'
}
</code></pre>
<p>The current syntax is:</p>
<pre><code class="language-xquery">typeswitch($item)
  case xs:numeric return 'number'
  default return '...',

switch($item)
  case 0 to 9 return 'single digit'
  default return '...'
</code></pre>
</div></details></div>
<div class="toot" id="created-364"><h2>Pull request #364 created<span class="toot-id"> #created-364</span></h2><div class="pubdate">20 Feb at 15:43:59 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/364">https://github.com/qt4cg/qtspecs/pull/364</a></div><p>Generalize switch expressions in XQuery (issue #328)</p></div>
<div class="toot" id="closed-337"><h2>Issue #337 closed<span class="toot-id"> #closed-337</span></h2><div class="pubdate">20 Feb at 14:38:11 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/337">https://github.com/qt4cg/qtspecs/issues/337</a></div><p>Local union and enum types: and the definition of generalised atomic types</p></div>
<div class="toot" id="created-363"><h2>Pull request #363 created<span class="toot-id"> #created-363</span></h2><div class="pubdate">20 Feb at 13:07:43 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/363">https://github.com/qt4cg/qtspecs/pull/363</a></div><p>Fix issue #345 - missing rules for type matching</p></div>
<div class="toot" id="created-362"><h2>Pull request #362 created<span class="toot-id"> #created-362</span></h2><div class="pubdate">20 Feb at 12:12:08 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/362">https://github.com/qt4cg/qtspecs/pull/362</a></div><details><summary>Drop obsolete note in XSLT regarding for-each-group/@array</summary><div class="markup"><p>Fixes issue #352</p>
</div></details></div>
<div class="toot" id="created-361"><h2>Issue #361 created<span class="toot-id"> #created-361</span></h2><div class="pubdate">20 Feb at 11:38:00 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/361">https://github.com/qt4cg/qtspecs/issues/361</a></div><details><summary>Named arguments: $input vs. $value</summary><div class="markup"><p>Great effort has been made in unifying the parameter names of the XQFO standard; thanks for that!</p>
<p>I believe to remember that:</p>
<ul>
<li><code>$value</code>, <code>$values</code>, <code>$value1</code>, etc. is used for atomic/atomized arguments, whereas</li>
<li><code>$input</code>, <code>$input1</code>, etc. is used for input, mostly of type <code>item()</code>, that is processed unchanged.</li>
<li><code>$uri</code> is used for arguments that could have been defined as items of type <code>xs:anyURI</code>.</li>
</ul>
<p>I believe the following argument names need to be double-checked (if not, It may be that I haven’t fully grasped how the naming rules are supposed to work):</p>
<p>Function | Currently | Presumably | Justification
--- | --- | --- | ---
<code>array:slice</code> | <code>$input</code> | <code>$array</code> | Alignment with <code>array:size</code> et al.
<code>trace</code> | <code>$value</code> | <code>$input</code> | Argument is not atomized
<code>json</code> | <code>$input</code> | <code>$value</code> | Argument is atomized
<code>string</code> | <code>$item</code> | <code>$value</code>  | <code>$item</code> is used nowhere else
<code>expanded-QName</code> | <code>$qname</code> | <code>$value</code> | Alignment with <code>prefix-from-QName</code> et al.
<code>resolve-QName</code> | <code>$qname</code> | <code>$value</code> | Alignment with <code>prefix-from-QName</code> et al.
<code>parse-QName</code> | <code>$eqname</code> | <code>$value</code> | Alignment with <code>parse-xml</code> et al.
<code>parse-json</code> | <code>$json</code> | <code>$value</code> | Alignment with <code>parse-xml</code> et al.
<code>json-to-xml</code> | <code>$json</code> | <code>$value</code> | Alignment with <code>parse-xml</code> et al.
<code>char</code> | <code>$name</code> | <code>$value</code> | Input may also be codepoint values, etc.
<code>namespace-uri-for-prefix</code> | <code>$prefix</code> | <code>$value</code> | <code>$prefix</code> is used nowhere else
<code>resolve-uri</code> | <code>$relative</code> | <code>$uri</code> | Absolute URIs are legal as well
<code>array:add</code> | <code>$add</code> | <code>$member</code> | Alignment with <code>array:put</code></p>
<p>And we should probably pay particular attention to the naming conventions when adding new functions.</p>
</div></details></div>
<div class="toot" id="created-360"><h2>Pull request #360 created<span class="toot-id"> #created-360</span></h2><div class="pubdate">20 Feb at 11:24:36 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/360">https://github.com/qt4cg/qtspecs/pull/360</a></div><details><summary>Issue 314 array composition and decomposition</summary><div class="markup"><p>This PR addresses parts of issue 29, issue 113, and issue 314 relating to the composition and decomposition of arrays.</p>
<p>It introduces two functions <code>array:of</code> for array composition, and <code>array:members</code> for decomposition, and defines all other array functions in terms of these two primitives (replacing the internal functions <code>op:A2S</code> and <code>op:S2A</code>). The items in the decomposed form of an array are called "value records", singleton maps of the form <code>map{'value': $value}</code></p>
<p>The function <code>array:from-sequence</code> is renamed <code>array:build</code> to reflect its symmetry with <code>map:build</code>.</p>
<p>Question for the group: should we have a new function for constructing a "value record", or is the syntax <code>map{'value': $value}</code> adequate for the purpose?</p>
</div></details></div>
<div class="toot" id="created-359"><h2>Issue #359 created<span class="toot-id"> #created-359</span></h2><div class="pubdate">20 Feb at 09:53:03 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/359">https://github.com/qt4cg/qtspecs/issues/359</a></div><details><summary>fn:void: Absorb result of evaluated argument</summary><div class="markup"><h3>Summary</h3>
<p>Absorb the result of the evaluated argument.</p>
<h3>Signature</h3>
<pre><code class="language-xquery">fn:void(
  $input as item()*
) as empty-sequence()
</code></pre>
<h3>Motivation</h3>
<p>Developers tend to get creative if they want to suppress the result of an expression. The reason is that there is no simply solution to do this properly. Some constructs I have seen in practice:</p>
<pre><code class="language-xquery">let $unused := EXPRESSION
return 'ok'

EXPRESSION[position() = 10000], 'ok'

let $result := 'ok'
return if(exists(EXPRESSION)) then $result else $result
</code></pre>
<p>Cases like this are frequent in nondeterministic code. Think e.g. of side-effecting functions of the EXPath HTTP-Client and File Modules: The function results are not always relevant for the invoking application, or already known.</p>
<p>The function is also helpful during development and for testing code. <code>fn:void#1</code> and <code>fn:identity#1</code> can both be passed on to functions to either return or ignore the result of their arguments. The function can potentially be used to measure the runtime performance of an expression (but an implementation should not be prevented from discarding the function call if the argument expression is deterministic).</p>
</div></details></div>
<div class="toot" id="created-358"><h2>Issue #358 created<span class="toot-id"> #created-358</span></h2><div class="pubdate">19 Feb at 23:55:31 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/358">https://github.com/qt4cg/qtspecs/issues/358</a></div><details><summary>serialization indent whitespace</summary><div class="markup"><p>There could be an option to control whether the serialization indents with space or tabs, and how many of them (e.g.  2 or 4 spaces )</p>
<p>Related: https://github.com/qt4cg/qtspecs/issues/101</p>
<p>A user request: https://github.com/benibela/xidel/issues/100</p>
</div></details></div>
<div class="toot" id="created-357"><h2>Issue #357 created<span class="toot-id"> #created-357</span></h2><div class="pubdate">18 Feb at 16:07:01 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/357">https://github.com/qt4cg/qtspecs/issues/357</a></div><details><summary>Representing key-value pairs</summary><div class="markup"><p>A map can be decomposed into, or composed from, a sequence of key-value pairs (KVPs).</p>
<p>There are two natural representations of a key-value pair (K, V): it can be represented as a singleton map (<code>map{ K: V }</code>) or as a "doubleton" map (<code>map{ 'key': K, 'value': V}</code>).</p>
<p>This issue examines how well either of these representations is currently supported, which of them is preferable, and how this support should be improved.</p>
<p>I'll consider the following basic operations: constructing a KVP from a key and a value, assembling a map from a set of KVPs, decomposing a map into a sequence of KVPs, extracting the key from a KVP, and extracting the value from a KVP.</p>
<p><strong>Singleton Representation</strong></p>
<p>Constructing a KVP from a key and a value:</p>
<pre><code>map{ $key : $value }
map:entry($key, $value)
&lt;xsl:map:entry key="$key" select="$value"/&gt;
</code></pre>
<p>Assembling a map from a set of KVPs</p>
<pre><code>map:merge($kvps)
&lt;xsl:map&gt;
</code></pre>
<p>Decomposing a map into a sequence of KVPs:</p>
<p><code>map:for-each($map, map:entry#2)</code></p>
<p>Extracting the key from a KVP:</p>
<p><code>map:keys($kvp)</code></p>
<p>Extracting the value from a KVP:</p>
<p><code>$kvp?*</code></p>
<p><strong>Doubleton Representation</strong></p>
<p>Constructing a KVP from a key and a value:</p>
<pre><code>map{ 'key': $key, 'value': $value }
</code></pre>
<p>Assembling a map from a set of KVPs</p>
<p><code>map:build($kvps, -&gt;{?key}, -&gt;{?value})</code></p>
<p>Decomposing a map into a sequence of KVPs:</p>
<p><code>map:for-each($map, -&gt;($K, $V){map{ 'key': $key, 'value': $value })</code></p>
<p>Extracting the key from a KVP:</p>
<p><code>$kvp?key</code></p>
<p>Extracting the value from a KVP:</p>
<p><code>$kvp?value</code></p>
<p><strong>Analysis</strong></p>
<p>The singleton representation is better supported at present, and it makes sense therefore to fill in the gaps that currently make it awkward. The main attraction of the doubleton representation is the ease of extracting the key and the value using <code>$kvp?key</code> and <code>$kvp?value</code>. The equivalents for the singleton representation (<code>map:keys($kvp)</code> and <code>$kvp?*</code>) feel clumsy and unintuitive; however, it's not at all obvious what would be better, short of introducing new custom syntax, which seems over-the-top. The best idea I can come up with is to have two functions <code>map:key($kvp)</code> and <code>map:value($kvp)</code> which require $kvp to be a singleton map. But I hate the namespace prefixes...</p>
<p>The other thing needed to "fill the gaps" is a function <code>map:entries($map)</code> equivalent to <code>map:for-each($map, map:entry#2)</code>.</p>
<p>What if we chose to go the other way, and improve support for the doubleton representation?</p>
<p>We could add <code>map:key-value-pair($key, $value)</code> to create  KVP, and <code>map:of($kvps)</code> to build a map from a set of KVPs, and <code>map:key-value-pairs($map)</code> to decompose a map. The trickiest problem is what to do about XSLT, where the 3.0 instructions <code>&lt;xsl:map&gt;</code> and <code>&lt;xsl:map-entry&gt;</code> use the singleton representation.</p>
</div></details></div>
<div class="toot" id="created-356"><h2>Issue #356 created<span class="toot-id"> #created-356</span></h2><div class="pubdate">18 Feb at 00:21:40 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/356">https://github.com/qt4cg/qtspecs/issues/356</a></div><details><summary>array:flatten: Issues</summary><div class="markup"><h1>1. Issues</h1>
<p>There are at least two issues with the definition of the function <a href="https://qt4cg.org/specifications/xpath-functions-40/Overview-diff.html#func-array-flatten"><strong><code>array:flatten</code></strong></a>:</p>
<ol>
<li>
<p>Unlike most other functions on arrays (such as <strong><a href="https://qt4cg.org/specifications/xpath-functions-40/Overview-diff.html#func-array-put">array:put</a>, <a href="https://qt4cg.org/specifications/xpath-functions-40/Overview-diff.html#func-array-replace">array:replace</a>, <a href="https://qt4cg.org/specifications/xpath-functions-40/Overview-diff.html#func-array-append">array:append</a>, <a href="https://qt4cg.org/specifications/xpath-functions-40/Overview-diff.html#func-array-slice">array:slice</a>, <a href="https://qt4cg.org/specifications/xpath-functions-40/Overview-diff.html#func-array-subarray">array:subarray</a>, <a href="https://qt4cg.org/specifications/xpath-functions-40/Overview-diff.html#func-array-remove">array:remove</a>, <a href="https://qt4cg.org/specifications/xpath-functions-40/Overview-diff.html#func-array-insert-before">array:insert-before</a>, <a href="https://qt4cg.org/specifications/xpath-functions-40/Overview-diff.html#func-array-tail">array:tail</a>, <a href="https://qt4cg.org/specifications/xpath-functions-40/Overview-diff.html#func-array-trunk">array:trunk</a>, <a href="https://qt4cg.org/specifications/xpath-functions-40/Overview-diff.html#func-array-reverse">array:reverse</a>, <a href="https://qt4cg.org/specifications/xpath-functions-40/Overview-diff.html#func-array-join">array:join</a>, <a href="https://qt4cg.org/specifications/xpath-functions-40/Overview-diff.html#func-array-for-each">array:for-each</a>, <a href="https://qt4cg.org/specifications/xpath-functions-40/Overview-diff.html#func-array-filter">array:filter</a>, <a href="https://qt4cg.org/specifications/xpath-functions-40/Overview-diff.html#func-array-for-each-pair">array:for-each-pair</a>, <a href="https://qt4cg.org/specifications/xpath-functions-40/Overview-diff.html#func-array-sort">array:sort</a>, <a href="https://qt4cg.org/specifications/xpath-functions-40/Overview-diff.html#func-array-partition">array:partition</a></strong>) , which produce an array as their result, <strong>this function produces only a sequence</strong></p>
</li>
<li>
<p><strong>This function is not lossless</strong> -- any members that are the empty sequence or the empty array are not represented in the returned result.</p>
</li>
</ol>
<h1>2. Suggested solution(s)</h1>
<p>We want to have a function that is similar to the wrongly defined one, but produces its contents as an array, and is lossless. There are two obvious ways to do this:</p>
<ol>
<li>
<p>Correct the specification of   <strong><a href="https://qt4cg.org/specifications/xpath-functions-40/Overview-diff.html#func-array-flatten"><code>array:flatten</code></a></strong> so that its result is an array and it represents the empty sequences and empty arrays as the same members of its result.</p>
</li>
<li>
<p>Add to the Specification a new function: <strong><code>array:leaves</code></strong> that produces an array as its result and that is lossless.
<strong>array:leaves</strong> returns an array whose members are exactly all the leaves of the input array, by the order of their appearance. By definition leaves are all, and at any depth, members that are not an array except when they are the empty array. Thus () (the empty sequence) and [] (the empty array) are leaves by definition.</p>
</li>
</ol>
<p><strong><em>Solution 2. will not cause any compatibility issues</em></strong>.</p>
<h1>3. Examples</h1>
<p>The expression <strong><code>array:leaves([1, (), [4, 6], 5, 3])</code></strong> returns <strong><code>[1, (),  4, 6, 5, 3]</code></strong>.</p>
<p>The expression <strong><code>array:leaves([1, 2, 5], [[10, 11], 12], [], 13)</code></strong> returns <strong><code>[1, 2, 5, 10, 11, 12, [], 13]</code></strong>.</p>
</div></details></div>
<div class="toot" id="agenda-02-21"><h2>QT4 CG meeting 023 draft agenda<span class="toot-id"> #agenda-02-21</span></h2><div class="pubdate">17 Feb at 17:49:00 GMT</div><div class="link">Link: <a href="https://qt4cg.org/meeting/agenda/2023/02-21">https://qt4cg.org/meeting/agenda/2023/02-21</a></div><p>Draft agenda published.</p></div>
<div class="toot" id="created-355"><h2>Pull request #355 created<span class="toot-id"> #created-355</span></h2><div class="pubdate">16 Feb at 21:41:38 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/355">https://github.com/qt4cg/qtspecs/pull/355</a></div><details><summary>Action QT4CG-022-02 - add to imp-def-feature appendix</summary><div class="markup"><p>Adds entries to the implementation-defined-features appendix of the serialization spec, corresponding to the option to generate <code>&lt;meta charset="XXX"&gt;</code> for HTML5.</p>
</div></details></div>
<div class="toot" id="created-354"><h2>Pull request #354 created<span class="toot-id"> #created-354</span></h2><div class="pubdate">16 Feb at 18:30:51 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/354">https://github.com/qt4cg/qtspecs/pull/354</a></div><details><summary>Combine multiple signatures of XSLT functions to use defaults</summary><div class="markup"><p>This PR addresses issue 69, by modifying those XSLT built-in functions that currently have multiple signatures, to use a single signature with parameter defaults instead.</p>
<p>The changes however don't currently render correctly. The XSLT processing pipeline needs to be changed to pick up the changes that were made to the F+O stylesheets to render parameter defaults correctly. I haven't yet managed to work out where this is done.</p>
</div></details></div>
<div class="toot" id="created-353"><h2>Pull request #353 created<span class="toot-id"> #created-353</span></h2><div class="pubdate">16 Feb at 17:22:48 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/353">https://github.com/qt4cg/qtspecs/pull/353</a></div><details><summary>Issue109 xsl note</summary><div class="markup"><p>Addresses issue #109 and issue #87. Unfortunately the PR also includes the unrelated commits for issue 22.</p>
</div></details></div>
<div class="toot" id="created-352"><h2>Issue #352 created<span class="toot-id"> #created-352</span></h2><div class="pubdate">16 Feb at 14:58:30 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/352">https://github.com/qt4cg/qtspecs/issues/352</a></div><details><summary>The @array attribute of xsl:for-each-group is no more</summary><div class="markup"><p>There is a note in XSLT §14.2 concerning the @array attribute of xsl:for-each-group, but this attribute has been dropped.</p>
</div></details></div>
<div class="toot" id="closed-351"><h2>Issue #351 closed<span class="toot-id"> #closed-351</span></h2><div class="pubdate">16 Feb at 08:48:37 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/351">https://github.com/qt4cg/qtspecs/pull/351</a></div><p>Another attempt to build off the merge-base branch</p></div>
<div class="toot" id="created-351"><h2>Pull request #351 created<span class="toot-id"> #created-351</span></h2><div class="pubdate">16 Feb at 08:48:31 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/351">https://github.com/qt4cg/qtspecs/pull/351</a></div><p>Another attempt to build off the merge-base branch</p></div>
<div class="toot" id="closed-341"><h2>Issue #341 closed<span class="toot-id"> #closed-341</span></h2><div class="pubdate">16 Feb at 00:17:45 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/341">https://github.com/qt4cg/qtspecs/issues/341</a></div><p>[XPath] Error-free selection operator for maps or arrays, or finite-domain functions</p></div>
<div class="toot" id="created-350"><h2>Issue #350 created<span class="toot-id"> #created-350</span></h2><div class="pubdate">16 Feb at 00:11:51 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/350">https://github.com/qt4cg/qtspecs/issues/350</a></div><details><summary>CompPath (Composite-objects path) Expressions</summary><div class="markup"><h1>CompPath (Composite-objects path) Expressions</h1>
<p>As initially discussed in issue #341, we were exploring different ways to provide an XPath-like language to traverse in depth composite objects such as maps and arrays and select their members at any depth.
While working on this, the idea of an XPath-like language for composite items started to emerge and here we present this idea in a more or less crystalized form.</p>
<h2>1. Root Component</h2>
<p>Any CompPath expression must start off a composite item (of type map or array, or of other future composite item type (maybe set? )  ).
This can be a literal composite item or a reference to a variable whose value is a composite item.</p>
<p>Examples:</p>
<pre><code class="language-xq">
(: Literal composite items: :)
[1, 2, 3]

[1, [2,  3]]?2

{"x":1, "y" : map{ "z": 2}}

{"x":1, "y" : map{ "z": 2}} ?y

(: Variables containing composite items: :)
let $comp1 := [1, [2, 3]],
 $comp2 :=$comp1 ?2,
 $comp3 := {"x":1, "y" : map{ "z": 2}},
 $comp4 := $comp3 ?y
</code></pre>
<p>In the above examples all literal expressions and all variables (<strong><code>$comp1, $comp2, $comp3, $comp4</code></strong>) may serve as the root component for a CompPath expression.</p>
<h2>2. The component-path operator (\)</h2>
<p>The component-path operator "\" is used to build expressions for locating members at any depth within component trees. Its left-hand side expression must return a result that is a composite item or else this result is represented as such by wrapping it into an array.</p>
<p>The operator returns an array, the values of whose members are composite items themselves or any such value may be a non-composite "leaf" in the root-component tree).</p>
<p>Each operation E1\E2 is evaluated as follows: Expression E1 is evaluated, and the result is wrapped in an array A1. If any member of A1 is not a composite item, a type error is raised.
Each member of A1 serves in turn  to provide an inner "composite-focus" (the member as the "composite-context-item" or <strong><code>.</code></strong>, its index in A1 as the "composite-context-position" or <strong><code>index()</code></strong>, the set of keys of the composite-context-item as the "composite-keyset" or <strong><code>keys()</code></strong> and the size of this member as the "composite-context-size" (specified as one of: <strong><code>size()</code></strong>, or <strong><code>array-size()</code></strong> or <strong><code>key-size()</code></strong>) ) for the evaluation of E2. The result of each evaluation of  E2, if it isn't a single composite item, is wrapped in a single array. The arrays resulting from all the evaluations of E2 are wrapped  in a single array and this single array is the result of the evaluation.</p>
<p>E2 is typically a function over the <em>context-focus</em>  and its results will be the set of the next step composite-context-items (used as the left-hand-side of the next in chain composite-step-expression (see below)), or these results would be the final results of evaluation if this is the last-in chain composite-step-expression.</p>
<h2>3. Composite-Steps</h2>
<p>A <strong>composite-step</strong> is a part of a composite-path-expression that generates an array and filters its members by zero or more predicates. A <strong>composite-step-expression</strong> is either a <em>CompositeAxisStep</em> or a <em>CompositePostfixExpression</em>.</p>
<h2>4. Composite-Axes</h2>
<p>The following axes are defined for traversing a composite-item tree:</p>
<ul>
<li>The <strong><code>child-member::</code></strong> axis contains the members of the composite-context-item.</li>
<li>The  <strong><code>value-member::</code></strong>  axis contains the members of the composite-context-item that are not composite themselves.</li>
<li>The  <strong><code>node-member::</code></strong>  axis contains the members of the composite-context-item that are nodes.</li>
<li>The <strong><code>descendant-member::</code></strong> axis is defined as the transitive closure of the <strong><code>child-member::</code></strong> axis; it contains the descendent-members of the composite-context-item (the child members of the composite-context-item, and their child-members, ... and so on).</li>
<li>The <strong><code>self::</code></strong> axis contains just the composite-context-item.</li>
<li>The <strong><code>descendant-member-or-self::</code></strong> contains the composite-context-item and all of its descendent-members.</li>
<li>The <strong><code>following-sibling-member::</code></strong> axis contains the members of the immediate container of the composite-context-item that follow it. For any two members <strong><em>mem1</em></strong> and <strong><em>mem2</em></strong> of a composite item <strong><em>Comp</em></strong>, by definition <strong><em>mem2</em></strong> follows <strong><em>mem1</em></strong> if and only if <strong><em>Comp</em></strong> is an array and the index of <strong><em>mem2</em></strong> in <strong><em>Comp</em></strong> is greater than that of <strong><em>mem1</em></strong>, or if <strong><em>Comp</em></strong> is a map, then the key of <strong><em>mem2</em></strong> is greater than that of <strong><em>mem1</em></strong>.</li>
<li>The <strong><code>preceding-sibling-member::</code></strong> axis contains the members of the immediate container of the composite-context-item that precede it. For any two members <strong><em>mem1</em></strong> and <strong><em>mem2</em></strong> of a composite item <strong><em>Comp</em></strong>, by definition <strong><em>mem1</em></strong> precedes <strong><em>mem2</em></strong> if and only if <strong><em>Comp</em></strong> is an array and the index of <strong><em>mem2</em></strong> in <strong><em>Comp</em></strong> is greater than that of <strong><em>mem1</em></strong>, or if <strong><em>Comp</em></strong> is a map, then the key of <strong><em>mem2</em></strong> is greater than that of <strong><em>mem1</em></strong>.</li>
</ul>
<p>For example, <strong><code>following-sibling-member::5</code></strong> means all members of the composite-context-item with index &gt; 5,
and <strong><code>preceding-sibling-member::5</code></strong> means all members of the composite-context-item with index &lt; 5</p>
<p><strong>Note</strong>: If the immediate container of the composite-context-item is a map whose key-values cannot be ordered, then specifying either of the <strong><code>following-sibling-member::</code></strong> or <strong><code>preceding-sibling-member::</code></strong> axes on this composite-context-item must raise a type error. (Obviously, these two axes are meaningful only for composite items, whose members are ordered, such as the array).</p>
<p>If the composite-axis name is omitted from a composite-axis step, the default axis is <strong><code>child-member::</code></strong></p>
<h2>5. Composite Axis Steps</h2>
<p>A composite axis step completely resembles the ordinary axis step in XPath. It consists of three parts:</p>
<ol>
<li>The composite axis  (<strong><code>child-member::</code></strong>, <strong><code>descendant-member::</code></strong>, <strong><code>value-member::</code></strong>, <strong><code>node-member::</code></strong>, <strong><code>following-sibling-member::</code></strong>, <strong><code>preceding-sibling-member::</code></strong>, <strong><code>self::</code></strong>, or the <strong><code>descendant-member-or-self::</code></strong> axis)</li>
<li>The member test</li>
<li>The composite-predicates</li>
</ol>
<h2>6. Member Tests</h2>
<p>A member test is a condition on the key-name, index, or kind (<em>composite</em>, <em>map</em>, <em>array</em> or <em>value</em>, <em>node</em>, or (any) <em>member</em>). A member test determines which members contained by a copmosite-axis are selected by a composite-step.</p>
<p>As such, a member test is either an <em>identifier-test</em> (key-name or index) or a <em>kind-test</em> (<em>composite</em>, <em>map</em>, <em>array</em>,  <em>value</em>, or <em>member</em>)).</p>
<p>Examples of member identifiers:</p>
<ul>
<li>
<p>A string specifies a name of a key, whose value will be selected. For example: <strong><code>\child-member::X</code></strong> selects from the composite-context-item the value corresponding to its key which has the name "X".</p>
</li>
<li>
<p><strong><code>\child-member::3</code></strong> selects from the composite-context-item the value of its 3rd member, if it is an array or the value corresponding to its key <strong><code>3</code></strong>, if it is a map.</p>
</li>
<li>
<p><strong><code>following-sibling-member::3</code></strong> selects from the composite-content-item (which is most-likely an array) all of its members having index greater than 3.</p>
</li>
<li>
<p><strong><code>preceding-sibling-member::3</code></strong> selects from the composite-content-item (which is most-likely an array) all of its members having index less than 3.</p>
</li>
<li>
<p><strong><code>\descendant-member-or-self::X</code></strong> selects from the composite-context-item (that must be a map) and from all its descendant-members, the values corresponding to their key named "X", if these descendents have a key named "X".</p>
</li>
<li>
<p>Similarly <strong><code>\5</code></strong> is equivalent to <strong><code>\child-member::5</code></strong> and selects from the composite-context-item that is an array the value of its 5th member. This will also select the value corresponding to the key <strong><code>5</code></strong> from the composite-context-item if it is a map, because on the <strong><code>child-member::</code></strong> axis both maps and arrays may be selected.</p>
</li>
<li>
<p><strong><code>\X</code></strong> is equivalent to <strong><code>\child-member::X</code></strong> and selects from the composite-context-item (that must be a map), the value corresponding to its key which has the name "X".</p>
<p>There is also the pseudo-operator <code>\\</code> . This is an abbreviation for:</p>
<p><strong><code>\descendant-member-or-self::member()\</code></strong></p>
<p>Thus, <strong><code>\\X</code></strong> means: "(Deep) Select all members of the root-component that are the corresponding values of keys equal to 'X' "</p>
</li>
<li>
<p>We may use a <strong><em>kind test</em></strong> as part of the previous example, if we want to select only a specific kind of members of the composite-context-item.
<strong><code>\array()</code></strong>  In this example, although we are on the <strong><code>child-member::</code></strong> axis, we want to select only members of the composite-context-item that are arrays.</p>
</li>
<li>
<p><strong><code>\map()</code></strong>  In this example, although we are on the <strong><code>child-member::</code></strong> axis, we want to select only members of the composite-context-item that are maps.</p>
</li>
<li>
<p><strong><code>\value()</code></strong>  In this example we want to select only members of the composite-context-item that are not composite items themselves.</p>
</li>
<li>
<p><strong><code>\node()</code></strong>  In this example we want to select only members of the composite-context-item that are nodes.</p>
</li>
<li>
<p><strong><code>\member()</code></strong>  In this example we want to select all members of the composite-context-item, regardless whether they are maps, arrays, or values.</p>
</li>
</ul>
<h3>6.1 Wildcards</h3>
<p>The <strong><code>*</code></strong> wildcard can be used instead of a member identifier. Its meaning is to select all existing members of the composite-context-item, that is possibly selected by a specific axis and limited by a specific member kind-test.</p>
<p><strong>Examples</strong>:</p>
<ul>
<li><strong><code>\*</code></strong>  (: (Shallow) Selects all members of the composite-context-item :)</li>
<li><strong><code>\map()\*</code></strong>  (: Selects from the composite-context-item all values that correspond to a key of any map-member of the composite-context item :)</li>
<li><strong><code>\array()\*</code></strong>  (: Selects from the composite-context-item all members of all its members that are arrays :)</li>
<li><strong><code>\\*</code></strong>  (: (Deep) Select all members of the composite tree rooted by the root-component :)</li>
</ul>
<h2>7. Predicates</h2>
<p>As defined above, a <strong>composite-step</strong> has three parts: <em>composite-axis</em> (can be omitted and then a default axis is used), <em>member test</em>, and an optional <em>list of composite-predicates</em>.</p>
<p>A <strong><em>composite-predicate</em></strong> in a composite-step is an expression used as a <em>filter</em> applied on the members of the composite-context-item that are already selected by the axis and member tests of the axis step, and not filtered out by any preceding composite-predicates in the <em>composite-predicates-list</em>. The composite-predicate may be any XPath expression and is written within double square brackets.</p>
<p><strong>Examples</strong>:</p>
<ul>
<li><strong><code>\*[[3]]</code></strong>  (: Selects any member of the composite-context-item, that is an array and has a 3rd member or any member of the composite-context-item, that is a map and has a key <strong>3</strong> :)
This is a shorthand for: <strong><code>\*[[array-size() ge 3 or 3 = keys()]]</code></strong></li>
<li><strong><code>\array()[[3]]</code></strong> (: Selects those array members of the composite-context-item that have a 3rd member :)
This is a shorthand for: <strong><code>\*[[size() ge 3]]</code></strong></li>
<li><strong><code>\*[[size() eq 7]]</code></strong>  (: Selects those members whose array-size() or key-size() is exactly 7:)
This is a shorthand for: <strong><code>\composite::*[[self::map() and key-size() eq 7 or self::array() and array-size() eq 7]]</code></strong></li>
<li><strong><code>\*[[X]]</code></strong>  (: Selects any member of the composite-context-item, that is a map and has a key <strong>X</strong>  :)</li>
<li><strong><code>\map()[[X]]</code></strong> (: Selects any map member of the composite-context-item, that has a key <strong>X</strong>  :)
The above two expressions are a shorthand for: <strong><code>\*[['X' = keys()]]</code></strong></li>
<li><strong><code>\value()[[. gt 0]]</code></strong> (: Selects any value (non-composite member) of the composite-context-item, that is a positive number :)</li>
</ul>
<h2>8. Mixing CompPath and XPath expressions</h2>
<p>CompPath and XPath expressions can be used as parts of a single expression:</p>
<ul>
<li>
<p>A CompPath expression may be appended at the end of any XPath expression that produces a composite-object .</p>
</li>
<li>
<p>An XPath expression may be appended at the end of any CompPath expression. When doing this,</p>
<p><strong><code>CompPathExpr / XPathExpr</code></strong></p>
<p>is equivalent to:</p>
<p><strong><code>CompPathExpr\node::* / XPathExpr</code></strong></p>
<p>And this:</p>
<p><strong><code>CompPathExpr ! XPathExpr</code></strong>  (:  Note: also causes ordering and deduplication of the nodes! :)</p>
<p>is equivalent to:</p>
<p><strong><code>CompPathExpr\value::* !  XPathExpr</code></strong>  (: Note: No ordering or deduplication, can be applied on any item, not just on nodes :)</p>
</li>
<li>
<p>A CompPath expression may be substituted for the expected argument of any XPath expression, for example:
<strong><code>count(MyCompPathExpr)</code></strong></p>
</li>
<li>
<p>Any XPath expression that produces a composite item can be used as the composite-root for any CompPath expression</p>
</li>
</ul>
<p><strong>Example</strong>:</p>
<pre><code class="language-xq">let $myBooks := 
&lt;books&gt;
 &lt;book name="Tom Sawyer"&gt;
   &lt;author&gt;Mark Twain&lt;/author&gt;
 &lt;/book&gt;
 &lt;book name="Wuthering Heights"&gt;
   &lt;author&gt;Emily Brontë&lt;/author&gt;
 &lt;/book&gt;
 &lt;book name="Jane Eyre"&gt;
   &lt;author&gt;Charlotte Brontë&lt;/author&gt;
 &lt;/book&gt;
 &lt;book name="Adventures of Huckleberry Finn"&gt;
   &lt;author&gt;Mark Twain&lt;/author&gt;
 &lt;/book&gt;
&lt;/books&gt;,
$map1 := map {"science-works": map{"Einstein": "Special Theory of relativity",
                                  "Darwin" : "On the Origin of Species"
                                 },
             "literature" : map{"19the Century": $myBooks}
            }
return
  $map1\literature\\*/book[author eq 'Mark Twain']
</code></pre>
<p>Evaluating this mixed CompPath and XPath expression produces the correct result:</p>
<pre><code class="language-xq">&lt;book name="Tom Sawyer"&gt;
  &lt;author&gt;Mark Twain&lt;/author&gt;
&lt;/book&gt;
&lt;book name="Adventures of Huckleberry Finn"&gt;
  &lt;author&gt;Mark Twain&lt;/author&gt;
&lt;/book&gt;
</code></pre>
</div></details></div>
<div class="toot" id="closed-349"><h2>Issue #349 closed<span class="toot-id"> #closed-349</span></h2><div class="pubdate">15 Feb at 18:04:32 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/349">https://github.com/qt4cg/qtspecs/pull/349</a></div><p>Revert PR change; it doesn't work in this context</p></div>
<div class="toot" id="created-349"><h2>Pull request #349 created<span class="toot-id"> #created-349</span></h2><div class="pubdate">15 Feb at 18:04:27 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/349">https://github.com/qt4cg/qtspecs/pull/349</a></div><p>Revert PR change; it doesn't work in this context</p></div>
<div class="toot" id="closed-348"><h2>Issue #348 closed<span class="toot-id"> #closed-348</span></h2><div class="pubdate">15 Feb at 17:46:33 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/348">https://github.com/qt4cg/qtspecs/pull/348</a></div><p>Attempt to build PR with merge-base version of master</p></div>
<div class="toot" id="created-348"><h2>Pull request #348 created<span class="toot-id"> #created-348</span></h2><div class="pubdate">15 Feb at 17:46:07 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/348">https://github.com/qt4cg/qtspecs/pull/348</a></div><details><summary>Attempt to build PR with merge-base version of master</summary><div class="markup"><p>This PR changes the CI <code>build-pr.yml</code> script so that it checks out the version of master that the branch started from, rather than the current version of master, for building the specifications.</p>
<ul>
<li>Pro: we won't get build failures when the current master can't build the old version (for example, when images have been removed)</li>
<li>Con: we won't get any features from the current master, such as stylesheet updates</li>
</ul>
<p>Since failing builds are more troublesome than formatting issues, I'm going to say the pros outweigh the cons.</p>
</div></details></div>
<div class="toot" id="created-347"><h2>Pull request #347 created<span class="toot-id"> #created-347</span></h2><div class="pubdate">15 Feb at 14:06:34 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/347">https://github.com/qt4cg/qtspecs/pull/347</a></div><details><summary>Attempt to clarify fn:parse-uri and fn:build-uri</summary><div class="markup"><p>Fix #307</p>
</div></details></div>
<div class="toot" id="closed-346"><h2>Issue #346 closed<span class="toot-id"> #closed-346</span></h2><div class="pubdate">15 Feb at 10:11:01 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/346">https://github.com/qt4cg/qtspecs/pull/346</a></div><p>Remove dagger from record cross-references</p></div>
<div class="toot" id="created-346"><h2>Pull request #346 created<span class="toot-id"> #created-346</span></h2><div class="pubdate">15 Feb at 10:10:36 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/346">https://github.com/qt4cg/qtspecs/pull/346</a></div><details><summary>Remove dagger from record cross-references</summary><div class="markup"><p>Record types are better supported by the stylesheets so the dagger is simply a distraction.</p>
</div></details></div>
<div class="toot" id="created-345"><h2>Issue #345 created<span class="toot-id"> #created-345</span></h2><div class="pubdate">14 Feb at 22:52:25 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/345">https://github.com/qt4cg/qtspecs/issues/345</a></div><details><summary>Missing rule for matching atomic values against atomic types</summary><div class="markup"><p>In XPath §3.6.2 we have forgotten to state the obvious rule:</p>
<p>"An Atomic Value AV matches a generalized atomic type GAT if the type annotation of AV (call it T) satisfies the condition derives-from(T, GAT)."</p>
<p>At the same time it would a good idea to clarify whether locally-declared union and enum types fall within the definition of "schema types" (I think they should do so.)</p>
</div></details></div>
<div class="toot" id="closed-342"><h2>Issue #342 closed<span class="toot-id"> #closed-342</span></h2><div class="pubdate">14 Feb at 17:24:35 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/342">https://github.com/qt4cg/qtspecs/pull/342</a></div><p>Issue318 meta elements</p></div>
<div class="toot" id="minutes-02-14"><h2>QT4 CG meeting 022 draft minutes<span class="toot-id"> #minutes-02-14</span></h2><div class="pubdate">14 Feb at 17:12:00 GMT</div><div class="link">Link: <a href="https://qt4cg.org/meeting/minutes/2023/02-14">https://qt4cg.org/meeting/minutes/2023/02-14</a></div><p>Draft minutes published.</p></div>
<div class="toot" id="closed-338"><h2>Issue #338 closed<span class="toot-id"> #closed-338</span></h2><div class="pubdate">09 Feb at 17:30:02 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/338">https://github.com/qt4cg/qtspecs/pull/338</a></div><p>Add ednote per action QT4CG-016-02</p></div>
<div class="toot" id="created-344"><h2>Pull request #344 created<span class="toot-id"> #created-344</span></h2><div class="pubdate">09 Feb at 17:06:56 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/344">https://github.com/qt4cg/qtspecs/pull/344</a></div><details><summary>Issue 22: allow "for"/"let" keyword to be repeated in XPath</summary><div class="markup"><p>Addresses the proposal in issue 22 to allow repetition of the "let" or "for" keyword in a ForExpr or LetExpr. (It does not, however, allow "for" and "let" to be mixed).</p>
</div></details></div>
<div class="toot" id="created-343"><h2>Issue #343 created<span class="toot-id"> #created-343</span></h2><div class="pubdate">09 Feb at 12:47:25 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/343">https://github.com/qt4cg/qtspecs/issues/343</a></div><details><summary>$collation argument: Unification</summary><div class="markup"><p>In the function set of the XQFO current specification, the type of the <code>$collation</code> parameter is sometimes <code>xs:string</code> and sometimes <code>xs:string?</code>, depending on the position of the parameter. Examples:</p>
<h4>Mandatory</h4>
<pre><code class="language-xquery">fn:distinct-values($values as&nbsp;xs:anyAtomicType*, $collation as fn:default-collation())&nbsp;as&nbsp;xs:anyAtomicType*
fn:index-of($input | as&nbsp;xs:anyAtomicType*, $search | as&nbsp;xs:anyAtomicType, $collation as&nbsp;xs:string)&nbsp;as&nbsp;xs:integer*
</code></pre>
<h4>Optional</h4>
<pre><code class="language-xquery">fn:sort($input as&nbsp;item()*, $collation as&nbsp;xs:string?, $key as&nbsp;function(item()) as xs:anyAtomicType*
fn:lowest($input as item()*, $collation as xs:string?, $key as&nbsp;function(item()) as xs:anyAtomicType*)&nbsp;as&nbsp;item()*
</code></pre>
<p>I think we should always allow an empty sequence.</p>
</div></details></div>
<div class="toot" id="created-342"><h2>Pull request #342 created<span class="toot-id"> #created-342</span></h2><div class="pubdate">09 Feb at 12:27:01 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/342">https://github.com/qt4cg/qtspecs/pull/342</a></div><details><summary>Issue318 meta elements</summary><div class="markup"><p>Revises the rules for serializing meta elements to take account of new HTML5 syntax.</p>
<p>Resolves issue #318</p>
</div></details></div>
<div class="toot" id="closed-18"><h2>Issue #18 closed<span class="toot-id"> #closed-18</span></h2><div class="pubdate">09 Feb at 11:01:40 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/18">https://github.com/qt4cg/qtspecs/issues/18</a></div><p>[DM31] Function types do not form a hierarchy</p></div>
<div class="toot" id="closed-58"><h2>Issue #58 closed<span class="toot-id"> #closed-58</span></h2><div class="pubdate">08 Feb at 16:20:16 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/58">https://github.com/qt4cg/qtspecs/issues/58</a></div><p>[XQuery] String Value Templates</p></div>
<div class="toot" id="closed-107"><h2>Issue #107 closed<span class="toot-id"> #closed-107</span></h2><div class="pubdate">08 Feb at 16:11:07 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/107">https://github.com/qt4cg/qtspecs/issues/107</a></div><p>Allow self::(a|b|c)</p></div>
<div class="toot" id="closed-234"><h2>Issue #234 closed<span class="toot-id"> #closed-234</span></h2><div class="pubdate">08 Feb at 11:45:42 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/234">https://github.com/qt4cg/qtspecs/issues/234</a></div><p>If Without Else</p></div>
<div class="toot" id="closed-330"><h2>Issue #330 closed<span class="toot-id"> #closed-330</span></h2><div class="pubdate">08 Feb at 08:35:16 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/330">https://github.com/qt4cg/qtspecs/pull/330</a></div><p>Update fn:parse-html to apply review feedback.</p></div>
<div class="toot" id="created-341"><h2>Issue #341 created<span class="toot-id"> #created-341</span></h2><div class="pubdate">08 Feb at 01:50:08 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/341">https://github.com/qt4cg/qtspecs/issues/341</a></div><details><summary>[XPath] Error-free selection operator for maps or arrays, or finite-domain functions</summary><div class="markup"><p>In March 2021 Jarno Elovirta raised on the <strong><em>#general channel</em></strong> of the XML.com Slack the problem that the existing map or array lookup operator "<strong>?</strong>" prevents a free traversal of a nested mapp/array object. For example, this expression results in error:</p>
<pre><code class="language-xq">[
  map {"k0": 1}, 
  map{"k0": [1, 2, 3]}
]  ?* ?("k0")  ?*
</code></pre>
<p><strong>[XPTY0004] Input of lookup operator must be map or array: 1.</strong></p>
<hr>
<p>There are three possible types of reaction to this problem:</p>
<ol>
<li>
<p>Do nothing</p>
</li>
<li>
<p>Relax the semantics of the map/array lookup operator "<strong>?</strong>" so that it can be applied on items of non-map/non-array type and in such case produce the empty sequence.</p>
</li>
<li>
<p>Introduce a similar operator to "<strong>?</strong>" that will behave as it, but instead of producing an error when applied on items of non-map/non-array type it produces the empty sequence.</p>
</li>
</ol>
<p>Obviously, we are not advocating the 1st choice above, or otherwise we wouldn't be raising any issue 😄</p>
<p>Choice 2 could be implemented, but this would have a few drawbacks:</p>
<ul>
<li>it would bring a certain degree of backwards incompatibility</li>
<li>"silently returning nothing" is really difficult to debug or even notice unexpected results, as pointed out by @michaelhkay</li>
</ul>
<p><strong>This proposal is to choose alternative 3. above</strong>.</p>
<p>Why is it better than the 2nd one?</p>
<ul>
<li>No incompatibility can be introduced, as this is a new operator.</li>
<li>The user has intentionally chosen this operator over the "?" operator, and this means that the user is well aware of the new, sometimes tricky to observe/explain/debug behavior, but the user doesn't mind these effects and is ready to deal with them.</li>
</ul>
<h2>Definition</h2>
<p>By definition the operator <strong>"-&gt;"</strong> with left-hand-side any expression <strong><em>E</em></strong> and right-hand-side a literal string  <strong><em>X</em></strong>:</p>
<p>&nbsp;&nbsp;&nbsp;<strong><code>E -&gt; X</code></strong></p>
<p>is lexically expanded to:</p>
<p>&nbsp;&nbsp;&nbsp;<strong><code>E[. instance of map(*) or . instance of array(*)]?X </code></strong></p>
<h2>Example</h2>
<p>With the original expression provided by Jarno Elovirta, but now using the <strong>"-&gt;"</strong> operator:</p>
<pre><code class="language-xq">[
  map {"k0": 1}, 
  map{"k0": [1, 2, 3]}
]  -&gt;* -&gt;("k0")  -&gt;*
</code></pre>
<p>its evaluation produces the expected result (all the values within just one of the leaves of the tree), and no error:</p>
<p><strong><code>1, 2, 3</code></strong></p>
<p>That is, <strong><code>1 -&gt;*</code></strong>  produces the empty sequence and no error.</p>
<p><strong>Note</strong>:</p>
<p>Of course, the above example can be rewritten to this equivalent XPath 3.0 expression and will get the wanted result, but literally no one, myself included, will ever write this:</p>
<pre><code class="language-xq">[
 map {"k0": 1}, 
 map{"k0": [1, 2, 3]}
] [. instance of map(*) or . instance of array(*)]      ?*
           [. instance of map(*) or . instance of array(*)]      ?k0
                                [. instance of map(*) or . instance of array(*)]   ?*
</code></pre>
<p><img src="https://user-images.githubusercontent.com/10605892/217432167-5f7fbff0-3d8d-48a3-a27d-5f62cb77c3dc.png" alt="image"></p>
<h2>Thus <strong><em><code>this is all about making it possible/feasible and empowering our users!</code></em></strong></h2>
</div></details></div>
<div class="toot" id="created-340"><h2>Issue #340 created<span class="toot-id"> #created-340</span></h2><div class="pubdate">07 Feb at 22:02:07 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/340">https://github.com/qt4cg/qtspecs/issues/340</a></div><details><summary>fn:format-number: Specifying decimal format</summary><div class="markup"><p>It would be nice if the decimal format for <code>fn:format-number</code> could also be supplied via an additional argument. The current syntax is:</p>
<pre><code class="language-xquery">(: result: 12.345,67 :)
declare decimal-format de decimal-separator = ',' grouping-separator = '.';

format-number(
  value := 12345.67,
  picture := '#.##0,00',
  decimal-format-name := 'de'
)
</code></pre>
<p>The syntax could be enhanced as follows:</p>
<pre><code class="language-xquery">format-number(
  value := 12345.67,
  picture := '#.##0,00',
  format := map { 'decimal-separator': ',', 'grouping-separator': '.' }
)
</code></pre>
<p>If both <code>decimal-format-name</code> and <code>format</code> are supplied, an error should be raised.</p>
<p><strong>Edit 2023-05-02, adopted from a comment further below:</strong></p>
<p>Next, language-specific default settings would be sensible. The existing syntax could be used:</p>
<pre><code class="language-xquery">format-number(12345.67, '#.##0,00', 'de')
</code></pre>
<p>As known from the other functions for formatting numbers and dates, it could be up to the implementation to decide which languages are supported. The defaults could be overwritten by custom decimal-format declarations in the prolog to ensure that a setting is applied, even if an implementation does not support it.</p>
</div></details></div>
<div class="toot" id="minutes-02-07"><h2>QT4 CG meeting 021 draft minutes<span class="toot-id"> #minutes-02-07</span></h2><div class="pubdate">07 Feb at 17:20:00 GMT</div><div class="link">Link: <a href="https://qt4cg.org/meeting/minutes/2023/02-07">https://qt4cg.org/meeting/minutes/2023/02-07</a></div><p>Draft minutes published.</p></div>
<div class="toot" id="created-339"><h2>Issue #339 created<span class="toot-id"> #created-339</span></h2><div class="pubdate">07 Feb at 13:46:57 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/339">https://github.com/qt4cg/qtspecs/issues/339</a></div><details><summary>The constraints on document-uri are too...constraining</summary><div class="markup"><p>The XPath data model imposes the following constraints on the document-uri property:</p>
<blockquote>
<p>If the <code>document-uri</code> is not the empty sequence, then the following constraint must hold: the node returned by evaluating <code>fn:doc()</code> with the document-uri as its argument must return the document node that provided the value of the <code>document-uri</code> property.</p>
<p>In other words, for any Document Node <code>$arg</code>, either <code>fn:document-uri($arg)</code> must return the empty sequence or <code>fn:doc(fn:document-uri($arg))</code> must return <code>$arg</code>.</p>
</blockquote>
<p>This contraint turns out to be inconvenient whenever the larger environment doesn’t enforce a 1:1 mapping between URIs and documents.</p>
<p>For example, in a browser context, a JavaScript function that returns different versions of the same document over time cannot identify those documents with the same document-uri.</p>
<p>In XProc, a <code>p:add-attribute</code> step that returns a copy of its input document with one additional attribute, cannot identify the output document with the same document-uri as the input document.</p>
<p>Given that the document URI is often necessary to evaluate relative URI references within a document, the constraints imposed in the data model are too strict.</p>
</div></details></div>
<div class="toot" id="created-338"><h2>Pull request #338 created<span class="toot-id"> #created-338</span></h2><div class="pubdate">07 Feb at 13:33:27 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/338">https://github.com/qt4cg/qtspecs/pull/338</a></div><details><summary>Add ednote per action QT4CG-016-02</summary><div class="markup"><p>This is a purely editorial change. Unless someone objects over the next few days, I'm just going to merge it in.</p>
</div></details></div>
<div class="toot" id="agenda-02-07"><h2>QT4 CG meeting 021 draft agenda<span class="toot-id"> #agenda-02-07</span></h2><div class="pubdate">04 Feb at 15:09:00 GMT</div><div class="link">Link: <a href="https://qt4cg.org/meeting/agenda/2023/02-07">https://qt4cg.org/meeting/agenda/2023/02-07</a></div><p>Draft agenda published.</p></div>
<div class="toot" id="created-337"><h2>Issue #337 created<span class="toot-id"> #created-337</span></h2><div class="pubdate">02 Feb at 00:52:31 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/337">https://github.com/qt4cg/qtspecs/issues/337</a></div><details><summary>Local union and enum types: and the definition of generalised atomic types</summary><div class="markup"><p>We need to review the proposed specs for local union and enum types, and decide whether or not to proceed with them.</p>
<p>I note that the definitions of <strong>generalized atomic type</strong> and <strong>pure union type</strong> say they must be "schema-defined", which appears to exclude locally-defined union and enum types.</p>
<p>I wonder if the definition of local enum types should be aligned more closely with an XSD type derived from xs:string by restricting with an enum facet. Now that we allow down-casting in the coercion rules, the objections to this seem to disappear.</p>
<p><code>cast</code> and <code>castable</code> should also probably pay more attention to these types.</p>
</div></details></div>
<div class="toot" id="created-336"><h2>Pull request #336 created<span class="toot-id"> #created-336</span></h2><div class="pubdate">01 Feb at 12:48:05 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/336">https://github.com/qt4cg/qtspecs/pull/336</a></div><details><summary>Action QT4CG-019-01 (type of $pattern in fn:tokenize())</summary><div class="markup"><p>Also, update the fos:history record for a number of functions.</p>
</div></details></div>
<div class="toot" id="closed-308"><h2>Issue #308 closed<span class="toot-id"> #closed-308</span></h2><div class="pubdate">01 Feb at 12:13:58 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/308">https://github.com/qt4cg/qtspecs/pull/308</a></div><p>Improve the legends in the diagrams</p></div>
<div class="toot" id="closed-335"><h2>Issue #335 closed<span class="toot-id"> #closed-335</span></h2><div class="pubdate">01 Feb at 12:13:57 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/335">https://github.com/qt4cg/qtspecs/pull/335</a></div><p>Rework type hierarchy diagrams as styled lists</p></div>
<div class="toot" id="created-335"><h2>Pull request #335 created<span class="toot-id"> #created-335</span></h2><div class="pubdate">01 Feb at 12:13:50 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/335">https://github.com/qt4cg/qtspecs/pull/335</a></div><details><summary>Rework type hierarchy diagrams as styled lists</summary><div class="markup"><p>Close #308</p>
<p>This proposal was accepted at meeting 020 on 31 January 2023.</p>
<p>The PR won't format correctly because there are style changes, so I'm just going to merge this. I have fixed the diagrams in both the data model specification and f&amp;o.</p>
</div></details></div>
<div class="toot" id="closed-205"><h2>Issue #205 closed<span class="toot-id"> #closed-205</span></h2><div class="pubdate">01 Feb at 10:18:56 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/205">https://github.com/qt4cg/qtspecs/issues/205</a></div><p>Make higher-order-function support mandatory</p></div>
<div class="toot" id="closed-221"><h2>Issue #221 closed<span class="toot-id"> #closed-221</span></h2><div class="pubdate">01 Feb at 10:18:37 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/221">https://github.com/qt4cg/qtspecs/issues/221</a></div><p>Expose op:same-key() as a user-visible function</p></div>
<div class="toot" id="closed-324"><h2>Issue #324 closed<span class="toot-id"> #closed-324</span></h2><div class="pubdate">01 Feb at 10:17:52 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/324">https://github.com/qt4cg/qtspecs/pull/324</a></div><p>Proposed syntax and semantics for string templates</p></div>
<div class="toot" id="closed-326"><h2>Issue #326 closed<span class="toot-id"> #closed-326</span></h2><div class="pubdate">01 Feb at 10:17:34 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/326">https://github.com/qt4cg/qtspecs/pull/326</a></div><p>Issue 205: make support for higher-order functions mandatory</p></div>
<div class="toot" id="closed-319"><h2>Issue #319 closed<span class="toot-id"> #closed-319</span></h2><div class="pubdate">01 Feb at 10:17:21 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/319">https://github.com/qt4cg/qtspecs/pull/319</a></div><p>Issue 221: op:same-key becomes fn:atomic-equal</p></div>
<div class="toot" id="created-334"><h2>Issue #334 created<span class="toot-id"> #created-334</span></h2><div class="pubdate">01 Feb at 09:17:02 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/334">https://github.com/qt4cg/qtspecs/issues/334</a></div><details><summary>Transient properties: a new approach to deep selection and update in maps and arrays</summary><div class="markup"><p>After exploring many alternatives, I have come to the conclusion that we can't solve the problem of deep navigation and transformation of JSON structures without a data model change.</p>
<p>Most of the problems boil down to this: JSON trees do not have parent pointers, therefore after navigating down to a leaf node of the tree, we cannot get any information from higher up the tree. The solution to this (the "zipper" model) is to retain transient information about how a particular node in the tree was reached, so that we can retrace our steps and revisit nodes that were passed en route.</p>
<p>The change I propose is quite minor, but powerful: Any XDM value can be augmented with a set of transient properties represented as a set of key-value pairs. These properties are ignored (and typically dropped) by all operations on a value, except where otherwise specified. For the purpose of exposition, I'll use the syntax <code>$value¶name</code> to refer to the transient <code>name</code> property of <code>$value</code>.</p>
<p>We'll change the semantics of <code>map:get()</code> and <code>array:get()</code>, and the associated lookup operators, so that the resulting values have transient properties indicating how they were selected. For example, given</p>
<p><code>let $name := $person?firstName</code></p>
<p>the resulting value (perhaps the string "Michael") will be augmented with transient properties</p>
<ul>
<li>¶parent - the map from which the value was selected (retaining its own transient properties if any)</li>
<li>¶key - the key used to make the selection, here "firstName"</li>
</ul>
<p>and derived properties:</p>
<ul>
<li>¶ancestors - the transitive closure of ¶parent</li>
<li>¶root - the last ¶ancestor</li>
<li>¶path - a string representation of the path used to select the value</li>
</ul>
<p>We can also define other "downward selection" operations such as <code>map:find</code>, and <code>array:foot</code> to retain these transient properties. So for example <code>map:find($json, 'firstname')[.='Michael']¶parent?surname</code> now finds the surnames of anyone named 'Michael', at any depth of the tree.</p>
<p>If we turn back to the use cases in my 2016 paper on transforming JSON</p>
<p>https://www.saxonica.com/papers/xmlprague-2016mhk.pdf</p>
<p>The first use case (bulk update) relied on matching items expressed in XML as</p>
<p><code>match="map[array[@key='tags']/string='ice']/number[@key='price']/text()"</code></p>
<p>which couldn't be done in JSON because of the inability to match based on ancestor context. With the new transient properties we can match this as</p>
<p><code>match="type(xs:integer)[¶key = 'price'][¶parent?tags?* = 'ice']"</code></p>
<p>In the second use case (hierarchic inversion), we can again get properties of parent or ancestor maps</p>
<p><code>$students ! map:put("course", ¶parent?name)</code></p>
<p>I think we can also use this to define deep update operations. But I'll leave that investigation until later.</p>
<p>Note: transient properties potentially have many other applications, for example we might use them to solve our problems with <code>document-uri()</code>. But exploring that would be a distraction here. The nice thing about transient properties is that they give a lot of potential for augmenting existing functionality with full backwards compatibility, because we can define existing operations to return results with additional transient properties that all existing operations will ignore. If we were so minded, for example, we could have different functions/operators return "quiet NaN" and "signalling NaN" by adding a transient property to the NaN value returned.</p>
</div></details></div>
<div class="toot" id="created-333"><h2>Issue #333 created<span class="toot-id"> #created-333</span></h2><div class="pubdate">01 Feb at 00:34:41 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/333">https://github.com/qt4cg/qtspecs/issues/333</a></div><details><summary>Equality of function items</summary><div class="markup"><p>The question of equality of function items arises in the discussion of determinism of functions and memo functions in XSLT - see F&amp;O 3.1 section 1.7.4, and came up again today in the context of fn:deep-equal.</p>
<p>1.7.4 makes a brave attempt to describe situations under which two functions are "identical", though leaving implementations room for flexibility. I think we can build on this and improve it, by describing more situations in which the result is predictable.</p>
<p>The data model describes the properties of a function item, and we can say that two function items are equivalent if all their properties are the same.</p>
<p>The properties that cause problems are the "implementation" and the "closure", and in both cases I think we can find ways of doing a comparison.</p>
<p>For the implementation, we can define this by reference to the way in which the implementation property is set. For function items constructed by reference to static functions (e.g. <code>my:func#3</code> or <code>function-lookup(my:func, 3)</code>) then they have the same implementation if and only if they are constructed by reference to the same static function. Similarly for function items constructed by evaluating an inline function expression. Other ways of constructing a function item, such as partial application, essentially create a new function with the same implementation as an existing function and a different closure.</p>
<p>For the closure (ignoring for the moment functions that include parts of the dynamic context in their closure), this is essentially just a set of variable bindings and it's not too difficult to say that functions are identical if these sets of variable bindings are identical.</p>
</div></details></div>
<div class="toot" id="created-332"><h2>Issue #332 created<span class="toot-id"> #created-332</span></h2><div class="pubdate">31 Jan at 18:51:03 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/332">https://github.com/qt4cg/qtspecs/issues/332</a></div><details><summary>Add a namespace uris option to fn:path</summary><div class="markup"><p>The output of <code>fn;path</code> using namespaces is very verbose as it is specified to use the <code>Q{uri}name</code> syntax. It would be useful if it was extended to take a namespace prefix to uri map.</p>
<ol>
<li>Add a second <code>$namespaces</code> parameter that has the type <code>map(union(xs:NCName, enum('')), xs:anyURI)</code> (the same as fn:in-scope-namespaces) -- this will have a default value of <code>map{}</code> to preserve the existing behaviour.</li>
<li>If the namespace uri is in the map, use the given prefix. If that prefix is "" then just use the local name.</li>
<li>If the namespace uri is not in the map, use the <code>Q{uri}name</code> syntax.</li>
</ol>
<p>This allows for things like <code>fn:path($e, namespaces := fn:in-scope-namespaces())</code>.</p>
</div></details></div>
<div class="toot" id="created-331"><h2>Issue #331 created<span class="toot-id"> #created-331</span></h2><div class="pubdate">31 Jan at 18:43:14 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/331">https://github.com/qt4cg/qtspecs/issues/331</a></div><details><summary>Extend fn:path to support arrays and maps.</summary><div class="markup"><p>Currently, <code>fn:path</code> is defined for nodes. This means it is not possible to use it with arrays or maps (e.g. to determine the path to a JSON item when a comparison fails).</p>
<p>As such, I recommend:</p>
<ol>
<li>changing the type to <code>item()</code></li>
<li>If the value is a node use the current logic.</li>
<li>If the value is in an array, use <code>?n</code> where n is the nth item of the array where the item is located.</li>
<li>If the value is in a map, use <code>?name</code> or <code>?"name"</code> where name is the key name of the map where the item is located.</li>
<li>If the value is an atomic item, or the root of a map/array structure, use <code>.</code>.</li>
</ol>
<p>Example: <code>.?4?user?name</code></p>
</div></details></div>
<div class="toot" id="minutes-01-31"><h2>QT4 CG meeting 020 draft minutes<span class="toot-id"> #minutes-01-31</span></h2><div class="pubdate">31 Jan at 17:12:00 GMT</div><div class="link">Link: <a href="https://qt4cg.org/meeting/minutes/2023/01-31">https://qt4cg.org/meeting/minutes/2023/01-31</a></div><p>Draft minutes published.</p></div>
<div class="toot" id="created-330"><h2>Pull request #330 created<span class="toot-id"> #created-330</span></h2><div class="pubdate">31 Jan at 12:56:33 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/330">https://github.com/qt4cg/qtspecs/pull/330</a></div><details><summary>Update fn:parse-html to apply review feedback.</summary><div class="markup"><p>This PR applies the following review comments:</p>
<ul>
<li>[x] QT4CG-016-03: RD to add a note clarifying “known character encoding”</li>
<li>[x] QT4CG-016-04: RD to add a note clarifying the “<em>”/”</em>” html/version combination</li>
<li>[x] QT4CG-016-05: RD to add a “todo” noting the dependency on keyword arguments</li>
<li>[x] QT4CG-016-06: RD to reword the introduction to mapping to clarify who’s doing the mapping</li>
<li>[ ] QT4CG-016-08: RD to clarify how namespace comparisons are performed.</li>
<li>[x] QT4CG-016-09: RD to add a note stating that the local name should always be lowercase</li>
<li>[x] QT4CG-016-10: RD to consider how to clarify parsed entity parsing.</li>
</ul>
</div></details></div>
<div class="toot" id="created-329"><h2>Issue #329 created<span class="toot-id"> #created-329</span></h2><div class="pubdate">30 Jan at 11:45:03 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/329">https://github.com/qt4cg/qtspecs/issues/329</a></div><details><summary>Keyword parameters: Error codes</summary><div class="markup"><p>I’ve read the current specification twice, and I have checked the existing qt4 tests, but I’m still confused by the exact meaning of the new error codes for keyword arguments, <code>XPST0141</code> and <code>XPST0142</code>. Things are getting particularly tricky if we consider partial function applications.</p>
<p>My proposal would be to simplify the current approach and:</p>
<ol>
<li>use the existing error code <code>XPST0017</code> for all cases in which a function cannot be chosen as the available arguments (both positional and keyword-based) don’t match the function definition, and</li>
<li>only raise a new error code (<code>XPST0141</code>, possibly) if a keyword argument has been specified more than once (as this can be done without checking the function definitions).</li>
</ol>
</div></details></div>
<div class="toot" id="created-328"><h2>Issue #328 created<span class="toot-id"> #created-328</span></h2><div class="pubdate">30 Jan at 10:05:00 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/328">https://github.com/qt4cg/qtspecs/issues/328</a></div><details><summary>Switch Cases: Lift single-item restriction on operands</summary><div class="markup"><h2>Motivation</h2>
<p><a href="https://www.w3.org/TR/xquery-31/#id-switch">XQuery switch cases</a> have a peculiar restriction: The operand of a single case must yield an empty sequence or a single item. There seem to be no (obvious) reasons why this restriction exists, so I believe we should lift it and allow arbitrary sequences.</p>
<p>A similar extension is planned for Java 12 (<a href="http://openjdk.java.net/jeps/325">JEP 325: Switch Expressions</a>). The required changes in XQuery are simpler, though, as the 3.1 grammar already supports arbitrary expressions as operands.</p>
<h2>Examples</h2>
<pre><code class="language-xquery">switch($value)
  case 1
  case 2
  case 3
  case 4
  case 5
    return 'small'
  default
    return 'big'
</code></pre>
<p>Proposed syntax:</p>
<pre><code class="language-xquery">switch($value)
  case 1 to 5
    return 'small'
  default
    return 'big'
</code></pre>
<h2>Required Changes</h2>
<p>The <a href="https://www.w3.org/TR/xquery-31/#id-switch">current matching rules</a> could be rephrased as follows:</p>
<ol>
<li>The SwitchCaseOperand is evaluated.</li>
<li>The resulting value is atomized.</li>
<li>The case matches if the value is empty and if the value of the switch expression is empty as well.</li>
<li>Otherwise, the atomized value of the switch operand expression is compared with each item of the atomized value of the SwitchCaseOperand using <code>fn:deep-equal</code>, with the default collation from the static context.</li>
</ol>
<h2>References</h2>
<ul>
<li>Original Proposal: https://github.com/expath/xpath-ng/pull/12</li>
<li>Discussion on Slack: https://xmlcom.slack.com/archives/C011NLXE4DU/p1675006336963479</li>
</ul>
</div></details></div>
<div class="toot" id="agenda-01-31"><h2>QT4 CG meeting 020 draft agenda<span class="toot-id"> #agenda-01-31</span></h2><div class="pubdate">30 Jan at 08:47:00 GMT</div><div class="link">Link: <a href="https://qt4cg.org/meeting/agenda/2023/01-31">https://qt4cg.org/meeting/agenda/2023/01-31</a></div><p>Draft agenda published.</p></div>
<div class="toot" id="created-327"><h2>Issue #327 created<span class="toot-id"> #created-327</span></h2><div class="pubdate">30 Jan at 08:42:45 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/327">https://github.com/qt4cg/qtspecs/issues/327</a></div><details><summary>Tokenisation</summary><div class="markup"><p>The rule in A.2</p>
<blockquote>
<p>When tokenizing, the longest possible match that is consistent with the EBNF is used.</p>
</blockquote>
<p>needs clarifying. It could be read as suggesting that if taking the longest match turns out to lead to a syntax error, the tokenisation should be re-attempted using a shorter match. I don't think that has ever been intended. So what exactly does the qualifier "that is consistent with the EBNF" actually mean?</p>
<p>Possibly related, A.2.2 Terminal Delimitation states:</p>
<blockquote>
<p>Terminal symbols that are not used exclusively in [/* ws: explicit */] productions are of two kinds: delimiting and non-delimiting.</p>
</blockquote>
<p>But (at least in the XQuery version) the list of delimiting tokens includes a number that are indeed used exclusively in ws:explicit productions, for example a number of tokens containing back-ticks, and <code>]]&gt;</code>.</p>
<p>I think we need to be clearer that tokens used in ws:explicit productions are recognised only when parsing the production that uses them. For example given the expression <code>A[B[C]]&gt;3</code>, we should not recognise <code>]]&gt;</code> as a token under the longest-token rule. I think that's probably what the "consistent with the EBNF" rule is intended to convey.</p>
</div></details></div>
<div class="toot" id="created-326"><h2>Pull request #326 created<span class="toot-id"> #created-326</span></h2><div class="pubdate">29 Jan at 22:45:46 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/326">https://github.com/qt4cg/qtspecs/pull/326</a></div><p>Issue 205: make support for higher-order functions mandatory</p></div>
<div class="toot" id="created-325"><h2>Issue #325 created<span class="toot-id"> #created-325</span></h2><div class="pubdate">29 Jan at 22:03:56 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/325">https://github.com/qt4cg/qtspecs/issues/325</a></div><details><summary>Operator precedence table needs updating</summary><div class="markup"><p>The <code>otherwise</code> and <code>-&gt;</code> operators (and maybe others) are missing from the non-normative precedence table in Appendix A.4.</p>
</div></details></div>
<div class="toot" id="created-324"><h2>Pull request #324 created<span class="toot-id"> #created-324</span></h2><div class="pubdate">29 Jan at 18:23:31 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/324">https://github.com/qt4cg/qtspecs/pull/324</a></div><details><summary>Proposed syntax and semantics for string templates</summary><div class="markup"><p>See issue #58.</p>
<p>I would recommend reviewing the XQuery version of the spec first, since it contains additional notes contrasting string templates and the existing string constructors. The section on string constructors has moved, but is unchanged except for the addition of this note.</p>
</div></details></div>
<div class="toot" id="created-323"><h2>Issue #323 created<span class="toot-id"> #created-323</span></h2><div class="pubdate">27 Jan at 21:56:32 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/323">https://github.com/qt4cg/qtspecs/issues/323</a></div><details><summary>add select attribute to xsl:text</summary><div class="markup"><p>Although xsl:text select="socks" would be the same as xsl:value-of select="socks" in implementation terms, users of XSLT 2 and later, even people who have been using XSLT 2 or 3 for some time, are often surprised to learn that xsl:value-of makes a text node, and that they need to use xsl:sequence to return something else.</p>
<p>So it'd be great to have them use xsl:text instead of xsl:value-of, where text nodes are wanted, because then introducing xsl:sequence is a small step.</p>
<p>Of course, beginners also often use value-of where they should be using apply-templates, e.g. to handle mixed content! But again, using xsl:text reduces that temptation.</p>
<p>We do have value templates now, <a href="xsl:text">xsl:text</a>{ .... }&lt;/xsl:text&gt;, which mitigates the need slightly, but i think only slightly, because the select= analogy is very compelling.</p>
</div></details></div>
<div class="toot" id="created-322"><h2>Issue #322 created<span class="toot-id"> #created-322</span></h2><div class="pubdate">26 Jan at 10:10:12 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/322">https://github.com/qt4cg/qtspecs/issues/322</a></div><details><summary>Map construction in XSLT: xsl:record instruction</summary><div class="markup"><p>Constructing maps in XSLT often involves code rather like this:</p>
<pre><code>            &lt;xsl:map&gt;
               &lt;xsl:map-entry key="'author'" select="string(AUTHOR)"/&gt;
               &lt;xsl:map-entry key="'title'" select="string(TITLE)"/&gt;
               &lt;xsl:map-entry key="'price'" select="xs:decimal(PRICE)"/&gt;
               &lt;xsl:map-entry key="'publisher'" select="string(../@name)"/&gt;
           &lt;/xsl:map&gt;
</code></pre>
<p>The alternative using XPath is also rather ugly:</p>
<pre><code>&lt;xsl:sequence select="map{'author': string(AUTHOR),
                                                 'title':string(TITLE), 
                                                 'price': xs:decimal(PRICE), 
                                                 'publisher':string(../@name)}"/&gt;
</code></pre>
<p>(the fact  that it is creating a map doesn't stand out; the <code>xsl:sequence</code> is a distraction because there's no sequence involved; and many users dislike long multi-line XPath expressions because of formatting problems in their editing tools)</p>
<p>I propose a new instruction xsl:record which allows:</p>
<pre><code>            &lt;xsl:record author="string(AUTHOR)"
                                title="string(TITLE)" 
                                price="xs:decimal(PRICE)" 
                                publisher="string(../@name)"/&gt;
</code></pre>
<p>This is rather like literal result elements in that the attributes are user-defined rather than system-defined. Unlike LREs, the values are general expressions rather than AVTs, because the values are not necessarily strings. The instruction can only be used where the keys (field names) take the form of NCNames.</p>
<p>If variable entries are required, or entries whose keys are not NCNames, they can appear as child instructions:</p>
<pre><code>            &lt;xsl:record author="string(AUTHOR)"
                                title="string(TITLE)" 
                                price="xs:decimal(PRICE)" 
                                publisher="string(../@name)"&gt;
              &lt;xsl:if test="@private"&gt;
                  &lt;xsl:map-entry name="'private entry'" select="true()"/&gt;
              &lt;/xsl:if&gt;
          &lt;/xsl:record&gt;
</code></pre>
<p>Follow the tradition of LREs, duplicates are resolved as "last one wins".</p>
<p>If "standard attributes" such as <code>[xsl:]version</code> are required, they must be in the XSLT namespace, as with LREs.</p>
</div></details></div>
<div class="toot" id="created-321"><h2>Issue #321 created<span class="toot-id"> #created-321</span></h2><div class="pubdate">26 Jan at 04:12:06 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/321">https://github.com/qt4cg/qtspecs/issues/321</a></div><details><summary>relax $input in fn:serialize</summary><div class="markup"><p>Relevant specifications:
https://qt4cg.org/specifications/xpath-functions-40/Overview-diff.html#func-serialize</p>
<p>Would it be possible to relax the strictures on <code>$input</code> (first parameter) of <code>fn:serialize()</code>?</p>
<ol>
<li>The specifications do not explicitly forbid <code>map(*)</code> or <code>array(*)</code> as input, but in practice, when these are supplied, Saxon rejects them. Developers (or at least this one) who work with arrays and maps often need to render them in string output or messages, if only for diagnostics. If there is something really prohibitively wrong with those two items as input to <code>fn:serialize()</code>, then the specifications should say so.</li>
<li>Attributes are forbidden, but it is unclear why. They get serialized fine in the context of a parent, why not alone?</li>
<li>Namespace nodes are forbidden; see previous point.</li>
</ol>
<p>(No doubt there must have been discussion on points 2-3, but the rationale is not clear from the specs.)</p>
<p>Perhaps the question is that the details of what the serialization should look like is contestable. I think the answer there is simply, pick one. I think we'll happily live with whatever is chosen.</p>
<p>For the serialization of maps and arrays, I'll point as one possible model my <a href="https://github.com/textalign/TAN-2021/blob/9d2215e36da1f64bddad9daddfc5aa2242e17c81/functions/maps/TAN-fn-maps-extended.xsl#L58">tan:map-to-xml()</a> and <a href="https://github.com/textalign/TAN-2021/blob/9d2215e36da1f64bddad9daddfc5aa2242e17c81/functions/arrays/TAN-fn-arrays-extended.xsl#L66">tan:array-to-xml()</a>, which have been indispensable for daily troubleshooting.</p>
</div></details></div>
<div class="toot" id="created-320"><h2>Pull request #320 created<span class="toot-id"> #created-320</span></h2><div class="pubdate">25 Jan at 18:58:47 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/320">https://github.com/qt4cg/qtspecs/pull/320</a></div><details><summary>Issue 98 - add options parameter to fn:deep-equal</summary><div class="markup"><p>This proposal adds an options parameter to fn:deep-equal, giving much more detailed control over how the comparison is performed (while remaining backwards compatible by default).</p>
<p>This proposal is a first draft and I would request careful review, it's not one to pass through "on the nod".</p>
</div></details></div>
<div class="toot" id="created-319"><h2>Pull request #319 created<span class="toot-id"> #created-319</span></h2><div class="pubdate">25 Jan at 16:20:34 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/319">https://github.com/qt4cg/qtspecs/pull/319</a></div><details><summary>Issue 221: op:same-key becomes fn:atomic-equal</summary><div class="markup"><p>The proposal renames op:same-key as fn:atomic-equal, thus making it directly available to applications.</p>
</div></details></div>
<div class="toot" id="closed-294"><h2>Issue #294 closed<span class="toot-id"> #closed-294</span></h2><div class="pubdate">25 Jan at 14:56:17 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/294">https://github.com/qt4cg/qtspecs/issues/294</a></div><p>fn:remove removing multiple items</p></div>
<div class="toot" id="created-318"><h2>Issue #318 created<span class="toot-id"> #created-318</span></h2><div class="pubdate">25 Jan at 11:36:27 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/318">https://github.com/qt4cg/qtspecs/issues/318</a></div><details><summary>Serialization HTML/XHTML output methods: meta elements and the charset attribute</summary><div class="markup"><p>HTML5 introduces the ability to write</p>
<p><code>&lt;meta charset="utf-8"/&gt;</code></p>
<p>in place of</p>
<p><code>&lt;meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/&gt;</code></p>
<p>The serialization spec (for HTML and XHTML output methods) ignores this.</p>
<p>(a) it requires the serializer to add a <code>meta</code> element in the second form rather than the first.</p>
<p>(b) when removing existing <code>meta</code> elements, it requires the second form to be deleted, but not the first. This may result in invalid (X)HTML in which both elements are present.</p>
</div></details></div>
<div class="toot" id="closed-309"><h2>Issue #309 closed<span class="toot-id"> #closed-309</span></h2><div class="pubdate">24 Jan at 17:20:48 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/309">https://github.com/qt4cg/qtspecs/pull/309</a></div><p>Drop ternary conditionals, as agreed on 2023-01-17</p></div>
<div class="toot" id="closed-310"><h2>Issue #310 closed<span class="toot-id"> #closed-310</span></h2><div class="pubdate">24 Jan at 17:20:32 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/310">https://github.com/qt4cg/qtspecs/pull/310</a></div><p>Fix outstanding issues from PR 304</p></div>
<div class="toot" id="closed-312"><h2>Issue #312 closed<span class="toot-id"> #closed-312</span></h2><div class="pubdate">24 Jan at 17:20:13 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/312">https://github.com/qt4cg/qtspecs/pull/312</a></div><p>Minor editorial improvements</p></div>
<div class="toot" id="closed-313"><h2>Issue #313 closed<span class="toot-id"> #closed-313</span></h2><div class="pubdate">24 Jan at 17:19:16 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/313">https://github.com/qt4cg/qtspecs/pull/313</a></div><p>Issue 294: fn:remove()</p></div>
<div class="toot" id="created-317"><h2>Issue #317 created<span class="toot-id"> #created-317</span></h2><div class="pubdate">24 Jan at 17:16:34 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/317">https://github.com/qt4cg/qtspecs/issues/317</a></div><details><summary>fn:format-integer: $lang → $language ?</summary><div class="markup"><p>A minor inconsistency in the XQFO specification: The third parameter of <code>fn:format-integer</code> is named <code>$lang</code>…</p>
<p>https://qt4cg.org/specifications/xpath-functions-40/Overview-diff.html#func-format-integer</p>
<p>…whereas all other language parameters are named <code>$language</code>.</p>
</div></details></div>
<div class="toot" id="minutes-01-24"><h2>QT4 CG meeting 019 draft minutes<span class="toot-id"> #minutes-01-24</span></h2><div class="pubdate">24 Jan at 17:11:00 GMT</div><div class="link">Link: <a href="https://qt4cg.org/meeting/minutes/2023/01-24">https://qt4cg.org/meeting/minutes/2023/01-24</a></div><p>Draft minutes published.</p></div>
<div class="toot" id="created-316"><h2>Issue #316 created<span class="toot-id"> #created-316</span></h2><div class="pubdate">23 Jan at 16:23:37 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/316">https://github.com/qt4cg/qtspecs/issues/316</a></div><details><summary>Function fn:differences</summary><div class="markup"><p>I didn't see any issues thread devoted <code>fn:differences()</code>, so am opening this one. Please respond with xrefs to anything relevant.</p>
<p>Draft here:
https://qt4cg.org/specifications/xpath-functions-40/Overview.html#func-differences</p>
<p>IMO, this function seems overly complicated for both users and implementors. The specs provide difficult reading. But it is the first function to try to address the desideratum for differencing. Something like it is needed methinks.</p>
<p>My suggestion would be to simplify the function as a straightforward string comparison, i.e., change the signature to something like <code>fn:differences($input1 as xs:string, $input2 as xs:string) as OUTPUT</code> where <code>OUTPUT</code> is either a tree structure (like the output of <code>fn:analyze-string()</code>) or a sequence of records (e.g., <code>(is-in-1 as xs:boolean, is-in-2 as xs:boolean, fragment as xs:string)</code>).</p>
<p>Such a change would make the function more tractable for both users and implementers. The user, would need to cast each sequence to a string, and in so doing will be able to (be compelled to) make fine-grained decisions on things such as normalization. Processor implementers have far simpler input, and they can choose the difference algorithm that makes best sense at the moment.</p>
<p>One counterargument might be that the resultant output would be difficult to correlate to the original sequences. Ostensibly, one wants to do things such as decide whether to drop certain items in sequence 1 or sequence 2. My response is that the current draft results in output that suffers from the same problem. Navigating the map to correlate it to the original sequence sounds daunting. With my suggestion, there are ways around this, through auxiliary functions or arity expansions that normalize the output.</p>
<p>But I don't want to get postprocessing output here, which would be tangential to the main question, i.e., how <code>fn:differences()</code> should be constructed in a way conducive to both users and implementers.</p>
</div></details></div>
<div class="toot" id="closed-311"><h2>Issue #311 closed<span class="toot-id"> #closed-311</span></h2><div class="pubdate">23 Jan at 11:46:17 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/311">https://github.com/qt4cg/qtspecs/pull/311</a></div><p>Stylesheet fix to mark optional fields in record definitions</p></div>
<div class="toot" id="closed-62"><h2>Issue #62 closed<span class="toot-id"> #closed-62</span></h2><div class="pubdate">21 Jan at 00:16:24 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/62">https://github.com/qt4cg/qtspecs/issues/62</a></div><p>[FO] The parameter types for fn:unique and array:partition are incorrectly specified.</p></div>
<div class="toot" id="closed-71"><h2>Issue #71 closed<span class="toot-id"> #closed-71</span></h2><div class="pubdate">21 Jan at 00:14:10 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/71">https://github.com/qt4cg/qtspecs/issues/71</a></div><p>[XSLT] Use of multiple predicates: order of evaluation</p></div>
<div class="toot" id="closed-171"><h2>Issue #171 closed<span class="toot-id"> #closed-171</span></h2><div class="pubdate">20 Jan at 23:44:17 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/171">https://github.com/qt4cg/qtspecs/issues/171</a></div><p>XPath ternary conditional operator</p></div>
<div class="toot" id="created-315"><h2>Issue #315 created<span class="toot-id"> #created-315</span></h2><div class="pubdate">18 Jan at 14:58:00 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/315">https://github.com/qt4cg/qtspecs/issues/315</a></div><details><summary>fn:transform inconsistency: initial-mode</summary><div class="markup"><p>The <code>fn:transform</code> specification in F+O says that if no initial-mode is supplied, the unnamed mode is used.</p>
<p>The XSLT 3.0 specification says that if no initial mode is supplied, then the default mode is used if one has been specified, or the unnamed mode is used if not.</p>
<p>I think the XSLT 3.0 spec should win here: it makes more sense if a default has been declared that it should actually be used.</p>
<p>(Thanks to Amanda Galtman for pointing this out.)</p>
</div></details></div>
<div class="toot" id="created-314"><h2>Issue #314 created<span class="toot-id"> #created-314</span></h2><div class="pubdate">18 Jan at 09:24:52 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/314">https://github.com/qt4cg/qtspecs/issues/314</a></div><details><summary>Basic Operations on Maps and Arrays</summary><div class="markup"><h1>Manipulating Arrays and Maps</h1>
<p>This is an outline of proposed new facilities designed to make processing of maps and arrays easier. The basic facilities needed for transformation of maps and arrays are the ability to decompose them into their parts, manipulate the parts, and the compose new arrays and maps from these parts.</p>
<p>Further background is in my 2022 Balisage paper, https://balisage.net/Proceedings/vol27/html/Kay01/BalisageVol27-Kay01.html</p>
<p>This proposal considers only the "shallow" operations on maps and arrays. Further proposals for deep search and update of nested structures are to be expected.</p>
<h2>Basics</h2>
<p>A map entry is an item used to represent a key-value pair in a map; it is an item of type <code>record(key as xs:anyAtomicType, value as item()*)</code>, aliased in this proposal as <code>type(map-entry)</code>.</p>
<p>Note: <em>an alternative representation for key-value pairs is as a singleton map, and that's the representation used by the existing map:entry() function and by the xsl:map-entry instruction. A representation as <code>record(key, value)</code> is rather more convenient to enable extraction of the key and value, but does create some compatibility issues...</em></p>
<p>An array entry is an item used to represent a member of an array; it is an item of type <code>record(value as item()*)</code>, aliased in this proposal as <code>type(array-entry)</code>.</p>
<h2>Decomposing Maps and Arrays</h2>
<p>The function <code>map:entries($map)</code> returns a sequence of map entries, in unpredictable order, representing the contents of the supplied map. It is equivalent to <code>map:for-each($map, -&gt;($k, $v){map:entry($k, $v)})</code>.</p>
<p>The function <code>array:entries($array)</code> returns a sequence of array entries, in array order, representing the members of the supplied array. It is equivalent to <code>array:for-each($array, -&gt;($v){array:entry($v)})</code>.</p>
<h2>Constructing Maps and Arrays</h2>
<p>The function <code>map:of($entries as type(map-entry)*) as map(*)</code> constructs a map from a sequence of map entries. A second parameter, <code>$options</code>, is available to control handling of duplicates, as with <code>map:merge()</code>. The function is equivalent to <code>map:merge($entries!map{'key':?key, 'value':?value})</code>.</p>
<p>The function <code>array:of($entries as type(array-entry)*) as array(*)</code> constructs an array from a sequence of array entries. It is equivalent to <code>array:fold-left($entries, [], array:append#2)</code>.</p>
<p>The function <code>map:entry($key, $value) as type(map-entry)</code> is equivalent to <code>map{'key':$key, 'value':$value}</code>. <em>Problem: we already have a function map:entry() in 3.1 that does something different. Need to change the terminology...</em></p>
<p>The function <code>array:entry($value) as type(array-entry)</code> is equivalent to <code>map{'value':$value}</code>.</p>
<h2>Filtering Maps and Arrays</h2>
<p>The construct <code>$map?[PREDICATE]</code> is equivalent to <code>map:of(map:entries($map)[PREDICATE])</code>. For example, given a map in which the keys are dates, <code>$map?[year-from-date(?key)=2023]</code> returns a map containing those entries in which the key is a date in 2023.</p>
<p>The construct <code>$array?[PREDICATE]</code> is equivalent to <code>array:of(array:entries($array)[PREDICATE])</code>. For example, <code>$array?[1]</code> selects the first item in the array (as a single-member array), while <code>$array?[exists(?value)]</code> returns an array containing all those entries in the input array that are not empty. If <code>$array</code> is an array of maps, then <code>$array?[?value?name='John']</code> selects those members of the array that are maps having <code>?name='John'</code>.</p>
<h2>Mapping Maps and Arrays</h2>
<p>The construct <code>$map!!EXPR</code> evaluates <code>EXPR</code> once for each entry in <code>$map</code> and returns the result as a flattened sequence. For example <code>map:of($map!!map:entry(?key, ?value+1))</code> returns a map in which each value has been incremented by one.</p>
<p>The construct <code>$array!!EXPR</code> evaluates <code>EXPR</code> once for each entry in <code>$array</code>, and returns the result as a flattened sequence. For example, <code>array:of($array!!array:entry(?value+1))</code> returns an array in which every value has been incremented by one.</p>
<h2>FLWOR Expressions</h2>
<p>The for-member clause <code>for member $m in $array</code> is equivalent to <code>for $sys:var in array:entries($array) let $m := $sys:var?value</code>.</p>
<p>The for-entry clause <code>for entry ($k, $v) in $map</code> is equivalent to <code>for $sys:var in map:entries($map) let $k := $sys:var?key, $v := $sys:var?value</code>.</p>
<h2>XSLT</h2>
<p>Iteration over maps and arrays is achieved using <code>&lt;xsl:for-each select="array:entries()"&gt;</code> and <code>&lt;xsl:for-each select="map:entries()"&gt;</code> directly.</p>
<p>Construction of maps uses the existing instructions <code>&lt;xsl:map&gt;</code> and <code>&lt;xsl:map-entry&gt;</code>. There is an inconvenience here in that the <code>&lt;xsl:map-entry&gt;</code> instruction returns a singleton map (<code>map{key:value}</code>) rather than a map entry as defined in this proposal (<code>map{'key':key, 'value':value}</code>)..</p>
<p>Construction of arrays uses the new instructions <code>&lt;xsl:array&gt;</code> and <code>&lt;xsl:array-entry&gt;</code>. The <code>xsl:array-entry</code> instruction is defined to construct an array entry as defined in this proposal.</p>
<h2>Use Cases</h2>
<p>To be supplied.</p>
</div></details></div>
<div class="toot" id="created-313"><h2>Pull request #313 created<span class="toot-id"> #created-313</span></h2><div class="pubdate">17 Jan at 22:53:06 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/313">https://github.com/qt4cg/qtspecs/pull/313</a></div><details><summary>Issue 294: fn:remove()</summary><div class="markup"><p>Allow remove() to remove several items, aligning it with array:remove() and map:remove()</p>
</div></details></div>
<div class="toot" id="created-312"><h2>Pull request #312 created<span class="toot-id"> #created-312</span></h2><div class="pubdate">17 Jan at 22:25:54 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/312">https://github.com/qt4cg/qtspecs/pull/312</a></div><details><summary>Minor editorial improvements</summary><div class="markup"><ul>
<li>Issue 300 (clarification about results being normalized)</li>
<li>Action QT4CG-018-02 (explaining signature notation)</li>
<li>Action QT4CG-018-04 (explaining numeric predicates on ancestor unions)</li>
</ul>
</div></details></div>
<div class="toot" id="created-311"><h2>Pull request #311 created<span class="toot-id"> #created-311</span></h2><div class="pubdate">17 Jan at 21:39:32 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/311">https://github.com/qt4cg/qtspecs/pull/311</a></div><p>Stylesheet fix to mark optional fields in record definitions</p></div>
<div class="toot" id="created-310"><h2>Pull request #310 created<span class="toot-id"> #created-310</span></h2><div class="pubdate">17 Jan at 21:27:45 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/310">https://github.com/qt4cg/qtspecs/pull/310</a></div><details><summary>Fix outstanding issues from PR 304</summary><div class="markup"><p>See https://github.com/qt4cg/qtsp…ecs/pull/304#issuecomment-1378532583 - but excluding item 3 because that's a stylesheet change.</p>
</div></details></div>
<div class="toot" id="created-309"><h2>Pull request #309 created<span class="toot-id"> #created-309</span></h2><div class="pubdate">17 Jan at 19:20:00 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/309">https://github.com/qt4cg/qtspecs/pull/309</a></div><details><summary>Drop ternary conditionals, as agreed on 2023-01-17</summary><div class="markup"><p>We agreed today to drop ternary conditional expressions from the proposal; this PR implements that change.</p>
</div></details></div>
<div class="toot" id="minutes-01-17"><h2>QT4 CG meeting 018 draft minutes<span class="toot-id"> #minutes-01-17</span></h2><div class="pubdate">17 Jan at 16:15:00 GMT</div><div class="link">Link: <a href="https://qt4cg.org/meeting/minutes/2023/01-17">https://qt4cg.org/meeting/minutes/2023/01-17</a></div><p>Draft minutes published.</p></div>
<div class="toot" id="closed-286"><h2>Issue #286 closed<span class="toot-id"> #closed-286</span></h2><div class="pubdate">17 Jan at 17:14:46 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/286">https://github.com/qt4cg/qtspecs/pull/286</a></div><p>Spec changes to allow child::(a|b|c) - Issue 107</p></div>
<div class="toot" id="closed-290"><h2>Issue #290 closed<span class="toot-id"> #closed-290</span></h2><div class="pubdate">17 Jan at 17:14:01 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/290">https://github.com/qt4cg/qtspecs/pull/290</a></div><p>Fix issue #18 (function type hierarchy)</p></div>
<div class="toot" id="closed-35"><h2>Issue #35 closed<span class="toot-id"> #closed-35</span></h2><div class="pubdate">17 Jan at 17:13:37 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/35">https://github.com/qt4cg/qtspecs/issues/35</a></div><p>[FO]The `union ( | )`, `itersect`, `except`  and `combine (,)` operators are not mentioned in the F &amp; O. Have not the best categorization in the XPath spec.</p></div>
<div class="toot" id="closed-288"><h2>Issue #288 closed<span class="toot-id"> #closed-288</span></h2><div class="pubdate">17 Jan at 17:13:36 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/288">https://github.com/qt4cg/qtspecs/issues/288</a></div><p>Error in fn:path specification</p></div>
<div class="toot" id="closed-257"><h2>Issue #257 closed<span class="toot-id"> #closed-257</span></h2><div class="pubdate">17 Jan at 17:13:36 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/257">https://github.com/qt4cg/qtspecs/issues/257</a></div><p>Improving the styling/presentation/prepresentation of the record types in the F&amp;O spec</p></div>
<div class="toot" id="closed-70"><h2>Issue #70 closed<span class="toot-id"> #closed-70</span></h2><div class="pubdate">17 Jan at 17:13:35 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/70">https://github.com/qt4cg/qtspecs/issues/70</a></div><p>[FO] Built-in function changes to support default values</p></div>
<div class="toot" id="closed-291"><h2>Issue #291 closed<span class="toot-id"> #closed-291</span></h2><div class="pubdate">17 Jan at 17:13:35 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/291">https://github.com/qt4cg/qtspecs/issues/291</a></div><p>DTD validity of F&amp;O spec</p></div>
<div class="toot" id="closed-304"><h2>Issue #304 closed<span class="toot-id"> #closed-304</span></h2><div class="pubdate">17 Jan at 17:13:34 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/304">https://github.com/qt4cg/qtspecs/pull/304</a></div><p>Mike's content changes from PR 292</p></div>
<div class="toot" id="closed-284"><h2>Issue #284 closed<span class="toot-id"> #closed-284</span></h2><div class="pubdate">17 Jan at 17:12:56 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/284">https://github.com/qt4cg/qtspecs/pull/284</a></div><p>Add grammar for "if (test) then {expr}" with no else</p></div>
<div class="toot" id="created-308"><h2>Pull request #308 created<span class="toot-id"> #created-308</span></h2><div class="pubdate">15 Jan at 17:05:08 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/308">https://github.com/qt4cg/qtspecs/pull/308</a></div><details><summary>Improve the legends in the diagrams</summary><div class="markup"><p>This PR completes my action QT4CG-015-03: NW to make sure the direction of the arrow is in the legends</p>
<p>I also made sure the legends aren't too wide. I still have more work to do for the other actions.</p>
</div></details></div>
<div class="toot" id="closed-259"><h2>Issue #259 closed<span class="toot-id"> #closed-259</span></h2><div class="pubdate">15 Jan at 16:46:57 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/259">https://github.com/qt4cg/qtspecs/pull/259</a></div><p>Issue #74 - add the fn:parse-html function</p></div>
<div class="toot" id="agenda-01-17"><h2>QT4 CG meeting 018 draft agenda<span class="toot-id"> #agenda-01-17</span></h2><div class="pubdate">15 Jan at 15:30:00 GMT</div><div class="link">Link: <a href="https://qt4cg.org/meeting/agenda/2023/01-17">https://qt4cg.org/meeting/agenda/2023/01-17</a></div><p>Draft agenda published.</p></div>
<div class="toot" id="closed-306"><h2>Issue #306 closed<span class="toot-id"> #closed-306</span></h2><div class="pubdate">15 Jan at 16:17:10 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/306">https://github.com/qt4cg/qtspecs/pull/306</a></div><p>fn:char - editors actions from 2023-01-10</p></div>
<div class="toot" id="created-307"><h2>Issue #307 created<span class="toot-id"> #created-307</span></h2><div class="pubdate">15 Jan at 15:42:30 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/307">https://github.com/qt4cg/qtspecs/issues/307</a></div><details><summary>Parsing and building URIs comments and queries</summary><div class="markup"><ol>
<li>fn:build-uri states:</li>
</ol>
<blockquote>
<p>If the scheme key is present in the map, the URI begins with the value of that key concatenated with //, otherwise it begins //.</p>
</blockquote>
<p>a. Shouldn't the concatenation be <code>://</code> so e.g. <code>http</code> becomes <code>http://</code>?
b. How are non-heirarchical schemes handled like <code>urn</code>, and <code>mailto</code>?</p>
<ol start="2">
<li>RFC 3986 allows IPv6 and IPvFuture addresses that contain <code>:</code> characters, e.g. <code>http://[::1]:80</code>.</li>
</ol>
<p>My understanding of fn:parse-uri is that this will fail to parse.</p>
<ol start="3">
<li>RFC 3986 states that for userinfo, the <code>user:password</code> form is deprecated.</li>
</ol>
<p>Browsers will reject this due to the security risk, and the RFC suggests that applications should not render the password (the part after the <code>:</code>) in clear text. -- Should fn:build-uri follow suite, or (along with fn:parse-uri) have an option to control the behaviour (keep, remove, invalid), where if the option is invalid, it will throw an fn:error?</p>
<ol start="4">
<li>RFC 3986 suggests that the port should be omitted if it matches the default for the scheme</li>
</ol>
<p>Should fn:build-uri have this behaviour?</p>
</div></details></div>
<div class="toot" id="created-306"><h2>Pull request #306 created<span class="toot-id"> #created-306</span></h2><div class="pubdate">10 Jan at 21:23:26 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/306">https://github.com/qt4cg/qtspecs/pull/306</a></div><details><summary>fn:char - editors actions from 2023-01-10</summary><div class="markup"><p>Changes to the new fn:char function (issue #121) as follows:</p>
<ul>
<li>Action QT4CG-017-01 clarifies the definition of formats #nnn and #xnnn.</li>
<li>Action QT4CG-017-02 changes the order of the rules</li>
<li>In discussion it was asked whether any HTML5 entity names refer to strings comprising more than one character. On investigation it appears that they do, and the spec has been revised to allow for this.</li>
<li>added history/status information</li>
</ul>
</div></details></div>
<div class="toot" id="closed-121"><h2>Issue #121 closed<span class="toot-id"> #closed-121</span></h2><div class="pubdate">10 Jan at 17:20:20 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/121">https://github.com/qt4cg/qtspecs/issues/121</a></div><p>[FO] fn:nl, fn:tab, fn:cr</p></div>
<div class="toot" id="minutes-01-10"><h2>QT4 CG meeting 017 draft minutes<span class="toot-id"> #minutes-01-10</span></h2><div class="pubdate">10 Jan at 16:20:00 GMT</div><div class="link">Link: <a href="https://qt4cg.org/meeting/minutes/2023/01-10">https://qt4cg.org/meeting/minutes/2023/01-10</a></div><p>Draft minutes published.</p></div>
<div class="toot" id="closed-261"><h2>Issue #261 closed<span class="toot-id"> #closed-261</span></h2><div class="pubdate">10 Jan at 17:19:36 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/261">https://github.com/qt4cg/qtspecs/pull/261</a></div><p>Proposed fn:char function - see issue 121</p></div>
<div class="toot" id="created-305"><h2>Issue #305 created<span class="toot-id"> #created-305</span></h2><div class="pubdate">09 Jan at 17:50:13 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/305">https://github.com/qt4cg/qtspecs/issues/305</a></div><details><summary>parse-xml() and whitespace stripping</summary><div class="markup"><p>There seems to be nothing in either the XSLT spec or in F+O that says explicitly whether stylesheet-defined space stripping rules (xsl:strip-space and xsl:preserve-space) apply to documents loaded using <code>fn:parse-xml</code> (or, by extension, <code>parse-html</code>).</p>
<p>The spec says that these rules apply to "source trees" defined as "any tree provided as input to the transformation. This includes the document containing the [global context item] if any, documents containing nodes present in the [initial match selection], documents containing nodes supplied as the values of [stylesheet parameters], documents obtained from the results of functions such as [document], [doc], and [collection]...".</p>
<p>I guess one reasonable interpretation is that the "such as" includes <code>parse-xml()</code>. But it goes rather against the grain that the behaviour of parse-xml() should be affected by the containing stylesheet declarations, when there is no mention of such a context-dependency in the function specification; in this, parse-xml() is rather different from doc() which deliberately says very little about how the XDM instance returned relates to the URI supplied as input.</p>
</div></details></div>
<div class="toot" id="closed-292"><h2>Issue #292 closed<span class="toot-id"> #closed-292</span></h2><div class="pubdate">09 Jan at 09:43:27 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/292">https://github.com/qt4cg/qtspecs/pull/292</a></div><p>Merge signatures with optional params</p></div>
<div class="toot" id="created-304"><h2>Pull request #304 created<span class="toot-id"> #created-304</span></h2><div class="pubdate">09 Jan at 09:32:41 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/304">https://github.com/qt4cg/qtspecs/pull/304</a></div><details><summary>Mike's content changes from PR 292</summary><div class="markup"><p>I teased apart some of the omnibus PR #292. I've commited the schema and stylesheet changes. This PR covers the remaining prose changes.</p>
<p>Mike writes:</p>
<blockquote>
<p>I regret that this has turned into a bit of an omnibus PR. The main changes are:</p>
<ul>
<li>Fix validity issues with the function catalog and its schema (Issue 291)</li>
<li>Convert all functions to use a single signature with optional parameters (Issue 70)</li>
<li>Extend the function catalog to handle record definitions (Issue 257)</li>
<li>Fix the (trivial) bug with properties of fn:path (Issue 288)</li>
<li>Add introductory text concerning the handling of operators (Issue 35)</li>
</ul>
</blockquote>
<p>Fix #291
Fix #70
Fix #257
Fix #288
Fix #35</p>
</div></details></div>
<div class="toot" id="closed-303"><h2>Issue #303 closed<span class="toot-id"> #closed-303</span></h2><div class="pubdate">09 Jan at 07:38:47 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/303">https://github.com/qt4cg/qtspecs/pull/303</a></div><p>Mike's proposed schema and stylesheet changes</p></div>
<div class="toot" id="created-303"><h2>Pull request #303 created<span class="toot-id"> #created-303</span></h2><div class="pubdate">09 Jan at 07:32:02 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/303">https://github.com/qt4cg/qtspecs/pull/303</a></div><details><summary>Mike's proposed schema and stylesheet changes</summary><div class="markup"><p>These are the schema and stylesheet changes from PR #292. They don't break the build and on casual inspection they seem fine, so I'm just going to accept them.</p>
</div></details></div>
<div class="toot" id="agenda-01-10"><h2>QT4 CG meeting 017 draft agenda<span class="toot-id"> #agenda-01-10</span></h2><div class="pubdate">06 Jan at 16:02:00 GMT</div><div class="link">Link: <a href="https://qt4cg.org/meeting/agenda/2023/01-10">https://qt4cg.org/meeting/agenda/2023/01-10</a></div><p>Draft agenda published.</p></div>
<div class="toot" id="created-300"><h2>Issue #300 created<span class="toot-id"> #created-300</span></h2><div class="pubdate">06 Jan at 16:19:33 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/300">https://github.com/qt4cg/qtspecs/issues/300</a></div><details><summary>[F+O] Ambiguity regarding Unicode normalization (editorial)</summary><div class="markup"><p>In §1.7.1 the paragraph</p>
<blockquote>
<p>Unless explicitly stated, the xs:string values returned by the
functions in this document are not normalized in the sense of
[Character Model for the World Wide Web 1.0: Fundamentals].</p>
</blockquote>
<p>is a little bit ambiguous for my taste. By "are not normalized" it means "no action is taken to normalize the strings", it doesn't mean "the strings will not be in normalized form".</p>
<p>I suggest: "Unless explicitly stated, the functions in this document operate on strings as sequences of codepoints and do not attempt to convert input strings, or produce output strings, in Unicode normalized form. Unicode normalization occurs only when explicitly requested, for example by use of the <code>fn:normalize-unicode</code> function."</p>
<p>At the same time we might update the reference to point to "Character Model for the World Wide Web: String Matching", revised in 2021, though it is still only a Working Group Note. See https://www.w3.org/TR/charmod-norm/#unicodeNormalization</p>
</div></details></div>
<div class="toot" id="closed-281"><h2>Issue #281 closed<span class="toot-id"> #closed-281</span></h2><div class="pubdate">02 Jan at 18:12:42 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/281">https://github.com/qt4cg/qtspecs/issues/281</a></div><p>XPath: Short-circuiting Functions and Lazy Evaluation Hints</p></div>
<div class="toot" id="created-299"><h2>Issue #299 created<span class="toot-id"> #created-299</span></h2><div class="pubdate">02 Jan at 18:08:24 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/299">https://github.com/qt4cg/qtspecs/issues/299</a></div><details><summary>Short-circuiting functions, function-arity guards and lazy hints</summary><div class="markup"><h1><strong>I. Shortcutting and lazy hints</strong></h1>
<p>Let us have this expression:</p>
<pre><code class="language-xq">let $f := function($arg1 as item()*, $arg2 as item()*) as function(item()*) as item()*
             {  (: Some code here :) }
  return
    $f($x) ($y)
</code></pre>
<p>Evaluating&nbsp;<strong><code>$f($x)</code></strong>&nbsp;produces a function. The&nbsp;<strong>actual arity</strong>&nbsp;of this resulting function can be any number&nbsp;<strong><code>N &gt;= 0</code></strong> :</p>
<ul>
<li>
<p>If&nbsp;<strong><code>N &gt; 1</code></strong>&nbsp;there would be arity mismatch error, as only one argument&nbsp;<code>$y</code>&nbsp;is provided in the expression.</p>
</li>
<li>
<p>If&nbsp;<strong><code>N = 1</code></strong>&nbsp;the final function call can be evaluated, and the argument&nbsp;<code>$y</code>   must be evaluated,  or</p>
</li>
<li>
<p><strong>If <code>N = 0</code>, then  <code>$y</code> is unneeded and can safely be ignored</strong> according to the updated <strong>“<a href="https://qt4cg.org/pr/279/xquery-40/xpath-40.html#id-coercion-rules">Coercion Rules / Function Coercion</a>”</strong> in Xpath 4.0.</p>
</li>
</ul>
<p><strong>Because a possibility exists to be able to ignore the evaluation of&nbsp;<code>$y</code>, it is logical to delay the evaluation of&nbsp;<code>$y</code>&nbsp;until the actual arity of&nbsp;<code>$f($x)</code>&nbsp;is known</strong>.</p>
<p>The current XPath 4.0 evaluation rules do not require an implementation to base its decision whether or not to evaluate&nbsp;<code>$y</code> on the actual arity of the function produced by <code>$f($x)</code>, thus at present an implementation could decide to evaluate <code>$y</code> regardless of the actual arity of the function produced by <code>$f($x)</code>.</p>
<p><strong>This is where a&nbsp;<em>lazy</em>&nbsp;hint comes</strong>: it indicates to the XPath processor that <em><strong>it is logical to make the decision about evaluation of&nbsp;<code>$y</code>&nbsp;based on the actual arity of the function returned by&nbsp;<code>$f($x)</code></strong></em>.</p>
<p>A rewrite of the above expression using a <strong><em><em>lazy</em></em></strong>&nbsp;hint looks like this:</p>
<pre><code class="language-xq">let $f := function($arg1 as item()*, $arg2 as item()*) as function(item()*) as item()*
             {  (: Some code here :) }  
  return
    $f($x) (lazy $y)
</code></pre>
<p>Here is one example of a function with short-cutting and calling it with a <strong><em>lazy</em></strong> hint:</p>
<pre><code class="language-xq">let $fAnd := function($x as xs:boolean, $y as xs:boolean) as xs:boolean
             {
                let $partial := function($x as xs:boolean) as function(xs:boolean) as  xs:boolean
                                {
                                  if(not($x)) then -&gt;(){false()}
                                              else -&gt;($t) {$t}
                                }
                 return $partial($x)($y)
             }
  return
     $fAnd($x (: possibly false() :), lazy&nbsp;$SomeVeryComplexAndSlowComputedExpression)
</code></pre>
<p><strong>Without the <strong><em>lazy</em></strong>&nbsp;hint in the above example, it is perfectly possible that an XPath implementation, unrestricted by the current rules, would evaluate <em><code>$SomeVeryComplexAndSlowComputedExpression</code></em> - something that is unneeded and could be avoided completely</strong>.</p>
<h2>Formal syntax and semantics</h2>
<ol>
<li>
<p>The <strong><em>lazy</em></strong> keyword should immediately precede any argument in a function call. If specified, it means that <strong><em>it is logical to make the decision about evaluation of this argument based on the actual arity of the function in this function call</em></strong>.</p>
<p>Based on this definition, it follows that <strong><em><code>lazy $argK</code></em></strong> implies <strong><em>lazy</em></strong> for all arguments following <code>$argK</code> in the function call. Thus specifying more than one <strong><em>lazy</em></strong> hint within a given function call is redundant and an implementation may report this redundancy to the user.</p>
<p>The scope of a <strong><em>lazy</em></strong> keyword specified on an argument is this and all following arguments of (only) the current function call.</p>
</li>
<li>
<p>It is possible to specify a <strong><em>lazy</em></strong> keyword that is in force for the respective argument(s) of all function calls of the given function. To do this, the <strong><em>lazy</em></strong> keyword must  be  specified immediately preceding a parameter name in the function definition of that function.</p>
<p>For example, if the function <strong><code>$f</code></strong> is specified as:</p>
<pre><code class="language-xq">let $f := function($arg1 as item()*, lazy $arg2 as item()*, $arg3 as item()*, $arg4 as item()* ) 
          { (: some code here:) }
  return
     $someExpression
</code></pre>
<p>Then any call of <strong><code>$f</code></strong> in its definition scope that has the form:</p>
<pre><code class="language-xq">$f($x, $y, $z, $t)
</code></pre>
<p>is equivalent to:</p>
<pre><code class="language-xq">$f($x, lazy $y, $z, $t)
</code></pre>
</li>
<li>
<p>It is possible to specify the <strong><em>lazy</em></strong> keyword immediately preceding a function definition. This instructs the XPath processor that any call of this function is only necessary to be evaluated if the function is actually called during the evaluation of the expression that contains this function call.</p>
<p>For example:</p>
<pre><code class="language-xq">let $complexComputation := lazy function($x, $y) {$x + $y}, (: Make it as complex as you want ... :)
     $someCondition := function()
        {
            let $date := current-date()
              return
                  month-from-date($date) eq 2
                and 
                 day-from-date($date) eq 29 
       }
  return if($someCondition()) 
           then $complexComputation(2, 3)
           else 0
</code></pre>
<p>Specifying the <strong><em>lazy</em></strong> keyword in the function definition for <code>$complexComputation</code> can save significant computing resources, because the programmer knows that <code>$someCondition()</code> is true during only a single day in any 4-years period.</p>
</li>
</ol>
<h1><strong>II.fn:lazy</strong></h1>
<h2>Summary</h2>
<p>Applied on a single argument that can be any <em>expression</em>. Lazily returns its argument <em>expression</em>.</p>
<h2>Signature</h2>
<pre><code class="language-xq">lazy fn:lazy( 
        $expression as item()*
) as item()*
</code></pre>
<h2>Properties</h2>
<p>This function is <strong><em><a href="https://qt4cg.org/specifications/xpath-functions-40/Overview.html#dt-deterministic">deterministic</a></em></strong>, <strong><em><a href="https://qt4cg.org/specifications/xpath-functions-40/Overview.html#dt-context-independent">context-independent</a></em></strong>, <strong><em><a href="https://qt4cg.org/specifications/xpath-functions-40/Overview.html#dt-focus-independent">focus-independent</a></em></strong></p>
<h2>Rules</h2>
<p>The semantics of the function is strictly defined below:</p>
<pre><code class="language-xq">let $lazyFunction := lazy fn:identity#1
   return
      (: AnyExpression here :)
</code></pre>
<p>Any expression <strong><code>Q</code></strong> of the form:</p>
<p><strong><em><code>Q(E1, lazy(E2))</code></em></strong></p>
<p>where <strong><code>E1</code></strong> and <strong><code>E2</code></strong> are subexpressions of <strong><code>Q</code></strong>, must be evaluated by the Processor in two steps:</p>
<ol>
<li>
<p>Substitute the expression</p>
<p><strong><em><code>Q(E1, lazy(E2))</code></em></strong></p>
<p>with:</p>
<p><strong><em><code>Q(E1, ?) (lazy E2)</code></em></strong></p>
</li>
<li>
<p>Evaluate the latter according to the rules for a <strong><em>lazy</em></strong> argument</p>
</li>
</ol>
<h2>Example</h2>
<p>We can use almost the same example as above, but here <code>$complexComputation</code> is defined without the <strong><em>lazy</em></strong> keyword and thus is not a <strong><em>lazy</em></strong> function. To have <code>$complexComputation</code> evaluated lazily, we call the <code>lazy()</code> function, passing <code>$complexComputation</code>  to it:</p>
<pre><code class="language-xq">let $complexComputation := (: no lazy here :) function($x, $y) {$x + $y}, (: Make it as complex as you want ... :)
     $someCondition := function()
        {
            let $date := current-date()
              return
                  month-from-date($date) eq 2
                and 
                 day-from-date($date) eq 29 
       }
  return 
        $someCondition() and lazy( $complexComputation(2, 3))
</code></pre>
<p>Here the expression <strong><code>Q</code></strong> is:</p>
<p><strong><em><code>$someCondition() and lazy( $complexComputation(2, 3))</code></em></strong></p>
<p>This  is the same as:</p>
<p><strong><em><code>fn:op("and")($someCondition(), lazy( $complexComputation(2, 3))</code></em></strong></p>
<p>According to the Rules above, the processor converts this to:</p>
<p><strong><em><code>fn:op("and")($someCondition(), ?) (lazy( $complexComputation(2, 3)) )</code></em></strong></p>
<p><code>$someCondition()</code> is evaluated and if its value is <code>false()</code>,   then the expression to be evaluated is:</p>
<p><strong><em><code>fn:op("and")(false(), ?) (lazy( $complexComputation(2, 3)) )</code></em></strong></p>
<p>As <strong><em><code>fn:op("and")(false(), ?)</code></em></strong> by definition is <strong><em><code>function() {false()}</code></em></strong>. then the final result <strong><code>false()</code></strong> is produced and the unnecessary argument <strong><em><code>$complexComputation(2, 3)</code></em></strong> is not evaluated at all.</p>
<h1><strong>III. A function's arity is a guard for its arguments</strong></h1>
<p>Let us have a  function <strong><code>$f</code></strong> defined as below:</p>
<pre><code class="language-xq">let $f := function($arg1 as item()*, $arg2 as item()*, …, $argN as item()*)
   as function(item()*, item()*, …, item()*) as item()*
     {
       if($cond0($arg1))       then -&gt; () { 123 }
        else if($cond1($arg1)) then -&gt; ($Z1 as item()*) {$Z1}
        else if($cond2($arg1)) then -&gt; ($Z1 as item()*, $Z2 as item()*) {$Z1 + $Z2}
        (:    .        .        .        .         .        .        .         .  :)
        else if($condK($arg1)) then -&gt; ($Z1 as item()*, $Z2 as item()*, …, $Zk as item()*)
                                       {$Z1 + $Z2 + … + $Zk}
        else ()
     }
  return
     $f($y1, $y2, …, $yN) ($z1, $z2, …, $zk)
</code></pre>
<p>A call to <strong><code>$f</code></strong> returns a function whose arity may be any of the numbers: 0, 1, …, K.</p>
<p>Depending on the arity of the returned function (0, 1, …, K), the last (K, K-1,  K-2, …, 2, 1, 0) arguments of the function call:</p>
<p><strong><em><code>$f($y1, $y2,  .  .  . , $yN) ($z1, $z2, .  .  . , $zk)</code></em></strong></p>
<p><strong>are unneeded and it is logical that they would not need to be evaluated</strong>.</p>
<p><strong>So, the actual arity of the result of calling <strong><code>$f</code></strong> is a guard for the arguments of a call to this function-result</strong>.</p>
<p>Thus, one more bullet needs to be added to [2.4.5 Guarded Expressions] https://qt4cg.org/specifications/xquery-40/xpath-40.html#id-guarded-expressions), specifying an additional guard-type:</p>
<ul>
<li>In an expression of the type <code>E(A1, A2, ..., AN)</code> any of the arguments <code>A</code><sub>K</sub> is guarded by the condition
<code>actual-arity(E) ge K</code>. This rule has the consequence that if the actual arity of <code>E()</code> is less than <code>K</code> then if any argument <code>Am</code> (where <code>m &gt;= K</code>) is evaluated, this must not raise a dynamic error. An implementation may base on the actual arity of <code>E()</code> its decision for the evaluation of the arguments.</li>
</ul>
</div></details></div>
<div class="toot" id="created-298"><h2>Issue #298 created<span class="toot-id"> #created-298</span></h2><div class="pubdate">02 Jan at 15:36:58 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/298">https://github.com/qt4cg/qtspecs/issues/298</a></div><details><summary>Abstract supertype for map and array</summary><div class="markup"><p>I've been wondering whether there would be any mileage in introducing an abstract super type for map() and array(), perhaps called lookup(). This would basically treat an array as a map with integer keys.</p>
<p>This would allow a cleaner type signature for map:find() and any future functions such as xx:search() that work both on maps and arrays. It might simplify the description of the lookup operator "?". For functions that already exist in both the map and array namespaces, such as get(), we could introduce a unified function in the fn namespace with the cosmetic benefit of reducing the need for namespace prefixes and namespace declarations.</p>
<p>I'm still keen to find a better way of doing iteration, filtering, mapping, and construction of maps and arrays, and I think this might be a useful stepping stone.</p>
</div></details></div></div></article></main></body></html>