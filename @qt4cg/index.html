<!DOCTYPE HTML><html><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><meta charset="UTF-8"><meta http-equiv="x-ua-compatible" content="ie=edge"><meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1"><link rel="stylesheet" href="/css/status.css"><title>@qt4cg statuses</title></head><body><main><article><h1>@qt4cg statuses</h1><p>This page displays recent status
            updates
            about the QT4CG project.</p><p>The are also captured in <a href="status.rss">an RSS feed</a>.</p><p>By year: <a href="2023/">2023</a>, <a href="2022/">2022</a>, <a href="2021/">2021</a>, <a href="2020/">2020</a></p><div class="toots">
<div class="toot" id="closed-597"><h2>Issue #597 closed<span class="toot-id"> #closed-597</span></h2><div class="pubdate">11 Jul at 16:39:35 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/597">https://github.com/qt4cg/qtspecs/pull/597</a></div><p>Editorial fixes from #566</p></div>
<div class="toot" id="closed-588"><h2>Issue #588 closed<span class="toot-id"> #closed-588</span></h2><div class="pubdate">11 Jul at 16:39:21 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/588">https://github.com/qt4cg/qtspecs/issues/588</a></div><p>Incompleteness of xsl:sort specification</p></div>
<div class="toot" id="closed-595"><h2>Issue #595 closed<span class="toot-id"> #closed-595</span></h2><div class="pubdate">11 Jul at 16:39:20 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/595">https://github.com/qt4cg/qtspecs/pull/595</a></div><p>588: (Editorial, XSLT) minor clarifications regarding xsl:sort</p></div>
<div class="toot" id="closed-592"><h2>Issue #592 closed<span class="toot-id"> #closed-592</span></h2><div class="pubdate">11 Jul at 16:39:07 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/592">https://github.com/qt4cg/qtspecs/issues/592</a></div><p>XSLT §5.6 xsl:decimal-format - no explanation of exponent-separator</p></div>
<div class="toot" id="closed-594"><h2>Issue #594 closed<span class="toot-id"> #closed-594</span></h2><div class="pubdate">11 Jul at 16:39:06 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/594">https://github.com/qt4cg/qtspecs/pull/594</a></div><p>592: (XSLT, Editorial) Add missing description of exponent-separator</p></div>
<div class="toot" id="closed-591"><h2>Issue #591 closed<span class="toot-id"> #closed-591</span></h2><div class="pubdate">11 Jul at 16:38:53 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/591">https://github.com/qt4cg/qtspecs/issues/591</a></div><p>Show defaults in XSLT element templates</p></div>
<div class="toot" id="closed-593"><h2>Issue #593 closed<span class="toot-id"> #closed-593</span></h2><div class="pubdate">11 Jul at 16:38:52 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/593">https://github.com/qt4cg/qtspecs/pull/593</a></div><p>591: [XSLT, editorial] Add defaults to XSLT element syntax summaries</p></div>
<div class="toot" id="closed-343"><h2>Issue #343 closed<span class="toot-id"> #closed-343</span></h2><div class="pubdate">11 Jul at 16:38:18 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/343">https://github.com/qt4cg/qtspecs/issues/343</a></div><p>$collation argument: Unification</p></div>
<div class="toot" id="closed-590"><h2>Issue #590 closed<span class="toot-id"> #closed-590</span></h2><div class="pubdate">11 Jul at 16:38:17 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/590">https://github.com/qt4cg/qtspecs/pull/590</a></div><p>343: make $collation uniformly optional</p></div>
<div class="toot" id="closed-365"><h2>Issue #365 closed<span class="toot-id"> #closed-365</span></h2><div class="pubdate">11 Jul at 16:38:06 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/365">https://github.com/qt4cg/qtspecs/issues/365</a></div><p>switch, typeswitch: Optional braces</p></div>
<div class="toot" id="closed-587"><h2>Issue #587 closed<span class="toot-id"> #closed-587</span></h2><div class="pubdate">11 Jul at 16:38:05 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/587">https://github.com/qt4cg/qtspecs/pull/587</a></div><p>365: Allow braces in switch and typeswitch expressions</p></div>
<div class="toot" id="closed-586"><h2>Issue #586 closed<span class="toot-id"> #closed-586</span></h2><div class="pubdate">11 Jul at 16:37:49 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/586">https://github.com/qt4cg/qtspecs/pull/586</a></div><p>585: [Editorial] Rearrange text (and grammar) for dynamic function calls</p></div>
<div class="toot" id="closed-584"><h2>Issue #584 closed<span class="toot-id"> #closed-584</span></h2><div class="pubdate">11 Jul at 16:37:37 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/584">https://github.com/qt4cg/qtspecs/pull/584</a></div><p>Editorial: Correction to map:filter examples</p></div>
<div class="toot" id="closed-317"><h2>Issue #317 closed<span class="toot-id"> #closed-317</span></h2><div class="pubdate">11 Jul at 16:37:26 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/317">https://github.com/qt4cg/qtspecs/issues/317</a></div><p>fn:format-integer: $lang → $language ?</p></div>
<div class="toot" id="closed-578"><h2>Issue #578 closed<span class="toot-id"> #closed-578</span></h2><div class="pubdate">11 Jul at 16:37:24 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/578">https://github.com/qt4cg/qtspecs/pull/578</a></div><p>317: fn:format-integer: $lang → $language</p></div>
<div class="toot" id="closed-577"><h2>Issue #577 closed<span class="toot-id"> #closed-577</span></h2><div class="pubdate">11 Jul at 16:37:12 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/577">https://github.com/qt4cg/qtspecs/pull/577</a></div><p>Editorial: improve generator for keyword tests</p></div>
<div class="toot" id="closed-555"><h2>Issue #555 closed<span class="toot-id"> #closed-555</span></h2><div class="pubdate">11 Jul at 16:36:56 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/555">https://github.com/qt4cg/qtspecs/pull/555</a></div><p>464: Revised narrative of normalization steps for serialization</p></div>
<div class="toot" id="closed-547"><h2>Issue #547 closed<span class="toot-id"> #closed-547</span></h2><div class="pubdate">11 Jul at 16:35:32 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/547">https://github.com/qt4cg/qtspecs/pull/547</a></div><p>Action QT4CG-036-02: Further elaboration of the rules for function identity</p></div>
<div class="toot" id="closed-539"><h2>Issue #539 closed<span class="toot-id"> #closed-539</span></h2><div class="pubdate">11 Jul at 16:34:03 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/539">https://github.com/qt4cg/qtspecs/issues/539</a></div><p>FLOWR where clause with a "do when false" option</p></div>
<div class="toot" id="created-600"><h2>Issue #600 created<span class="toot-id"> #created-600</span></h2><div class="pubdate">10 Jul at 07:49:55 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/600">https://github.com/qt4cg/qtspecs/issues/600</a></div><details><summary>fn:decode-from-uri: counterpart of fn-encode-to-uri</summary><div class="markup"><p>Adopted from https://github.com/qt4cg/qtspecs/issues/566#issuecomment-1607397586:</p>
<p>The initial suggestion in #72 was to provide a function for decoding a URI. Maybe we should still think about adding a <code>fn:decode-uri</code> or <code>fn:decode-from-uri</code> function, in which we could tackle the open issues that need to be solved for <code>fn:parse-uri</code>. The current URI decoding rules could then be replaced with a reference to this new function.</p>
</div></details></div>
<div class="toot" id="created-599"><h2>Pull request #599 created<span class="toot-id"> #created-599</span></h2><div class="pubdate">09 Jul at 23:25:20 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/599">https://github.com/qt4cg/qtspecs/pull/599</a></div><details><summary>90: Simplified stylesheets with no xsl:version</summary><div class="markup"><p>Fix #90</p>
</div></details></div>
<div class="toot" id="closed-598"><h2>Issue #598 closed<span class="toot-id"> #closed-598</span></h2><div class="pubdate">09 Jul at 23:24:25 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/598">https://github.com/qt4cg/qtspecs/pull/598</a></div><p>Issue90 XSLT: simplified stylesheets with no xsl:version</p></div>
<div class="toot" id="created-598"><h2>Pull request #598 created<span class="toot-id"> #created-598</span></h2><div class="pubdate">09 Jul at 23:05:46 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/598">https://github.com/qt4cg/qtspecs/pull/598</a></div><details><summary>Issue90 XSLT: simplified stylesheets with no xsl:version</summary><div class="markup"><p>Fix #90. Allow simplified stylesheets with no xsl:version attribute (and therefore no XSL namespace declaration)</p>
</div></details></div>
<div class="toot" id="agenda-07-11"><h2>QT4 CG meeting 041 draft agenda<span class="toot-id"> #agenda-07-11</span></h2><div class="pubdate">07 Jul at 13:00:00 GMT</div><div class="link">Link: <a href="https://qt4cg.org/meeting/agenda/2023/07-11">https://qt4cg.org/meeting/agenda/2023/07-11</a></div><p>Draft agenda published.</p></div>
<div class="toot" id="created-597"><h2>Pull request #597 created<span class="toot-id"> #created-597</span></h2><div class="pubdate">07 Jul at 12:30:51 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/597">https://github.com/qt4cg/qtspecs/pull/597</a></div><details><summary>Editorial fixes from #566</summary><div class="markup"><p>This PR addresses some minor comments from issue #566. There are more substantive comments but I think they warrant discussion first.</p>
</div></details></div>
<div class="toot" id="created-596"><h2>Issue #596 created<span class="toot-id"> #created-596</span></h2><div class="pubdate">05 Jul at 07:45:57 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/596">https://github.com/qt4cg/qtspecs/issues/596</a></div><details><summary>Pinned values: Transforming Trees</summary><div class="markup"><h1>Pinned Values: Transforming JTrees</h1>
<p>This is a continuation of ideas raised in issue #341, issue #350, and elsewhere. It's related to the requirements presented in issue #262 and issue #297.</p>
<p>I have also presented ideas on transforming JSON trees at XML Prague and at Balisage, and I have tried out ideas over the years in Saxon extension functions. The proposal here owes a lot to those ideas, but consolidates them in a slightly different way.</p>
<p>I'll use the term JTree to refer to a tree structure of maps and arrays. The key difference between a JTree and a node tree (let's call it an XTree) is that the nodes in a JTree have no identity and no parent pointers.</p>
<p>As a result, some operations are remarkably difficult. Let's take one example:</p>
<p>Consider the JSON structure</p>
<pre><code>{ "cities": [
    {  "name" : "Paris",
       "size" : 300
    },
    {  "name" : "Berlin",
       "size" : 300
    }
]}
</code></pre>
<p>and suppose we want to return a modified version of this in which the size of Berlin is changed to 400. It would be nice to be able to write something like:</p>
<pre><code>modify($input, $input?cities[?name="Berlin"]?size, 400)
</code></pre>
<p>But of course, we can't do this. The result of the second argument is simply a number, 300, and we don't want to change all instances of the number 300 to 400, we only want to change one specific instance. Without value identity, the concept of "one specific instance" has no meaning.</p>
<p>I'll leave it as an exercise to the reader to work out how to do this transformation using our current XSLT and XQuery capabilities. It's far more difficult than it should be. In addition, the tree-walking approach in XSLT of applying template rules recursively is inefficient, because its cost typically depends on the size of the tree, not on the size of the modification. With immutable/persistent data structures underpinning XDM maps and arrays, it should be possible to perform this modification in constant time, regardless of the size of the tree.</p>
<p>My solution to this is that the expression in the second argument should return a <em>pinned value</em>. The pinned value behaves just like a plain integer 300 when used in operations such as arithmetic, but being pinned means that its location in the original JTree is retained, meaning that it becomes possible to replace it in the JTree with a different value.</p>
<h2>Data Model</h2>
<p>We need a change to the data model. Any value (any item or sequence) can have the property of being <em>pinned</em>. If a value is pinned, then it has a property called its <em>locus</em> which identifies its position within a JTree.</p>
<p>With a small number of exceptions, specifically noted below, the fact that a value is pinned and has a locus does not change the effect of any operations on the value. For example, the fact that an integer with value 300 is pinned does not change the result of any arithmetic or comparison operations on the number.</p>
<p>A <em>locus</em> may identify a value as being the root of a JTree, or it may identify its position within a JTree. In the latter case it has two basic properties called its <em>container</em> and its <em>slot</em>. The container is a pinned sequence, array, or map, and the slot identifies the value's position within the container: if the container is a sequence or an array, then the slot is an integer position; if the container is a map, then the slot is a key value.</p>
<h2>Operations on Pinned Values</h2>
<p>A value (any value) can be pinned as the root of a JTree using the function <code>fn:pin(value)</code>. This returns a value that is in every way identical to the original (including node identity, if it is a node or contains nodes) except for being pinned.</p>
<p>Some selected operations have their definition changed so that if the input is a pinned value, then the result is a pinned value. These are of two kinds:</p>
<ul>
<li>Operations that return an existing value unchanged generally retain the pinned property and the locus. For example if a value is bound to a variable, then the result of a variable reference will retain these properties.</li>
<li>Operations that select a value within a sequence, array, or map, when that sequence, array, or map is pinned, return a pinned value whose locus identifies the container and the value's slot within that container.</li>
</ul>
<p>So in the above example, if <code>$input</code> is pinned, the expression <code>$input?cities[?name="Berlin"]?size</code> returns an integer (300) whose locus is <code>(C, "size")</code>, where C is the map having name="Berlin". C in turn has a locus (A, 2) where A is the array of cities, and A has a locus (R, "cities") where R is the root of the JTree (the original <code>$input</code> value).</p>
<p>It now becomes possible to define the <code>modify</code> function as follows: The first argument is a value which must be pinned. The second argument must return a pinned value which must be within the tree identified by the first argument (that is, recursively finding the container must lead to this root). The result of the <code>modify()</code> function is formed by recursively replacing each container, all the way up to the root, with a new container in which the contents of the relevant slot are replaced.</p>
<h2>Feasibility</h2>
<p>Let's pause to ask ourselves two questions: is this reasonably feasible to implement, and is it realistically possible to expect users to understand what's going on?</p>
<h3>Implementation</h3>
<p>I've had an implementation of something rather similar in Saxon for years, and I don't think it's especially difficult. In effect we have a Java class <code>PinnedValue</code> which extends <code>Value</code> and which delegates nearly all operations (including "instance of") to a contained <code>Value</code>. The one thing you need to be careful of is assuming (for example) that if a value represents an XDM array, then it will be an instance of a Java class such as <code>XdmArray</code>. (The terminology in the current Saxon implementation is quite different, so don't expect to find this in the current code).</p>
<h3>Usability</h3>
<p>I think that basic features like the <code>modify()</code> function won't be too difficult to explain. We just have to explain that (a) you can only modify a JTree if the root is first pinned, and (b) the expression used in the second argument must use a restricted set of operations: basically, those that do downward selection of values within a container.</p>
<h2>Further Operations</h2>
<p>I've illustrated the benefits with one particular operation, a modify() function, but the feature opens up many other possibilities as well. Here are a few:</p>
<ul>
<li>For pinned values we can expose the container and slot properties through functions (or through custom syntax such as axes). For example this means that in XSLT, if you are doing a recursive traversal of a JTree, a template rule for processing a particular value has access to its ancestors in the same way as is possible for XTrees.</li>
<li>In addition derived properties of a pinned value can be exposed, for example the preceding and following "siblings" within an array (or indeed, within a sequence).</li>
</ul>
<p>I'll explore some additional use cases in further posts.</p>
</div></details></div>
<div class="toot" id="created-595"><h2>Pull request #595 created<span class="toot-id"> #created-595</span></h2><div class="pubdate">04 Jul at 21:31:43 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/595">https://github.com/qt4cg/qtspecs/pull/595</a></div><details><summary>588: (Editorial, XSLT) minor clarifications regarding xsl:sort</summary><div class="markup"><p>The main issue turned out to be spurious; there is in fact an explanation of the order attribute in the right place. But I made a couple of other minor editorial changes, including dropping the default for @data-type in the (non-normative) schema for XSLT 4.0 - the default of <code>data-type="text"</code> is inappropriate because it forces conversion, e.g. of dates to strings, and the default should be no conversion.</p>
<p>Fix #588.</p>
</div></details></div>
<div class="toot" id="created-594"><h2>Pull request #594 created<span class="toot-id"> #created-594</span></h2><div class="pubdate">04 Jul at 21:05:59 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/594">https://github.com/qt4cg/qtspecs/pull/594</a></div><details><summary>592: (XSLT, Editorial) Add missing description of exponent-separator</summary><div class="markup"><p>Fix #592</p>
</div></details></div>
<div class="toot" id="created-593"><h2>Pull request #593 created<span class="toot-id"> #created-593</span></h2><div class="pubdate">04 Jul at 15:40:45 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/593">https://github.com/qt4cg/qtspecs/pull/593</a></div><details><summary>591: [XSLT, editorial] Add defaults to XSLT element syntax summaries</summary><div class="markup"><p>Fix #591. Add default values to e:attribute entries in the XSLT syntax summaries; change the DTD to allow these; change the stylesheet to render them; add a paragraph to the Notation section to explain the conventions.</p>
</div></details></div>
<div class="toot" id="created-592"><h2>Issue #592 created<span class="toot-id"> #created-592</span></h2><div class="pubdate">04 Jul at 15:38:28 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/592">https://github.com/qt4cg/qtspecs/issues/592</a></div><details><summary>XSLT §5.6 xsl:decimal-format - no explanation of exponent-separator</summary><div class="markup"><p>This problem is inherited from XSLT 3.0</p>
<p>Section 5.6 gives a brief description of the purpose of every attribute of <code>xsl:decimal-format</code>, with the exception of <code>exponent-separator</code>.</p>
</div></details></div></div><p>See 1088
            more statuses in yearly archives.</p></article></main></body></html>