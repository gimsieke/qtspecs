<item>
   <title>Issue #356 created</title>
   <pubDate>2023-02-18T00:21:40Z</pubDate>
   <link>https://github.com/qt4cg/qtspecs/issues/356</link>
   <guid>https://qt4cg.org/@qt4cg/2023/#created-356</guid>
   <description>&lt;div&gt;&lt;p&gt;array:leaves&lt;/p&gt;&lt;div class="markup"&gt;&lt;h1&gt;1. Issues&lt;/h1&gt;
&lt;p&gt;There are at least two issues with the definition of the function &lt;a href="https://qt4cg.org/specifications/xpath-functions-40/Overview-diff.html#func-array-flatten"&gt;&lt;strong&gt;&lt;code&gt;array:flatten&lt;/code&gt;&lt;/strong&gt;&lt;/a&gt;:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;Unlike most other functions on arrays (such as &lt;strong&gt;&lt;a href="https://qt4cg.org/specifications/xpath-functions-40/Overview-diff.html#func-array-put"&gt;array:put&lt;/a&gt;, &lt;a href="https://qt4cg.org/specifications/xpath-functions-40/Overview-diff.html#func-array-replace"&gt;array:replace&lt;/a&gt;, &lt;a href="https://qt4cg.org/specifications/xpath-functions-40/Overview-diff.html#func-array-append"&gt;array:append&lt;/a&gt;, &lt;a href="https://qt4cg.org/specifications/xpath-functions-40/Overview-diff.html#func-array-slice"&gt;array:slice&lt;/a&gt;, &lt;a href="https://qt4cg.org/specifications/xpath-functions-40/Overview-diff.html#func-array-subarray"&gt;array:subarray&lt;/a&gt;, &lt;a href="https://qt4cg.org/specifications/xpath-functions-40/Overview-diff.html#func-array-remove"&gt;array:remove&lt;/a&gt;, &lt;a href="https://qt4cg.org/specifications/xpath-functions-40/Overview-diff.html#func-array-insert-before"&gt;array:insert-before&lt;/a&gt;, &lt;a href="https://qt4cg.org/specifications/xpath-functions-40/Overview-diff.html#func-array-tail"&gt;array:tail&lt;/a&gt;, &lt;a href="https://qt4cg.org/specifications/xpath-functions-40/Overview-diff.html#func-array-trunk"&gt;array:trunk&lt;/a&gt;, &lt;a href="https://qt4cg.org/specifications/xpath-functions-40/Overview-diff.html#func-array-reverse"&gt;array:reverse&lt;/a&gt;, &lt;a href="https://qt4cg.org/specifications/xpath-functions-40/Overview-diff.html#func-array-join"&gt;array:join&lt;/a&gt;, &lt;a href="https://qt4cg.org/specifications/xpath-functions-40/Overview-diff.html#func-array-for-each"&gt;array:for-each&lt;/a&gt;, &lt;a href="https://qt4cg.org/specifications/xpath-functions-40/Overview-diff.html#func-array-filter"&gt;array:filter&lt;/a&gt;, &lt;a href="https://qt4cg.org/specifications/xpath-functions-40/Overview-diff.html#func-array-for-each-pair"&gt;array:for-each-pair&lt;/a&gt;, &lt;a href="https://qt4cg.org/specifications/xpath-functions-40/Overview-diff.html#func-array-sort"&gt;array:sort&lt;/a&gt;, &lt;a href="https://qt4cg.org/specifications/xpath-functions-40/Overview-diff.html#func-array-partition"&gt;array:partition&lt;/a&gt;&lt;/strong&gt;) , which produce an array as their result, &lt;strong&gt;this function produces only a sequence&lt;/strong&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;This function is not lossless&lt;/strong&gt; -- any members that are the empty sequence or the empty array are not represented in the returned result.&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;h1&gt;2. Suggested solution(s)&lt;/h1&gt;
&lt;p&gt;We want to have a function that is similar to the wrongly defined one, but produces its contents as an array, and is lossless. There are two obvious ways to do this:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;Correct the specification of   &lt;strong&gt;&lt;a href="https://qt4cg.org/specifications/xpath-functions-40/Overview-diff.html#func-array-flatten"&gt;&lt;code&gt;array:flatten&lt;/code&gt;&lt;/a&gt;&lt;/strong&gt; so that its result is an array and it represents the empty sequences and empty arrays as the same members of its result.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Add to the Specification a new function: &lt;strong&gt;&lt;code&gt;array:leaves&lt;/code&gt;&lt;/strong&gt; that produces an array as its result and that is lossless.
&lt;strong&gt;array:leaves&lt;/strong&gt; returns an array whose members are exactly all the leaves of the input array, by the order of their appearance. By definition leaves are all, and at any depth, members that are not an array except when they are the empty array. Thus () (the empty sequence) and [] (the empty array) are leaves by definition.&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;&lt;strong&gt;&lt;em&gt;Solution 2. will not cause any compatibility issues&lt;/em&gt;&lt;/strong&gt;.&lt;/p&gt;
&lt;h1&gt;3. Examples&lt;/h1&gt;
&lt;p&gt;The expression &lt;strong&gt;&lt;code&gt;array:leaves([1, (), [4, 6], 5, 3])&lt;/code&gt;&lt;/strong&gt; returns &lt;strong&gt;&lt;code&gt;[1, (),  4, 6, 5, 3]&lt;/code&gt;&lt;/strong&gt;.&lt;/p&gt;
&lt;p&gt;The expression &lt;strong&gt;&lt;code&gt;array:leaves([1, 2, 5], [[10, 11], 12], [], 13)&lt;/code&gt;&lt;/strong&gt; returns &lt;strong&gt;&lt;code&gt;[1, 2, 5, 10, 11, 12, [], 13]&lt;/code&gt;&lt;/strong&gt;.&lt;/p&gt;
&lt;/div&gt;&lt;/div&gt;</description>
</item>
