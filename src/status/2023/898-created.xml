<item>
   <title>Issue #898 created</title>
   <pubDate>2023-12-13T10:04:04Z</pubDate>
   <link>https://github.com/qt4cg/qtspecs/issues/898</link>
   <guid>https://qt4cg.org/@qt4cg/2023/#created-898</guid>
   <description>&lt;div&gt;&lt;p&gt;Drop the requirement for document-uri() uniqueness&lt;/p&gt;&lt;div class="markup"&gt;&lt;p&gt;The specification of document-uri() states that the returned URI must be useable as input to the doc() function and that it always round-trips, so &lt;code&gt;doc(document-uri($X)) is $X&lt;/code&gt; is guaranteed true.&lt;/p&gt;
&lt;p&gt;A consequence of this rule is that you can't have two documents in the same execution scope with the same document-uri() property.&lt;/p&gt;
&lt;p&gt;Enforcing this rule causes a lot of trouble. For example at the API level, the user can set two stylesheet or query parameters to two different documents that are associated with the same URI. Another example, two XSLT packages in the same stylesheet can call doc() on the same URI and get different documents back because they have set different validation and whitespace-stripping options. Use of &lt;code&gt;fn:transform()&lt;/code&gt; causes further complications when documents are passed across the boundary (in fact that's where we first encountered the problem). And &lt;code&gt;collection()&lt;/code&gt; brings further complications.&lt;/p&gt;
&lt;p&gt;In order to conform to the rule in the spec, we changed Saxon a while back so the only documents that are guaranteed to have a document-uri() property are those that were read using the doc() function - and even then, things like validation and whitespace variations are troublesome. This causes users much confusion, partly, because of the change from earlier Saxon releases, but more because there are many situations where they would expect document-uri() to give a useful result and it doesn't.&lt;/p&gt;
&lt;p&gt;I think we can fix this simply by removing the guarantee. That will cause less inconvenience to users than the current rule. We could perhaps modify it to say that in the case of a document returned from the doc() function, its document-uri() property will be such that a call to doc() with that URI will return the same document, but in the case of documents derived from other sources (for example &lt;code&gt;collection()&lt;/code&gt;, or a result from &lt;code&gt;fn:transform&lt;/code&gt;) there is no such guarantee.&lt;/p&gt;
&lt;/div&gt;&lt;/div&gt;</description>
</item>
