<item>
   <title>Issue #1014 created</title>
   <pubDate>2024-02-08T13:43:32Z</pubDate>
   <link>https://github.com/qt4cg/qtspecs/issues/1014</link>
   <guid>https://qt4cg.org/@qt4cg/2024/#created-1014</guid>
   <description>&lt;div&gt;&lt;p&gt;Predicates, sequences of numbers: Feedback&lt;/p&gt;&lt;div class="markup"&gt;&lt;p&gt;Feedback on #996:&lt;/p&gt;
&lt;h3&gt;Successful result: early exit&lt;/h3&gt;
&lt;p&gt;If the EBV is computed, and if the first item is a node, the remaining items are ignored:&lt;/p&gt;
&lt;pre&gt;&lt;code class="language-xquery"&gt;'OK'[ &amp;lt;a/&amp;gt;, 1, 'x' ]  →  'OK'
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;I would suggest doing the same for predicates that start with a number:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;If a comparison is successful, an implementation should be allowed to skip the remaining comparisons.&lt;/li&gt;
&lt;li&gt;If &lt;code&gt;$seq&lt;/code&gt; starts with a number, &lt;code&gt;E[$seq]&lt;/code&gt; and &lt;code&gt;E[position() = $seq]&lt;/code&gt; will become equivalent:&lt;/li&gt;
&lt;/ul&gt;
&lt;pre&gt;&lt;code class="language-xquery"&gt;$seq[1 to 100, 'x']
$seq[position() = (1 to 100, 'x')]
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Obviously, an error still needs to be raised if a comparisons leads to a type error.&lt;/p&gt;
&lt;h3&gt;Error Codes&lt;/h3&gt;
&lt;p&gt;If we don’t equate &lt;code&gt;E[$seq]&lt;/code&gt; and &lt;code&gt;E[position() = $seq]&lt;/code&gt;, it would be useful to stick with &lt;code&gt;FORG0006&lt;/code&gt; (instead of &lt;code&gt;XPTY0004&lt;/code&gt;) [1]:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;It would be confusing to get &lt;code&gt;FORG0006&lt;/code&gt; for &lt;code&gt;E['x', 1]&lt;/code&gt; and &lt;code&gt;XPTY0004&lt;/code&gt; for &lt;code&gt;E[1, 'x']&lt;/code&gt;.&lt;/li&gt;
&lt;li&gt;If a processor uses unified implementations for EBV and predicate checks, it leads to additional effort just because the error code differs.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;If we use different error codes, existing tests need to be revised ([2], maybe others).&lt;/p&gt;
&lt;p&gt;[1] https://github.com/qt4cg/qtspecs/pull/996/files#diff-b37a92a9eb3ab9ba48a00de9627a1124466b9c86ecb2b4989d04be3942c597a6R8240
[2] https://github.com/qt4cg/qt4tests/blob/70e52c690a26bbeee0641af14ccb319a2cc98081/prod/Predicate.xml#L1158-L1165&lt;/p&gt;
&lt;/div&gt;&lt;/div&gt;</description>
</item>
